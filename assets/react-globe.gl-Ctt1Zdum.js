import{r as e,R as t,O as r,V as n,M as i,a as o,C as s,G as a,b as A,S as l,c as u,F as c,d as h,T as d,e as p,B as f,f as m,g,I as y,h as b,i as v,j as _,k as x,l as w,m as T,H as S,N as E,n as M,P as N,o as C,p as R,L as P,q as D,s as B,t as q,u as O,v as L,D as k,W as I,w as F,x as U,y as V,z as G,A as j,E as z,J as H,K as W,Q,U as $,X as Y,Y as X,Z as K,_ as Z,$ as J,a0 as ee,a1 as te,a2 as re,a3 as ne,a4 as ie,a5 as oe,a6 as se,a7 as ae,a8 as Ae,a9 as le,aa as ue,ab as ce,ac as he,ad as de,ae as pe,af as fe,ag as me,ah as ge,ai as ye,aj as be,ak as ve,al as _e,am as xe,an as we,ao as Te,ap as Se,aq as Ee,ar as Me,as as Ne,at as Ce,au as Re,av as Pe,aw as De,ax as Be,ay as qe,az as Oe,aA as Le,aB as ke,aC as Ie,aD as Fe,aE as Ue,aF as Ve,aG as Ge,aH as je,aI as ze,aJ as He,aK as We,aL as Qe,aM as $e,aN as Ye,aO as Xe,aP as Ke,aQ as Ze,aR as Je,aS as et,aT as tt,aU as rt,aV as nt,aW as it,aX as ot,aY as st,aZ as at,a_ as At,a$ as lt,b0 as ut,b1 as ct,b2 as ht,b3 as dt,b4 as pt,b5 as ft,b6 as mt,b7 as gt,b8 as yt,b9 as bt,ba as vt,bb as _t,bc as xt,bd as wt,be as Tt,bf as St,bg as Et,bh as Mt,bi as Nt,bj as Ct,bk as Rt,bl as Pt,bm as Dt,bn as Bt,bo as qt,bp as Ot,bq as Lt,br as kt,bs as It,bt as Ft,bu as Ut,bv as Vt,bw as Gt,bx as jt,by as zt,bz as Ht,bA as Wt,bB as Qt,bC as $t,bD as Yt,bE as Xt,bF as Kt,bG as Zt,bH as Jt,bI as er,bJ as tr,bK as rr,bL as nr,bM as ir,bN as or,bO as sr,bP as ar,bQ as Ar,bR as lr,bS as ur,bT as cr,bU as hr,bV as dr,bW as pr,bX as fr,bY as mr,bZ as gr,b_ as yr,b$ as br,c0 as vr,c1 as _r,c2 as xr,c3 as wr,c4 as Tr,c5 as Sr,c6 as Er,c7 as Mr,c8 as Nr,c9 as Cr,ca as Rr,cb as Pr,cc as Dr,cd as Br,ce as qr,cf as Or,cg as Lr,ch as kr,ci as Ir,cj as Fr,ck as Ur,cl as Vr,cm as Gr,cn as jr,co as zr,cp as Hr,cq as Wr,cr as Qr,cs as $r,ct as Yr,cu as Xr,cv as Kr,cw as Zr,cx as Jr,cy as en,cz as tn,cA as rn,cB as nn,cC as on,cD as sn,cE as an,cF as An,cG as ln,cH as un,cI as cn,cJ as hn,cK as dn,cL as pn,cM as fn,cN as mn,cO as gn,cP as yn,cQ as bn,cR as vn,cS as _n,cT as xn,cU as wn,cV as Tn,cW as Sn,cX as En,cY as Mn,cZ as Nn,c_ as Cn,c$ as Rn,d0 as Pn,d1 as Dn,d2 as Bn,d3 as qn,d4 as On,d5 as Ln,d6 as kn,d7 as In,d8 as Fn,d9 as Un,da as Vn,db as Gn,dc as jn,dd as zn,de as Hn,df as Wn,dg as Qn}from"./index-BfrEUt-M.js";function $n(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;A=!1}else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(u){l=!0,i=u}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||Kn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xn(e){return function(e){if(Array.isArray(e))return Zn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Kn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kn(e,t){if(e){if("string"==typeof e)return Zn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zn(e,t):void 0}}function Zn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Jn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ei(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||ri(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ti(e){return function(e){if(Array.isArray(e))return Jn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ri(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ri(e,t){if(e){if("string"==typeof e)return Jn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Jn(e,t):void 0}}function ni(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.useEffect,n=e.useRef(),i=e.useRef(!1),o=e.useRef(!1),s=ei(e.useState(0),2);s[0];var a=s[1];i.current&&(o.current=!0),r(function(){return i.current||(n.current=t(),i.current=!0),a(function(e){return e+1}),function(){o.current&&n.current&&n.current()}},[])}const ii=new o,oi=new i,si=new i,ai=new o,Ai=new o;function li(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var ui="object"==typeof global&&global&&global.Object===Object&&global,ci="object"==typeof self&&self&&self.Object===Object&&self,hi=ui||ci||Function("return this")(),di=function(){return hi.Date.now()},pi=/\s/;var fi=/^\s+/;function mi(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&pi.test(e.charAt(t)););return t}(e)+1).replace(fi,""):e}var gi=hi.Symbol,yi=Object.prototype,bi=yi.hasOwnProperty,vi=yi.toString,_i=gi?gi.toStringTag:void 0;var xi=Object.prototype.toString;var wi=gi?gi.toStringTag:void 0;function Ti(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":wi&&wi in Object(e)?function(e){var t=bi.call(e,_i),r=e[_i];try{e[_i]=void 0;var n=!0}catch(tH){}var i=vi.call(e);return n&&(t?e[_i]=r:delete e[_i]),i}(e):function(e){return xi.call(e)}(e)}var Si=/^[-+]0x[0-9a-f]+$/i,Ei=/^0b[01]+$/i,Mi=/^0o[0-7]+$/i,Ni=parseInt;function Ci(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==Ti(e)}(e))return NaN;if(li(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=li(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=mi(e);var r=Ei.test(e);return r||Mi.test(e)?Ni(e.slice(2),r?2:8):Si.test(e)?NaN:+e}var Ri=Math.max,Pi=Math.min;function Di(e,t,r){var n,i,o,s,a,A,l=0,u=!1,c=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function d(t){var r=n,o=i;return n=i=void 0,l=t,s=e.apply(o,r)}function p(e){var r=e-A;return void 0===A||r>=t||r<0||c&&e-l>=o}function f(){var e=di();if(p(e))return m(e);a=setTimeout(f,function(e){var r=t-(e-A);return c?Pi(r,o-(e-l)):r}(e))}function m(e){return a=void 0,h&&n?d(e):(n=i=void 0,s)}function g(){var e=di(),r=p(e);if(n=arguments,i=this,A=e,r){if(void 0===a)return function(e){return l=e,a=setTimeout(f,t),u?d(e):s}(A);if(c)return clearTimeout(a),a=setTimeout(f,t),d(A)}return void 0===a&&(a=setTimeout(f,t)),s}return t=Ci(t)||0,li(r)&&(u=!!r.leading,o=(c="maxWait"in r)?Ri(Ci(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h),g.cancel=function(){void 0!==a&&clearTimeout(a),l=0,n=A=i=a=void 0},g.flush=function(){return void 0===a?s:m(di())},g}function Bi(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function qi(e,t,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}function Oi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Bi(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Bi(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Li=qi(function e(t,r){var n=r.default,i=void 0===n?null:n,o=r.triggerUpdate,s=void 0===o||o,a=r.onChange,A=void 0===a?function(e,t){}:a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.defaultVal=i,this.triggerUpdate=s,this.onChange=A});function ki(e){var t=e.stateInit,r=void 0===t?function(){return{}}:t,n=e.props,i=void 0===n?{}:n,o=e.methods,s=void 0===o?{}:o,a=e.aliases,A=void 0===a?{}:a,l=e.init,u=void 0===l?function(){}:l,c=e.update,h=void 0===c?function(){}:c,d=Object.keys(i).map(function(e){return new Li(e,i[e])});return function e(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=!!(this instanceof e?this.constructor:void 0),a=o?n.shift():void 0,l=n[0],c=void 0===l?{}:l,p=Object.assign({},r instanceof Function?r(c):r,{initialised:!1}),f={};function m(e){return g(e,c),y(),m}var g=function(e,t){u.call(m,e,p,t),p.initialised=!0},y=Di(function(){p.initialised&&(h.call(m,p,f),f={})},1);return d.forEach(function(e){m[e.name]=function(e){var t=e.name,r=e.triggerUpdate,n=void 0!==r&&r,i=e.onChange,o=void 0===i?function(e,t){}:i,s=e.defaultVal,a=void 0===s?null:s;return function(e){var r=p[t];if(!arguments.length)return r;var i=void 0===e?a:e;return p[t]=i,o.call(m,i,p,r),!f.hasOwnProperty(t)&&(f[t]=r),n&&y(),m}}(e)}),Object.keys(s).forEach(function(e){m[e]=function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(t=s[e]).call.apply(t,[m,p].concat(n))}}),Object.entries(A).forEach(function(e){var t=Oi(e,2),r=t[0],n=t[1];return m[r]=m[n]}),m.resetProps=function(){return d.forEach(function(e){m[e.name](e.defaultVal)}),m},m.resetProps(),p._rerender=y,o&&a&&m(a),m}}var Ii=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(e){var t=1.70158;return 1===e?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return 0===e?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-Ii.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*Ii.Bounce.In(2*e):.5*Ii.Bounce.Out(2*e-1)+.5}}),generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(2*t,e)/2:(1-Math.pow(2-2*t,e))/2+.5}}}}),Fi=function(){return performance.now()},Ui=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=Fi()),void 0===t&&(t=!1);var r=Object.keys(this._tweens);if(0===r.length)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]],o=!t;i&&!1===i.update(e,o)&&!t&&delete this._tweens[r[n]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),Vi={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),o=Vi.Utils.Linear;return t<0?o(e[0],e[1],n):t>1?o(e[r],e[r-1],r-n):o(e[i],e[i+1>r?r:i+1],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e}}},Gi=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),ji=new Ui,zi=function(){function e(e,t){void 0===t&&(t=ji),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Ii.Linear.None,this._interpolationFunction=Vi.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=Gi.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(e,t){if(void 0===t&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e<0?0:e,this},e.prototype.dynamic=function(e){return void 0===e&&(e=!1),this._isDynamic=e,this},e.prototype.start=function(e,t){if(void 0===e&&(e=Fi()),void 0===t&&(t=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var r in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var n={};for(var i in this._valuesEnd)n[i]=this._valuesEnd[i];this._valuesEnd=n}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},e.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},e.prototype._setupProperties=function(e,t,r,n,i){for(var o in r){var s=e[o],a=Array.isArray(s),A=a?"array":typeof s,l=!a&&Array.isArray(r[o]);if("undefined"!==A&&"function"!==A){if(l){if(0===(m=r[o]).length)continue;for(var u=[s],c=0,h=m.length;c<h;c+=1){var d=this._handleRelativeValue(s,m[c]);if(isNaN(d)){l=!1,console.warn("Found invalid interpolation list. Skipping.");break}u.push(d)}l&&(r[o]=u)}if("object"!==A&&!a||!s||l)(void 0===t[o]||i)&&(t[o]=s),a||(t[o]*=1),n[o]=l?r[o].slice().reverse():t[o]||0;else{t[o]=a?[]:{};var p=s;for(var f in p)t[o][f]=p[f];n[o]=a?[]:{};var m=r[o];if(!this._isDynamic){var g={};for(var f in m)g[f]=m[f];r[o]=m=g}this._setupProperties(p,t[o],m,n[o],i)}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=Fi()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=Fi()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return void 0===e&&(e=ji),this._group=e,this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=Ii.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=Vi.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){var r,n,i=this;if(void 0===e&&(e=Fi()),void 0===t&&(t=!0),this._isPaused)return!0;var o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>o)return!1;t&&this.start(e,!0)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var s=e-this._startTime,a=this._duration+(null!==(r=this._repeatDelayTime)&&void 0!==r?r:this._delayTime),A=this._duration+this._repeat*a,l=function(){if(0===i._duration)return 1;if(s>A)return 1;var e=Math.trunc(s/a),t=s-e*a,r=Math.min(t/i._duration,1);return 0===r&&s===i._duration?1:r}(),u=this._easingFunction(l);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,u),this._onUpdateCallback&&this._onUpdateCallback(this._object,l),0===this._duration||s>=this._duration){if(this._repeat>0){var c=Math.min(Math.trunc((s-this._duration)/a)+1,this._repeat);for(n in isFinite(this._repeat)&&(this._repeat-=c),this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=a*c,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var h=0,d=this._chainedTweens.length;h<d;h++)this._chainedTweens[h].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,r,n){for(var i in r)if(void 0!==t[i]){var o=t[i]||0,s=r[i],a=Array.isArray(e[i]),A=Array.isArray(s);!a&&A?e[i]=this._interpolationFunction(s,n):"object"==typeof s&&s?this._updateProperties(e[i],o,s,n):"number"==typeof(s=this._handleRelativeValue(o,s))&&(e[i]=o+(s-o)*n)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof r?this._valuesStartRepeat[e]+parseFloat(r):this._valuesEnd[e],this._valuesEnd[e]=t},e}();Gi.nextId;var Hi=ji;function Wi(e,t,r,n,i){if(isNaN(t)||isNaN(r)||isNaN(n))return e;var o,s,a,A,l,u,c,h,d,p,f,m,g=e._root,y={data:i},b=e._x0,v=e._y0,_=e._z0,x=e._x1,w=e._y1,T=e._z1;if(!g)return e._root=y,e;for(;g.length;)if((h=t>=(s=(b+x)/2))?b=s:x=s,(d=r>=(a=(v+w)/2))?v=a:w=a,(p=n>=(A=(_+T)/2))?_=A:T=A,o=g,!(g=g[f=p<<2|d<<1|h]))return o[f]=y,e;if(l=+e._x.call(null,g.data),u=+e._y.call(null,g.data),c=+e._z.call(null,g.data),t===l&&r===u&&n===c)return y.next=g,o?o[f]=y:e._root=y,e;do{o=o?o[f]=new Array(8):e._root=new Array(8),(h=t>=(s=(b+x)/2))?b=s:x=s,(d=r>=(a=(v+w)/2))?v=a:w=a,(p=n>=(A=(_+T)/2))?_=A:T=A}while((f=p<<2|d<<1|h)==(m=(c>=A)<<2|(u>=a)<<1|l>=s));return o[m]=g,o[f]=y,e}function Qi(e,t,r,n,i,o,s){this.node=e,this.x0=t,this.y0=r,this.z0=n,this.x1=i,this.y1=o,this.z1=s}Hi.getAll.bind(Hi),Hi.removeAll.bind(Hi),Hi.add.bind(Hi),Hi.remove.bind(Hi),Hi.update.bind(Hi);const $i=(e,t,r,n,i,o)=>Math.sqrt((e-n)**2+(t-i)**2+(r-o)**2);function Yi(e){return e[0]}function Xi(e){return e[1]}function Ki(e){return e[2]}function Zi(e,t,r,n){var i=new Ji(null==t?Yi:t,null==r?Xi:r,null==n?Ki:n,NaN,NaN,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function Ji(e,t,r,n,i,o,s,a,A){this._x=e,this._y=t,this._z=r,this._x0=n,this._y0=i,this._z0=o,this._x1=s,this._y1=a,this._z1=A,this._root=void 0}function eo(e){for(var t={data:e.data},r=t;e=e.next;)r=r.next={data:e.data};return t}var to=Zi.prototype=Ji.prototype;function ro(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function no(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function io(e){let t,r,n;function i(e,n,i=0,o=e.length){if(i<o){if(0!==t(n,n))return o;do{const t=i+o>>>1;r(e[t],n)<0?i=t+1:o=t}while(i<o)}return i}return 2!==e.length?(t=ro,r=(t,r)=>ro(e(t),r),n=(t,r)=>e(t)-r):(t=e===ro||e===no?e:oo,r=e,n=e),{left:i,center:function(e,t,r=0,o=e.length){const s=i(e,t,r,o-1);return s>r&&n(e[s-1],t)>-n(e[s],t)?s-1:s},right:function(e,n,i=0,o=e.length){if(i<o){if(0!==t(n,n))return o;do{const t=i+o>>>1;r(e[t],n)<=0?i=t+1:o=t}while(i<o)}return i}}}function oo(){return 0}to.copy=function(){var e,t,r=new Ji(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),n=this._root;if(!n)return r;if(!n.length)return r._root=eo(n),r;for(e=[{source:n,target:r._root=new Array(8)}];n=e.pop();)for(var i=0;i<8;++i)(t=n.source[i])&&(t.length?e.push({source:t,target:n.target[i]=new Array(8)}):n.target[i]=eo(t));return r},to.add=function(e){const t=+this._x.call(null,e),r=+this._y.call(null,e),n=+this._z.call(null,e);return Wi(this.cover(t,r,n),t,r,n,e)},to.addAll=function(e){Array.isArray(e)||(e=Array.from(e));const t=e.length,r=new Float64Array(t),n=new Float64Array(t),i=new Float64Array(t);let o=1/0,s=1/0,a=1/0,A=-1/0,l=-1/0,u=-1/0;for(let c,h,d,p,f=0;f<t;++f)isNaN(h=+this._x.call(null,c=e[f]))||isNaN(d=+this._y.call(null,c))||isNaN(p=+this._z.call(null,c))||(r[f]=h,n[f]=d,i[f]=p,h<o&&(o=h),h>A&&(A=h),d<s&&(s=d),d>l&&(l=d),p<a&&(a=p),p>u&&(u=p));if(o>A||s>l||a>u)return this;this.cover(o,s,a).cover(A,l,u);for(let c=0;c<t;++c)Wi(this,r[c],n[c],i[c],e[c]);return this},to.cover=function(e,t,r){if(isNaN(e=+e)||isNaN(t=+t)||isNaN(r=+r))return this;var n=this._x0,i=this._y0,o=this._z0,s=this._x1,a=this._y1,A=this._z1;if(isNaN(n))s=(n=Math.floor(e))+1,a=(i=Math.floor(t))+1,A=(o=Math.floor(r))+1;else{for(var l,u,c=s-n||1,h=this._root;n>e||e>=s||i>t||t>=a||o>r||r>=A;)switch(u=(r<o)<<2|(t<i)<<1|e<n,(l=new Array(8))[u]=h,h=l,c*=2,u){case 0:s=n+c,a=i+c,A=o+c;break;case 1:n=s-c,a=i+c,A=o+c;break;case 2:s=n+c,i=a-c,A=o+c;break;case 3:n=s-c,i=a-c,A=o+c;break;case 4:s=n+c,a=i+c,o=A-c;break;case 5:n=s-c,a=i+c,o=A-c;break;case 6:s=n+c,i=a-c,o=A-c;break;case 7:n=s-c,i=a-c,o=A-c}this._root&&this._root.length&&(this._root=h)}return this._x0=n,this._y0=i,this._z0=o,this._x1=s,this._y1=a,this._z1=A,this},to.data=function(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},to.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1],+e[0][2]).cover(+e[1][0],+e[1][1],+e[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},to.find=function(e,t,r,n){var i,o,s,a,A,l,u,c,h,d=this._x0,p=this._y0,f=this._z0,m=this._x1,g=this._y1,y=this._z1,b=[],v=this._root;for(v&&b.push(new Qi(v,d,p,f,m,g,y)),null==n?n=1/0:(d=e-n,p=t-n,f=r-n,m=e+n,g=t+n,y=r+n,n*=n);c=b.pop();)if(!(!(v=c.node)||(o=c.x0)>m||(s=c.y0)>g||(a=c.z0)>y||(A=c.x1)<d||(l=c.y1)<p||(u=c.z1)<f))if(v.length){var _=(o+A)/2,x=(s+l)/2,w=(a+u)/2;b.push(new Qi(v[7],_,x,w,A,l,u),new Qi(v[6],o,x,w,_,l,u),new Qi(v[5],_,s,w,A,x,u),new Qi(v[4],o,s,w,_,x,u),new Qi(v[3],_,x,a,A,l,w),new Qi(v[2],o,x,a,_,l,w),new Qi(v[1],_,s,a,A,x,w),new Qi(v[0],o,s,a,_,x,w)),(h=(r>=w)<<2|(t>=x)<<1|e>=_)&&(c=b[b.length-1],b[b.length-1]=b[b.length-1-h],b[b.length-1-h]=c)}else{var T=e-+this._x.call(null,v.data),S=t-+this._y.call(null,v.data),E=r-+this._z.call(null,v.data),M=T*T+S*S+E*E;if(M<n){var N=Math.sqrt(n=M);d=e-N,p=t-N,f=r-N,m=e+N,g=t+N,y=r+N,i=v.data}}return i},to.findAllWithinRadius=function(e,t,r,n){const i=[],o=e-n,s=t-n,a=r-n,A=e+n,l=t+n,u=r+n;return this.visit((c,h,d,p,f,m,g)=>{if(!c.length)do{const o=c.data;$i(e,t,r,this._x(o),this._y(o),this._z(o))<=n&&i.push(o)}while(c=c.next);return h>A||d>l||p>u||f<o||m<s||g<a}),i},to.remove=function(e){if(isNaN(o=+this._x.call(null,e))||isNaN(s=+this._y.call(null,e))||isNaN(a=+this._z.call(null,e)))return this;var t,r,n,i,o,s,a,A,l,u,c,h,d,p,f,m=this._root,g=this._x0,y=this._y0,b=this._z0,v=this._x1,_=this._y1,x=this._z1;if(!m)return this;if(m.length)for(;;){if((c=o>=(A=(g+v)/2))?g=A:v=A,(h=s>=(l=(y+_)/2))?y=l:_=l,(d=a>=(u=(b+x)/2))?b=u:x=u,t=m,!(m=m[p=d<<2|h<<1|c]))return this;if(!m.length)break;(t[p+1&7]||t[p+2&7]||t[p+3&7]||t[p+4&7]||t[p+5&7]||t[p+6&7]||t[p+7&7])&&(r=t,f=p)}for(;m.data!==e;)if(n=m,!(m=m.next))return this;return(i=m.next)&&delete m.next,n?(i?n.next=i:delete n.next,this):t?(i?t[p]=i:delete t[p],(m=t[0]||t[1]||t[2]||t[3]||t[4]||t[5]||t[6]||t[7])&&m===(t[7]||t[6]||t[5]||t[4]||t[3]||t[2]||t[1]||t[0])&&!m.length&&(r?r[f]=m:this._root=m),this):(this._root=i,this)},to.removeAll=function(e){for(var t=0,r=e.length;t<r;++t)this.remove(e[t]);return this},to.root=function(){return this._root},to.size=function(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},to.visit=function(e){var t,r,n,i,o,s,a,A,l=[],u=this._root;for(u&&l.push(new Qi(u,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=l.pop();)if(!e(u=t.node,n=t.x0,i=t.y0,o=t.z0,s=t.x1,a=t.y1,A=t.z1)&&u.length){var c=(n+s)/2,h=(i+a)/2,d=(o+A)/2;(r=u[7])&&l.push(new Qi(r,c,h,d,s,a,A)),(r=u[6])&&l.push(new Qi(r,n,h,d,c,a,A)),(r=u[5])&&l.push(new Qi(r,c,i,d,s,h,A)),(r=u[4])&&l.push(new Qi(r,n,i,d,c,h,A)),(r=u[3])&&l.push(new Qi(r,c,h,o,s,a,d)),(r=u[2])&&l.push(new Qi(r,n,h,o,c,a,d)),(r=u[1])&&l.push(new Qi(r,c,i,o,s,h,d)),(r=u[0])&&l.push(new Qi(r,n,i,o,c,h,d))}return this},to.visitAfter=function(e){var t,r=[],n=[];for(this._root&&r.push(new Qi(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=r.pop();){var i=t.node;if(i.length){var o,s=t.x0,a=t.y0,A=t.z0,l=t.x1,u=t.y1,c=t.z1,h=(s+l)/2,d=(a+u)/2,p=(A+c)/2;(o=i[0])&&r.push(new Qi(o,s,a,A,h,d,p)),(o=i[1])&&r.push(new Qi(o,h,a,A,l,d,p)),(o=i[2])&&r.push(new Qi(o,s,d,A,h,u,p)),(o=i[3])&&r.push(new Qi(o,h,d,A,l,u,p)),(o=i[4])&&r.push(new Qi(o,s,a,p,h,d,c)),(o=i[5])&&r.push(new Qi(o,h,a,p,l,d,c)),(o=i[6])&&r.push(new Qi(o,s,d,p,h,u,c)),(o=i[7])&&r.push(new Qi(o,h,d,p,l,u,c))}n.push(t)}for(;t=n.pop();)e(t.node,t.x0,t.y0,t.z0,t.x1,t.y1,t.z1);return this},to.x=function(e){return arguments.length?(this._x=e,this):this._x},to.y=function(e){return arguments.length?(this._y=e,this):this._y},to.z=function(e){return arguments.length?(this._z=e,this):this._z};const so=io(ro).right;function ao(e,t){let r,n;if(void 0===t)for(const i of e)null!=i&&(void 0===r?i>=i&&(r=n=i):(r>i&&(r=i),n<i&&(n=i)));else{let i=-1;for(let o of e)null!=(o=t(o,++i,e))&&(void 0===r?o>=o&&(r=n=o):(r>o&&(r=o),n<o&&(n=o)))}return[r,n]}io(function(e){return null===e?NaN:+e}).center;class Ao{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let n=0;n<this._n&&n<32;n++){const i=t[n],o=e+i,s=Math.abs(e)<Math.abs(i)?e-(o-i):i-(o-e);s&&(t[r++]=s),e=o}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t,r,n,i=this._n,o=0;if(i>0){for(o=e[--i];i>0&&(t=o,r=e[--i],o=t+r,n=r-(o-t),!n););i>0&&(n<0&&e[i-1]<0||n>0&&e[i-1]>0)&&(r=2*n,t=o+r,r==t-o&&(o=t))}return o}}const lo=Math.sqrt(50),uo=Math.sqrt(10),co=Math.sqrt(2);function ho(e,t,r){const n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),s=o>=lo?10:o>=uo?5:o>=co?2:1;let a,A,l;return i<0?(l=Math.pow(10,-i)/s,a=Math.round(e*l),A=Math.round(t*l),a/l<e&&++a,A/l>t&&--A,l=-l):(l=Math.pow(10,i)*s,a=Math.round(e/l),A=Math.round(t/l),a*l<e&&++a,A*l>t&&--A),A<a&&.5<=r&&r<2?ho(e,t,2*r):[a,A,l]}function po(e,t,r){return ho(e=+e,t=+t,r=+r)[2]}function fo(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function mo(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=0|Math.max(0,Math.ceil((t-e)/r)),o=new Array(i);++n<i;)o[n]=e+n*r;return o}function go(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function yo(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function bo(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function vo(){}var _o=.7,xo=1/_o,wo="\\s*([+-]?\\d+)\\s*",To="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",So="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Eo=/^#([0-9a-f]{3,8})$/,Mo=new RegExp(`^rgb\\(${wo},${wo},${wo}\\)$`),No=new RegExp(`^rgb\\(${So},${So},${So}\\)$`),Co=new RegExp(`^rgba\\(${wo},${wo},${wo},${To}\\)$`),Ro=new RegExp(`^rgba\\(${So},${So},${So},${To}\\)$`),Po=new RegExp(`^hsl\\(${To},${So},${So}\\)$`),Do=new RegExp(`^hsla\\(${To},${So},${So},${To}\\)$`),Bo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function qo(){return this.rgb().formatHex()}function Oo(){return this.rgb().formatRgb()}function Lo(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Eo.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?ko(t):3===r?new Uo(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?Io(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?Io(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Mo.exec(e))?new Uo(t[1],t[2],t[3],1):(t=No.exec(e))?new Uo(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Co.exec(e))?Io(t[1],t[2],t[3],t[4]):(t=Ro.exec(e))?Io(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Po.exec(e))?Wo(t[1],t[2]/100,t[3]/100,1):(t=Do.exec(e))?Wo(t[1],t[2]/100,t[3]/100,t[4]):Bo.hasOwnProperty(e)?ko(Bo[e]):"transparent"===e?new Uo(NaN,NaN,NaN,0):null}function ko(e){return new Uo(e>>16&255,e>>8&255,255&e,1)}function Io(e,t,r,n){return n<=0&&(e=t=r=NaN),new Uo(e,t,r,n)}function Fo(e,t,r,n){return 1===arguments.length?function(e){return e instanceof vo||(e=Lo(e)),e?new Uo((e=e.rgb()).r,e.g,e.b,e.opacity):new Uo}(e):new Uo(e,t,r,null==n?1:n)}function Uo(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function Vo(){return`#${Ho(this.r)}${Ho(this.g)}${Ho(this.b)}`}function Go(){const e=jo(this.opacity);return`${1===e?"rgb(":"rgba("}${zo(this.r)}, ${zo(this.g)}, ${zo(this.b)}${1===e?")":`, ${e})`}`}function jo(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function zo(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ho(e){return((e=zo(e))<16?"0":"")+e.toString(16)}function Wo(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new $o(e,t,r,n)}function Qo(e){if(e instanceof $o)return new $o(e.h,e.s,e.l,e.opacity);if(e instanceof vo||(e=Lo(e)),!e)return new $o;if(e instanceof $o)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,a=o-i,A=(o+i)/2;return a?(s=t===o?(r-n)/a+6*(r<n):r===o?(n-t)/a+2:(t-r)/a+4,a/=A<.5?o+i:2-o-i,s*=60):a=A>0&&A<1?0:s,new $o(s,a,A,e.opacity)}function $o(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function Yo(e){return(e=(e||0)%360)<0?e+360:e}function Xo(e){return Math.max(0,Math.min(1,e||0))}function Ko(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}yo(vo,Lo,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:qo,formatHex:qo,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Qo(this).formatHsl()},formatRgb:Oo,toString:Oo}),yo(Uo,Fo,bo(vo,{brighter(e){return e=null==e?xo:Math.pow(xo,e),new Uo(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?_o:Math.pow(_o,e),new Uo(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Uo(zo(this.r),zo(this.g),zo(this.b),jo(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Vo,formatHex:Vo,formatHex8:function(){return`#${Ho(this.r)}${Ho(this.g)}${Ho(this.b)}${Ho(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Go,toString:Go})),yo($o,function(e,t,r,n){return 1===arguments.length?Qo(e):new $o(e,t,r,null==n?1:n)},bo(vo,{brighter(e){return e=null==e?xo:Math.pow(xo,e),new $o(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?_o:Math.pow(_o,e),new $o(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Uo(Ko(e>=240?e-240:e+120,i,n),Ko(e,i,n),Ko(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new $o(Yo(this.h),Xo(this.s),Xo(this.l),jo(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=jo(this.opacity);return`${1===e?"hsl(":"hsla("}${Yo(this.h)}, ${100*Xo(this.s)}%, ${100*Xo(this.l)}%${1===e?")":`, ${e})`}`}}));const Zo=e=>()=>e;function Jo(e){return 1===(e=+e)?es:function(t,r){return r-t?function(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}(t,r,e):Zo(isNaN(t)?r:t)}}function es(e,t){var r=t-e;return r?function(e,t){return function(r){return e+r*t}}(e,r):Zo(isNaN(e)?t:e)}const ts=function e(t){var r=Jo(t);function n(e,t){var n=r((e=Fo(e)).r,(t=Fo(t)).r),i=r(e.g,t.g),o=r(e.b,t.b),s=es(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=i(t),e.b=o(t),e.opacity=s(t),e+""}}return n.gamma=e,n}(1);function rs(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function ns(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function is(e,t){return(ns(t)?rs:os)(e,t)}function os(e,t){var r,n=t?t.length:0,i=e?Math.min(n,e.length):0,o=new Array(i),s=new Array(n);for(r=0;r<i;++r)o[r]=hs(e[r],t[r]);for(;r<n;++r)s[r]=t[r];return function(e){for(r=0;r<i;++r)s[r]=o[r](e);return s}}function ss(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function as(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function As(e,t){var r,n={},i={};for(r in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)r in e?n[r]=hs(e[r],t[r]):i[r]=t[r];return function(e){for(r in n)i[r]=n[r](e);return i}}var ls=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,us=new RegExp(ls.source,"g");function cs(e,t){var r,n,i,o=ls.lastIndex=us.lastIndex=0,s=-1,a=[],A=[];for(e+="",t+="";(r=ls.exec(e))&&(n=us.exec(t));)(i=n.index)>o&&(i=t.slice(o,i),a[s]?a[s]+=i:a[++s]=i),(r=r[0])===(n=n[0])?a[s]?a[s]+=n:a[++s]=n:(a[++s]=null,A.push({i:s,x:as(r,n)})),o=us.lastIndex;return o<t.length&&(i=t.slice(o),a[s]?a[s]+=i:a[++s]=i),a.length<2?A[0]?function(e){return function(t){return e(t)+""}}(A[0].x):function(e){return function(){return e}}(t):(t=A.length,function(e){for(var r,n=0;n<t;++n)a[(r=A[n]).i]=r.x(e);return a.join("")})}function hs(e,t){var r,n=typeof t;return null==t||"boolean"===n?Zo(t):("number"===n?as:"string"===n?(r=Lo(t))?(t=r,ts):cs:t instanceof Lo?ts:t instanceof Date?ss:ns(t)?rs:Array.isArray(t)?os:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?As:as)(e,t)}function ds(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function ps(e){return+e}var fs=[0,1];function ms(e){return e}function gs(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function ys(e,t,r){var n=e[0],i=e[1],o=t[0],s=t[1];return i<n?(n=gs(i,n),o=r(s,o)):(n=gs(n,i),o=r(o,s)),function(e){return o(n(e))}}function bs(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),o=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=gs(e[s],e[s+1]),o[s]=r(t[s],t[s+1]);return function(t){var r=so(e,t,1,n)-1;return o[r](i[r](t))}}function vs(){var e,t,r,n,i,o,s=fs,a=fs,A=hs,l=ms;function u(){var e=Math.min(s.length,a.length);return l!==ms&&(l=function(e,t){var r;return e>t&&(r=e,e=t,t=r),function(r){return Math.max(e,Math.min(t,r))}}(s[0],s[e-1])),n=e>2?bs:ys,i=o=null,c}function c(t){return null==t||isNaN(t=+t)?r:(i||(i=n(s.map(e),a,A)))(e(l(t)))}return c.invert=function(r){return l(t((o||(o=n(a,s.map(e),as)))(r)))},c.domain=function(e){return arguments.length?(s=Array.from(e,ps),u()):s.slice()},c.range=function(e){return arguments.length?(a=Array.from(e),u()):a.slice()},c.rangeRound=function(e){return a=Array.from(e),A=ds,u()},c.clamp=function(e){return arguments.length?(l=!!e||ms,u()):l!==ms},c.interpolate=function(e){return arguments.length?(A=e,u()):A},c.unknown=function(e){return arguments.length?(r=e,c):r},function(r,n){return e=r,t=n,u()}}function _s(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function xs(e){return(e=_s(Math.abs(e)))?e[1]:NaN}var ws,Ts=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ss(e){if(!(t=Ts.exec(e)))throw new Error("invalid format: "+e);var t;return new Es({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Es(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Ms(e,t){var r=_s(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}Ss.prototype=Es.prototype,Es.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ns={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Ms(100*e,t),r:Ms,s:function(e,t){var r=_s(e,t);if(!r)return e+"";var n=r[0],i=r[1],o=i-(ws=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=n.length;return o===s?n:o>s?n+new Array(o-s+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+_s(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Cs(e){return e}var Rs,Ps,Ds,Bs=Array.prototype.map,qs=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Os(e){var t,r,n=void 0===e.grouping||void 0===e.thousands?Cs:(t=Bs.call(e.grouping,Number),r=e.thousands+"",function(e,n){for(var i=e.length,o=[],s=0,a=t[0],A=0;i>0&&a>0&&(A+a+1>n&&(a=Math.max(1,n-A)),o.push(e.substring(i-=a,i+a)),!((A+=a+1)>n));)a=t[s=(s+1)%t.length];return o.reverse().join(r)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?Cs:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(Bs.call(e.numerals,String)),A=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function c(e){var t=(e=Ss(e)).fill,r=e.align,c=e.sign,h=e.symbol,d=e.zero,p=e.width,f=e.comma,m=e.precision,g=e.trim,y=e.type;"n"===y?(f=!0,y="g"):Ns[y]||(void 0===m&&(m=12),g=!0,y="g"),(d||"0"===t&&"="===r)&&(d=!0,t="0",r="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",v="$"===h?o:/[%p]/.test(y)?A:"",_=Ns[y],x=/[defgprs%]/.test(y);function w(e){var i,o,A,h=b,w=v;if("c"===y)w=_(e)+w,e="";else{var T=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:_(Math.abs(e),m),g&&(e=function(e){e:for(var t,r=e.length,n=1,i=-1;n<r;++n)switch(e[n]){case".":i=t=n;break;case"0":0===i&&(i=n),t=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),T&&0===+e&&"+"!==c&&(T=!1),h=(T?"("===c?c:l:"-"===c||"("===c?"":c)+h,w=("s"===y?qs[8+ws/3]:"")+w+(T&&"("===c?")":""),x)for(i=-1,o=e.length;++i<o;)if(48>(A=e.charCodeAt(i))||A>57){w=(46===A?s+e.slice(i+1):e.slice(i))+w,e=e.slice(0,i);break}}f&&!d&&(e=n(e,1/0));var S=h.length+e.length+w.length,E=S<p?new Array(p-S+1).join(t):"";switch(f&&d&&(e=n(E+e,E.length?p-w.length:1/0),E=""),r){case"<":e=h+e+w+E;break;case"=":e=h+E+e+w;break;case"^":e=E.slice(0,S=E.length>>1)+h+e+w+E.slice(S);break;default:e=E+h+e+w}return a(e)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),w.toString=function(){return e+""},w}return{format:c,formatPrefix:function(e,t){var r=c(((e=Ss(e)).type="f",e)),n=3*Math.max(-8,Math.min(8,Math.floor(xs(t)/3))),i=Math.pow(10,-n),o=qs[8+n/3];return function(e){return r(i*e)+o}}}}function Ls(e,t,r,n){var i,o=function(e,t,r){r=+r;const n=(t=+t)<(e=+e),i=n?po(t,e,r):po(e,t,r);return(n?-1:1)*(i<0?1/-i:i)}(e,t,r);switch((n=Ss(null==n?",f":n)).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null!=n.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(xs(t)/3)))-xs(Math.abs(e)))}(o,s))||(n.precision=i),Ds(n,s);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,xs(t)-xs(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(n.precision=i-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(i=function(e){return Math.max(0,-xs(Math.abs(e)))}(o))||(n.precision=i-2*("%"===n.type))}return Ps(n)}function ks(e){var t=e.domain;return e.ticks=function(e){var r=t();return function(e,t,r){if(!((r=+r)>0))return[];if((e=+e)===(t=+t))return[e];const n=t<e,[i,o,s]=n?ho(t,e,r):ho(e,t,r);if(!(o>=i))return[];const a=o-i+1,A=new Array(a);if(n)if(s<0)for(let l=0;l<a;++l)A[l]=(o-l)/-s;else for(let l=0;l<a;++l)A[l]=(o-l)*s;else if(s<0)for(let l=0;l<a;++l)A[l]=(i+l)/-s;else for(let l=0;l<a;++l)A[l]=(i+l)*s;return A}(r[0],r[r.length-1],null==e?10:e)},e.tickFormat=function(e,r){var n=t();return Ls(n[0],n[n.length-1],null==e?10:e,r)},e.nice=function(r){null==r&&(r=10);var n,i,o=t(),s=0,a=o.length-1,A=o[s],l=o[a],u=10;for(l<A&&(i=A,A=l,l=i,i=s,s=a,a=i);u-- >0;){if((i=po(A,l,r))===n)return o[s]=A,o[a]=l,t(o);if(i>0)A=Math.floor(A/i)*i,l=Math.ceil(l/i)*i;else{if(!(i<0))break;A=Math.ceil(A*i)/i,l=Math.floor(l*i)/i}n=i}return e},e}function Is(){var e=vs()(ms,ms);return e.copy=function(){return t=e,Is().domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown());var t},go.apply(e,arguments),ks(e)}function Fs(){var e,t=0,r=1,n=1,i=[.5],o=[0,1];function s(t){return null!=t&&t<=t?o[so(i,t,0,n)]:e}function a(){var e=-1;for(i=new Array(n);++e<n;)i[e]=((e+1)*r-(e-n)*t)/(n+1);return s}return s.domain=function(e){return arguments.length?([t,r]=e,t=+t,r=+r,a()):[t,r]},s.range=function(e){return arguments.length?(n=(o=Array.from(e)).length-1,a()):o.slice()},s.invertExtent=function(e){var s=o.indexOf(e);return s<0?[NaN,NaN]:s<1?[t,i[0]]:s>=n?[i[n-1],r]:[i[s-1],i[s]]},s.unknown=function(t){return arguments.length?(e=t,s):s},s.thresholds=function(){return i.slice()},s.copy=function(){return Fs().domain([t,r]).range(o).unknown(e)},go.apply(ks(s),arguments)}Rs=Os({thousands:",",grouping:[3],currency:["$",""]}),Ps=Rs.format,Ds=Rs.formatPrefix;var Us=1e-6,Vs=1e-12,Gs=Math.PI,js=Gs/2,zs=Gs/4,Hs=2*Gs,Ws=180/Gs,Qs=Gs/180,$s=Math.abs,Ys=Math.atan,Xs=Math.atan2,Ks=Math.cos,Zs=Math.ceil,Js=Math.exp,ea=Math.hypot,ta=Math.log,ra=Math.sin,na=Math.sign||function(e){return e>0?1:e<0?-1:0},ia=Math.sqrt,oa=Math.tan;function sa(e){return e>1?js:e<-1?-js:Math.asin(e)}function aa(e){return(e=ra(e/2))*e}function Aa(){}function la(e,t){e&&ca.hasOwnProperty(e.type)&&ca[e.type](e,t)}var ua={Feature:function(e,t){la(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)la(r[n].geometry,t)}},ca={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){ha(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)ha(r[n],t,0)},Polygon:function(e,t){da(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)da(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)la(r[n],t)}};function ha(e,t,r){var n,i=-1,o=e.length-r;for(t.lineStart();++i<o;)n=e[i],t.point(n[0],n[1],n[2]);t.lineEnd()}function da(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)ha(e[r],t,1);t.polygonEnd()}function pa(e,t){e&&ua.hasOwnProperty(e.type)?ua[e.type](e,t):la(e,t)}var fa,ma,ga,ya,ba,va,_a,xa,wa,Ta,Sa,Ea,Ma,Na,Ca,Ra,Pa=new Ao,Da=new Ao,Ba={point:Aa,lineStart:Aa,lineEnd:Aa,polygonStart:function(){Pa=new Ao,Ba.lineStart=qa,Ba.lineEnd=Oa},polygonEnd:function(){var e=+Pa;Da.add(e<0?Hs+e:e),this.lineStart=this.lineEnd=this.point=Aa},sphere:function(){Da.add(Hs)}};function qa(){Ba.point=La}function Oa(){ka(fa,ma)}function La(e,t){Ba.point=ka,fa=e,ma=t,ga=e*=Qs,ya=Ks(t=(t*=Qs)/2+zs),ba=ra(t)}function ka(e,t){var r=(e*=Qs)-ga,n=r>=0?1:-1,i=n*r,o=Ks(t=(t*=Qs)/2+zs),s=ra(t),a=ba*s,A=ya*o+a*Ks(i),l=a*n*ra(i);Pa.add(Xs(l,A)),ga=e,ya=o,ba=s}function Ia(e){return[Xs(e[1],e[0]),sa(e[2])]}function Fa(e){var t=e[0],r=e[1],n=Ks(r);return[n*Ks(t),n*ra(t),ra(r)]}function Ua(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Va(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Ga(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function ja(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function za(e){var t=ia(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ha,Wa,Qa,$a,Ya,Xa,Ka,Za,Ja,eA,tA,rA,nA,iA,oA,sA,aA={point:AA,lineStart:uA,lineEnd:cA,polygonStart:function(){aA.point=hA,aA.lineStart=dA,aA.lineEnd=pA,Na=new Ao,Ba.polygonStart()},polygonEnd:function(){Ba.polygonEnd(),aA.point=AA,aA.lineStart=uA,aA.lineEnd=cA,Pa<0?(va=-(xa=180),_a=-(wa=90)):Na>Us?wa=90:Na<-1e-6&&(_a=-90),Ra[0]=va,Ra[1]=xa},sphere:function(){va=-(xa=180),_a=-(wa=90)}};function AA(e,t){Ca.push(Ra=[va=e,xa=e]),t<_a&&(_a=t),t>wa&&(wa=t)}function lA(e,t){var r=Fa([e*Qs,t*Qs]);if(Ma){var n=Va(Ma,r),i=Va([n[1],-n[0],0],n);za(i),i=Ia(i);var o,s=e-Ta,a=s>0?1:-1,A=i[0]*Ws*a,l=$s(s)>180;l^(a*Ta<A&&A<a*e)?(o=i[1]*Ws)>wa&&(wa=o):l^(a*Ta<(A=(A+360)%360-180)&&A<a*e)?(o=-i[1]*Ws)<_a&&(_a=o):(t<_a&&(_a=t),t>wa&&(wa=t)),l?e<Ta?fA(va,e)>fA(va,xa)&&(xa=e):fA(e,xa)>fA(va,xa)&&(va=e):xa>=va?(e<va&&(va=e),e>xa&&(xa=e)):e>Ta?fA(va,e)>fA(va,xa)&&(xa=e):fA(e,xa)>fA(va,xa)&&(va=e)}else Ca.push(Ra=[va=e,xa=e]);t<_a&&(_a=t),t>wa&&(wa=t),Ma=r,Ta=e}function uA(){aA.point=lA}function cA(){Ra[0]=va,Ra[1]=xa,aA.point=AA,Ma=null}function hA(e,t){if(Ma){var r=e-Ta;Na.add($s(r)>180?r+(r>0?360:-360):r)}else Sa=e,Ea=t;Ba.point(e,t),lA(e,t)}function dA(){Ba.lineStart()}function pA(){hA(Sa,Ea),Ba.lineEnd(),$s(Na)>Us&&(va=-(xa=180)),Ra[0]=va,Ra[1]=xa,Ma=null}function fA(e,t){return(t-=e)<0?t+360:t}function mA(e,t){return e[0]-t[0]}function gA(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function yA(e){var t,r,n,i,o,s,a;if(wa=xa=-(va=_a=1/0),Ca=[],pa(e,aA),r=Ca.length){for(Ca.sort(mA),t=1,o=[n=Ca[0]];t<r;++t)gA(n,(i=Ca[t])[0])||gA(n,i[1])?(fA(n[0],i[1])>fA(n[0],n[1])&&(n[1]=i[1]),fA(i[0],n[1])>fA(n[0],n[1])&&(n[0]=i[0])):o.push(n=i);for(s=-1/0,t=0,n=o[r=o.length-1];t<=r;n=i,++t)i=o[t],(a=fA(n[1],i[0]))>s&&(s=a,va=i[0],xa=n[1])}return Ca=Ra=null,va===1/0||_a===1/0?[[NaN,NaN],[NaN,NaN]]:[[va,_a],[xa,wa]]}var bA={sphere:Aa,point:vA,lineStart:xA,lineEnd:SA,polygonStart:function(){bA.lineStart=EA,bA.lineEnd=MA},polygonEnd:function(){bA.lineStart=xA,bA.lineEnd=SA}};function vA(e,t){e*=Qs;var r=Ks(t*=Qs);_A(r*Ks(e),r*ra(e),ra(t))}function _A(e,t,r){++Ha,Qa+=(e-Qa)/Ha,$a+=(t-$a)/Ha,Ya+=(r-Ya)/Ha}function xA(){bA.point=wA}function wA(e,t){e*=Qs;var r=Ks(t*=Qs);iA=r*Ks(e),oA=r*ra(e),sA=ra(t),bA.point=TA,_A(iA,oA,sA)}function TA(e,t){e*=Qs;var r=Ks(t*=Qs),n=r*Ks(e),i=r*ra(e),o=ra(t),s=Xs(ia((s=oA*o-sA*i)*s+(s=sA*n-iA*o)*s+(s=iA*i-oA*n)*s),iA*n+oA*i+sA*o);Wa+=s,Xa+=s*(iA+(iA=n)),Ka+=s*(oA+(oA=i)),Za+=s*(sA+(sA=o)),_A(iA,oA,sA)}function SA(){bA.point=vA}function EA(){bA.point=NA}function MA(){CA(rA,nA),bA.point=vA}function NA(e,t){rA=e,nA=t,e*=Qs,t*=Qs,bA.point=CA;var r=Ks(t);iA=r*Ks(e),oA=r*ra(e),sA=ra(t),_A(iA,oA,sA)}function CA(e,t){e*=Qs;var r=Ks(t*=Qs),n=r*Ks(e),i=r*ra(e),o=ra(t),s=oA*o-sA*i,a=sA*n-iA*o,A=iA*i-oA*n,l=ea(s,a,A),u=sa(l),c=l&&-u/l;Ja.add(c*s),eA.add(c*a),tA.add(c*A),Wa+=u,Xa+=u*(iA+(iA=n)),Ka+=u*(oA+(oA=i)),Za+=u*(sA+(sA=o)),_A(iA,oA,sA)}function RA(e){Ha=Wa=Qa=$a=Ya=Xa=Ka=Za=0,Ja=new Ao,eA=new Ao,tA=new Ao,pa(e,bA);var t=+Ja,r=+eA,n=+tA,i=ea(t,r,n);return i<Vs&&(t=Xa,r=Ka,n=Za,Wa<Us&&(t=Qa,r=$a,n=Ya),(i=ea(t,r,n))<Vs)?[NaN,NaN]:[Xs(r,t)*Ws,sa(n/i)*Ws]}function PA(e,t){function r(r,n){return r=e(r,n),t(r[0],r[1])}return e.invert&&t.invert&&(r.invert=function(r,n){return(r=t.invert(r,n))&&e.invert(r[0],r[1])}),r}function DA(e,t){return $s(e)>Gs&&(e-=Math.round(e/Hs)*Hs),[e,t]}function BA(e,t,r){return(e%=Hs)?t||r?PA(OA(e),LA(t,r)):OA(e):t||r?LA(t,r):DA}function qA(e){return function(t,r){return $s(t+=e)>Gs&&(t-=Math.round(t/Hs)*Hs),[t,r]}}function OA(e){var t=qA(e);return t.invert=qA(-e),t}function LA(e,t){var r=Ks(e),n=ra(e),i=Ks(t),o=ra(t);function s(e,t){var s=Ks(t),a=Ks(e)*s,A=ra(e)*s,l=ra(t),u=l*r+a*n;return[Xs(A*i-u*o,a*r-l*n),sa(u*i+A*o)]}return s.invert=function(e,t){var s=Ks(t),a=Ks(e)*s,A=ra(e)*s,l=ra(t),u=l*i-A*o;return[Xs(A*i+l*o,a*r+u*n),sa(u*r-a*n)]},s}function kA(e,t){(t=Fa(t))[0]-=e,za(t);var r=function(e){return e>1?0:e<-1?Gs:Math.acos(e)}(-t[1]);return((-t[2]<0?-r:r)+Hs-Us)%Hs}function IA(){var e,t=[];return{point:function(t,r,n){e.push([t,r,n])},lineStart:function(){t.push(e=[])},lineEnd:Aa,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var r=t;return t=[],e=null,r}}}function FA(e,t){return $s(e[0]-t[0])<Us&&$s(e[1]-t[1])<Us}function UA(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function VA(e,t,r,n,i){var o,s,a=[],A=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,r,n=e[0],s=e[t];if(FA(n,s)){if(!n[2]&&!s[2]){for(i.lineStart(),o=0;o<t;++o)i.point((n=e[o])[0],n[1]);return void i.lineEnd()}s[0]+=2e-6}a.push(r=new UA(n,e,null,!0)),A.push(r.o=new UA(n,null,r,!1)),a.push(r=new UA(s,e,null,!1)),A.push(r.o=new UA(s,null,r,!0))}}),a.length){for(A.sort(t),GA(a),GA(A),o=0,s=A.length;o<s;++o)A[o].e=r=!r;for(var l,u,c=a[0];;){for(var h=c,d=!0;h.v;)if((h=h.n)===c)return;l=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(o=0,s=l.length;o<s;++o)i.point((u=l[o])[0],u[1]);else n(h.x,h.n.x,1,i);h=h.n}else{if(d)for(l=h.p.z,o=l.length-1;o>=0;--o)i.point((u=l[o])[0],u[1]);else n(h.x,h.p.x,-1,i);h=h.p}l=(h=h.o).z,d=!d}while(!h.v);i.lineEnd()}}}function GA(e){if(t=e.length){for(var t,r,n=0,i=e[0];++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function jA(e){return $s(e[0])<=Gs?e[0]:na(e[0])*(($s(e[0])+Gs)%Hs-Gs)}function zA(e,t){var r=jA(t),n=t[1],i=ra(n),o=[ra(r),-Ks(r),0],s=0,a=0,A=new Ao;1===i?n=js+Us:-1===i&&(n=-js-Us);for(var l=0,u=e.length;l<u;++l)if(h=(c=e[l]).length)for(var c,h,d=c[h-1],p=jA(d),f=d[1]/2+zs,m=ra(f),g=Ks(f),y=0;y<h;++y,p=v,m=x,g=w,d=b){var b=c[y],v=jA(b),_=b[1]/2+zs,x=ra(_),w=Ks(_),T=v-p,S=T>=0?1:-1,E=S*T,M=E>Gs,N=m*x;if(A.add(Xs(N*S*ra(E),g*w+N*Ks(E))),s+=M?T+S*Hs:T,M^p>=r^v>=r){var C=Va(Fa(d),Fa(b));za(C);var R=Va(o,C);za(R);var P=(M^T>=0?-1:1)*sa(R[2]);(n>P||n===P&&(C[0]||C[1]))&&(a+=M^T>=0?1:-1)}}return(s<-1e-6||s<Us&&A<-1e-12)^1&a}function HA(e,t,r,n){return function(i){var o,s,a,A=t(i),l=IA(),u=t(l),c=!1,h={point:d,lineStart:f,lineEnd:m,polygonStart:function(){h.point=g,h.lineStart=y,h.lineEnd=b,s=[],o=[]},polygonEnd:function(){h.point=d,h.lineStart=f,h.lineEnd=m,s=fo(s);var e=zA(o,n);s.length?(c||(i.polygonStart(),c=!0),VA(s,QA,e,r,i)):e&&(c||(i.polygonStart(),c=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),c&&(i.polygonEnd(),c=!1),s=o=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(t,r){e(t,r)&&i.point(t,r)}function p(e,t){A.point(e,t)}function f(){h.point=p,A.lineStart()}function m(){h.point=d,A.lineEnd()}function g(e,t){a.push([e,t]),u.point(e,t)}function y(){u.lineStart(),a=[]}function b(){g(a[0][0],a[0][1]),u.lineEnd();var e,t,r,n,A=u.clean(),h=l.result(),d=h.length;if(a.pop(),o.push(a),a=null,d)if(1&A){if((t=(r=h[0]).length-1)>0){for(c||(i.polygonStart(),c=!0),i.lineStart(),e=0;e<t;++e)i.point((n=r[e])[0],n[1]);i.lineEnd()}}else d>1&&2&A&&h.push(h.pop().concat(h.shift())),s.push(h.filter(WA))}return h}}function WA(e){return e.length>1}function QA(e,t){return((e=e.x)[0]<0?e[1]-js-Us:js-e[1])-((t=t.x)[0]<0?t[1]-js-Us:js-t[1])}DA.invert=DA;const $A=HA(function(){return!0},function(e){var t,r=NaN,n=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(o,s){var a=o>0?Gs:-Gs,A=$s(o-r);$s(A-Gs)<Us?(e.point(r,n=(n+s)/2>0?js:-js),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(o,n),t=0):i!==a&&A>=Gs&&($s(r-i)<Us&&(r-=i*Us),$s(o-a)<Us&&(o-=a*Us),n=function(e,t,r,n){var i,o,s=ra(e-r);return $s(s)>Us?Ys((ra(t)*(o=Ks(n))*ra(r)-ra(n)*(i=Ks(t))*ra(e))/(i*o*s)):(t+n)/2}(r,n,o,s),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),t=0),e.point(r=o,n=s),i=a},lineEnd:function(){e.lineEnd(),r=n=NaN},clean:function(){return 2-t}}},function(e,t,r,n){var i;if(null==e)i=r*js,n.point(-Gs,i),n.point(0,i),n.point(Gs,i),n.point(Gs,0),n.point(Gs,-i),n.point(0,-i),n.point(-Gs,-i),n.point(-Gs,0),n.point(-Gs,i);else if($s(e[0]-t[0])>Us){var o=e[0]<t[0]?Gs:-Gs;i=r*o/2,n.point(-o,i),n.point(0,i),n.point(o,i)}else n.point(t[0],t[1])},[-Gs,-js]);function YA(e){var t=Ks(e),r=2*Qs,n=t>0,i=$s(t)>Us;function o(e,r){return Ks(e)*Ks(r)>t}function s(e,r,n){var i=[1,0,0],o=Va(Fa(e),Fa(r)),s=Ua(o,o),a=o[0],A=s-a*a;if(!A)return!n&&e;var l=t*s/A,u=-t*a/A,c=Va(i,o),h=ja(i,l);Ga(h,ja(o,u));var d=c,p=Ua(h,d),f=Ua(d,d),m=p*p-f*(Ua(h,h)-1);if(!(m<0)){var g=ia(m),y=ja(d,(-p-g)/f);if(Ga(y,h),y=Ia(y),!n)return y;var b,v=e[0],_=r[0],x=e[1],w=r[1];_<v&&(b=v,v=_,_=b);var T=_-v,S=$s(T-Gs)<Us;if(!S&&w<x&&(b=x,x=w,w=b),S||T<Us?S?x+w>0^y[1]<($s(y[0]-v)<Us?x:w):x<=y[1]&&y[1]<=w:T>Gs^(v<=y[0]&&y[0]<=_)){var E=ja(d,(-p+g)/f);return Ga(E,h),[y,Ia(E)]}}}function a(t,r){var i=n?e:Gs-e,o=0;return t<-i?o|=1:t>i&&(o|=2),r<-i?o|=4:r>i&&(o|=8),o}return HA(o,function(e){var t,r,A,l,u;return{lineStart:function(){l=A=!1,u=1},point:function(c,h){var d,p=[c,h],f=o(c,h),m=n?f?0:a(c,h):f?a(c+(c<0?Gs:-Gs),h):0;if(!t&&(l=A=f)&&e.lineStart(),f!==A&&(!(d=s(t,p))||FA(t,d)||FA(p,d))&&(p[2]=1),f!==A)u=0,f?(e.lineStart(),d=s(p,t),e.point(d[0],d[1])):(d=s(t,p),e.point(d[0],d[1],2),e.lineEnd()),t=d;else if(i&&t&&n^f){var g;m&r||!(g=s(p,t,!0))||(u=0,n?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1],3)))}!f||t&&FA(t,p)||e.point(p[0],p[1]),t=p,A=f,r=m},lineEnd:function(){A&&e.lineEnd(),t=null},clean:function(){return u|(l&&A)<<1}}},function(t,n,i,o){!function(e,t,r,n,i,o){if(r){var s=Ks(t),a=ra(t),A=n*r;null==i?(i=t+n*Hs,o=t-A/2):(i=kA(s,i),o=kA(s,o),(n>0?i<o:i>o)&&(i+=n*Hs));for(var l,u=i;n>0?u>o:u<o;u-=A)l=Ia([s,-a*Ks(u),-a*ra(u)]),e.point(l[0],l[1])}}(o,e,r,i,t,n)},n?[0,-e]:[-Gs,e-Gs])}var XA,KA,ZA,JA,el=1e9,tl=-el;function rl(e,t,r,n){function i(i,o){return e<=i&&i<=r&&t<=o&&o<=n}function o(i,o,a,l){var u=0,c=0;if(null==i||(u=s(i,a))!==(c=s(o,a))||A(i,o)<0^a>0)do{l.point(0===u||3===u?e:r,u>1?n:t)}while((u=(u+a+4)%4)!==c);else l.point(o[0],o[1])}function s(n,i){return $s(n[0]-e)<Us?i>0?0:3:$s(n[0]-r)<Us?i>0?2:1:$s(n[1]-t)<Us?i>0?1:0:i>0?3:2}function a(e,t){return A(e.x,t.x)}function A(e,t){var r=s(e,1),n=s(t,1);return r!==n?r-n:0===r?t[1]-e[1]:1===r?e[0]-t[0]:2===r?e[1]-t[1]:t[0]-e[0]}return function(s){var A,l,u,c,h,d,p,f,m,g,y,b=s,v=IA(),_={point:x,lineStart:function(){_.point=w,l&&l.push(u=[]);g=!0,m=!1,p=f=NaN},lineEnd:function(){A&&(w(c,h),d&&m&&v.rejoin(),A.push(v.result()));_.point=x,m&&b.lineEnd()},polygonStart:function(){b=v,A=[],l=[],y=!0},polygonEnd:function(){var t=function(){for(var t=0,r=0,i=l.length;r<i;++r)for(var o,s,a=l[r],A=1,u=a.length,c=a[0],h=c[0],d=c[1];A<u;++A)o=h,s=d,h=(c=a[A])[0],d=c[1],s<=n?d>n&&(h-o)*(n-s)>(d-s)*(e-o)&&++t:d<=n&&(h-o)*(n-s)<(d-s)*(e-o)&&--t;return t}(),r=y&&t,i=(A=fo(A)).length;(r||i)&&(s.polygonStart(),r&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),i&&VA(A,a,t,o,s),s.polygonEnd());b=s,A=l=u=null}};function x(e,t){i(e,t)&&b.point(e,t)}function w(o,s){var a=i(o,s);if(l&&u.push([o,s]),g)c=o,h=s,d=a,g=!1,a&&(b.lineStart(),b.point(o,s));else if(a&&m)b.point(o,s);else{var A=[p=Math.max(tl,Math.min(el,p)),f=Math.max(tl,Math.min(el,f))],v=[o=Math.max(tl,Math.min(el,o)),s=Math.max(tl,Math.min(el,s))];!function(e,t,r,n,i,o){var s,a=e[0],A=e[1],l=0,u=1,c=t[0]-a,h=t[1]-A;if(s=r-a,c||!(s>0)){if(s/=c,c<0){if(s<l)return;s<u&&(u=s)}else if(c>0){if(s>u)return;s>l&&(l=s)}if(s=i-a,c||!(s<0)){if(s/=c,c<0){if(s>u)return;s>l&&(l=s)}else if(c>0){if(s<l)return;s<u&&(u=s)}if(s=n-A,h||!(s>0)){if(s/=h,h<0){if(s<l)return;s<u&&(u=s)}else if(h>0){if(s>u)return;s>l&&(l=s)}if(s=o-A,h||!(s<0)){if(s/=h,h<0){if(s>u)return;s>l&&(l=s)}else if(h>0){if(s<l)return;s<u&&(u=s)}return l>0&&(e[0]=a+l*c,e[1]=A+l*h),u<1&&(t[0]=a+u*c,t[1]=A+u*h),!0}}}}}(A,v,e,t,r,n)?a&&(b.lineStart(),b.point(o,s),y=!1):(m||(b.lineStart(),b.point(A[0],A[1])),b.point(v[0],v[1]),a||b.lineEnd(),y=!1)}p=o,f=s,m=a}return _}}var nl={sphere:Aa,point:Aa,lineStart:function(){nl.point=ol,nl.lineEnd=il},lineEnd:Aa,polygonStart:Aa,polygonEnd:Aa};function il(){nl.point=nl.lineEnd=Aa}function ol(e,t){KA=e*=Qs,ZA=ra(t*=Qs),JA=Ks(t),nl.point=sl}function sl(e,t){e*=Qs;var r=ra(t*=Qs),n=Ks(t),i=$s(e-KA),o=Ks(i),s=n*ra(i),a=JA*r-ZA*n*o,A=ZA*r+JA*n*o;XA.add(Xs(ia(s*s+a*a),A)),KA=e,ZA=r,JA=n}var al=[null,null],Al={type:"LineString",coordinates:al};function ll(e,t){return al[0]=e,al[1]=t,function(e){return XA=new Ao,pa(e,nl),+XA}(Al)}var ul={Feature:function(e,t){return hl(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)if(hl(r[n].geometry,t))return!0;return!1}},cl={Sphere:function(){return!0},Point:function(e,t){return dl(e.coordinates,t)},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)if(dl(r[n],t))return!0;return!1},LineString:function(e,t){return pl(e.coordinates,t)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)if(pl(r[n],t))return!0;return!1},Polygon:function(e,t){return fl(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)if(fl(r[n],t))return!0;return!1},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)if(hl(r[n],t))return!0;return!1}};function hl(e,t){return!(!e||!cl.hasOwnProperty(e.type))&&cl[e.type](e,t)}function dl(e,t){return 0===ll(e,t)}function pl(e,t){for(var r,n,i,o=0,s=e.length;o<s;o++){if(0===(n=ll(e[o],t)))return!0;if(o>0&&(i=ll(e[o],e[o-1]))>0&&r<=i&&n<=i&&(r+n-i)*(1-Math.pow((r-n)/i,2))<Vs*i)return!0;r=n}return!1}function fl(e,t){return!!zA(e.map(ml),gl(t))}function ml(e){return(e=e.map(gl)).pop(),e}function gl(e){return[e[0]*Qs,e[1]*Qs]}function yl(e,t,r){var n=mo(e,t-Us,r).concat(t);return function(e){return n.map(function(t){return[e,t]})}}function bl(e,t,r){var n=mo(e,t-Us,r).concat(t);return function(e){return n.map(function(t){return[t,e]})}}function vl(){return function(){var e,t,r,n,i,o,s,a,A,l,u,c,h=10,d=h,p=90,f=360,m=2.5;function g(){return{type:"MultiLineString",coordinates:y()}}function y(){return mo(Zs(n/p)*p,r,p).map(u).concat(mo(Zs(a/f)*f,s,f).map(c)).concat(mo(Zs(t/h)*h,e,h).filter(function(e){return $s(e%p)>Us}).map(A)).concat(mo(Zs(o/d)*d,i,d).filter(function(e){return $s(e%f)>Us}).map(l))}return g.lines=function(){return y().map(function(e){return{type:"LineString",coordinates:e}})},g.outline=function(){return{type:"Polygon",coordinates:[u(n).concat(c(s).slice(1),u(r).reverse().slice(1),c(a).reverse().slice(1))]}},g.extent=function(e){return arguments.length?g.extentMajor(e).extentMinor(e):g.extentMinor()},g.extentMajor=function(e){return arguments.length?(n=+e[0][0],r=+e[1][0],a=+e[0][1],s=+e[1][1],n>r&&(e=n,n=r,r=e),a>s&&(e=a,a=s,s=e),g.precision(m)):[[n,a],[r,s]]},g.extentMinor=function(r){return arguments.length?(t=+r[0][0],e=+r[1][0],o=+r[0][1],i=+r[1][1],t>e&&(r=t,t=e,e=r),o>i&&(r=o,o=i,i=r),g.precision(m)):[[t,o],[e,i]]},g.step=function(e){return arguments.length?g.stepMajor(e).stepMinor(e):g.stepMinor()},g.stepMajor=function(e){return arguments.length?(p=+e[0],f=+e[1],g):[p,f]},g.stepMinor=function(e){return arguments.length?(h=+e[0],d=+e[1],g):[h,d]},g.precision=function(h){return arguments.length?(m=+h,A=yl(o,i,90),l=bl(t,e,m),u=yl(a,s,90),c=bl(n,r,m),g):m},g.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()()}function _l(e,t){var r=e[0]*Qs,n=e[1]*Qs,i=t[0]*Qs,o=t[1]*Qs,s=Ks(n),a=ra(n),A=Ks(o),l=ra(o),u=s*Ks(r),c=s*ra(r),h=A*Ks(i),d=A*ra(i),p=2*sa(ia(aa(o-n)+s*A*aa(i-r))),f=ra(p),m=p?function(e){var t=ra(e*=p)/f,r=ra(p-e)/f,n=r*u+t*h,i=r*c+t*d,o=r*a+t*l;return[Xs(i,n)*Ws,Xs(o,ia(n*n+i*i))*Ws]}:function(){return[r*Ws,n*Ws]};return m.distance=p,m}const xl=e=>e;var wl=1/0,Tl=wl,Sl=-wl,El=Sl,Ml={point:function(e,t){e<wl&&(wl=e);e>Sl&&(Sl=e);t<Tl&&(Tl=t);t>El&&(El=t)},lineStart:Aa,lineEnd:Aa,polygonStart:Aa,polygonEnd:Aa,result:function(){var e=[[wl,Tl],[Sl,El]];return Sl=El=-(Tl=wl=1/0),e}};function Nl(e){return function(t){var r=new Cl;for(var n in e)r[n]=e[n];return r.stream=t,r}}function Cl(){}function Rl(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=n&&e.clipExtent(null),pa(r,e.stream(Ml)),t(Ml.result()),null!=n&&e.clipExtent(n),e}function Pl(e,t,r){return Rl(e,function(r){var n=t[1][0]-t[0][0],i=t[1][1]-t[0][1],o=Math.min(n/(r[1][0]-r[0][0]),i/(r[1][1]-r[0][1])),s=+t[0][0]+(n-o*(r[1][0]+r[0][0]))/2,a=+t[0][1]+(i-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([s,a])},r)}Cl.prototype={constructor:Cl,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Dl=Ks(30*Qs);function Bl(e,t){return+t?function(e,t){function r(n,i,o,s,a,A,l,u,c,h,d,p,f,m){var g=l-n,y=u-i,b=g*g+y*y;if(b>4*t&&f--){var v=s+h,_=a+d,x=A+p,w=ia(v*v+_*_+x*x),T=sa(x/=w),S=$s($s(x)-1)<Us||$s(o-c)<Us?(o+c)/2:Xs(_,v),E=e(S,T),M=E[0],N=E[1],C=M-n,R=N-i,P=y*C-g*R;(P*P/b>t||$s((g*C+y*R)/b-.5)>.3||s*h+a*d+A*p<Dl)&&(r(n,i,o,s,a,A,M,N,S,v/=w,_/=w,x,f,m),m.point(M,N),r(M,N,S,v,_,x,l,u,c,h,d,p,f,m))}}return function(t){var n,i,o,s,a,A,l,u,c,h,d,p,f={point:m,lineStart:g,lineEnd:b,polygonStart:function(){t.polygonStart(),f.lineStart=v},polygonEnd:function(){t.polygonEnd(),f.lineStart=g}};function m(r,n){r=e(r,n),t.point(r[0],r[1])}function g(){u=NaN,f.point=y,t.lineStart()}function y(n,i){var o=Fa([n,i]),s=e(n,i);r(u,c,l,h,d,p,u=s[0],c=s[1],l=n,h=o[0],d=o[1],p=o[2],16,t),t.point(u,c)}function b(){f.point=m,t.lineEnd()}function v(){g(),f.point=_,f.lineEnd=x}function _(e,t){y(n=e,t),i=u,o=c,s=h,a=d,A=p,f.point=y}function x(){r(u,c,l,h,d,p,i,o,n,s,a,A,16,t),f.lineEnd=b,b()}return f}}(e,t):function(e){return Nl({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}(e)}var ql=Nl({point:function(e,t){this.stream.point(e*Qs,t*Qs)}});function Ol(e,t,r,n,i,o){if(!o)return function(e,t,r,n,i){function o(o,s){return[t+e*(o*=n),r-e*(s*=i)]}return o.invert=function(o,s){return[(o-t)/e*n,(r-s)/e*i]},o}(e,t,r,n,i);var s=Ks(o),a=ra(o),A=s*e,l=a*e,u=s/e,c=a/e,h=(a*r-s*t)/e,d=(a*t+s*r)/e;function p(e,o){return[A*(e*=n)-l*(o*=i)+t,r-l*e-A*o]}return p.invert=function(e,t){return[n*(u*e-c*t+h),i*(d-c*e-u*t)]},p}function Ll(e){return function(e){var t,r,n,i,o,s,a,A,l,u,c=150,h=480,d=250,p=0,f=0,m=0,g=0,y=0,b=0,v=1,_=1,x=null,w=$A,T=null,S=xl,E=.5;function M(e){return A(e[0]*Qs,e[1]*Qs)}function N(e){return(e=A.invert(e[0],e[1]))&&[e[0]*Ws,e[1]*Ws]}function C(){var e=Ol(c,0,0,v,_,b).apply(null,t(p,f)),n=Ol(c,h-e[0],d-e[1],v,_,b);return r=BA(m,g,y),a=PA(t,n),A=PA(r,a),s=Bl(a,E),R()}function R(){return l=u=null,M}return M.stream=function(e){return l&&u===e?l:l=ql(function(e){return Nl({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}(r)(w(s(S(u=e)))))},M.preclip=function(e){return arguments.length?(w=e,x=void 0,R()):w},M.postclip=function(e){return arguments.length?(S=e,T=n=i=o=null,R()):S},M.clipAngle=function(e){return arguments.length?(w=+e?YA(x=e*Qs):(x=null,$A),R()):x*Ws},M.clipExtent=function(e){return arguments.length?(S=null==e?(T=n=i=o=null,xl):rl(T=+e[0][0],n=+e[0][1],i=+e[1][0],o=+e[1][1]),R()):null==T?null:[[T,n],[i,o]]},M.scale=function(e){return arguments.length?(c=+e,C()):c},M.translate=function(e){return arguments.length?(h=+e[0],d=+e[1],C()):[h,d]},M.center=function(e){return arguments.length?(p=e[0]%360*Qs,f=e[1]%360*Qs,C()):[p*Ws,f*Ws]},M.rotate=function(e){return arguments.length?(m=e[0]%360*Qs,g=e[1]%360*Qs,y=e.length>2?e[2]%360*Qs:0,C()):[m*Ws,g*Ws,y*Ws]},M.angle=function(e){return arguments.length?(b=e%360*Qs,C()):b*Ws},M.reflectX=function(e){return arguments.length?(v=e?-1:1,C()):v<0},M.reflectY=function(e){return arguments.length?(_=e?-1:1,C()):_<0},M.precision=function(e){return arguments.length?(s=Bl(a,E=e*e),R()):ia(E)},M.fitExtent=function(e,t){return Pl(M,e,t)},M.fitSize=function(e,t){return function(e,t,r){return Pl(e,[[0,0],t],r)}(M,e,t)},M.fitWidth=function(e,t){return function(e,t,r){return Rl(e,function(r){var n=+t,i=n/(r[1][0]-r[0][0]),o=(n-i*(r[1][0]+r[0][0]))/2,s=-i*r[0][1];e.scale(150*i).translate([o,s])},r)}(M,e,t)},M.fitHeight=function(e,t){return function(e,t,r){return Rl(e,function(r){var n=+t,i=n/(r[1][1]-r[0][1]),o=-i*r[0][0],s=(n-i*(r[1][1]+r[0][1]))/2;e.scale(150*i).translate([o,s])},r)}(M,e,t)},function(){return t=e.apply(this,arguments),M.invert=t.invert&&N,C()}}(function(){return e})()}function kl(e,t){return[e,ta(oa((js+t)/2))]}function Il(e,t){var r=Ks(t),n=1+Ks(e)*r;return[r*ra(e)/n,ra(t)/n]}function Fl(){return Ll(Il).scale(250).clipAngle(142)}function Ul(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Vl(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}function Gl(e,t,r){return t=Yl(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Xl()?Reflect.construct(t,[],Yl(e).constructor):t.apply(e,r))}function jl(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function zl(e,t){return e.get(Vl(e,t))}function Hl(e,t,r){jl(e,t),t.set(e,r)}function Wl(e,t,r){return e.set(Vl(e,t),r),r}function Ql(e,t,r){return function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,eu(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $l(e,t,r){return(t=eu(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Yl(e){return Yl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Yl(e)}function Xl(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Xl=function(){return!!e})()}function Kl(e,t){return Kl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Kl(e,t)}function Zl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||tu(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jl(e){return function(e){if(Array.isArray(e))return Ul(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||tu(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eu(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function tu(e,t){if(e){if("string"==typeof e)return Ul(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ul(e,t):void 0}}kl.invert=function(e,t){return[e,2*Ys(Js(t))-js]},Il.invert=function(e){return function(t,r){var n=ia(t*t+r*r),i=e(n),o=ra(i),s=Ks(i);return[Xs(t*o,n*s),sa(n&&r*o/n)]}}(function(e){return 2*Ys(e)});var ru=function(e){e instanceof Array?e.forEach(ru):(e.map&&e.map.dispose(),e.dispose())},nu=function(e){e.geometry&&e.geometry.dispose(),e.material&&ru(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(nu)},iu=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),nu(t)}};function ou(e,t,r){var n=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return{x:r*Math.sin(n)*Math.cos(i),y:r*Math.cos(n),z:r*Math.sin(n)*Math.sin(i)}}function su(e){return e*Math.PI/180}var au=function(e){return 1-(kl(0,(.5-e)*Math.PI)[1]/Math.PI+1)/2},Au=function(e){return Math.max(0,Math.min(1,au(e)))},lu=function(e){return.5-kl.invert(0,(2*(1-e)-1)*Math.PI)[1]/Math.PI},uu=function(e,t,r,n){var i=Math.pow(2,e),o=Math.max(0,Math.min(i-1,Math.floor((r+180)*i/360))),s=(90-n)/180;return t&&(s=Math.max(0,Math.min(1,au(s)))),[o,Math.floor(s*i)]},cu=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,s=[],a=Math.pow(2,e),A=360/a,l=180/a,u=void 0===i?a-1:i,c=void 0===o?a-1:o,h=r,d=Math.min(a-1,u);h<=d;h++)for(var p=n,f=Math.min(a-1,c);p<=f;p++){var m=p,g=l;if(t)m=0===p?p:lu(p/a)*a,g=180*((p+1===a?p+1:lu((p+1)/a)*a)-m)/a;var y=(h+.5)*A-180,b=90-(180*m/a+g/2),v=g;s.push({x:h,y:p,lng:y,lat:b,latLen:v})}return s},hu=new WeakMap,du=new WeakMap,pu=new WeakMap,fu=new WeakMap,mu=new WeakMap,gu=new WeakMap,yu=new WeakMap,bu=new WeakMap,vu=new WeakSet,_u=function(){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.tileUrl,o=n.minLevel,s=void 0===o?0:o,a=n.maxLevel,c=void 0===a?17:a,h=n.mercatorProjection,d=void 0===h||h;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){jl(e,t),t.add(e)}(r=Gl(this,e),vu),Hl(r,hu,void 0),Hl(r,du,void 0),Hl(r,pu,void 0),Hl(r,fu,void 0),Hl(r,mu,{}),Hl(r,gu,void 0),Hl(r,yu,void 0),Hl(r,bu,void 0),$l(r,"minLevel",void 0),$l(r,"maxLevel",void 0),$l(r,"thresholds",Jl(new Array(30)).map(function(e,t){return 8/Math.pow(2,t)})),$l(r,"curvatureResolution",5),$l(r,"tileMargin",0),$l(r,"clearTiles",function(){Object.values(zl(mu,r)).forEach(function(e){e.forEach(function(e){e.obj&&(r.remove(e.obj),iu(e.obj),delete e.obj)})}),Wl(mu,r,{})}),Wl(hu,r,t),r.tileUrl=i,Wl(du,r,d),r.minLevel=s,r.maxLevel=c,r.level=0,r.add(Wl(bu,r,new A(new l(.99*zl(hu,r),180,90),new u({color:0})))),zl(bu,r).visible=!1,zl(bu,r).material.polygonOffset=!0,zl(bu,r).material.polygonOffsetUnits=3,zl(bu,r).material.polygonOffsetFactor=1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Kl(e,t)}(e,a),Ql(e,[{key:"tileUrl",get:function(){return zl(pu,this)},set:function(e){Wl(pu,this,e),this.updatePov(zl(yu,this))}},{key:"level",get:function(){return zl(fu,this)},set:function(e){var t=this;zl(mu,this)[e]||Vl(vu,this,xu).call(this,e);var r=zl(fu,this);if(Wl(fu,this,e),e!==r&&void 0!==r){if(zl(bu,this).visible=e>0,zl(mu,this)[e].forEach(function(e){return e.obj&&(e.obj.material.depthWrite=!0)}),r<e&&zl(mu,this)[r].forEach(function(e){return e.obj&&(e.obj.material.depthWrite=!1)}),r>e)for(var n=e+1;n<=r;n++)zl(mu,this)[n]&&zl(mu,this)[n].forEach(function(e){e.obj&&(t.remove(e.obj),iu(e.obj),delete e.obj)});Vl(vu,this,wu).call(this)}}},{key:"updatePov",value:function(e){var t,r=this;if(e&&e instanceof s&&(Wl(yu,this,e),Wl(gu,this,function(n){if(!n.hullPnts){var s=360/Math.pow(2,r.level),a=n.lng,A=n.lat,l=n.latLen,u=a-s/2,h=a+s/2,d=A-l/2,p=A+l/2;n.hullPnts=[[A,a],[d,u],[p,u],[d,h],[p,h]].map(function(e){var t=Zl(e,2);return ou(t[0],t[1],zl(hu,r))}).map(function(e){var t=e.x,r=e.y,n=e.z;return new o(t,r,n)})}return t||(t=new c,e.updateMatrix(),e.updateMatrixWorld(),t.setFromProjectionMatrix((new i).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))),n.hullPnts.some(function(e){return t.containsPoint(e.clone().applyMatrix4(r.matrixWorld))})}),this.tileUrl)){var n=(e.position.clone().distanceTo(this.getWorldPosition(new o))-zl(hu,this))/zl(hu,this),a=this.thresholds.findIndex(function(e){return e&&e<=n});this.level=Math.min(this.maxLevel,Math.max(this.minLevel,a<0?this.thresholds.length:a)),Vl(vu,this,wu).call(this)}}}])}();function xu(e){var t=this;if(e>7)zl(mu,this)[e]=[];else{var r=zl(mu,this)[e]=cu(e,zl(du,this));r.forEach(function(e){return e.centroid=ou(e.lat,e.lng,zl(hu,t))}),r.octree=Zi().x(function(e){return e.centroid.x}).y(function(e){return e.centroid.y}).z(function(e){return e.centroid.z}).addAll(r)}}function wu(){var e=this;if(this.tileUrl&&void 0!==this.level&&zl(mu,this).hasOwnProperty(this.level)&&(zl(gu,this)||!(this.level>6))){var t=zl(mu,this)[this.level];if(zl(yu,this)){var r=this.worldToLocal(zl(yu,this).position.clone());if(t.octree){var n,i=this.worldToLocal(zl(yu,this).position.clone()),o=3*(i.length()-zl(hu,this));t=(n=t.octree).findAllWithinRadius.apply(n,Jl(i).concat([o]))}else{var s=function(e){var t=e.x,r=e.y,n=e.z,i=Math.sqrt(t*t+r*r+n*n),o=Math.acos(r/i),s=Math.atan2(n,t);return{lat:90-180*o/Math.PI,lng:90-180*s/Math.PI-(s<-Math.PI/2?360:0),r:i}}(r),a=90*(s.r/zl(hu,this)-1),u=a/Math.cos(su(s.lat)),c=[s.lng-u,s.lng+u],f=[s.lat+a,s.lat-a],m=Zl(uu(this.level,zl(du,this),c[0],f[0]),2),g=m[0],y=m[1],b=Zl(uu(this.level,zl(du,this),c[1],f[1]),2),v=b[0],_=b[1];!t.record&&(t.record={});var x=t.record;if(x.hasOwnProperty("".concat(Math.round((g+v)/2),"_").concat(Math.round((y+_)/2)))){for(var w=[],T=g;T<=v;T++)for(var S=y;S<=_;S++){var E="".concat(T,"_").concat(S);x.hasOwnProperty(E)||(x[E]=cu(this.level,zl(du,this),T,S,T,S)[0],t.push(x[E])),w.push(x[E])}t=w}else t=cu(this.level,zl(du,this),g,y,v,_).map(function(e){var r="".concat(e.x,"_").concat(e.y);return x.hasOwnProperty(r)?x[r]:(x[r]=e,t.push(e),e)})}}t.filter(function(e){return!e.obj}).filter(zl(gu,this)||function(){return!0}).forEach(function(t){var r=t.x,n=t.y,i=t.lng,o=t.lat,s=t.latLen,a=360/Math.pow(2,e.level);if(!t.obj){var u=a*(1-e.tileMargin),c=s*(1-e.tileMargin),f=su(i),m=su(-o),g=new A(new l(zl(hu,e),Math.ceil(u/e.curvatureResolution),Math.ceil(c/e.curvatureResolution),su(90-u/2)+f,su(u),su(90-c/2)+m,su(c)),new h);if(zl(du,e)){var y=Zl([o+s/2,o-s/2].map(function(e){return.5-e/180}),2),b=y[0],v=y[1];!function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=Is().domain([1,0]).range([t,r]).clamp(!0),i=Is().domain([Au(t),Au(r)]).range([1,0]).clamp(!0),o=function(e){return i(Au(n(e)))},s=e.array,a=0,A=s.length;a<A;a+=2)s[a+1]=o(s[a+1]);e.needsUpdate=!0}(g.geometry.attributes.uv,b,v)}t.obj=g}t.loading||(t.loading=!0,(new d).load(e.tileUrl(r,n,e.level),function(r){var n=t.obj;n&&(r.colorSpace=p,n.material.map=r,n.material.color=null,n.material.needsUpdate=!0,e.add(n)),t.loading=!1}))})}}function Tu(e,t,r=2){const n=t&&t.length,i=n?t[0]*r:e.length;let o=Su(e,0,i,r,!0);const s=[];if(!o||o.next===o.prev)return s;let a,A,l;if(n&&(o=function(e,t,r,n){const i=[];for(let o=0,s=t.length;o<s;o++){const r=Su(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n,!1);r===r.next&&(r.steiner=!0),i.push(Lu(r))}i.sort(Du);for(let o=0;o<i.length;o++)r=Bu(i[o],r);return r}(e,t,o,r)),e.length>80*r){a=1/0,A=1/0;let t=-1/0,n=-1/0;for(let o=r;o<i;o+=r){const r=e[o],i=e[o+1];r<a&&(a=r),i<A&&(A=i),r>t&&(t=r),i>n&&(n=i)}l=Math.max(t-a,n-A),l=0!==l?32767/l:0}return Mu(o,s,r,a,A,l,0),s}function Su(e,t,r,n,i){let o;if(i===function(e,t,r,n){let i=0;for(let o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,r,n)>0)for(let s=t;s<r;s+=n)o=Qu(s/n|0,e[s],e[s+1],o);else for(let s=r-n;s>=t;s-=n)o=Qu(s/n|0,e[s],e[s+1],o);return o&&Vu(o,o.next)&&($u(o),o=o.next),o}function Eu(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!Vu(n,n.next)&&0!==Uu(n.prev,n,n.next))n=n.next;else{if($u(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function Mu(e,t,r,n,i,o,s){if(!e)return;!s&&o&&function(e,t,r,n){let i=e;do{0===i.z&&(i.z=Ou(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r=1;do{let n,i=e;e=null;let o=null;for(t=0;i;){t++;let s=i,a=0;for(let e=0;e<r&&(a++,s=s.nextZ,s);e++);let A=r;for(;a>0||A>0&&s;)0!==a&&(0===A||!s||i.z<=s.z)?(n=i,i=i.nextZ,a--):(n=s,s=s.nextZ,A--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=s}o.nextZ=null,r*=2}while(t>1)}(i)}(e,n,i,o);let a=e;for(;e.prev!==e.next;){const A=e.prev,l=e.next;if(o?Cu(e,n,i,o):Nu(e))t.push(A.i,e.i,l.i),$u(e),e=l.next,a=l.next;else if((e=l)===a){s?1===s?Mu(e=Ru(Eu(e),t),t,r,n,i,o,2):2===s&&Pu(e,t,r,n,i,o):Mu(Eu(e),t,r,n,i,o,1);break}}}function Nu(e){const t=e.prev,r=e,n=e.next;if(Uu(t,r,n)>=0)return!1;const i=t.x,o=r.x,s=n.x,a=t.y,A=r.y,l=n.y,u=Math.min(i,o,s),c=Math.min(a,A,l),h=Math.max(i,o,s),d=Math.max(a,A,l);let p=n.next;for(;p!==t;){if(p.x>=u&&p.x<=h&&p.y>=c&&p.y<=d&&Iu(i,a,o,A,s,l,p.x,p.y)&&Uu(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Cu(e,t,r,n){const i=e.prev,o=e,s=e.next;if(Uu(i,o,s)>=0)return!1;const a=i.x,A=o.x,l=s.x,u=i.y,c=o.y,h=s.y,d=Math.min(a,A,l),p=Math.min(u,c,h),f=Math.max(a,A,l),m=Math.max(u,c,h),g=Ou(d,p,t,r,n),y=Ou(f,m,t,r,n);let b=e.prevZ,v=e.nextZ;for(;b&&b.z>=g&&v&&v.z<=y;){if(b.x>=d&&b.x<=f&&b.y>=p&&b.y<=m&&b!==i&&b!==s&&Iu(a,u,A,c,l,h,b.x,b.y)&&Uu(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,v.x>=d&&v.x<=f&&v.y>=p&&v.y<=m&&v!==i&&v!==s&&Iu(a,u,A,c,l,h,v.x,v.y)&&Uu(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;b&&b.z>=g;){if(b.x>=d&&b.x<=f&&b.y>=p&&b.y<=m&&b!==i&&b!==s&&Iu(a,u,A,c,l,h,b.x,b.y)&&Uu(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=y;){if(v.x>=d&&v.x<=f&&v.y>=p&&v.y<=m&&v!==i&&v!==s&&Iu(a,u,A,c,l,h,v.x,v.y)&&Uu(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Ru(e,t){let r=e;do{const n=r.prev,i=r.next.next;!Vu(n,i)&&Gu(n,r,r.next,i)&&Hu(n,i)&&Hu(i,n)&&(t.push(n.i,r.i,i.i),$u(r),$u(r.next),r=e=i),r=r.next}while(r!==e);return Eu(r)}function Pu(e,t,r,n,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Fu(s,e)){let a=Wu(s,e);return s=Eu(s,s.next),a=Eu(a,a.next),Mu(s,t,r,n,i,o,0),void Mu(a,t,r,n,i,o,0)}e=e.next}s=s.next}while(s!==e)}function Du(e,t){let r=e.x-t.x;if(0===r&&(r=e.y-t.y,0===r)){r=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return r}function Bu(e,t){const r=function(e,t){let r=t;const n=e.x,i=e.y;let o,s=-1/0;if(Vu(e,r))return r;do{if(Vu(e,r.next))return r.next;if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>s&&(s=e,o=r.x<r.next.x?r:r.next,e===n))return o}r=r.next}while(r!==t);if(!o)return null;const a=o,A=o.x,l=o.y;let u=1/0;r=o;do{if(n>=r.x&&r.x>=A&&n!==r.x&&ku(i<l?n:s,i,A,l,i<l?s:n,i,r.x,r.y)){const t=Math.abs(i-r.y)/(n-r.x);Hu(r,e)&&(t<u||t===u&&(r.x>o.x||r.x===o.x&&qu(o,r)))&&(o=r,u=t)}r=r.next}while(r!==a);return o}(e,t);if(!r)return t;const n=Wu(r,e);return Eu(n,n.next),Eu(r,r.next)}function qu(e,t){return Uu(e.prev,e,t.prev)<0&&Uu(t.next,e,e.next)<0}function Ou(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Lu(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function ku(e,t,r,n,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(n-a)>=(r-s)*(t-a)&&(r-s)*(o-a)>=(i-s)*(n-a)}function Iu(e,t,r,n,i,o,s,a){return!(e===s&&t===a)&&ku(e,t,r,n,i,o,s,a)}function Fu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Gu(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Hu(e,t)&&Hu(t,e)&&function(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Uu(e.prev,e,t.prev)||Uu(e,t.prev,t))||Vu(e,t)&&Uu(e.prev,e,e.next)>0&&Uu(t.prev,t,t.next)>0)}function Uu(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Vu(e,t){return e.x===t.x&&e.y===t.y}function Gu(e,t,r,n){const i=zu(Uu(e,t,r)),o=zu(Uu(e,t,n)),s=zu(Uu(r,n,e)),a=zu(Uu(r,n,t));return i!==o&&s!==a||(!(0!==i||!ju(e,r,t))||(!(0!==o||!ju(e,n,t))||(!(0!==s||!ju(r,e,n))||!(0!==a||!ju(r,t,n)))))}function ju(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function zu(e){return e>0?1:e<0?-1:0}function Hu(e,t){return Uu(e.prev,e,e.next)<0?Uu(e,t,e.next)>=0&&Uu(e,e.prev,t)>=0:Uu(e,t,e.prev)<0||Uu(e,e.next,t)<0}function Wu(e,t){const r=Yu(e.i,e.x,e.y),n=Yu(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Qu(e,t,r,n){const i=Yu(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function $u(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Yu(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Xu(e){const t=[],r=[],n=e[0][0].length;let i=0,o=0;for(const s of e){for(const e of s)for(let r=0;r<n;r++)t.push(e[r]);o&&(i+=o,r.push(i)),o=s.length}return{vertices:t,holes:r,dimensions:n}}function Ku(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Zu(e,t,r){return t=Ju(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ec()?Reflect.construct(t,[],Ju(e).constructor):t.apply(e,r))}function Ju(e){return Ju=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ju(e)}function ec(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ec=function(){return!!e})()}function tc(e,t){return tc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tc(e,t)}function rc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;A=!1}else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||ic(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nc(e){return function(e){if(Array.isArray(e))return Ku(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ic(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ic(e,t){if(e){if("string"==typeof e)return Ku(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ku(e,t):void 0}}var oc=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=[],r=null;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(n){if(r){var i=180*ll(n,r)/Math.PI;if(i>e)for(var o=_l(r,n),s=r.length>2||n.length>2?as(r[2]||0,n[2]||0):null,a=s?function(e){return[].concat(nc(o(e)),[s(e)])}:o,A=1/Math.ceil(i/e),l=A;l<1;)t.push(a(l)),l+=A}t.push(r=n)}),t},sc="undefined"!=typeof window&&window.THREE?window.THREE:{BufferGeometry:f,Float32BufferAttribute:m},ac=(new sc.BufferGeometry).setAttribute?"setAttribute":"addAttribute",Ac=function(){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Zu(this,e)).type="GeoJsonGeometry",r.parameters={geoJson:t,radius:n,resolution:i};var o=({Point:l,MultiPoint:function(e,t){var r={vertices:[],indices:[]};return e.map(function(e){return l(e,t)}).forEach(function(e){var t=rc(e,1)[0];lc(r,t)}),[r]},LineString:u,MultiLineString:function(e,t){var r={vertices:[],indices:[]};return e.map(function(e){return u(e,t)}).forEach(function(e){var t=rc(e,1)[0];lc(r,t)}),[r]},Polygon:c,MultiPolygon:function(e,t){var r={vertices:[],indices:[]},n={vertices:[],indices:[]};e.map(function(e){return c(e,t)}).forEach(function(e){var t=rc(e,2),i=t[0],o=t[1];lc(r,i),o&&lc(n,o)});var i=[r];return n.vertices.length&&i.push(n),i}}[t.type]||function(){return[]})(t.coordinates,n),s=[],a=[],A=0;function l(e,t){return[{vertices:cc(e[1],e[0],t+(e[2]||0)),indices:[]}]}function u(e,t){for(var r=Xu([oc(e,i).map(function(e){var r=rc(e,3),n=r[0],i=r[1],o=r[2];return cc(i,n,t+(void 0===o?0:o))})]).vertices,n=Math.round(r.length/3),o=[],s=1;s<n;s++)o.push(s-1,s);return[{vertices:r,indices:o}]}function c(e,t){for(var r=Xu(e.map(function(e){return oc(e,i).map(function(e){var r=rc(e,3),n=r[0],i=r[1],o=r[2];return cc(i,n,t+(void 0===o?0:o))})})),n=r.vertices,o=r.holes,s=o[0]||1/0,a=n.slice(0,3*s),A=n.slice(3*s),l=new Set(o),u=Math.round(n.length/3),c=[],h=[],d=1;d<u;d++)l.has(d)||(d<s?c.push(d-1,d):h.push(d-1-s,d-s));var p=[{indices:c,vertices:a}];return o.length&&p.push({indices:h,vertices:A}),p}return o.forEach(function(e){var t=s.length;lc({indices:s,vertices:a},e),r.addGroup(t,s.length-t,A++)}),s.length&&r.setIndex(s),a.length&&r[ac]("position",new sc.Float32BufferAttribute(a,3)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tc(e,t)}(e,sc.BufferGeometry),function(e){return Object.defineProperty(e,"prototype",{writable:!1}),e}(e)}();function lc(e,t){var r=Math.round(e.vertices.length/3);uc(e.vertices,t.vertices),uc(e.indices,t.indices.map(function(e){return e+r}))}function uc(e,t){var r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ic(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw o}}}}(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;e.push(i)}}catch(o){n.e(o)}finally{n.f()}}function cc(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return[r*Math.sin(n)*Math.cos(i),r*Math.cos(n),r*Math.sin(n)*Math.sin(i)]}function hc(e){let t,r,n,i=-1,o=0;for(let l=0;l<e.length;++l){const s=e[l];if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=s.itemSize),r!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=s.normalized),n!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===i&&(i=s.gpuType),i!==s.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;o+=s.count*r}const s=new t(o),a=new g(s,r,n);let A=0;for(let l=0;l<e.length;++l){const t=e[l];if(t.isInterleavedBufferAttribute){const e=A/r;for(let n=0,i=t.count;n<i;n++)for(let o=0;o<r;o++){const r=t.getComponent(n,o);a.setComponent(n+e,o,r)}}else s.set(t.array,A);A+=t.count*r}return void 0!==i&&(a.gpuType=i),a}function dc(e){const t=e.data.array.constructor,r=e.count,n=e.itemSize,i=e.normalized,o=new t(r*n);let s;s=e.isInstancedInterleavedBufferAttribute?new y(o,n,i,e.meshPerAttribute):new g(o,n,i);for(let a=0;a<r;a++)s.setX(a,e.getX(a)),n>=2&&s.setY(a,e.getY(a)),n>=3&&s.setZ(a,e.getZ(a)),n>=4&&s.setW(a,e.getW(a));return s}const pc=Object.freeze(Object.defineProperty({__proto__:null,computeMikkTSpaceTangents:function(e,t,r=!0){if(!t||!t.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function n(e){if(e.normalized||e.isInterleavedBufferAttribute){const t=new Float32Array(e.count*e.itemSize);for(let r=0,n=0;r<e.count;r++)t[n++]=e.getX(r),t[n++]=e.getY(r),e.itemSize>2&&(t[n++]=e.getZ(r));return t}return e.array instanceof Float32Array?e.array:new Float32Array(e.array)}const i=e.index?e.toNonIndexed():e,o=t.generateTangents(n(i.attributes.position),n(i.attributes.normal),n(i.attributes.uv));if(r)for(let s=3;s<o.length;s+=4)o[s]*=-1;return i.setAttribute("tangent",new g(o,4)),e!==i&&e.copy(i),e},computeMorphedAttributes:function(e){const t=new o,r=new o,n=new o,i=new o,s=new o,a=new o,A=new o,l=new o,u=new o;function c(e,o,c,h,d,p,f,m){t.fromBufferAttribute(o,d),r.fromBufferAttribute(o,p),n.fromBufferAttribute(o,f);const g=e.morphTargetInfluences;if(c&&g){A.set(0,0,0),l.set(0,0,0),u.set(0,0,0);for(let e=0,o=c.length;e<o;e++){const o=g[e],m=c[e];0!==o&&(i.fromBufferAttribute(m,d),s.fromBufferAttribute(m,p),a.fromBufferAttribute(m,f),h?(A.addScaledVector(i,o),l.addScaledVector(s,o),u.addScaledVector(a,o)):(A.addScaledVector(i.sub(t),o),l.addScaledVector(s.sub(r),o),u.addScaledVector(a.sub(n),o)))}t.add(A),r.add(l),n.add(u)}e.isSkinnedMesh&&(e.applyBoneTransform(d,t),e.applyBoneTransform(p,r),e.applyBoneTransform(f,n)),m[3*d+0]=t.x,m[3*d+1]=t.y,m[3*d+2]=t.z,m[3*p+0]=r.x,m[3*p+1]=r.y,m[3*p+2]=r.z,m[3*f+0]=n.x,m[3*f+1]=n.y,m[3*f+2]=n.z}const h=e.geometry,d=e.material;let p,f,g;const y=h.index,b=h.attributes.position,v=h.morphAttributes.position,_=h.morphTargetsRelative,x=h.attributes.normal,w=h.morphAttributes.position,T=h.groups,S=h.drawRange;let E,M,N,C,R,P,D;const B=new Float32Array(b.count*b.itemSize),q=new Float32Array(x.count*x.itemSize);if(null!==y)if(Array.isArray(d))for(E=0,N=T.length;E<N;E++)for(R=T[E],P=Math.max(R.start,S.start),D=Math.min(R.start+R.count,S.start+S.count),M=P,C=D;M<C;M+=3)p=y.getX(M),f=y.getX(M+1),g=y.getX(M+2),c(e,b,v,_,p,f,g,B),c(e,x,w,_,p,f,g,q);else for(P=Math.max(0,S.start),D=Math.min(y.count,S.start+S.count),E=P,N=D;E<N;E+=3)p=y.getX(E),f=y.getX(E+1),g=y.getX(E+2),c(e,b,v,_,p,f,g,B),c(e,x,w,_,p,f,g,q);else if(Array.isArray(d))for(E=0,N=T.length;E<N;E++)for(R=T[E],P=Math.max(R.start,S.start),D=Math.min(R.start+R.count,S.start+S.count),M=P,C=D;M<C;M+=3)p=M,f=M+1,g=M+2,c(e,b,v,_,p,f,g,B),c(e,x,w,_,p,f,g,q);else for(P=Math.max(0,S.start),D=Math.min(b.count,S.start+S.count),E=P,N=D;E<N;E+=3)p=E,f=E+1,g=E+2,c(e,b,v,_,p,f,g,B),c(e,x,w,_,p,f,g,q);return{positionAttribute:b,normalAttribute:x,morphedPositionAttribute:new m(B,3),morphedNormalAttribute:new m(q,3)}},deepCloneAttribute:function(e){return e.isInstancedInterleavedBufferAttribute||e.isInterleavedBufferAttribute?dc(e):e.isInstancedBufferAttribute?(new y).copy(e):(new g).copy(e)},deinterleaveAttribute:dc,deinterleaveGeometry:function(e){const t=e.attributes,r=e.morphTargets,n=new Map;for(const i in t){const e=t[i];e.isInterleavedBufferAttribute&&(n.has(e)||n.set(e,dc(e)),t[i]=n.get(e))}for(const i in r){const e=r[i];e.isInterleavedBufferAttribute&&(n.has(e)||n.set(e,dc(e)),r[i]=n.get(e))}},estimateBytesUsed:function(e){let t=0;for(const n in e.attributes){const r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const r=e.getIndex();return t+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0,t},interleaveAttributes:function(e){let t,r=0,n=0;for(let l=0,u=e.length;l<u;++l){const i=e[l];if(void 0===t&&(t=i.array.constructor),t!==i.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;r+=i.array.length,n+=i.itemSize}const i=new b(new t(r),n);let o=0;const s=[],a=["getX","getY","getZ","getW"],A=["setX","setY","setZ","setW"];for(let l=0,u=e.length;l<u;l++){const t=e[l],r=t.itemSize,n=t.count,u=new v(i,r,o,t.normalized);s.push(u),o+=r;for(let e=0;e<n;e++)for(let n=0;n<r;n++)u[A[n]](e,t[a[n]](e))}return s},mergeAttributes:hc,mergeGeometries:function(e,t=!1){const r=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),o={},s={},a=e[0].morphTargetsRelative,A=new f;let l=0;for(let u=0;u<e.length;++u){const c=e[u];let h=0;if(r!==(null!==c.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in c.attributes){if(!n.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[e]&&(o[e]=[]),o[e].push(c.attributes[e]),h++}if(h!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in c.morphAttributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[e]&&(s[e]=[]),s[e].push(c.morphAttributes[e])}if(t){let e;if(r)e=c.index.count;else{if(void 0===c.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;e=c.attributes.position.count}A.addGroup(l,e,u),l+=e}}if(r){let t=0;const r=[];for(let n=0;n<e.length;++n){const i=e[n].index;for(let e=0;e<i.count;++e)r.push(i.getX(e)+t);t+=e[n].attributes.position.count}A.setIndex(r)}for(const u in o){const e=hc(o[u]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" attribute."),null;A.setAttribute(u,e)}for(const u in s){const e=s[u][0].length;if(0===e)break;A.morphAttributes=A.morphAttributes||{},A.morphAttributes[u]=[];for(let t=0;t<e;++t){const e=[];for(let n=0;n<s[u].length;++n)e.push(s[u][n][t]);const r=hc(e);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+u+" morphAttribute."),null;A.morphAttributes[u].push(r)}}return A},mergeGroups:function(e){if(0===e.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),e;let t=e.groups;if(t=t.sort((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start),null===e.getIndex()){const t=e.getAttribute("position"),r=[];for(let e=0;e<t.count;e+=3)r.push(e,e+1,e+2);e.setIndex(r)}const r=e.getIndex(),n=[];for(let s=0;s<t.length;s++){const e=t[s],i=e.start,o=i+e.count;for(let t=i;t<o;t++)n.push(r.getX(t))}e.dispose(),e.setIndex(n);let i=0;for(let s=0;s<t.length;s++){const e=t[s];e.start=i,i+=e.count}let o=t[0];e.groups=[o];for(let s=1;s<t.length;s++){const r=t[s];o.materialIndex===r.materialIndex?o.count+=r.count:(o=r,e.groups.push(o))}return e},mergeVertices:function(e,t=1e-4){t=Math.max(t,Number.EPSILON);const r={},n=e.getIndex(),i=e.getAttribute("position"),o=n?n.count:i.count;let s=0;const a=Object.keys(e.attributes),A={},l={},u=[],c=["getX","getY","getZ","getW"],h=["setX","setY","setZ","setW"];for(let y=0,b=a.length;y<b;y++){const t=a[y],r=e.attributes[t];A[t]=new r.constructor(new r.array.constructor(r.count*r.itemSize),r.itemSize,r.normalized);const n=e.morphAttributes[t];n&&(l[t]||(l[t]=[]),n.forEach((e,r)=>{const n=new e.array.constructor(e.count*e.itemSize);l[t][r]=new e.constructor(n,e.itemSize,e.normalized)}))}const d=.5*t,p=Math.log10(1/t),f=Math.pow(10,p),m=d*f;for(let y=0;y<o;y++){const t=n?n.getX(y):y;let i="";for(let r=0,n=a.length;r<n;r++){const n=a[r],o=e.getAttribute(n),s=o.itemSize;for(let e=0;e<s;e++)i+=~~(o[c[e]](t)*f+m)+","}if(i in r)u.push(r[i]);else{for(let r=0,n=a.length;r<n;r++){const n=a[r],i=e.getAttribute(n),o=e.morphAttributes[n],u=i.itemSize,d=A[n],p=l[n];for(let e=0;e<u;e++){const r=c[e],n=h[e];if(d[n](s,i[r](t)),o)for(let e=0,i=o.length;e<i;e++)p[e][n](s,o[e][r](t))}}r[i]=s,u.push(s),s++}}const g=e.clone();for(const y in e.attributes){const e=A[y];if(g.setAttribute(y,new e.constructor(e.array.slice(0,s*e.itemSize),e.itemSize,e.normalized)),y in l)for(let t=0;t<l[y].length;t++){const e=l[y][t];g.morphAttributes[y][t]=new e.constructor(e.array.slice(0,s*e.itemSize),e.itemSize,e.normalized)}}return g.setIndex(u),g},toCreasedNormals:function(e,t=Math.PI/3){const r=Math.cos(t),n=100*(1+1e-10),i=[new o,new o,new o],s=new o,a=new o,A=new o,l=new o;function u(e){return`${~~(e.x*n)},${~~(e.y*n)},${~~(e.z*n)}`}const c=e.index?e.toNonIndexed():e,h=c.attributes.position,d={};for(let m=0,g=h.count/3;m<g;m++){const e=3*m,t=i[0].fromBufferAttribute(h,e+0),r=i[1].fromBufferAttribute(h,e+1),n=i[2].fromBufferAttribute(h,e+2);s.subVectors(n,r),a.subVectors(t,r);const A=(new o).crossVectors(s,a).normalize();for(let o=0;o<3;o++){const e=u(i[o]);e in d||(d[e]=[]),d[e].push(A)}}const p=new Float32Array(3*h.count),f=new g(p,3,!1);for(let o=0,m=h.count/3;o<m;o++){const e=3*o,t=i[0].fromBufferAttribute(h,e+0),n=i[1].fromBufferAttribute(h,e+1),c=i[2].fromBufferAttribute(h,e+2);s.subVectors(c,n),a.subVectors(t,n),A.crossVectors(s,a).normalize();for(let o=0;o<3;o++){const t=d[u(i[o])];l.set(0,0,0);for(let e=0,n=t.length;e<n;e++){const n=t[e];A.dot(n)>r&&l.add(n)}l.normalize(),f.setXYZ(e+o,l.x,l.y,l.z)}}return c.setAttribute("normal",f),c},toTrianglesDrawMode:function(e,t){if(t===_)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===x||t===w){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const n=r.count-2,i=[];if(t===x)for(let e=1;e<=n;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(i),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}},Symbol.toStringTag,{value:"Module"}));var fc=function(e){return"function"==typeof e?e:"string"==typeof e?function(t){return t[e]}:function(t){return e}};function mc(e){return mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mc(e)}var gc=/^\s+/,yc=/\s+$/;function bc(e,t){if(t=t||{},(e=e||"")instanceof bc)return e;if(!(this instanceof bc))return new bc(e,t);var r=function(e){var t={r:0,g:0,b:0},r=1,n=null,i=null,o=null,s=!1,a=!1;"string"==typeof e&&(e=function(e){e=e.replace(gc,"").replace(yc,"").toLowerCase();var t,r=!1;if(Lc[e])e=Lc[e],r=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=Yc.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=Yc.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=Yc.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=Yc.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=Yc.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=Yc.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=Yc.hex8.exec(e))return{r:Vc(t[1]),g:Vc(t[2]),b:Vc(t[3]),a:Hc(t[4]),format:r?"name":"hex8"};if(t=Yc.hex6.exec(e))return{r:Vc(t[1]),g:Vc(t[2]),b:Vc(t[3]),format:r?"name":"hex"};if(t=Yc.hex4.exec(e))return{r:Vc(t[1]+""+t[1]),g:Vc(t[2]+""+t[2]),b:Vc(t[3]+""+t[3]),a:Hc(t[4]+""+t[4]),format:r?"name":"hex8"};if(t=Yc.hex3.exec(e))return{r:Vc(t[1]+""+t[1]),g:Vc(t[2]+""+t[2]),b:Vc(t[3]+""+t[3]),format:r?"name":"hex"};return!1}(e));"object"==mc(e)&&(Xc(e.r)&&Xc(e.g)&&Xc(e.b)?(t=function(e,t,r){return{r:255*Fc(e,255),g:255*Fc(t,255),b:255*Fc(r,255)}}(e.r,e.g,e.b),s=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):Xc(e.h)&&Xc(e.s)&&Xc(e.v)?(n=jc(e.s),i=jc(e.v),t=function(e,t,r){e=6*Fc(e,360),t=Fc(t,100),r=Fc(r,100);var n=Math.floor(e),i=e-n,o=r*(1-t),s=r*(1-i*t),a=r*(1-(1-i)*t),A=n%6,l=[r,s,o,o,a,r][A],u=[a,r,r,s,o,o][A],c=[o,o,a,r,r,s][A];return{r:255*l,g:255*u,b:255*c}}(e.h,n,i),s=!0,a="hsv"):Xc(e.h)&&Xc(e.s)&&Xc(e.l)&&(n=jc(e.s),o=jc(e.l),t=function(e,t,r){var n,i,o;function s(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}if(e=Fc(e,360),t=Fc(t,100),r=Fc(r,100),0===t)n=i=o=r;else{var a=r<.5?r*(1+t):r+t-r*t,A=2*r-a;n=s(A,a,e+1/3),i=s(A,a,e),o=s(A,a,e-1/3)}return{r:255*n,g:255*i,b:255*o}}(e.h,n,o),s=!0,a="hsl"),e.hasOwnProperty("a")&&(r=e.a));return r=Ic(r),{ok:s,format:e.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:r}}(e);this._originalInput=e,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||r.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=r.ok}function vc(e,t,r){e=Fc(e,255),t=Fc(t,255),r=Fc(r,255);var n,i,o=Math.max(e,t,r),s=Math.min(e,t,r),a=(o+s)/2;if(o==s)n=i=0;else{var A=o-s;switch(i=a>.5?A/(2-o-s):A/(o+s),o){case e:n=(t-r)/A+(t<r?6:0);break;case t:n=(r-e)/A+2;break;case r:n=(e-t)/A+4}n/=6}return{h:n,s:i,l:a}}function _c(e,t,r){e=Fc(e,255),t=Fc(t,255),r=Fc(r,255);var n,i,o=Math.max(e,t,r),s=Math.min(e,t,r),a=o,A=o-s;if(i=0===o?0:A/o,o==s)n=0;else{switch(o){case e:n=(t-r)/A+(t<r?6:0);break;case t:n=(r-e)/A+2;break;case r:n=(e-t)/A+4}n/=6}return{h:n,s:i,v:a}}function xc(e,t,r,n){var i=[Gc(Math.round(e).toString(16)),Gc(Math.round(t).toString(16)),Gc(Math.round(r).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function wc(e,t,r,n){return[Gc(zc(n)),Gc(Math.round(e).toString(16)),Gc(Math.round(t).toString(16)),Gc(Math.round(r).toString(16))].join("")}function Tc(e,t){t=0===t?0:t||10;var r=bc(e).toHsl();return r.s-=t/100,r.s=Uc(r.s),bc(r)}function Sc(e,t){t=0===t?0:t||10;var r=bc(e).toHsl();return r.s+=t/100,r.s=Uc(r.s),bc(r)}function Ec(e){return bc(e).desaturate(100)}function Mc(e,t){t=0===t?0:t||10;var r=bc(e).toHsl();return r.l+=t/100,r.l=Uc(r.l),bc(r)}function Nc(e,t){t=0===t?0:t||10;var r=bc(e).toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(-t/100*255))),r.g=Math.max(0,Math.min(255,r.g-Math.round(-t/100*255))),r.b=Math.max(0,Math.min(255,r.b-Math.round(-t/100*255))),bc(r)}function Cc(e,t){t=0===t?0:t||10;var r=bc(e).toHsl();return r.l-=t/100,r.l=Uc(r.l),bc(r)}function Rc(e,t){var r=bc(e).toHsl(),n=(r.h+t)%360;return r.h=n<0?360+n:n,bc(r)}function Pc(e){var t=bc(e).toHsl();return t.h=(t.h+180)%360,bc(t)}function Dc(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var r=bc(e).toHsl(),n=[bc(e)],i=360/t,o=1;o<t;o++)n.push(bc({h:(r.h+o*i)%360,s:r.s,l:r.l}));return n}function Bc(e){var t=bc(e).toHsl(),r=t.h;return[bc(e),bc({h:(r+72)%360,s:t.s,l:t.l}),bc({h:(r+216)%360,s:t.s,l:t.l})]}function qc(e,t,r){t=t||6,r=r||30;var n=bc(e).toHsl(),i=360/r,o=[bc(e)];for(n.h=(n.h-(i*t>>1)+720)%360;--t;)n.h=(n.h+i)%360,o.push(bc(n));return o}function Oc(e,t){t=t||6;for(var r=bc(e).toHsv(),n=r.h,i=r.s,o=r.v,s=[],a=1/t;t--;)s.push(bc({h:n,s:i,v:o})),o=(o+a)%1;return s}bc.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,r,n=this.toRgb();return e=n.r/255,t=n.g/255,r=n.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))},setAlpha:function(e){return this._a=Ic(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=_c(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=_c(this._r,this._g,this._b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.v);return 1==this._a?"hsv("+t+", "+r+"%, "+n+"%)":"hsva("+t+", "+r+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var e=vc(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=vc(this._r,this._g,this._b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.l);return 1==this._a?"hsl("+t+", "+r+"%, "+n+"%)":"hsla("+t+", "+r+"%, "+n+"%, "+this._roundA+")"},toHex:function(e){return xc(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,r,n,i){var o=[Gc(Math.round(e).toString(16)),Gc(Math.round(t).toString(16)),Gc(Math.round(r).toString(16)),Gc(zc(n))];if(i&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)&&o[3].charAt(0)==o[3].charAt(1))return o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0);return o.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*Fc(this._r,255))+"%",g:Math.round(100*Fc(this._g,255))+"%",b:Math.round(100*Fc(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*Fc(this._r,255))+"%, "+Math.round(100*Fc(this._g,255))+"%, "+Math.round(100*Fc(this._b,255))+"%)":"rgba("+Math.round(100*Fc(this._r,255))+"%, "+Math.round(100*Fc(this._g,255))+"%, "+Math.round(100*Fc(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(kc[xc(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+wc(this._r,this._g,this._b,this._a),r=t,n=this._gradientType?"GradientType = 1, ":"";if(e){var i=bc(e);r="#"+wc(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+t+",endColorstr="+r+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,n=this._a<1&&this._a>=0;return t||!n||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"hex4"===e&&(r=this.toHex8String(!0)),"hex8"===e&&(r=this.toHex8String()),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),r||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return bc(this.toString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(Mc,arguments)},brighten:function(){return this._applyModification(Nc,arguments)},darken:function(){return this._applyModification(Cc,arguments)},desaturate:function(){return this._applyModification(Tc,arguments)},saturate:function(){return this._applyModification(Sc,arguments)},greyscale:function(){return this._applyModification(Ec,arguments)},spin:function(){return this._applyModification(Rc,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(qc,arguments)},complement:function(){return this._applyCombination(Pc,arguments)},monochromatic:function(){return this._applyCombination(Oc,arguments)},splitcomplement:function(){return this._applyCombination(Bc,arguments)},triad:function(){return this._applyCombination(Dc,[3])},tetrad:function(){return this._applyCombination(Dc,[4])}},bc.fromRatio=function(e,t){if("object"==mc(e)){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]="a"===n?e[n]:jc(e[n]));e=r}return bc(e,t)},bc.equals=function(e,t){return!(!e||!t)&&bc(e).toRgbString()==bc(t).toRgbString()},bc.random=function(){return bc.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},bc.mix=function(e,t,r){r=0===r?0:r||50;var n=bc(e).toRgb(),i=bc(t).toRgb(),o=r/100;return bc({r:(i.r-n.r)*o+n.r,g:(i.g-n.g)*o+n.g,b:(i.b-n.b)*o+n.b,a:(i.a-n.a)*o+n.a})},bc.readability=function(e,t){var r=bc(e),n=bc(t);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)},bc.isReadable=function(e,t,r){var n,i,o=bc.readability(e,t);switch(i=!1,(n=function(e){var t,r;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),r=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==r&&"large"!==r&&(r="small");return{level:t,size:r}}(r)).level+n.size){case"AAsmall":case"AAAlarge":i=o>=4.5;break;case"AAlarge":i=o>=3;break;case"AAAsmall":i=o>=7}return i},bc.mostReadable=function(e,t,r){var n,i,o,s,a=null,A=0;i=(r=r||{}).includeFallbackColors,o=r.level,s=r.size;for(var l=0;l<t.length;l++)(n=bc.readability(e,t[l]))>A&&(A=n,a=bc(t[l]));return bc.isReadable(e,a,{level:o,size:s})||!i?a:(r.includeFallbackColors=!1,bc.mostReadable(e,["#fff","#000"],r))};var Lc=bc.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},kc=bc.hexNames=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}(Lc);function Ic(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function Fc(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var r=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(e);return e=Math.min(t,Math.max(0,parseFloat(e))),r&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function Uc(e){return Math.min(1,Math.max(0,e))}function Vc(e){return parseInt(e,16)}function Gc(e){return 1==e.length?"0"+e:""+e}function jc(e){return e<=1&&(e=100*e+"%"),e}function zc(e){return Math.round(255*parseFloat(e)).toString(16)}function Hc(e){return Vc(e)/255}var Wc,Qc,$c,Yc=(Qc="[\\s|\\(]+("+(Wc="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+Wc+")[,|\\s]+("+Wc+")\\s*\\)?",$c="[\\s|\\(]+("+Wc+")[,|\\s]+("+Wc+")[,|\\s]+("+Wc+")[,|\\s]+("+Wc+")\\s*\\)?",{CSS_UNIT:new RegExp(Wc),rgb:new RegExp("rgb"+Qc),rgba:new RegExp("rgba"+$c),hsl:new RegExp("hsl"+Qc),hsla:new RegExp("hsla"+$c),hsv:new RegExp("hsv"+Qc),hsva:new RegExp("hsva"+$c),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function Xc(e){return!!Yc.CSS_UNIT.exec(e)}function Kc(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Zc(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}function Jc(e,t){return e.get(Zc(e,t))}function eh(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function th(e,t,r){return e.set(Zc(e,t),r),r}function rh(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oh(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function nh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||sh(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ih(e){return function(e){if(Array.isArray(e))return Kc(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||sh(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oh(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function sh(e,t){if(e){if("string"==typeof e)return Kc(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Kc(e,t):void 0}}var ah,Ah=new WeakMap,lh=new WeakMap,uh=new WeakMap,ch=new WeakMap,hh=new WeakMap,dh=new WeakMap,ph=function(){return rh(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),eh(this,Ah,new Map),eh(this,lh,new Map),eh(this,uh,function(e){return e}),eh(this,ch,function(){return{}}),eh(this,hh,function(){}),eh(this,dh,function(){})},[{key:"getObj",value:function(e){return Jc(Ah,this).get(Jc(uh,this).call(this,e))}},{key:"getData",value:function(e){return Jc(lh,this).get(e)}},{key:"entries",value:function(){return ih(Jc(lh,this).entries()).map(function(e){var t=nh(e,2),r=t[0];return[t[1],r]})}},{key:"id",value:function(e){return th(uh,this,fc(e)),this}},{key:"onCreateObj",value:function(e){return th(ch,this,e),this}},{key:"onUpdateObj",value:function(e){return th(hh,this,e),this}},{key:"onRemoveObj",value:function(e){return th(dh,this,e),this}},{key:"digest",value:function(e){var t=this;e.filter(function(e){return!Jc(Ah,t).has(Jc(uh,t).call(t,e))}).forEach(function(e){var r=Jc(ch,t).call(t,e);Jc(Ah,t).set(Jc(uh,t).call(t,e),r),Jc(lh,t).set(r,e)});var r=new Map(e.map(function(e){return[Jc(uh,t).call(t,e),e]}));return Jc(Ah,this).forEach(function(e,n){r.has(n)?Jc(hh,t).call(t,e,r.get(n)):(Jc(dh,t).call(t,e,n),Jc(Ah,t).delete(n),Jc(lh,t).delete(e))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}(),fh={exports:{}};var mh=(ah||(ah=1,fh.exports=function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var n=r(1),i=function(){function e(e,t,r){void 0===e&&(e=NaN),void 0===t&&(t=NaN),void 0===r&&(r=!1),this._minFPS=t,this._maxFPS=e,this._timeScale=1,this._currentTick=0,this._currentTime=0,this._tickDeltaTime=0,this._isRunning=!1,this._maxInterval=isNaN(this._minFPS)?NaN:1e3/this._minFPS,this._minInterval=isNaN(this._maxFPS)?NaN:1e3/this._maxFPS,this._onResume=new n.default,this._onPause=new n.default,this._onTick=new n.default,this._onTickOncePerFrame=new n.default,r||this.resume()}return e.prototype.updateOnce=function(e){e(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},e.prototype.resume=function(){this._isRunning||(this._isRunning=!0,this._lastTimeUpdated=this.getTimer(),this._onResume.dispatch(),this.animateOnce())},e.prototype.pause=function(){this._isRunning&&(this._isRunning=!1,this._onPause.dispatch(),window.cancelAnimationFrame(this._animationFrameHandle))},e.prototype.dispose=function(){this.pause(),this._onResume.removeAll(),this._onPause.removeAll(),this._onTick.removeAll()},Object.defineProperty(e.prototype,"currentTick",{get:function(){return this._currentTick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTimeSeconds",{get:function(){return this._currentTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tickDeltaTimeSeconds",{get:function(){return this._tickDeltaTime/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeScale",{get:function(){return this._timeScale},set:function(e){this._timeScale!==e&&(this._timeScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onResume",{get:function(){return this._onResume},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onPause",{get:function(){return this._onPause},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onTick",{get:function(){return this._onTick},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onTickOncePerFrame",{get:function(){return this._onTickOncePerFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),e.prototype.animateOnce=function(){var e=this;this._animationFrameHandle=window.requestAnimationFrame(function(){return e.onFrame()})},e.prototype.onFrame=function(){if(this._now=this.getTimer(),this._frameDeltaTime=this._now-this._lastTimeUpdated,isNaN(this._minInterval)||this._frameDeltaTime>=this._minInterval)if(isNaN(this._maxInterval))this.update(this._frameDeltaTime*this._timeScale,!0),this._lastTimeUpdated=this._now;else for(this._interval=Math.min(this._frameDeltaTime,this._maxInterval);this._now>=this._lastTimeUpdated+this._interval;)this.update(this._interval*this._timeScale,this._now<=this._lastTimeUpdated+2*this._maxInterval),this._lastTimeUpdated+=this._interval;this._isRunning&&this.animateOnce()},e.prototype.update=function(e,t){void 0===t&&(t=!0),this._currentTick++,this._currentTime+=e,this._tickDeltaTime=e,this._onTick.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick),t&&this._onTickOncePerFrame.dispatch(this.currentTimeSeconds,this.tickDeltaTimeSeconds,this.currentTick)},e.prototype.getTimer=function(){return Date.now()},e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){!function(t,r){e.exports=r()}(0,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t){var r=function(){function e(){this.functions=[]}return e.prototype.add=function(e){return-1===this.functions.indexOf(e)&&(this.functions.push(e),!0)},e.prototype.remove=function(e){var t=this.functions.indexOf(e);return t>-1&&(this.functions.splice(t,1),!0)},e.prototype.removeAll=function(){return this.functions.length>0&&(this.functions.length=0,!0)},e.prototype.dispatch=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.functions.concat().forEach(function(t){t.apply(void 0,e)})},Object.defineProperty(e.prototype,"numItems",{get:function(){return this.functions.length},enumerable:!0,configurable:!0}),e}();Object.defineProperty(t,"__esModule",{value:!0}),t.default=r}])})}])),fh.exports);const gh=T(mh),yh=134217729;function bh(e,t,r,n,i){let o,s,a,A,l=t[0],u=n[0],c=0,h=0;u>l==u>-l?(o=l,l=t[++c]):(o=u,u=n[++h]);let d=0;if(c<e&&h<r)for(u>l==u>-l?(s=l+o,a=o-(s-l),l=t[++c]):(s=u+o,a=o-(s-u),u=n[++h]),o=s,0!==a&&(i[d++]=a);c<e&&h<r;)u>l==u>-l?(s=o+l,A=s-o,a=o-(s-A)+(l-A),l=t[++c]):(s=o+u,A=s-o,a=o-(s-A)+(u-A),u=n[++h]),o=s,0!==a&&(i[d++]=a);for(;c<e;)s=o+l,A=s-o,a=o-(s-A)+(l-A),l=t[++c],o=s,0!==a&&(i[d++]=a);for(;h<r;)s=o+u,A=s-o,a=o-(s-A)+(u-A),u=n[++h],o=s,0!==a&&(i[d++]=a);return 0===o&&0!==d||(i[d++]=o),d}function vh(e){return new Float64Array(e)}const _h=vh(4),xh=vh(8),wh=vh(12),Th=vh(16),Sh=vh(4);function Eh(e,t,r,n,i,o){const s=(t-o)*(r-i),a=(e-i)*(n-o),A=s-a,l=Math.abs(s+a);return Math.abs(A)>=33306690738754716e-32*l?A:-function(e,t,r,n,i,o,s){let a,A,l,u,c,h,d,p,f,m,g,y,b,v,_,x,w,T;const S=e-i,E=r-i,M=t-o,N=n-o;v=S*N,h=yh*S,d=h-(h-S),p=S-d,h=yh*N,f=h-(h-N),m=N-f,_=p*m-(v-d*f-p*f-d*m),x=M*E,h=yh*M,d=h-(h-M),p=M-d,h=yh*E,f=h-(h-E),m=E-f,w=p*m-(x-d*f-p*f-d*m),g=_-w,c=_-g,_h[0]=_-(g+c)+(c-w),y=v+g,c=y-v,b=v-(y-c)+(g-c),g=b-x,c=b-g,_h[1]=b-(g+c)+(c-x),T=y+g,c=T-y,_h[2]=y-(T-c)+(g-c),_h[3]=T;let C=function(e,t){let r=t[0];for(let n=1;n<e;n++)r+=t[n];return r}(4,_h),R=22204460492503146e-32*s;if(C>=R||-C>=R)return C;if(c=e-S,a=e-(S+c)+(c-i),c=r-E,l=r-(E+c)+(c-i),c=t-M,A=t-(M+c)+(c-o),c=n-N,u=n-(N+c)+(c-o),0===a&&0===A&&0===l&&0===u)return C;if(R=11093356479670487e-47*s+33306690738754706e-32*Math.abs(C),C+=S*u+N*a-(M*l+E*A),C>=R||-C>=R)return C;v=a*N,h=yh*a,d=h-(h-a),p=a-d,h=yh*N,f=h-(h-N),m=N-f,_=p*m-(v-d*f-p*f-d*m),x=A*E,h=yh*A,d=h-(h-A),p=A-d,h=yh*E,f=h-(h-E),m=E-f,w=p*m-(x-d*f-p*f-d*m),g=_-w,c=_-g,Sh[0]=_-(g+c)+(c-w),y=v+g,c=y-v,b=v-(y-c)+(g-c),g=b-x,c=b-g,Sh[1]=b-(g+c)+(c-x),T=y+g,c=T-y,Sh[2]=y-(T-c)+(g-c),Sh[3]=T;const P=bh(4,_h,4,Sh,xh);v=S*u,h=yh*S,d=h-(h-S),p=S-d,h=yh*u,f=h-(h-u),m=u-f,_=p*m-(v-d*f-p*f-d*m),x=M*l,h=yh*M,d=h-(h-M),p=M-d,h=yh*l,f=h-(h-l),m=l-f,w=p*m-(x-d*f-p*f-d*m),g=_-w,c=_-g,Sh[0]=_-(g+c)+(c-w),y=v+g,c=y-v,b=v-(y-c)+(g-c),g=b-x,c=b-g,Sh[1]=b-(g+c)+(c-x),T=y+g,c=T-y,Sh[2]=y-(T-c)+(g-c),Sh[3]=T;const D=bh(P,xh,4,Sh,wh);v=a*u,h=yh*a,d=h-(h-a),p=a-d,h=yh*u,f=h-(h-u),m=u-f,_=p*m-(v-d*f-p*f-d*m),x=A*l,h=yh*A,d=h-(h-A),p=A-d,h=yh*l,f=h-(h-l),m=l-f,w=p*m-(x-d*f-p*f-d*m),g=_-w,c=_-g,Sh[0]=_-(g+c)+(c-w),y=v+g,c=y-v,b=v-(y-c)+(g-c),g=b-x,c=b-g,Sh[1]=b-(g+c)+(c-x),T=y+g,c=T-y,Sh[2]=y-(T-c)+(g-c),Sh[3]=T;const B=bh(D,wh,4,Sh,Th);return Th[B-1]}(e,t,r,n,i,o,l)}const Mh=Math.pow(2,-52),Nh=new Uint32Array(512);class Ch{static from(e,t=Oh,r=Lh){const n=e.length,i=new Float64Array(2*n);for(let o=0;o<n;o++){const n=e[o];i[2*o]=t(n),i[2*o+1]=r(n)}return new Ch(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:n,_hullHash:i}=this,o=e.length>>1;let s=1/0,a=1/0,A=-1/0,l=-1/0;for(let T=0;T<o;T++){const t=e[2*T],r=e[2*T+1];t<s&&(s=t),r<a&&(a=r),t>A&&(A=t),r>l&&(l=r),this._ids[T]=T}const u=(s+A)/2,c=(a+l)/2;let h,d,p;for(let T=0,S=1/0;T<o;T++){const t=Rh(u,c,e[2*T],e[2*T+1]);t<S&&(h=T,S=t)}const f=e[2*h],m=e[2*h+1];for(let T=0,S=1/0;T<o;T++){if(T===h)continue;const t=Rh(f,m,e[2*T],e[2*T+1]);t<S&&t>0&&(d=T,S=t)}let g=e[2*d],y=e[2*d+1],b=1/0;for(let T=0;T<o;T++){if(T===h||T===d)continue;const t=Dh(f,m,g,y,e[2*T],e[2*T+1]);t<b&&(p=T,b=t)}let v=e[2*p],_=e[2*p+1];if(b===1/0){for(let n=0;n<o;n++)this._dists[n]=e[2*n]-e[0]||e[2*n+1]-e[1];Bh(this._ids,this._dists,0,o-1);const t=new Uint32Array(o);let r=0;for(let e=0,n=-1/0;e<o;e++){const i=this._ids[e],o=this._dists[i];o>n&&(t[r++]=i,n=o)}return this.hull=t.subarray(0,r),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Eh(f,m,g,y,v,_)<0){const e=d,t=g,r=y;d=p,g=v,y=_,p=e,v=t,_=r}const x=function(e,t,r,n,i,o){const s=r-e,a=n-t,A=i-e,l=o-t,u=s*s+a*a,c=A*A+l*l,h=.5/(s*l-a*A),d=e+(l*u-a*c)*h,p=t+(s*c-A*u)*h;return{x:d,y:p}}(f,m,g,y,v,_);this._cx=x.x,this._cy=x.y;for(let T=0;T<o;T++)this._dists[T]=Rh(e[2*T],e[2*T+1],x.x,x.y);Bh(this._ids,this._dists,0,o-1),this._hullStart=h;let w=3;r[h]=t[p]=d,r[d]=t[h]=p,r[p]=t[d]=h,n[h]=0,n[d]=1,n[p]=2,i.fill(-1),i[this._hashKey(f,m)]=h,i[this._hashKey(g,y)]=d,i[this._hashKey(v,_)]=p,this.trianglesLen=0,this._addTriangle(h,d,p,-1,-1,-1);for(let T,S,E=0;E<this._ids.length;E++){const o=this._ids[E],s=e[2*o],a=e[2*o+1];if(E>0&&Math.abs(s-T)<=Mh&&Math.abs(a-S)<=Mh)continue;if(T=s,S=a,o===h||o===d||o===p)continue;let A=0;for(let e=0,t=this._hashKey(s,a);e<this._hashSize&&(A=i[(t+e)%this._hashSize],-1===A||A===r[A]);e++);A=t[A];let l,u=A;for(;l=r[u],Eh(s,a,e[2*u],e[2*u+1],e[2*l],e[2*l+1])>=0;)if(u=l,u===A){u=-1;break}if(-1===u)continue;let c=this._addTriangle(u,o,r[u],-1,-1,n[u]);n[o]=this._legalize(c+2),n[u]=c,w++;let f=r[u];for(;l=r[f],Eh(s,a,e[2*f],e[2*f+1],e[2*l],e[2*l+1])<0;)c=this._addTriangle(f,o,l,n[o],-1,n[f]),n[o]=this._legalize(c+2),r[f]=f,w--,f=l;if(u===A)for(;l=t[u],Eh(s,a,e[2*l],e[2*l+1],e[2*u],e[2*u+1])<0;)c=this._addTriangle(l,o,u,-1,n[u],n[l]),this._legalize(c+2),n[l]=c,r[u]=u,w--,u=l;this._hullStart=t[o]=u,r[u]=t[f]=o,r[o]=f,i[this._hashKey(s,a)]=o,i[this._hashKey(e[2*u],e[2*u+1])]=u}this.hull=new Uint32Array(w);for(let T=0,S=this._hullStart;T<w;T++)this.hull[T]=S,S=r[S];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const r=e/(Math.abs(e)+Math.abs(t));return(t>0?3-r:1+r)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:n}=this;let i=0,o=0;for(;;){const s=r[e],a=e-e%3;if(o=a+(e+2)%3,-1===s){if(0===i)break;e=Nh[--i];continue}const A=s-s%3,l=a+(e+1)%3,u=A+(s+2)%3,c=t[o],h=t[e],d=t[l],p=t[u];if(Ph(n[2*c],n[2*c+1],n[2*h],n[2*h+1],n[2*d],n[2*d+1],n[2*p],n[2*p+1])){t[e]=p,t[s]=c;const n=r[u];if(-1===n){let t=this._hullStart;do{if(this._hullTri[t]===u){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,n),this._link(s,r[o]),this._link(o,u);const a=A+(s+1)%3;i<Nh.length&&(Nh[i++]=a)}else{if(0===i)break;e=Nh[--i]}}return o}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,r,n,i,o){const s=this.trianglesLen;return this._triangles[s]=e,this._triangles[s+1]=t,this._triangles[s+2]=r,this._link(s,n),this._link(s+1,i),this._link(s+2,o),this.trianglesLen+=3,s}}function Rh(e,t,r,n){const i=e-r,o=t-n;return i*i+o*o}function Ph(e,t,r,n,i,o,s,a){const A=e-s,l=t-a,u=r-s,c=n-a,h=i-s,d=o-a,p=u*u+c*c,f=h*h+d*d;return A*(c*f-p*d)-l*(u*f-p*h)+(A*A+l*l)*(u*d-c*h)<0}function Dh(e,t,r,n,i,o){const s=r-e,a=n-t,A=i-e,l=o-t,u=s*s+a*a,c=A*A+l*l,h=.5/(s*l-a*A),d=(l*u-a*c)*h,p=(s*c-A*u)*h;return d*d+p*p}function Bh(e,t,r,n){if(n-r<=20)for(let i=r+1;i<=n;i++){const n=e[i],o=t[n];let s=i-1;for(;s>=r&&t[e[s]]>o;)e[s+1]=e[s--];e[s+1]=n}else{let i=r+1,o=n;qh(e,r+n>>1,i),t[e[r]]>t[e[n]]&&qh(e,r,n),t[e[i]]>t[e[n]]&&qh(e,i,n),t[e[r]]>t[e[i]]&&qh(e,r,i);const s=e[i],a=t[s];for(;;){do{i++}while(t[e[i]]<a);do{o--}while(t[e[o]]>a);if(o<i)break;qh(e,i,o)}e[r+1]=e[o],e[o]=s,n-i+1>=o-r?(Bh(e,t,i,n),Bh(e,t,r,o-1)):(Bh(e,t,r,o-1),Bh(e,t,i,n))}}function qh(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function Oh(e){return e[0]}function Lh(e){return e[1]}function kh(e,t){var r,n,i,o,s,a,A,l,u,c=0,h=e[0],d=e[1],p=t.length;for(r=0;r<p;r++){n=0;var f=t[r],m=f.length-1;if((l=f[0])[0]!==f[m][0]&&l[1]!==f[m][1])throw new Error("First and last coordinates in a ring must be the same");for(o=l[0]-h,s=l[1]-d;n<m;n++){if(a=(u=f[n+1])[0]-h,A=u[1]-d,0===s&&0===A){if(a<=0&&o>=0||o<=0&&a>=0)return 0}else if(A>=0&&s<=0||A<=0&&s>=0){if(0===(i=Eh(o,a,s,A,0,0)))return 0;(i>0&&A>0&&s<=0||i<0&&A<=0&&s>0)&&c++}l=u,s=A,o=a}}return c%2!=0}var Ih=function(e,t,r={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const n=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}(e),i="Feature"===(o=t).type?o.geometry:o;var o;const s=i.type,a=t.bbox;let A=i.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(n,a))return!1;"Polygon"===s&&(A=[A]);let l=!1;for(var u=0;u<A.length;++u){const e=kh(n,A[u]);if(0===e)return!r.ignoreBoundary;e&&(l=!0)}return l};const Fh=1e-6;class Uh{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,r){const n=(e=+e)+(r=+r),i=t=+t;if(r<0)throw new Error("negative radius");null===this._x1?this._+=`M${n},${i}`:(Math.abs(this._x1-n)>Fh||Math.abs(this._y1-i)>Fh)&&(this._+="L"+n+","+i),r&&(this._+=`A${r},${r},0,1,1,${e-r},${t}A${r},${r},0,1,1,${this._x1=n},${this._y1=i}`)}rect(e,t,r,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+r}v${+n}h${-r}Z`}value(){return this._||null}}class Vh{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Gh{constructor(e,[t,r,n,i]=[0,0,960,500]){if(!((n=+n)>=(t=+t)&&(i=+i)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=n,this.xmin=t,this.ymax=i,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:r},vectors:n}=this;let i,o;const s=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let p,f,m=0,g=0,y=r.length;m<y;m+=3,g+=2){const n=2*r[m],a=2*r[m+1],A=2*r[m+2],l=e[n],u=e[n+1],c=e[a],h=e[a+1],d=e[A],y=e[A+1],b=c-l,v=h-u,_=d-l,x=y-u,w=2*(b*x-v*_);if(Math.abs(w)<1e-9){if(void 0===i){i=o=0;for(const r of t)i+=e[2*r],o+=e[2*r+1];i/=t.length,o/=t.length}const r=1e9*Math.sign((i-l)*x-(o-u)*_);p=(l+d)/2-r*x,f=(u+y)/2+r*_}else{const e=1/w,t=b*b+v*v,r=_*_+x*x;p=l+(x*t-v*r)*e,f=u+(b*r-_*t)*e}s[g]=p,s[g+1]=f}let a,A,l,u=t[t.length-1],c=4*u,h=e[2*u],d=e[2*u+1];n.fill(0);for(let p=0;p<t.length;++p)u=t[p],a=c,A=h,l=d,c=4*u,h=e[2*u],d=e[2*u+1],n[a+2]=n[c]=l-d,n[a+3]=n[c+1]=h-A}render(e){const t=null==e?e=new Uh:void 0,{delaunay:{halfedges:r,inedges:n,hull:i},circumcenters:o,vectors:s}=this;if(i.length<=1)return null;for(let l=0,u=r.length;l<u;++l){const t=r[l];if(t<l)continue;const n=2*Math.floor(l/3),i=2*Math.floor(t/3),s=o[n],a=o[n+1],A=o[i],u=o[i+1];this._renderSegment(s,a,A,u,e)}let a,A=i[i.length-1];for(let l=0;l<i.length;++l){a=A,A=i[l];const t=2*Math.floor(n[A]/3),r=o[t],u=o[t+1],c=4*a,h=this._project(r,u,s[c+2],s[c+3]);h&&this._renderSegment(r,u,h[0],h[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new Uh:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const r=null==t?t=new Uh:void 0,n=this._clip(e);if(null===n||!n.length)return;t.moveTo(n[0],n[1]);let i=n.length;for(;n[0]===n[i-2]&&n[1]===n[i-1]&&i>1;)i-=2;for(let o=2;o<i;o+=2)n[o]===n[o-2]&&n[o+1]===n[o-1]||t.lineTo(n[o],n[o+1]);return t.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,r=e.length/2;t<r;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new Vh;return this.renderCell(e,t),t.value()}_renderSegment(e,t,r,n,i){let o;const s=this._regioncode(e,t),a=this._regioncode(r,n);0===s&&0===a?(i.moveTo(e,t),i.lineTo(r,n)):(o=this._clipSegment(e,t,r,n,s,a))&&(i.moveTo(o[0],o[1]),i.lineTo(o[2],o[3]))}contains(e,t,r){return(t=+t)==t&&(r=+r)==r&&this.delaunay._step(e,t,r)===e}*neighbors(e){const t=this._clip(e);if(t)for(const r of this.delaunay.neighbors(e)){const e=this._clip(r);if(e)e:for(let n=0,i=t.length;n<i;n+=2)for(let o=0,s=e.length;o<s;o+=2)if(t[n]===e[o]&&t[n+1]===e[o+1]&&t[(n+2)%i]===e[(o+s-2)%s]&&t[(n+3)%i]===e[(o+s-1)%s]){yield r;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:r,halfedges:n,triangles:i}}=this,o=r[e];if(-1===o)return null;const s=[];let a=o;do{const r=Math.floor(a/3);if(s.push(t[2*r],t[2*r+1]),a=a%3==2?a-2:a+1,i[a]!==e)break;a=n[a]}while(a!==o&&-1!==a);return s}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:r}=this,n=4*e;return this._simplify(r[n]||r[n+1]?this._clipInfinite(e,t,r[n],r[n+1],r[n+2],r[n+3]):this._clipFinite(e,t))}_clipFinite(e,t){const r=t.length;let n,i,o,s,a=null,A=t[r-2],l=t[r-1],u=this._regioncode(A,l),c=0;for(let h=0;h<r;h+=2)if(n=A,i=l,A=t[h],l=t[h+1],o=u,u=this._regioncode(A,l),0===o&&0===u)s=c,c=0,a?a.push(A,l):a=[A,l];else{let t,r,h,d,p;if(0===o){if(null===(t=this._clipSegment(n,i,A,l,o,u)))continue;[r,h,d,p]=t}else{if(null===(t=this._clipSegment(A,l,n,i,u,o)))continue;[d,p,r,h]=t,s=c,c=this._edgecode(r,h),s&&c&&this._edge(e,s,c,a,a.length),a?a.push(r,h):a=[r,h]}s=c,c=this._edgecode(d,p),s&&c&&this._edge(e,s,c,a,a.length),a?a.push(d,p):a=[d,p]}if(a)s=c,c=this._edgecode(a[0],a[1]),s&&c&&this._edge(e,s,c,a,a.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(e,t,r,n,i,o){const s=i<o;for(s&&([e,t,r,n,i,o]=[r,n,e,t,o,i]);;){if(0===i&&0===o)return s?[r,n,e,t]:[e,t,r,n];if(i&o)return null;let a,A,l=i||o;8&l?(a=e+(r-e)*(this.ymax-t)/(n-t),A=this.ymax):4&l?(a=e+(r-e)*(this.ymin-t)/(n-t),A=this.ymin):2&l?(A=t+(n-t)*(this.xmax-e)/(r-e),a=this.xmax):(A=t+(n-t)*(this.xmin-e)/(r-e),a=this.xmin),i?(e=a,t=A,i=this._regioncode(e,t)):(r=a,n=A,o=this._regioncode(r,n))}}_clipInfinite(e,t,r,n,i,o){let s,a=Array.from(t);if((s=this._project(a[0],a[1],r,n))&&a.unshift(s[0],s[1]),(s=this._project(a[a.length-2],a[a.length-1],i,o))&&a.push(s[0],s[1]),a=this._clipFinite(e,a))for(let A,l=0,u=a.length,c=this._edgecode(a[u-2],a[u-1]);l<u;l+=2)A=c,c=this._edgecode(a[l],a[l+1]),A&&c&&(l=this._edge(e,A,c,a,l),u=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,r,n,i){for(;t!==r;){let r,o;switch(t){case 5:t=4;continue;case 4:t=6,r=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,r=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,r=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,r=this.xmin,o=this.ymin}n[i]===r&&n[i+1]===o||!this.contains(e,r,o)||(n.splice(i,0,r,o),i+=2)}return i}_project(e,t,r,n){let i,o,s,a=1/0;if(n<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/n)<a&&(s=this.ymin,o=e+(a=i)*r)}else if(n>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/n)<a&&(s=this.ymax,o=e+(a=i)*r)}if(r>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/r)<a&&(o=this.xmax,s=t+(a=i)*n)}else if(r<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/r)<a&&(o=this.xmin,s=t+(a=i)*n)}return[o,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const r=(t+2)%e.length,n=(t+4)%e.length;(e[t]===e[r]&&e[r]===e[n]||e[t+1]===e[r+1]&&e[r+1]===e[n+1])&&(e.splice(r,2),t-=2)}e.length||(e=null)}return e}}const jh=2*Math.PI,zh=Math.pow;function Hh(e){return e[0]}function Wh(e){return e[1]}function Qh(e,t,r){return[e+Math.sin(e+t)*r,t+Math.cos(e-t)*r]}class $h{static from(e,t=Hh,r=Wh,n){return new $h("length"in e?function(e,t,r,n){const i=e.length,o=new Float64Array(2*i);for(let s=0;s<i;++s){const i=e[s];o[2*s]=t.call(n,i,s,e),o[2*s+1]=r.call(n,i,s,e)}return o}(e,t,r,n):Float64Array.from(function*(e,t,r,n){let i=0;for(const o of e)yield t.call(n,o,i,e),yield r.call(n,o,i,e),++i}(e,t,r,n)))}constructor(e){this._delaunator=new Ch(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:r}=e;for(let n=0;n<t.length;n+=3){const e=2*t[n],i=2*t[n+1],o=2*t[n+2];if((r[o]-r[e])*(r[i+1]-r[e+1])-(r[i]-r[e])*(r[o+1]-r[e+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,r)=>t[2*e]-t[2*r]||t[2*e+1]-t[2*r+1]);const e=this.collinear[0],r=this.collinear[this.collinear.length-1],n=[t[2*e],t[2*e+1],t[2*r],t[2*r+1]],i=1e-8*Math.hypot(n[3]-n[1],n[2]-n[0]);for(let o=0,s=t.length/2;o<s;++o){const e=Qh(t[2*o],t[2*o+1],i);t[2*o]=e[0],t[2*o+1]=e[1]}this._delaunator=new Ch(t)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),s=this._hullIndex.fill(-1);for(let a=0,A=r.length;a<A;++a){const e=i[a%3==2?a-2:a+1];-1!==r[a]&&-1!==o[e]||(o[e]=a)}for(let a=0,A=n.length;a<A;++a)s[n[a]]=a;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],o[n[0]]=1,2===n.length&&(o[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(e){return new Gh(this,e)}*neighbors(e){const{inedges:t,hull:r,_hullIndex:n,halfedges:i,triangles:o,collinear:s}=this;if(s){const t=s.indexOf(e);return t>0&&(yield s[t-1]),void(t<s.length-1&&(yield s[t+1]))}const a=t[e];if(-1===a)return;let A=a,l=-1;do{if(yield l=o[A],A=A%3==2?A-2:A+1,o[A]!==e)return;if(A=i[A],-1===A){const t=r[(n[e]+1)%r.length];return void(t!==l&&(yield t))}}while(A!==a)}find(e,t,r=0){if((e=+e)!=e||(t=+t)!=t)return-1;const n=r;let i;for(;(i=this._step(r,e,t))>=0&&i!==r&&i!==n;)r=i;return i}_step(e,t,r){const{inedges:n,hull:i,_hullIndex:o,halfedges:s,triangles:a,points:A}=this;if(-1===n[e]||!A.length)return(e+1)%(A.length>>1);let l=e,u=zh(t-A[2*e],2)+zh(r-A[2*e+1],2);const c=n[e];let h=c;do{let n=a[h];const c=zh(t-A[2*n],2)+zh(r-A[2*n+1],2);if(c<u&&(u=c,l=n),h=h%3==2?h-2:h+1,a[h]!==e)break;if(h=s[h],-1===h){if(h=i[(o[e]+1)%i.length],h!==n&&zh(t-A[2*h],2)+zh(r-A[2*h+1],2)<u)return h;break}}while(h!==c);return l}render(e){const t=null==e?e=new Uh:void 0,{points:r,halfedges:n,triangles:i}=this;for(let o=0,s=n.length;o<s;++o){const t=n[o];if(t<o)continue;const s=2*i[o],a=2*i[t];e.moveTo(r[s],r[s+1]),e.lineTo(r[a],r[a+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){void 0!==t||e&&"function"==typeof e.moveTo||(t=e,e=null),t=null==t?2:+t;const r=null==e?e=new Uh:void 0,{points:n}=this;for(let i=0,o=n.length;i<o;i+=2){const r=n[i],o=n[i+1];e.moveTo(r+t,o),e.arc(r,o,t,0,jh)}return r&&r.value()}renderHull(e){const t=null==e?e=new Uh:void 0,{hull:r,points:n}=this,i=2*r[0],o=r.length;e.moveTo(n[i],n[i+1]);for(let s=1;s<o;++s){const t=2*r[s];e.lineTo(n[t],n[t+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new Vh;return this.renderHull(e),e.value()}renderTriangle(e,t){const r=null==t?t=new Uh:void 0,{points:n,triangles:i}=this,o=2*i[e*=3],s=2*i[e+1],a=2*i[e+2];return t.moveTo(n[o],n[o+1]),t.lineTo(n[s],n[s+1]),t.lineTo(n[a],n[a+1]),t.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,r=e.length/3;t<r;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new Vh;return this.renderTriangle(e,t),t.value()}}const Yh=Math.PI,Xh=Yh/2,Kh=180/Yh,Zh=Yh/180,Jh=Math.atan2,ed=Math.cos,td=Math.max,rd=Math.min,nd=Math.sin,id=Math.sign||function(e){return e>0?1:e<0?-1:0},od=Math.sqrt;function sd(e){return e>1?Xh:e<-1?-Xh:Math.asin(e)}function ad(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ad(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function ld(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]}function ud(e){var t=od(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]}function cd(e){return[Jh(e[1],e[0])*Kh,sd(td(-1,rd(1,e[2])))*Kh]}function hd(e){const t=e[0]*Zh,r=e[1]*Zh,n=ed(r);return[n*ed(t),n*nd(t),nd(r)]}function dd(e){return e=e.map(e=>hd(e)),ad(e[0],Ad(e[2],e[1]))}function pd(e){const t=function(e){if(e.length<2)return{};let t=0;for(;isNaN(e[t][0]+e[t][1])&&t++<e.length;);const r=function(e){function t(t){return(t=e(t[0]*Qs,t[1]*Qs))[0]*=Ws,t[1]*=Ws,t}return e=BA(e[0]*Qs,e[1]*Qs,e.length>2?e[2]*Qs:0),t.invert=function(t){return(t=e.invert(t[0]*Qs,t[1]*Qs))[0]*=Ws,t[1]*=Ws,t},t}(e[t]),n=Fl().translate([0,0]).scale(1).rotate(r.invert([180,0]));e=e.map(n);const i=[];let o=1;for(let c=0,h=e.length;c<h;c++){let t=e[c][0]**2+e[c][1]**2;!isFinite(t)||t>1e32?i.push(c):t>o&&(o=t)}const s=1e6*od(o);i.forEach(t=>e[t]=[s,0]),e.push([0,s]),e.push([-s,0]),e.push([0,-s]);const a=$h.from(e);a.projection=n;const{triangles:A,halfedges:l,inedges:u}=a;for(let c=0,h=l.length;c<h;c++)if(l[c]<0){const e=c%3==2?c-2:c+1,r=c%3==0?c+2:c-1,n=l[e],i=l[r];l[n]=i,l[i]=n,l[e]=l[r]=-1,A[c]=A[e]=A[r]=t,u[A[n]]=n%3==0?n+2:n-1,u[A[i]]=i%3==0?i+2:i-1,c+=2-c%3}else A[c]>e.length-3-1&&(A[c]=t);return a}(e),r=function(e){const{triangles:t}=e;if(!t)return[];const r=[];for(let n=0,i=t.length/3;n<i;n++){const e=t[3*n],i=t[3*n+1],o=t[3*n+2];e!==i&&i!==o&&r.push([e,o,i])}return r}(t),n=function(e,t){const r=new Set;return 2===t.length?[[0,1]]:(e.forEach(e=>{if(e[0]!==e[1]&&!(dd(e.map(e=>t[e]))<0))for(let t,n=0;n<3;n++)t=(n+1)%3,r.add(ao([e[n],e[t]]).join("-"))}),Array.from(r,e=>e.split("-").map(Number)))}(r,e),i=function(e,t){const r=[];e.forEach(e=>{for(let t=0;t<3;t++){const n=e[t],i=e[(t+1)%3];r[n]=r[n]||[],r[n].push(i)}}),0===e.length&&(2===t?(r[0]=[1],r[1]=[0]):1===t&&(r[0]=[]));return r}(r,e.length),o=function(e,t){function r(e,t){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}return function(n,i,o){void 0===o&&(o=0);let s,a,A=o;const l=hd([n,i]);do{s=o,o=null,a=r(l,hd(t[s])),e[s].forEach(e=>{let n=r(l,hd(t[e]));if(n<a)return a=n,o=e,void(A=e)})}while(null!==o);return A}}(i,e),s=function(e,t){return e.map(e=>{const r=e.map(e=>t[e]).map(hd);return cd(ud(ld(ld(Ad(r[1],r[0]),Ad(r[2],r[1])),Ad(r[0],r[2]))))})}(r,e),{polygons:a,centers:A}=function(e,t,r){const n=[],i=e.slice();if(0===t.length){if(r.length<2)return{polygons:n,centers:i};if(2===r.length){const e=hd(r[0]),t=hd(r[1]),o=ud(ld(e,t)),a=ud(Ad(e,t)),A=Ad(o,a),l=[o,Ad(o,A),Ad(Ad(o,A),A),Ad(Ad(Ad(o,A),A),A)].map(cd).map(s);return n.push(l),n.push(l.slice().reverse()),{polygons:n,centers:i}}}t.forEach((e,t)=>{for(let r=0;r<3;r++){const i=e[r],o=e[(r+1)%3],s=e[(r+2)%3];n[i]=n[i]||[],n[i].push([o,s,t,[i,o,s]])}});const o=n.map(e=>{const t=[e[0][2]];let n=e[0][1];for(let r=1;r<e.length;r++)for(let i=0;i<e.length;i++)if(e[i][0]==n){n=e[i][1],t.push(e[i][2]);break}if(t.length>2)return t;if(2==t.length){const n=fd(r[e[0][3][0]],r[e[0][3][1]],i[t[0]]),o=fd(r[e[0][3][2]],r[e[0][3][0]],i[t[0]]),a=s(n),A=s(o);return[t[0],A,t[1],a]}});function s(e){let r=-1;return i.slice(t.length,1/0).forEach((n,i)=>{n[0]===e[0]&&n[1]===e[1]&&(r=i+t.length)}),r<0&&(r=i.length,i.push(e)),r}return{polygons:o,centers:i}}(s,r,e),l=function(e){const t=[];return e.forEach(e=>{if(!e)return;let r=e[e.length-1];for(let n of e)n>r&&t.push([r,n]),r=n}),t}(a),u=function(e,t){const r=new Set,n=[];e.map(e=>{if(!(dd(e.map(e=>t[e>t.length?0:e]))>1e-12))for(let t=0;t<3;t++){let n=[e[t],e[(t+1)%3]],i=`${n[0]}-${n[1]}`;r.has(i)?r.delete(i):r.add(`${n[1]}-${n[0]}`)}});const i=new Map;let o;if(r.forEach(e=>{e=e.split("-").map(Number),i.set(e[0],e[1]),o=e[0]}),void 0===o)return n;let s=o;do{n.push(s);let e=i.get(s);i.set(s,-1),s=e}while(s>-1&&s!==o);return n}(r,e),c=function(e,t){return function(r){const n=new Map,i=new Map;return e.forEach((e,t)=>{const o=e.join("-");n.set(o,r[t]),i.set(o,!0)}),t.forEach(e=>{let t=0,r=-1;for(let i=0;i<3;i++){let o=ao([e[i],e[(i+1)%3]]).join("-");n.get(o)>t&&(t=n.get(o),r=o)}i.set(r,!1)}),e.map(e=>i.get(e.join("-")))}}(n,r);return{delaunay:t,edges:n,triangles:r,centers:A,neighbors:i,polygons:a,mesh:l,hull:u,urquhart:c,find:o}}function fd(e,t,r){e=hd(e),t=hd(t),r=hd(r);const n=id(ad(Ad(t,e),r));return cd(ud(ld(e,t)).map(e=>n*e))}function md(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function gd(e,t,r){return t=yd(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,bd()?Reflect.construct(t,[],yd(e).constructor):t.apply(e,r))}function yd(e){return yd=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},yd(e)}function bd(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(bd=function(){return!!e})()}function vd(e,t){return vd=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vd(e,t)}function _d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||wd(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xd(e){return function(e){if(Array.isArray(e))return md(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||wd(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wd(e,t){if(e){if("string"==typeof e)return md(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?md(e,t):void 0}}function Td(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).resolution,r=void 0===t?1/0:t,n=function(e,t){return e.map(function(e){var r,n=[];return e.forEach(function(e){if(r){var i=180*ll(e,r)/Math.PI;if(i>t)for(var o=_l(r,e),s=1/Math.ceil(i/t),a=s;a<1;)n.push(o(a)),a+=s}n.push(r=e)}),n})}(e,r),i=fo(n),o=function(e,t){var r={type:"Polygon",coordinates:e},n=yA(r),i=_d(n,2),o=_d(i[0],2),s=o[0],a=o[1],A=_d(i[1],2),l=A[0],u=A[1];if(Math.min(Math.abs(l-s),Math.abs(u-a))<t)return[];var c=s>l||u>=89||a<=-89;return function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.minLng,n=t.maxLng,i=t.minLat,o=t.maxLat,s=Math.round(Math.pow(360/e,2)/Math.PI),a=(1+Math.sqrt(5))/2,A=function(e){return e/a*360%360-180},l=function(e){return Math.acos(2*e/s-1)/Math.PI*180-90},u=function(e){return s*(Math.cos((e+90)*Math.PI/180)+1)/2},c=[void 0!==o?Math.ceil(u(o)):0,void 0!==i?Math.floor(u(i)):s-1],h=void 0===r&&void 0===n?function(){return!0}:void 0===r?function(e){return e<=n}:void 0===n?function(e){return e>=r}:n>=r?function(e){return e>=r&&e<=n}:function(e){return e>=r||e<=n},d=[],p=c[0];p<=c[1];p++){var f=A(p);h(f)&&d.push([f,l(p)])}return d}(t,{minLng:s,maxLng:l,minLat:a,maxLat:u}).filter(function(e){return Sd(e,r,c)})}(e,r),s=[].concat(xd(i),xd(o)),a={type:"Polygon",coordinates:e},A=_d(yA(a),2),l=_d(A[0],2),u=l[0],c=l[1],h=_d(A[1],2),d=h[0],p=h[1],f=u>d||p>=89||c<=-89,m=[];if(f){var g=function(e){const t=function(e){if(t.delaunay=null,t._data=e,"object"==typeof t._data&&"FeatureCollection"===t._data.type&&(t._data=t._data.features),"object"==typeof t._data){const e=t._data.map(e=>[t._vx(e),t._vy(e),e]).filter(e=>isFinite(e[0]+e[1]));t.points=e.map(e=>[e[0],e[1]]),t.valid=e.map(e=>e[2]),t.delaunay=pd(t.points)}return t};return t._vx=function(e){return"object"==typeof e&&"type"in e?RA(e)[0]:0 in e?e[0]:void 0},t._vy=function(e){return"object"==typeof e&&"type"in e?RA(e)[1]:1 in e?e[1]:void 0},t.x=function(e){return e?(t._vx=e,t):t._vx},t.y=function(e){return e?(t._vy=e,t):t._vy},t.polygons=function(e){if(void 0!==e&&t(e),!t.delaunay)return!1;const r={type:"FeatureCollection",features:[]};return 0===t.valid.length||(t.delaunay.polygons.forEach((e,n)=>r.features.push({type:"Feature",geometry:e?{type:"Polygon",coordinates:[[...e,e[0]].map(e=>t.delaunay.centers[e])]}:null,properties:{site:t.valid[n],sitecoordinates:t.points[n],neighbours:t.delaunay.neighbors[n]}})),1===t.valid.length&&r.features.push({type:"Feature",geometry:{type:"Sphere"},properties:{site:t.valid[0],sitecoordinates:t.points[0],neighbours:[]}})),r},t.triangles=function(e){return void 0!==e&&t(e),!!t.delaunay&&{type:"FeatureCollection",features:t.delaunay.triangles.map((e,r)=>(e=e.map(e=>t.points[e]),e.center=t.delaunay.centers[r],e)).filter(e=>dd(e)>0).map(e=>({type:"Feature",properties:{circumcenter:e.center},geometry:{type:"Polygon",coordinates:[[...e,e[0]]]}}))}},t.links=function(e){if(void 0!==e&&t(e),!t.delaunay)return!1;const r=t.delaunay.edges.map(e=>ll(t.points[e[0]],t.points[e[1]])),n=t.delaunay.urquhart(r);return{type:"FeatureCollection",features:t.delaunay.edges.map((e,i)=>({type:"Feature",properties:{source:t.valid[e[0]],target:t.valid[e[1]],length:r[i],urquhart:!!n[i]},geometry:{type:"LineString",coordinates:[t.points[e[0]],t.points[e[1]]]}}))}},t.mesh=function(e){return void 0!==e&&t(e),!!t.delaunay&&{type:"MultiLineString",coordinates:t.delaunay.edges.map(e=>[t.points[e[0]],t.points[e[1]]])}},t.cellMesh=function(e){if(void 0!==e&&t(e),!t.delaunay)return!1;const{centers:r,polygons:n}=t.delaunay,i=[];for(const t of n)if(t)for(let e=t.length,n=t[e-1],o=t[0],s=0;s<e;n=o,o=t[++s])o>n&&i.push([r[n],r[o]]);return{type:"MultiLineString",coordinates:i}},t._found=void 0,t.find=function(e,r,n){if(t._found=t.delaunay.find(e,r,t._found),!n||ll([e,r],t.points[t._found])<n)return t._found},t.hull=function(e){void 0!==e&&t(e);const r=t.delaunay.hull,n=t.points;return 0===r.length?null:{type:"Polygon",coordinates:[[...r.map(e=>n[e]),n[r[0]]]]}},e?t(e):t}(s).triangles(),y=new Map(s.map(function(e,t){var r=_d(e,2),n=r[0],i=r[1];return["".concat(n,"-").concat(i),t]}));g.features.forEach(function(e){var t,r=e.geometry.coordinates[0].slice(0,3).reverse(),n=[];if(r.forEach(function(e){var t=_d(e,2),r=t[0],i=t[1],o="".concat(r,"-").concat(i);y.has(o)&&n.push(y.get(o))}),3===n.length){if(n.some(function(e){return e<i.length}))if(!Sd(e.properties.circumcenter,a,f))return;(t=m).push.apply(t,n)}})}else if(o.length)for(var b=Ch.from(s),v=function(e){var t,r=[2,1,0].map(function(t){return b.triangles[e+t]}),n=r.map(function(e){return s[e]});if(r.some(function(e){return e<i.length})){var o=[0,1].map(function(e){return function(e,t){let r=0,n=0;if(void 0===t)for(let i of e)null!=i&&(i=+i)>=i&&(++r,n+=i);else{let i=-1;for(let o of e)null!=(o=t(o,++i,e))&&(o=+o)>=o&&(++r,n+=o)}if(r)return n/r}(n,function(t){return t[e]})});if(!Sd(o,a,f))return 1}(t=m).push.apply(t,xd(r))},_=0,x=b.triangles.length;_<x;_+=3)v(_);else{var w=Xu(n),T=w.vertices,S=w.holes;m=Tu(T,void 0===S?[]:S,2)}var E=Is(ao(s,function(e){return e[0]}),[0,1]),M=Is(ao(s,function(e){return e[1]}),[0,1]),N=s.map(function(e){var t=_d(e,2),r=t[0],n=t[1];return[E(r),M(n)]});return{contour:n,triangles:{points:s,indices:m,uvs:N}}}function Sd(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?function(e,t){return(e&&ul.hasOwnProperty(e.type)?ul[e.type]:hl)(e,t)}(t,e):Ih(e,t)}var Ed=window.THREE?window.THREE:{BufferGeometry:f,Float32BufferAttribute:m},Md=(new Ed.BufferGeometry).setAttribute?"setAttribute":"addAttribute",Nd=function(){function e(t,r,n,i,o,s,a){var A;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(A=gd(this,e)).type="ConicPolygonGeometry",A.parameters={polygonGeoJson:t,bottomHeight:r,topHeight:n,closedBottom:i,closedTop:o,includeSides:s,curvatureResolution:a},r=r||0,n=n||1,i=void 0===i||i,o=void 0===o||o,s=void 0===s||s;var l=Td(t,{resolution:a=a||5}),u=l.contour,c=l.triangles,h=fo(c.uvs),d=[],p=[],f=[],m=0,g=function(e){var t=Math.round(d.length/3),r=f.length;d=d.concat(e.vertices),p=p.concat(e.uvs),f=f.concat(t?e.indices.map(function(e){return e+t}):e.indices),A.addGroup(r,f.length-r,m++)};function y(e,t){var r="function"==typeof t?t:function(){return t},n=e.map(function(e){return e.map(function(e){var t=_d(e,2),n=t[0],i=t[1];return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180;return[r*Math.sin(n)*Math.cos(i),r*Math.cos(n),r*Math.sin(n)*Math.sin(i)]}(i,n,r(n,i))})});return Xu(n)}function b(e){return{indices:!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?c.indices:c.indices.slice().reverse(),vertices:y([c.points],e).vertices,uvs:h}}return s&&g(function(){for(var e=y(u,r),t=e.vertices,i=e.holes,o=y(u,n).vertices,s=fo([o,t]),a=Math.round(o.length/3),A=new Set(i),l=0,c=[],h=0;h<a;h++){var d=h+1;if(d===a)d=l;else if(A.has(d)){var p=d;d=l,l=p}c.push(h,h+a,d+a),c.push(d+a,d,h)}for(var f=[],m=1;m>=0;m--)for(var g=0;g<a;g+=1)f.push(g/(a-1),m);return{indices:c,vertices:s,uvs:f}}()),i&&g(b(r,!1)),o&&g(b(n,!0)),A.setIndex(f),A[Md]("position",new Ed.Float32BufferAttribute(d,3)),A[Md]("uv",new Ed.Float32BufferAttribute(p,2)),A.computeVertexNormals(),A}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vd(e,t)}(e,Ed.BufferGeometry),function(e){return Object.defineProperty(e,"prototype",{writable:!1}),e}(e)}();function Cd(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Rd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||Bd(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pd(e){return function(e){if(Array.isArray(e))return Cd(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Bd(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dd(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function Bd(e,t){if(e){if("string"==typeof e)return Cd(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Cd(e,t):void 0}}var qd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=(t instanceof Array?t.length?t:[void 0]:[t]).map(function(e){return{keyAccessor:e,isProp:!(e instanceof Function)}}),o=e.reduce(function(e,t){var n=e,o=t;return i.forEach(function(e,t){var s,a=e.keyAccessor;if(e.isProp){var A=o,l=A[a],u=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(A,[a].map(Dd));s=l,o=u}else s=a(o,t);t+1<i.length?(n.hasOwnProperty(s)||(n[s]={}),n=n[s]):r?(n.hasOwnProperty(s)||(n[s]=[]),n[s].push(o)):n[s]=o}),e},{});r instanceof Function&&function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;n===i.length?Object.keys(t).forEach(function(e){return t[e]=r(t[e])}):Object.values(t).forEach(function(t){return e(t,n+1)})}(o);var s=o;return n&&(s=[],function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];r.length===i.length?s.push({keys:r,vals:t}):Object.entries(t).forEach(function(t){var n=Rd(t,2),i=n[0],o=n[1];return e(o,[].concat(Pd(r),[i]))})}(o),t instanceof Array&&0===t.length&&1===s.length&&(s[0].keys=[])),s},Od=function(e){var t,r=void 0!==(e=e||{})?e:{},n={};for(t in r)r.hasOwnProperty(t)&&(n[t]=r[t]);var i,o="";"undefined"!=typeof document&&document.currentScript&&(o=document.currentScript.src),o=0!==o.indexOf("blob:")?o.substr(0,o.lastIndexOf("/")+1):"",i=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response)t(n.response);else{var i=z(e);i?t(i.buffer):r()}},n.onerror=r,n.send(null)};var s=r.print||console.log.bind(console),a=r.printErr||console.warn.bind(console);for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);n=null,r.arguments&&r.arguments;var A=0;var l=!1;function u(e){var t,n=r["_"+e];return t="Cannot call unknown function "+e+", make sure it is exported",n||ne("Assertion failed: "+t),n}function c(e,t,r,n,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);(function(e,t,r){(function(e,t,r,n){if(!(n>0))return 0;for(var i=r,o=r+n-1,s=0;s<e.length;++s){var a=e.charCodeAt(s);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++s);if(a<=127){if(r>=o)break;t[r++]=a}else if(a<=2047){if(r+1>=o)break;t[r++]=192|a>>6,t[r++]=128|63&a}else if(a<=65535){if(r+2>=o)break;t[r++]=224|a>>12,t[r++]=128|a>>6&63,t[r++]=128|63&a}else{if(r+3>=o)break;t[r++]=240|a>>18,t[r++]=128|a>>12&63,t[r++]=128|a>>6&63,t[r++]=128|63&a}}t[r]=0})(e,p,t,r)})(e,t=Y(r),r)}return t},array:function(e){var t=Y(e.length);return function(e,t){d.set(e,t)}(e,t),t}};var s=u(e),a=[],A=0;if(n)for(var l=0;l<n.length;l++){var c=o[r[l]];c?(0===A&&(A=K()),a[l]=c(n[l])):a[l]=n[l]}var h=s.apply(null,a);return h=function(e){return"string"===t?v(e):"boolean"===t?Boolean(e):e}(h),0!==A&&X(A),h}var h,d,p,f,m,g,y,b="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function v(e,t){return e?function(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&b)return b.decode(e.subarray(t,i));for(var o="";t<i;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var A=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|A:(7&s)<<18|a<<12|A<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var l=s-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o}(p,e,t):""}function _(e,t){return e%t>0&&(e+=t-e%t),e}function x(e){h=e,r.HEAP8=d=new Int8Array(e),r.HEAP16=f=new Int16Array(e),r.HEAP32=m=new Int32Array(e),r.HEAPU8=p=new Uint8Array(e),r.HEAPU16=new Uint16Array(e),r.HEAPU32=new Uint32Array(e),r.HEAPF32=g=new Float32Array(e),r.HEAPF64=y=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var w=r.TOTAL_MEMORY||33554432;function T(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?r.dynCall_v(n):r.dynCall_vi(n,t.arg):n(void 0===t.arg?null:t.arg)}else t()}}w=(h=r.buffer?r.buffer:new ArrayBuffer(w)).byteLength,x(h),m[7152]=5271520;var S=[],E=[],M=[],N=[];function C(e){S.unshift(e)}function R(e){N.unshift(e)}var P=Math.abs,D=Math.ceil,B=Math.floor,q=Math.min,O=0,L=null;r.preloadedImages={},r.preloadedAudios={};var k,I,F=null,U="data:application/octet-stream;base64,";function V(e){return String.prototype.startsWith?e.startsWith(U):0===e.indexOf(U)}F="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";function G(){return d.length}var j="function"==typeof atob?atob:function(e){var t,r,n,i,o,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=a.indexOf(e.charAt(l++))<<2|(i=a.indexOf(e.charAt(l++)))>>4,r=(15&i)<<4|(o=a.indexOf(e.charAt(l++)))>>2,n=(3&o)<<6|(s=a.indexOf(e.charAt(l++))),A+=String.fromCharCode(t),64!==o&&(A+=String.fromCharCode(r)),64!==s&&(A+=String.fromCharCode(n))}while(l<e.length);return A};function z(e){if(V(e))return function(e){try{for(var t=j(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(U.length))}var H=function(e,t,r){var n=new e.Int8Array(r),i=new e.Int32Array(r);new e.Uint8Array(r),new e.Float32Array(r);var o=new e.Float64Array(r),s=0|t.o,a=0|t.p,A=e.Math.floor,l=e.Math.abs,u=e.Math.sqrt,c=e.Math.pow,h=e.Math.cos,d=e.Math.sin,p=e.Math.tan,f=e.Math.acos,m=e.Math.asin,g=e.Math.atan,y=e.Math.atan2,b=e.Math.ceil,v=e.Math.imul,_=e.Math.min,x=e.Math.max,w=e.Math.clz32,T=t.b,S=t.c,E=t.d,M=t.e,N=t.f,C=t.g,R=t.h,P=t.i,D=28640;function B(e,t,r,n){return 0|q(e|=0,t|=0,r|=0,n|=0,0)}function q(e,t,r,n,o){var s,a=0,A=0,l=0,u=0;if(s=D,D=D+16|0,A=s,!(0|O(e|=0,t|=0,r|=0,n|=0,o|=0)))return D=s,0|(n=0);do{if((0|r)>=0){if((0|r)>13780509){if(0|(a=0|ht(15,A)))break;A=0|i[(l=A)>>2],l=0|i[l+4>>2]}else u=0|rr(0|r,0|(a=((0|r)<0)<<31>>31),3,0),l=0|S(),a=0|Kt(0|r,0|a,1,0),a=0|Kt(0|(a=0|rr(0|u,0|l,0|a,0|S())),0|S(),1,0),l=0|S(),i[A>>2]=a,i[A+4>>2]=l,A=a;if(dr(0|n,0,A<<3),0|o){dr(0|o,0,A<<2),a=0|L(e,t,r,n,o,A,l,0);break}(a=0|Xt(A,4))?(u=0|L(e,t,r,n,a,A,l,0),Yt(a),a=u):a=13}else a=2}while(0);return D=s,0|(u=a)}function O(e,t,r,n,o){e|=0,t|=0,r|=0,n|=0,o|=0;var s,a,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0;if(a=D,D=D+16|0,m=a+8|0,i[(f=s=a)>>2]=e,i[f+4>>2]=t,(0|r)<0)return D=a,0|(m=2);if(i[(A=n)>>2]=e,i[A+4>>2]=t,(A=!!(0|o))&&(i[o>>2]=0),0|je(e,t))return D=a,0|(m=9);i[m>>2]=0;e:do{if((0|r)>=1)if(A)for(d=1,h=0,p=0,f=1,A=e;;){if(!(h|p)){if(0|(A=0|k(A,t,4,m,s)))break e;if(0|je(A=0|i[(t=s)>>2],t=0|i[t+4>>2])){A=9;break e}}if(0|(A=0|k(A,t,0|i[26800+(p<<2)>>2],m,s)))break e;if(A=0|i[(t=s)>>2],t=0|i[t+4>>2],i[(e=n+(d<<3)|0)>>2]=A,i[e+4>>2]=t,i[o+(d<<2)>>2]=f,l=(0|(e=h+1|0))==(0|f),c=6==(0|(u=p+1|0)),0|je(A,t)){A=9;break e}if((0|(f=f+(c&l&1)|0))>(0|r)){A=0;break}d=d+1|0,h=l?0:e,p=l?c?0:u:p}else for(d=1,h=0,p=0,f=1,A=e;;){if(!(h|p)){if(0|(A=0|k(A,t,4,m,s)))break e;if(0|je(A=0|i[(t=s)>>2],t=0|i[t+4>>2])){A=9;break e}}if(0|(A=0|k(A,t,0|i[26800+(p<<2)>>2],m,s)))break e;if(A=0|i[(t=s)>>2],t=0|i[t+4>>2],i[(e=n+(d<<3)|0)>>2]=A,i[e+4>>2]=t,l=(0|(e=h+1|0))==(0|f),c=6==(0|(u=p+1|0)),0|je(A,t)){A=9;break e}if((0|(f=f+(c&l&1)|0))>(0|r)){A=0;break}d=d+1|0,h=l?0:e,p=l?c?0:u:p}else A=0}while(0);return D=a,0|(m=A)}function L(e,t,r,n,o,s,a,A){r|=0,n|=0,o|=0,A|=0;var l,u,c,h=0,d=0,p=0,f=0,m=0,g=0,y=0;if(c=D,D=D+16|0,l=c+8|0,u=c,h=0|ir(0|(e|=0),0|(t|=0),0|(s|=0),0|(a|=0)),p=0|S(),!(!(0|(y=0|i[(g=f=n+(h<<3)|0)>>2]))&!(0|(g=0|i[g+4>>2]))|(d=(0|y)==(0|e)&(0|g)==(0|t))))do{h=0|nr(0|(h=0|Kt(0|h,0|p,1,0)),0|S(),0|s,0|a),p=0|S(),d=(0|(g=0|i[(y=f=n+(h<<3)|0)>>2]))==(0|e)&(0|(y=0|i[y+4>>2]))==(0|t)}while(!(!(0|g)&!(0|y)|d));if(h=o+(h<<2)|0,d&&(0|i[h>>2])<=(0|A))return D=c,0|(y=0);if(i[(y=f)>>2]=e,i[y+4>>2]=t,i[h>>2]=A,(0|A)>=(0|r))return D=c,0|(y=0);switch(d=A+1|0,i[l>>2]=0,0|(h=0|k(e,t,2,l,u))){case 9:m=9;break;case 0:(h=0|L(0|i[(h=u)>>2],0|i[h+4>>2],r,n,o,s,a,d))||(m=9)}e:do{if(9==(0|m)){switch(i[l>>2]=0,0|(h=0|k(e,t,3,l,u))){case 9:break;case 0:if(0|(h=0|L(0|i[(h=u)>>2],0|i[h+4>>2],r,n,o,s,a,d)))break e;break;default:break e}switch(i[l>>2]=0,0|(h=0|k(e,t,1,l,u))){case 9:break;case 0:if(0|(h=0|L(0|i[(h=u)>>2],0|i[h+4>>2],r,n,o,s,a,d)))break e;break;default:break e}switch(i[l>>2]=0,0|(h=0|k(e,t,5,l,u))){case 9:break;case 0:if(0|(h=0|L(0|i[(h=u)>>2],0|i[h+4>>2],r,n,o,s,a,d)))break e;break;default:break e}switch(i[l>>2]=0,0|(h=0|k(e,t,4,l,u))){case 9:break;case 0:if(0|(h=0|L(0|i[(h=u)>>2],0|i[h+4>>2],r,n,o,s,a,d)))break e;break;default:break e}switch(i[l>>2]=0,0|(h=0|k(e,t,6,l,u))){case 9:break;case 0:if(0|(h=0|L(0|i[(h=u)>>2],0|i[h+4>>2],r,n,o,s,a,d)))break e;break;default:break e}return D=c,0|(y=0)}}while(0);return D=c,0|(y=h)}function k(e,t,r,n,o){e|=0,t|=0,o|=0;var s,a,A=0,l=0,u=0,c=0,h=0,d=0,p=0;if((r|=0)>>>0>6)return 0|(o=1);if(h=(0|i[(n|=0)>>2])%6|0,i[n>>2]=h,(0|h)>0){A=0;do{r=0|be(r),A=A+1|0}while((0|A)<(0|i[n>>2]))}if(h=0|sr(0|e,0|t,45),S(),(a=127&h)>>>0>121)return 0|(o=5);s=0|We(e,t),A=0|sr(0|e,0|t,52),S(),A&=15;e:do{if(A){for(;;){if(u=0|sr(0|e,0|t,0|(l=3*(15-A|0)|0)),S(),7==(0|(u&=7))){t=5;break}if(p=!(0|Ke(A)),A=A+-1|0,d=0|ar(7,0,0|l),t&=~S(),e=0|ar(0|i[(p?432:16)+(28*u|0)+(r<<2)>>2],0,0|l)|e&~d,t|=l=0|S(),!(r=0|i[(p?640:224)+(28*u|0)+(r<<2)>>2])){r=0;break e}if(!A){c=8;break e}}return 0|t}c=8}while(0);8==(0|c)&&(e|=0|ar(0|(p=0|i[848+(28*a|0)+(r<<2)>>2]),0,45),t=S()|-1040385&t,r=0|i[4272+(28*a|0)+(r<<2)>>2],127&~p||(p=0|ar(0|i[848+(28*a|0)+20>>2],0,45),t=S()|-1040385&t,r=0|i[4272+(28*a|0)+20>>2],e=0|$e(p|e,t),t=0|S(),i[n>>2]=1+(0|i[n>>2]))),u=0|sr(0|e,0|t,45),S(),u&=127;e:do{if(0|U(u)){t:do{if(1==(0|We(e,t))){if((0|a)!=(0|u)){if(0|z(u,0|i[7696+(28*a|0)>>2])){e=0|Xe(e,t),l=1,t=0|S();break}E(27795,26864,436,26872)}switch(0|s){case 3:e=0|$e(e,t),t=0|S(),i[n>>2]=1+(0|i[n>>2]),l=0;break t;case 5:e=0|Xe(e,t),t=0|S(),i[n>>2]=5+(0|i[n>>2]),l=0;break t;case 0:return 0|(p=9);default:return 0|(p=1)}}else l=0}while(0);if((0|r)>0){A=0;do{e=0|Qe(e,t),t=0|S(),A=A+1|0}while((0|A)!=(0|r))}if((0|a)!=(0|u)){if(!(0|V(u))){if(!!(0|l)|5!=(0|We(e,t)))break;i[n>>2]=1+(0|i[n>>2]);break}switch(127&h){case 8:case 118:break e}3!=(0|We(e,t))&&(i[n>>2]=1+(0|i[n>>2]))}}else if((0|r)>0){A=0;do{e=0|$e(e,t),t=0|S(),A=A+1|0}while((0|A)!=(0|r))}}while(0);return i[n>>2]=((0|i[n>>2])+r|0)%6|0,i[(p=o)>>2]=e,i[p+4>>2]=t,0|(p=0)}function I(e,t,r,n){r|=0,n|=0;var o,s,a,A=0,l=0;for(a=D,D=D+16|0,o=a,s=a+8|0,A=(A=!(0|je(e|=0,t|=0)))?1:2;;){if(i[s>>2]=0,!(0|k(e,t,A,s,o))&((0|i[(l=o)>>2])==(0|r)?(0|i[l+4>>2])==(0|n):0)){e=4;break}if((A=A+1|0)>>>0>=7){A=7,e=4;break}}return 4==(0|e)?(D=a,0|A):0}function F(e,t,r,n,s,a,A){t|=0,r|=0,n|=0,s|=0,a|=0,A|=0;var l,u,c,h,d,p,f,m,g,y,b=0,v=0,_=0,x=0,w=0,T=0,E=0,M=0,N=0,C=0,R=0,P=0,B=0,q=0,O=0,L=0,k=0,I=0,F=0;if(y=D,D=D+64|0,f=y+48|0,m=y+32|0,g=y+24|0,l=y+8|0,u=y,(0|(v=0|i[(e|=0)>>2]))<=0)return D=y,0|(O=0);for(c=e+4|0,h=f+8|0,d=m+8|0,p=l+8|0,b=0,B=0;;){P=(_=0|i[c>>2])+(B<<4)|0,i[f>>2]=i[P>>2],i[f+4>>2]=i[P+4>>2],i[f+8>>2]=i[P+8>>2],i[f+12>>2]=i[P+12>>2],(0|B)==(v+-1|0)?(i[m>>2]=i[_>>2],i[m+4>>2]=i[_+4>>2],i[m+8>>2]=i[_+8>>2],i[m+12>>2]=i[_+12>>2]):(P=_+(B+1<<4)|0,i[m>>2]=i[P>>2],i[m+4>>2]=i[P+4>>2],i[m+8>>2]=i[P+8>>2],i[m+12>>2]=i[P+12>>2]),v=0|te(f,m,n,g);e:do{if(v)_=0,b=v;else if(_=0|i[(v=g)>>2],(0|(v=0|i[v+4>>2]))>0|!(0|v)&_>>>0>0){R=0,P=0;t:for(;;){if(k=1/(+(_>>>0)+4294967296*+(0|v)),F=+o[f>>3],I=+((v=0|Zt(0|_,0|v,0|R,0|P))>>>0)+4294967296*+(0|S()),L=+(R>>>0)+4294967296*+(0|P),o[l>>3]=k*(F*I)+k*(+o[m>>3]*L),o[p>>3]=k*(+o[h>>3]*I)+k*(+o[d>>3]*L),0|(v=0|Ze(l,n,u))){b=v;break}T=0|ir(0|(N=0|i[(C=u)>>2]),0|(C=0|i[C+4>>2]),0|t,0|r),x=0|S(),_=0|i[(w=v=A+(T<<3)|0)>>2],w=0|i[w+4>>2];r:do{if(!(0|_)&!(0|w))q=v,O=16;else for(E=0,M=0;;){if((0|E)>(0|r)|(0|E)==(0|r)&M>>>0>t>>>0){b=1;break t}if((0|_)==(0|N)&(0|w)==(0|C))break r;if(T=0|nr(0|(v=0|Kt(0|T,0|x,1,0)),0|S(),0|t,0|r),x=0|S(),M=0|Kt(0|M,0|E,1,0),E=0|S(),!(0|(_=0|i[(w=v=A+(T<<3)|0)>>2]))&!(0|(w=0|i[w+4>>2]))){q=v,O=16;break}}}while(0);if(16!=(0|O)||(O=0,!(0|N)&!(0|C))||(i[(M=q)>>2]=N,i[M+4>>2]=C,M=a+(i[s>>2]<<3)|0,i[M>>2]=N,i[M+4>>2]=C,M=0|Kt(0|i[(M=s)>>2],0|i[M+4>>2],1,0),N=0|S(),i[(C=s)>>2]=M,i[C+4>>2]=N),R=0|Kt(0|R,0|P,1,0),P=0|S(),_=0|i[(v=g)>>2],!((0|(v=0|i[v+4>>2]))>(0|P)|(0|v)==(0|P)&_>>>0>R>>>0)){_=1;break e}}_=0}else _=1}while(0);if(B=B+1|0,!_){O=21;break}if((0|B)>=(0|(v=0|i[e>>2]))){b=0,O=21;break}}return 21==(0|O)?(D=y,0|b):0}function U(e){return(e|=0)>>>0>121?0|(e=0):0|(e=0|i[7696+(28*e|0)+16>>2])}function V(e){return 4==(0|(e|=0))|117==(0|e)|0}function G(e){return 0|i[11120+(216*(0|i[(e|=0)>>2])|0)+(72*(0|i[e+4>>2])|0)+(24*(0|i[e+8>>2])|0)+(i[e+12>>2]<<3)>>2]}function j(e){return 0|i[11120+(216*(0|i[(e|=0)>>2])|0)+(72*(0|i[e+4>>2])|0)+(24*(0|i[e+8>>2])|0)+(i[e+12>>2]<<3)+4>>2]}function z(e,t){return t|=0,(0|i[7696+(28*(e|=0)|0)+20>>2])==(0|t)?0|(t=1):0|(t=(0|i[7696+(28*e|0)+24>>2])==(0|t))}function H(e,t){return 0|i[848+(28*(e|=0)|0)+((t|=0)<<2)>>2]}function W(e,t){return t|=0,(0|i[848+(28*(e|=0)|0)>>2])==(0|t)?0|(t=0):(0|i[848+(28*e|0)+4>>2])==(0|t)?0|(t=1):(0|i[848+(28*e|0)+8>>2])==(0|t)?0|(t=2):(0|i[848+(28*e|0)+12>>2])==(0|t)?0|(t=3):(0|i[848+(28*e|0)+16>>2])==(0|t)?0|(t=4):(0|i[848+(28*e|0)+20>>2])==(0|t)?0|(t=5):0|((0|i[848+(28*e|0)+24>>2])==(0|t)?6:7)}function Q(e){var t,r,n;return t=(n=+o[(e|=0)+16>>3])-(r=+o[e+24>>3]),+(n<r?t+6.283185307179586:t)}function $(e){return+o[(e|=0)+16>>3]<+o[e+24>>3]|0}function Y(e){return+(+o[(e|=0)>>3]-+o[e+8>>3])}function X(e,t){e|=0;var r,n,i=0;return(i=+o[(t|=0)>>3])>=+o[e+8>>3]&&i<=+o[e>>3]?(r=+o[e+16>>3],i=+o[e+24>>3],t=(n=+o[t+8>>3])>=i,e=n<=r&1,r<i?t&&(e=1):t||(e=0),0|(t=!!(0|e))):0|(t=0)}function K(e,t){t|=0;var r,n,i,s,a,A=0,l=0,u=0,c=0;return+o[(e|=0)>>3]<+o[t+8>>3]||+o[e+8>>3]>+o[t>>3]?0|(A=0):(i=(l=+o[e+16>>3])<(c=+o[(r=e+24|0)>>3]),u=(a=+o[(A=t+16|0)>>3])<(s=+o[(n=t+24|0)>>3]),t=c-a<s-l,e=i?u|t?1:2:0,t=u?i?1:t?2:1:0,(l=+lt(l,e))<+lt(+o[n>>3],t)||(c=+lt(+o[r>>3],e))>+lt(+o[A>>3],t)?0|(u=0):0|(u=1))}function Z(e,t){t|=0;var r,n,i,s,a,A=0,l=0,u=0,c=0;return+o[(e|=0)>>3]<+o[t>>3]||+o[e+8>>3]>+o[t+8>>3]?0|(A=0):(i=(s=+o[(A=e+16|0)>>3])<(l=+o[e+24>>3]),u=(c=+o[(r=t+16|0)>>3])<(a=+o[(n=t+24|0)>>3]),t=l-c<a-s,e=i?u|t?1:2:0,t=u?i?1:t?2:1:0,(l=+lt(l,e))<=+lt(+o[n>>3],t)?0|(u=(c=+lt(+o[A>>3],e))>=+lt(+o[r>>3],t)):0|(u=0))}function J(e,t){e|=0,t|=0;var r,n,s,a,A,l=0;s=D,D=D+176|0,i[(n=s)>>2]=4,l=+o[t>>3],o[n+8>>3]=l,a=+o[t+16>>3],o[n+16>>3]=a,o[n+24>>3]=l,l=+o[t+24>>3],o[n+32>>3]=l,A=+o[t+8>>3],o[n+40>>3]=A,o[n+48>>3]=l,o[n+56>>3]=A,o[n+64>>3]=a,r=(t=n+72|0)+96|0;do{i[t>>2]=0,t=t+4|0}while((0|t)<(0|r));hr(0|e,0|n,168),D=s}function ee(e,t,r){e|=0,t|=0,r|=0;var n,a,u,c,h,d,p,f=0,m=0,g=0,y=0,v=0,x=0,w=0;d=D,D=D+288|0,h=d+264|0,y=d+96|0,m=(f=g=d)+96|0;do{i[f>>2]=0,f=f+4|0}while((0|f)<(0|m));return 0|(t=0|nt(t,g))?(D=d,0|(x=t)):(tt(g=0|i[(m=g)>>2],m=0|i[m+4>>2],h),rt(g,m,y),c=+ut(h,y+8|0),o[h>>3]=+o[e>>3],o[(m=h+8|0)>>3]=+o[e+16>>3],o[y>>3]=+o[e+8>>3],o[(g=y+8|0)>>3]=+o[e+24>>3],a=+ut(h,y),w=+o[m>>3]-+o[g>>3],u=+l(+w),p=+o[h>>3]-+o[y>>3],n=+l(+p),!(0==w|0==p)&&(w=+lr(+u,+n),w=+b(+a*a/+ur(+w/+ur(+u,+n),3)/(c*(2.59807621135*c)*.8)),o[s>>3]=w,v=~~w>>>0,x=+l(w)>=1?w>0?~~+_(+A(w/4294967296),4294967295)>>>0:~~+b((w-+(~~w>>>0))/4294967296)>>>0:0,2146435072&~i[s+4>>2])?(y=!(0|v)&!(0|x),i[(t=r)>>2]=y?1:v,i[t+4>>2]=y?0:x,t=0):t=1,D=d,0|(x=t))}function te(e,t,r,n){e|=0,t|=0,r|=0,n|=0;var a,u,c,h,d=0,p=0,f=0;h=D,D=D+288|0,u=h+264|0,c=h+96|0,a=(d=p=h)+96|0;do{i[d>>2]=0,d=d+4|0}while((0|d)<(0|a));return 0|(r=0|nt(r,p))?(D=h,0|(n=r)):(tt(d=0|i[(r=p)>>2],r=0|i[r+4>>2],u),rt(d,r,c),f=+ut(u,c+8|0),f=+b(+ +ut(e,t)/(2*f)),o[s>>3]=f,r=~~f>>>0,d=+l(f)>=1?f>0?~~+_(+A(f/4294967296),4294967295)>>>0:~~+b((f-+(~~f>>>0))/4294967296)>>>0:0,2146435072&~i[s+4>>2]?(p=!(0|r)&!(0|d),i[n>>2]=p?1:r,i[n+4>>2]=p?0:d,D=h,0|(n=0)):(D=h,0|(n=1)))}function re(e,t,r,n){t|=0,r|=0,n|=0,i[(e|=0)>>2]=t,i[e+4>>2]=r,i[e+8>>2]=n}function ne(e,t){e|=0;var r,n,s,a,A=0,u=0,c=0,h=0,d=0,p=0,f=0;i[(a=(t|=0)+8|0)>>2]=0,n=+o[e>>3],h=+l(+n),s=+o[e+8>>3],h+=.5*(d=1.1547005383792515*+l(+s)),h-=+(0|(A=~~h)),d-=+(0|(e=~~d));do{if(h<.5){if(h<.3333333333333333){if(i[t>>2]=A,d<.5*(h+1)){i[t+4>>2]=e;break}e=e+1|0,i[t+4>>2]=e;break}if(e=(1&!(d<(f=1-h)))+e|0,i[t+4>>2]=e,f<=d&d<2*h){A=A+1|0,i[t>>2]=A;break}i[t>>2]=A;break}if(!(h<.6666666666666666)){if(A=A+1|0,i[t>>2]=A,d<.5*h){i[t+4>>2]=e;break}e=e+1|0,i[t+4>>2]=e;break}if(d<1-h){if(i[t+4>>2]=e,2*h-1<d){i[t>>2]=A;break}}else e=e+1|0,i[t+4>>2]=e;A=A+1|0,i[t>>2]=A}while(0);do{if(n<0){if(1&e){A=~~(+(0|A)-(2*(+((p=0|Zt(0|A,((0|A)<0)<<31>>31,0|(p=(e+1|0)/2|0),((0|p)<0)<<31>>31))>>>0)+4294967296*+(0|S()))+1)),i[t>>2]=A;break}A=~~(+(0|A)-2*(+((p=0|Zt(0|A,((0|A)<0)<<31>>31,0|(p=(0|e)/2|0),((0|p)<0)<<31>>31))>>>0)+4294967296*+(0|S()))),i[t>>2]=A;break}}while(0);p=t+4|0,s<0&&(A=A-((1|e<<1)/2|0)|0,i[t>>2]=A,e=0-e|0,i[p>>2]=e),u=e-A|0,(0|A)<0?(c=0-A|0,i[p>>2]=u,i[a>>2]=c,i[t>>2]=0,e=u,A=0):c=0,(0|e)<0&&(A=A-e|0,i[t>>2]=A,c=c-e|0,i[a>>2]=c,i[p>>2]=0,e=0),r=A-c|0,u=e-c|0,(0|c)<0&&(i[t>>2]=r,i[p>>2]=u,i[a>>2]=0,e=u,A=r,c=0),(0|(u=(0|c)<(0|(u=(0|e)<(0|A)?e:A))?c:u))<=0||(i[t>>2]=A-u,i[p>>2]=e-u,i[a>>2]=c-u)}function ie(e){var t,r=0,n=0,o=0,s=0,a=0;r=0|i[(e|=0)>>2],n=0|i[(t=e+4|0)>>2],(0|r)<0&&(n=n-r|0,i[t>>2]=n,i[(a=e+8|0)>>2]=(0|i[a>>2])-r,i[e>>2]=0,r=0),(0|n)<0?(r=r-n|0,i[e>>2]=r,s=(0|i[(a=e+8|0)>>2])-n|0,i[a>>2]=s,i[t>>2]=0,n=0):(a=s=e+8|0,s=0|i[s>>2]),(0|s)<0&&(r=r-s|0,i[e>>2]=r,n=n-s|0,i[t>>2]=n,i[a>>2]=0,s=0),(0|(o=(0|s)<(0|(o=(0|n)<(0|r)?n:r))?s:o))<=0||(i[e>>2]=r-o,i[t>>2]=n-o,i[a>>2]=s-o)}function oe(e,t){t|=0;var r,n;n=0|i[(e|=0)+8>>2],r=+((0|i[e+4>>2])-n|0),o[t>>3]=+((0|i[e>>2])-n|0)-.5*r,o[t+8>>3]=.8660254037844386*r}function se(e,t,r){e|=0,t|=0,i[(r|=0)>>2]=(0|i[t>>2])+(0|i[e>>2]),i[r+4>>2]=(0|i[t+4>>2])+(0|i[e+4>>2]),i[r+8>>2]=(0|i[t+8>>2])+(0|i[e+8>>2])}function ae(e,t,r){e|=0,t|=0,i[(r|=0)>>2]=(0|i[e>>2])-(0|i[t>>2]),i[r+4>>2]=(0|i[e+4>>2])-(0|i[t+4>>2]),i[r+8>>2]=(0|i[e+8>>2])-(0|i[t+8>>2])}function Ae(e,t){t|=0;var r,n=0;n=0|v(0|i[(e|=0)>>2],t),i[e>>2]=n,r=0|v(0|i[(n=e+4|0)>>2],t),i[n>>2]=r,t=0|v(0|i[(e=e+8|0)>>2],t),i[e>>2]=t}function le(e){var t,r,n=0,o=0,s=0,a=0,A=0;A=(0|(r=0|i[(e|=0)>>2]))<0,e=(e=(o=(0|(a=((t=(0|(s=(0|i[e+4>>2])-(A?r:0)|0))<0)?0-s|0:0)+((0|i[e+8>>2])-(A?r:0))|0))<0)?0:a)-((s=(0|(o=(0|e)<(0|(o=(0|(n=(t?0:s)-(o?a:0)|0))<(0|(a=(A?0:r)-(t?s:0)-(o?a:0)|0))?n:a))?e:o))>0)?o:0)|0,n=n-(s?o:0)|0;e:do{switch(a-(s?o:0)|0){case 0:switch(0|n){case 0:return 0|(A=0|e?1==(0|e)?1:7:0);case 1:return 0|(A=0|e?1==(0|e)?3:7:2);default:break e}case 1:switch(0|n){case 0:return 0|(A=0|e?1==(0|e)?5:7:4);case 1:if(e)break e;return 0|(e=6);default:break e}}}while(0);return 0|(A=7)}function ue(e){var t,r,n=0,o=0,s=0,a=0,A=0,l=0,u=0;if(l=0|i[(r=(e|=0)+8|0)>>2],(t=(0|i[e>>2])-l|0)>>>0>715827881|(l=(0|i[(u=e+4|0)>>2])-l|0)>>>0>715827881){if(a=2147483647-t|0,A=-2147483648-t|0,(s=(0|t)>0)?(0|a)<(0|t):(0|A)>(0|t))return 0|(u=1);if(o=t<<1,s?(2147483647-o|0)<(0|t):(-2147483648-o|0)>(0|t))return 0|(u=1);if((0|l)>0?(2147483647-l|0)<(0|l):(-2147483648-l|0)>(0|l))return 0|(u=1);if(n=3*t|0,o=l<<1,(s?(0|a)<(0|o):(0|A)>(0|o))||((0|t)>-1?(-2147483648|n)>=(0|l):(-2147483648^n)<(0|l)))return 0|(u=1)}else o=l<<1,n=3*t|0;return s=0|Qt(.14285714285714285*+(n-l|0)),i[e>>2]=s,a=0|Qt(.14285714285714285*+(o+t|0)),i[u>>2]=a,i[r>>2]=0,n=(o=(0|a)<(0|s))?s:a,(0|(o=o?a:s))<0&&((-2147483648==(0|o)||((0|n)>0?(2147483647-n|0)<(0|o):(-2147483648-n|0)>(0|o)))&&E(27795,26892,354,26903),((0|n)>-1?(-2147483648|n)>=(0|o):(-2147483648^n)<(0|o))&&E(27795,26892,354,26903)),n=a-s|0,(0|s)<0?(o=0-s|0,i[u>>2]=n,i[r>>2]=o,i[e>>2]=0,s=0):(n=a,o=0),(0|n)<0&&(s=s-n|0,i[e>>2]=s,o=o-n|0,i[r>>2]=o,i[u>>2]=0,n=0),A=s-o|0,a=n-o|0,(0|o)<0?(i[e>>2]=A,i[u>>2]=a,i[r>>2]=0,n=a,a=A,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|n)<(0|a)?n:a))?o:s))<=0||(i[e>>2]=a-s,i[u>>2]=n-s,i[r>>2]=o-s),0|(u=0)}function ce(e){var t,r=0,n=0,o=0,s=0,a=0,A=0,l=0;if(s=0|i[(t=(e|=0)+8|0)>>2],(a=(0|i[e>>2])-s|0)>>>0>715827881|(s=(0|i[(A=e+4|0)>>2])-s|0)>>>0>715827881){if((n=(0|a)>0)?(2147483647-a|0)<(0|a):(-2147483648-a|0)>(0|a))return 0|(A=1);if(r=a<<1,(o=(0|s)>0)?(2147483647-s|0)<(0|s):(-2147483648-s|0)>(0|s))return 0|(A=1);if(l=s<<1,o?(2147483647-l|0)<(0|s):(-2147483648-l|0)>(0|s))return 0|(l=1);if(n?(2147483647-r|0)<(0|s):(-2147483648-r|0)>(0|s))return 0|(l=1);if(n=3*s|0,(0|s)>-1?(-2147483648|n)>=(0|a):(-2147483648^n)<(0|a))return 0|(l=1)}else n=3*s|0,r=a<<1;return o=0|Qt(.14285714285714285*+(r+s|0)),i[e>>2]=o,s=0|Qt(.14285714285714285*+(n-a|0)),i[A>>2]=s,i[t>>2]=0,r=(n=(0|s)<(0|o))?o:s,(0|(n=n?s:o))<0&&((-2147483648==(0|n)||((0|r)>0?(2147483647-r|0)<(0|n):(-2147483648-r|0)>(0|n)))&&E(27795,26892,402,26917),((0|r)>-1?(-2147483648|r)>=(0|n):(-2147483648^r)<(0|n))&&E(27795,26892,402,26917)),r=s-o|0,(0|o)<0?(n=0-o|0,i[A>>2]=r,i[t>>2]=n,i[e>>2]=0,o=0):(r=s,n=0),(0|r)<0&&(o=o-r|0,i[e>>2]=o,n=n-r|0,i[t>>2]=n,i[A>>2]=0,r=0),a=o-n|0,s=r-n|0,(0|n)<0?(i[e>>2]=a,i[A>>2]=s,i[t>>2]=0,r=s,s=a,n=0):s=o,(0|(o=(0|n)<(0|(o=(0|r)<(0|s)?r:s))?n:o))<=0||(i[e>>2]=s-o,i[A>>2]=r-o,i[t>>2]=n-o),0|(l=0)}function he(e){var t,r,n=0,o=0,s=0,a=0,A=0;o=0|i[(t=(e|=0)+8|0)>>2],s=0|Qt(.14285714285714285*+((3*(n=(0|i[e>>2])-o|0)|0)-(o=(0|i[(r=e+4|0)>>2])-o|0)|0)),i[e>>2]=s,n=0|Qt(.14285714285714285*+((o<<1)+n|0)),i[r>>2]=n,i[t>>2]=0,o=n-s|0,(0|s)<0?(A=0-s|0,i[r>>2]=o,i[t>>2]=A,i[e>>2]=0,n=o,s=0,o=A):o=0,(0|n)<0&&(s=s-n|0,i[e>>2]=s,o=o-n|0,i[t>>2]=o,i[r>>2]=0,n=0),A=s-o|0,a=n-o|0,(0|o)<0?(i[e>>2]=A,i[r>>2]=a,i[t>>2]=0,n=a,a=A,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|n)<(0|a)?n:a))?o:s))<=0||(i[e>>2]=a-s,i[r>>2]=n-s,i[t>>2]=o-s)}function de(e){var t,r,n=0,o=0,s=0,a=0,A=0;o=0|i[(t=(e|=0)+8|0)>>2],s=0|Qt(.14285714285714285*+(((n=(0|i[e>>2])-o|0)<<1)+(o=(0|i[(r=e+4|0)>>2])-o|0)|0)),i[e>>2]=s,n=0|Qt(.14285714285714285*+((3*o|0)-n|0)),i[r>>2]=n,i[t>>2]=0,o=n-s|0,(0|s)<0?(A=0-s|0,i[r>>2]=o,i[t>>2]=A,i[e>>2]=0,n=o,s=0,o=A):o=0,(0|n)<0&&(s=s-n|0,i[e>>2]=s,o=o-n|0,i[t>>2]=o,i[r>>2]=0,n=0),A=s-o|0,a=n-o|0,(0|o)<0?(i[e>>2]=A,i[r>>2]=a,i[t>>2]=0,n=a,a=A,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|n)<(0|a)?n:a))?o:s))<=0||(i[e>>2]=a-s,i[r>>2]=n-s,i[t>>2]=o-s)}function pe(e){var t,r,n,o=0,s=0,a=0,A=0;o=0|i[(e|=0)>>2],s=0|i[(r=e+4|0)>>2],a=0|i[(n=e+8|0)>>2],A=s+(3*o|0)|0,i[e>>2]=A,s=a+(3*s|0)|0,i[r>>2]=s,o=(3*a|0)+o|0,i[n>>2]=o,a=s-A|0,(0|A)<0?(o=o-A|0,i[r>>2]=a,i[n>>2]=o,i[e>>2]=0,s=a,a=0):a=A,(0|s)<0&&(a=a-s|0,i[e>>2]=a,o=o-s|0,i[n>>2]=o,i[r>>2]=0,s=0),t=a-o|0,A=s-o|0,(0|o)<0?(i[e>>2]=t,i[r>>2]=A,i[n>>2]=0,a=t,o=0):A=s,(0|(s=(0|o)<(0|(s=(0|A)<(0|a)?A:a))?o:s))<=0||(i[e>>2]=a-s,i[r>>2]=A-s,i[n>>2]=o-s)}function fe(e){var t,r,n,o=0,s=0,a=0,A=0;A=0|i[(e|=0)>>2],a=(3*(o=0|i[(r=e+4|0)>>2])|0)+A|0,A=(s=0|i[(n=e+8|0)>>2])+(3*A|0)|0,i[e>>2]=A,i[r>>2]=a,o=(3*s|0)+o|0,i[n>>2]=o,s=a-A|0,(0|A)<0?(o=o-A|0,i[r>>2]=s,i[n>>2]=o,i[e>>2]=0,A=0):s=a,(0|s)<0&&(A=A-s|0,i[e>>2]=A,o=o-s|0,i[n>>2]=o,i[r>>2]=0,s=0),t=A-o|0,a=s-o|0,(0|o)<0?(i[e>>2]=t,i[r>>2]=a,i[n>>2]=0,A=t,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|a)<(0|A)?a:A))?o:s))<=0||(i[e>>2]=A-s,i[r>>2]=a-s,i[n>>2]=o-s)}function me(e,t){e|=0;var r,n,o,s=0,a=0,A=0;((t|=0)+-1|0)>>>0>=6||(A=(0|i[15440+(12*t|0)>>2])+(0|i[e>>2])|0,i[e>>2]=A,o=e+4|0,a=(0|i[15440+(12*t|0)+4>>2])+(0|i[o>>2])|0,i[o>>2]=a,n=e+8|0,t=(0|i[15440+(12*t|0)+8>>2])+(0|i[n>>2])|0,i[n>>2]=t,s=a-A|0,(0|A)<0?(t=t-A|0,i[o>>2]=s,i[n>>2]=t,i[e>>2]=0,a=0):(s=a,a=A),(0|s)<0&&(a=a-s|0,i[e>>2]=a,t=t-s|0,i[n>>2]=t,i[o>>2]=0,s=0),r=a-t|0,A=s-t|0,(0|t)<0?(i[e>>2]=r,i[o>>2]=A,i[n>>2]=0,a=r,t=0):A=s,(0|(s=(0|t)<(0|(s=(0|A)<(0|a)?A:a))?t:s))<=0||(i[e>>2]=a-s,i[o>>2]=A-s,i[n>>2]=t-s))}function ge(e){var t,r,n,o=0,s=0,a=0,A=0;A=0|i[(e|=0)>>2],a=(o=0|i[(r=e+4|0)>>2])+A|0,A=(s=0|i[(n=e+8|0)>>2])+A|0,i[e>>2]=A,i[r>>2]=a,o=s+o|0,i[n>>2]=o,s=a-A|0,(0|A)<0?(o=o-A|0,i[r>>2]=s,i[n>>2]=o,i[e>>2]=0,a=0):(s=a,a=A),(0|s)<0&&(a=a-s|0,i[e>>2]=a,o=o-s|0,i[n>>2]=o,i[r>>2]=0,s=0),t=a-o|0,A=s-o|0,(0|o)<0?(i[e>>2]=t,i[r>>2]=A,i[n>>2]=0,a=t,o=0):A=s,(0|(s=(0|o)<(0|(s=(0|A)<(0|a)?A:a))?o:s))<=0||(i[e>>2]=a-s,i[r>>2]=A-s,i[n>>2]=o-s)}function ye(e){var t,r,n,o=0,s=0,a=0,A=0;o=0|i[(e|=0)>>2],a=0|i[(r=e+4|0)>>2],s=0|i[(n=e+8|0)>>2],A=a+o|0,i[e>>2]=A,a=s+a|0,i[r>>2]=a,o=s+o|0,i[n>>2]=o,s=a-A|0,(0|A)<0?(o=o-A|0,i[r>>2]=s,i[n>>2]=o,i[e>>2]=0,a=0):(s=a,a=A),(0|s)<0&&(a=a-s|0,i[e>>2]=a,o=o-s|0,i[n>>2]=o,i[r>>2]=0,s=0),t=a-o|0,A=s-o|0,(0|o)<0?(i[e>>2]=t,i[r>>2]=A,i[n>>2]=0,a=t,o=0):A=s,(0|(s=(0|o)<(0|(s=(0|A)<(0|a)?A:a))?o:s))<=0||(i[e>>2]=a-s,i[r>>2]=A-s,i[n>>2]=o-s)}function be(e){switch(0|(e|=0)){case 1:e=5;break;case 5:e=4;break;case 4:e=6;break;case 6:e=2;break;case 2:e=3;break;case 3:e=1}return 0|e}function ve(e){switch(0|(e|=0)){case 1:e=3;break;case 3:e=2;break;case 2:e=6;break;case 6:e=4;break;case 4:e=5;break;case 5:e=1}return 0|e}function _e(e){var t,r,n,o=0,s=0,a=0,A=0;o=0|i[(e|=0)>>2],s=0|i[(r=e+4|0)>>2],a=0|i[(n=e+8|0)>>2],A=s+(o<<1)|0,i[e>>2]=A,s=a+(s<<1)|0,i[r>>2]=s,o=(a<<1)+o|0,i[n>>2]=o,a=s-A|0,(0|A)<0?(o=o-A|0,i[r>>2]=a,i[n>>2]=o,i[e>>2]=0,s=a,a=0):a=A,(0|s)<0&&(a=a-s|0,i[e>>2]=a,o=o-s|0,i[n>>2]=o,i[r>>2]=0,s=0),t=a-o|0,A=s-o|0,(0|o)<0?(i[e>>2]=t,i[r>>2]=A,i[n>>2]=0,a=t,o=0):A=s,(0|(s=(0|o)<(0|(s=(0|A)<(0|a)?A:a))?o:s))<=0||(i[e>>2]=a-s,i[r>>2]=A-s,i[n>>2]=o-s)}function xe(e){var t,r,n,o=0,s=0,a=0,A=0;A=0|i[(e|=0)>>2],a=((o=0|i[(r=e+4|0)>>2])<<1)+A|0,A=(s=0|i[(n=e+8|0)>>2])+(A<<1)|0,i[e>>2]=A,i[r>>2]=a,o=(s<<1)+o|0,i[n>>2]=o,s=a-A|0,(0|A)<0?(o=o-A|0,i[r>>2]=s,i[n>>2]=o,i[e>>2]=0,A=0):s=a,(0|s)<0&&(A=A-s|0,i[e>>2]=A,o=o-s|0,i[n>>2]=o,i[r>>2]=0,s=0),t=A-o|0,a=s-o|0,(0|o)<0?(i[e>>2]=t,i[r>>2]=a,i[n>>2]=0,A=t,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|a)<(0|A)?a:A))?o:s))<=0||(i[e>>2]=A-s,i[r>>2]=a-s,i[n>>2]=o-s)}function we(e,t){t|=0;var r,n,o,s=0,a=0,A=0;return o=(0|(n=(0|i[(e|=0)>>2])-(0|i[t>>2])|0))<0,r=(0|(a=(0|i[e+4>>2])-(0|i[t+4>>2])-(o?n:0)|0))<0,t=(t=(e=(0|(A=(o?0-n|0:0)+(0|i[e+8>>2])-(0|i[t+8>>2])+(r?0-a|0:0)|0))<0)?0:A)-((a=(0|(e=(0|t)<(0|(e=(0|(s=(r?0:a)-(e?A:0)|0))<(0|(A=(o?0:n)-(r?a:0)-(e?A:0)|0))?s:A))?t:e))>0)?e:0)|0,s=s-(a?e:0)|0,0|((0|(e=(0|(e=A-(a?e:0)|0))>-1?e:0-e|0))>(0|(t=(0|(s=(0|s)>-1?s:0-s|0))>(0|(t=(0|t)>-1?t:0-t|0))?s:t))?e:t)}function Te(e,t){t|=0;var r;r=0|i[(e|=0)+8>>2],i[t>>2]=(0|i[e>>2])-r,i[t+4>>2]=(0|i[e+4>>2])-r}function Se(e,t){t|=0;var r,n,o,s=0,a=0,A=0;if(a=0|i[(e|=0)>>2],i[t>>2]=a,A=0|i[e+4>>2],i[(n=t+4|0)>>2]=A,i[(o=t+8|0)>>2]=0,e=(s=(0|A)<(0|a))?a:A,(0|(s=s?A:a))<0){if(-2147483648==(0|s)||((0|e)>0?(2147483647-e|0)<(0|s):(-2147483648-e|0)>(0|s)))return 0|(t=1);if((0|e)>-1?(-2147483648|e)>=(0|s):(-2147483648^e)<(0|s))return 0|(t=1)}return e=A-a|0,(0|a)<0?(s=0-a|0,i[n>>2]=e,i[o>>2]=s,i[t>>2]=0,a=0):(e=A,s=0),(0|e)<0&&(a=a-e|0,i[t>>2]=a,s=s-e|0,i[o>>2]=s,i[n>>2]=0,e=0),r=a-s|0,A=e-s|0,(0|s)<0?(i[t>>2]=r,i[n>>2]=A,i[o>>2]=0,e=A,A=r,s=0):A=a,(0|(a=(0|s)<(0|(a=(0|e)<(0|A)?e:A))?s:a))<=0||(i[t>>2]=A-a,i[n>>2]=e-a,i[o>>2]=s-a),0|(t=0)}function Ee(e){var t,r,n,o;r=(o=0|i[(t=(e|=0)+8|0)>>2])-(0|i[e>>2])|0,i[e>>2]=r,e=(0|i[(n=e+4|0)>>2])-o|0,i[n>>2]=e,i[t>>2]=0-(e+r)}function Me(e){var t,r,n=0,o=0,s=0,a=0,A=0;n=0-(o=0|i[(e|=0)>>2])|0,i[e>>2]=n,i[(t=e+8|0)>>2]=0,a=(s=0|i[(r=e+4|0)>>2])+o|0,(0|o)>0?(i[r>>2]=a,i[t>>2]=o,i[e>>2]=0,n=0,s=a):o=0,(0|s)<0?(A=n-s|0,i[e>>2]=A,o=o-s|0,i[t>>2]=o,i[r>>2]=0,a=A-o|0,n=0-o|0,(0|o)<0?(i[e>>2]=a,i[r>>2]=n,i[t>>2]=0,s=n,o=0):(s=0,a=A)):a=n,(0|(n=(0|o)<(0|(n=(0|s)<(0|a)?s:a))?o:n))<=0||(i[e>>2]=a-n,i[r>>2]=s-n,i[t>>2]=o-n)}function Ne(e,t,r){r|=0;var n,o,s=0,a=0;return o=D,D=D+16|0,n=o,a=-2130706433&(t|=0)|134217728,!0&268435456==(2013265920&t)?(s=0|sr(0|(e|=0),0|t,56),S(),s=0|function(e,t,r){e|=0,t|=0,r|=0;var n=0,o=0,s=0;if(s=D,D=D+16|0,o=s,n=0|je(e,t),(r+-1|0)>>>0>5)return D=s,0|(o=-1);if(n=!!(0|n),1==(0|r)&n)return D=s,0|(o=-1);do{if(!(0|It(e,t,o))){if(n){n=(5+(0|i[26352+(r<<2)>>2])-(0|i[o>>2])|0)%5|0;break}n=(6+(0|i[26384+(r<<2)>>2])-(0|i[o>>2])|0)%6|0;break}n=-1}while(0);return o=n,D=s,0|o}(e,a,7&s),-1==(0|s)?(i[r>>2]=0,D=o,0|(a=6)):(0|et(e,a,n)&&E(27795,26932,282,26947),t=0|sr(0|e,0|t,52),S(),t&=15,0|je(e,a)?De(n,t,s,2,r):Le(n,t,s,2,r),D=o,0|(a=0))):(D=o,0|(a=6))}function Ce(e,t,r,n){t|=0,n|=0;var s,a=0,A=0,l=0,u=0;if(s=D,D=D+16|0,function(e,t,r){e|=0,t|=0,r|=0;var n=0,s=0,a=0;a=D,D=D+32|0,s=a,function(e,t){e|=0,t|=0;var r=0,n=0,i=0;r=+o[e>>3],n=+h(+r),r=+d(+r),o[t+16>>3]=r,r=+o[e+8>>3],i=n*+h(+r),o[t>>3]=i,r=n*+d(+r),o[t+8>>3]=r}(e,s),i[t>>2]=0,o[r>>3]=5,n=+kt(16400,s),n<+o[r>>3]&&(i[t>>2]=0,o[r>>3]=n);n=+kt(16424,s),n<+o[r>>3]&&(i[t>>2]=1,o[r>>3]=n);n=+kt(16448,s),n<+o[r>>3]&&(i[t>>2]=2,o[r>>3]=n);n=+kt(16472,s),n<+o[r>>3]&&(i[t>>2]=3,o[r>>3]=n);n=+kt(16496,s),n<+o[r>>3]&&(i[t>>2]=4,o[r>>3]=n);n=+kt(16520,s),n<+o[r>>3]&&(i[t>>2]=5,o[r>>3]=n);n=+kt(16544,s),n<+o[r>>3]&&(i[t>>2]=6,o[r>>3]=n);n=+kt(16568,s),n<+o[r>>3]&&(i[t>>2]=7,o[r>>3]=n);n=+kt(16592,s),n<+o[r>>3]&&(i[t>>2]=8,o[r>>3]=n);n=+kt(16616,s),n<+o[r>>3]&&(i[t>>2]=9,o[r>>3]=n);n=+kt(16640,s),n<+o[r>>3]&&(i[t>>2]=10,o[r>>3]=n);n=+kt(16664,s),n<+o[r>>3]&&(i[t>>2]=11,o[r>>3]=n);n=+kt(16688,s),n<+o[r>>3]&&(i[t>>2]=12,o[r>>3]=n);n=+kt(16712,s),n<+o[r>>3]&&(i[t>>2]=13,o[r>>3]=n);n=+kt(16736,s),n<+o[r>>3]&&(i[t>>2]=14,o[r>>3]=n);n=+kt(16760,s),n<+o[r>>3]&&(i[t>>2]=15,o[r>>3]=n);n=+kt(16784,s),n<+o[r>>3]&&(i[t>>2]=16,o[r>>3]=n);n=+kt(16808,s),n<+o[r>>3]&&(i[t>>2]=17,o[r>>3]=n);n=+kt(16832,s),n<+o[r>>3]&&(i[t>>2]=18,o[r>>3]=n);if(n=+kt(16856,s),!(n<+o[r>>3]))return void(D=a);i[t>>2]=19,o[r>>3]=n,D=a}(e|=0,r|=0,u=s),(A=+f(+(1-.5*+o[u>>3])))<1e-16)return i[n>>2]=0,i[n+4>>2]=0,i[n+8>>2]=0,i[n+12>>2]=0,void(D=s);if(u=0|i[r>>2],a=+at((a=+o[15920+(24*u|0)>>3])-+at(+function(e,t){e|=0,t|=0;var r=0,n=0,i=0,s=0,a=0;return s=+o[t>>3],n=+h(+s),i=+o[t+8>>3]-+o[e+8>>3],a=n*+d(+i),r=+o[e>>3],+ +y(+a,+(+d(+s)*+h(+r)-+h(+i)*(n*+d(+r))))}(15600+(u<<4)|0,e))),l=0|Ke(t)?+at(a+-.3334731722518321):a,a=2.618033988749896*+p(+A),(0|t)>0){e=0;do{a*=2.6457513110645907,e=e+1|0}while((0|e)!=(0|t))}A=+h(+l)*a,o[n>>3]=A,l=+d(+l)*a,o[n+8>>3]=l,D=s}function Re(e,t,r,n,s){t|=0,r|=0,n|=0,s|=0;var a,A=0,c=0;if(A=+function(e){e|=0;var t=0,r=0;return r=+o[e>>3],t=+o[e+8>>3],+ +u(+(r*r+t*t))}(e|=0),A<1e-16)return t=15600+(t<<4)|0,i[s>>2]=i[t>>2],i[s+4>>2]=i[t+4>>2],i[s+8>>2]=i[t+8>>2],void(i[s+12>>2]=i[t+12>>2]);if(c=+y(+ +o[e+8>>3],+ +o[e>>3]),(0|r)>0){e=0;do{A*=.37796447300922725,e=e+1|0}while((0|e)!=(0|r))}a=.3333333333333333*A,n?(r=!(0|Ke(r)),A=+g(.381966011250105*(r?a:.37796447300922725*a))):(A=+g(.381966011250105*A),0|Ke(r)&&(c=+at(c+.3334731722518321))),function(e,t,r,n){e|=0,t=+t,r=+r,n|=0;var s=0,a=0,A=0,u=0;if(r<1e-16)return i[n>>2]=i[e>>2],i[n+4>>2]=i[e+4>>2],i[n+8>>2]=i[e+8>>2],void(i[n+12>>2]=i[e+12>>2]);a=t<0?t+6.283185307179586:t,a=t>=6.283185307179586?a+-6.283185307179586:a;do{if(!(a<1e-16)){if(s=+l(+(a+-3.141592653589793))<1e-16,t=+o[e>>3],s){t-=r,o[n>>3]=t,s=n;break}if(A=+h(+r),r=+d(+r),t=A*+d(+t)+ +h(+a)*(r*+h(+t)),t=+m(+((t=t>1?1:t)<-1?-1:t)),o[n>>3]=t,+l(+(t+-1.5707963267948966))<1e-16)return o[n>>3]=1.5707963267948966,void(o[n+8>>3]=0);if(+l(+(t+1.5707963267948966))<1e-16)return o[n>>3]=-1.5707963267948966,void(o[n+8>>3]=0);if(u=1/+h(+t),a=r*+d(+a)*u,r=+o[e>>3],t=u*((A-+d(+t)*+d(+r))/+h(+r)),A=a>1?1:a,t=t>1?1:t,(t=+o[e+8>>3]+ +y(+(A<-1?-1:A),+(t<-1?-1:t)))>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);return void(o[n+8>>3]=t)}t=+o[e>>3]+r,o[n>>3]=t,s=n}while(0);if(+l(+(t+-1.5707963267948966))<1e-16)return o[s>>3]=1.5707963267948966,void(o[n+8>>3]=0);if(+l(+(t+1.5707963267948966))<1e-16)return o[s>>3]=-1.5707963267948966,void(o[n+8>>3]=0);if(t=+o[e+8>>3],t>3.141592653589793)do{t+=-6.283185307179586}while(t>3.141592653589793);if(t<-3.141592653589793)do{t+=6.283185307179586}while(t<-3.141592653589793);o[n+8>>3]=t}(15600+(t<<4)|0,+at(+o[15920+(24*t|0)>>3]-c),A,s)}function Pe(e,t,r){t|=0,r|=0;var n,o;n=D,D=D+16|0,oe((e|=0)+4|0,o=n),Re(o,0|i[e>>2],t,0,r),D=n}function De(e,t,r,n,s){e|=0,t|=0,r|=0,n|=0,s|=0;var a,A,l,u,c,h,d,p,f,m,g,y,b,v,_,x,w,T,S,M,N,C,R=0,P=0,B=0,q=0,O=0,L=0;if(C=D,D=D+272|0,q=C+240|0,S=C,M=C+224|0,N=C+208|0,g=C+176|0,y=C+160|0,b=C+192|0,v=C+144|0,_=C+128|0,x=C+112|0,w=C+96|0,T=C+80|0,i[(R=C+256|0)>>2]=t,i[q>>2]=i[e>>2],i[q+4>>2]=i[e+4>>2],i[q+8>>2]=i[e+8>>2],i[q+12>>2]=i[e+12>>2],Be(q,R,S),i[s>>2]=0,(0|(q=n+r+(5==(0|n)&1)|0))<=(0|r))D=C;else{A=M+4|0,l=g+4|0,u=r+5|0,c=16880+((a=0|i[R>>2])<<2)|0,h=16960+(a<<2)|0,d=_+8|0,p=x+8|0,f=w+8|0,m=N+4|0,B=r;e:for(;;){P=S+((0|B)%5<<4)|0,i[N>>2]=i[P>>2],i[N+4>>2]=i[P+4>>2],i[N+8>>2]=i[P+8>>2],i[N+12>>2]=i[P+12>>2];do{}while(2==(0|qe(N,a,0,1)));if((0|B)>(0|r)&!!(0|Ke(t))){if(i[g>>2]=i[N>>2],i[g+4>>2]=i[N+4>>2],i[g+8>>2]=i[N+8>>2],i[g+12>>2]=i[N+12>>2],oe(A,y),n=0|i[g>>2],R=0|i[17040+(80*n|0)+(i[M>>2]<<2)>>2],i[g>>2]=i[18640+(80*n|0)+(20*R|0)>>2],(0|(P=0|i[18640+(80*n|0)+(20*R|0)+16>>2]))>0){e=0;do{ge(l),e=e+1|0}while((0|e)<(0|P))}switch(P=18640+(80*n|0)+(20*R|0)+4|0,i[b>>2]=i[P>>2],i[b+4>>2]=i[P+4>>2],i[b+8>>2]=i[P+8>>2],Ae(b,3*(0|i[c>>2])|0),se(l,b,l),ie(l),oe(l,v),O=+(0|i[h>>2]),o[_>>3]=3*O,o[d>>3]=0,L=-1.5*O,o[x>>3]=L,o[p>>3]=2.598076211353316*O,o[w>>3]=L,o[f>>3]=-2.598076211353316*O,0|i[17040+(80*(0|i[g>>2])|0)+(i[N>>2]<<2)>>2]){case 1:e=x,n=_;break;case 3:e=w,n=x;break;case 2:e=_,n=w;break;default:e=12;break e}Ot(y,v,n,e,T),Re(T,0|i[g>>2],a,1,s+8+(i[s>>2]<<4)|0),i[s>>2]=1+(0|i[s>>2])}if((0|B)<(0|u)&&(oe(m,g),Re(g,0|i[N>>2],a,1,s+8+(i[s>>2]<<4)|0),i[s>>2]=1+(0|i[s>>2])),i[M>>2]=i[N>>2],i[M+4>>2]=i[N+4>>2],i[M+8>>2]=i[N+8>>2],i[M+12>>2]=i[N+12>>2],(0|(B=B+1|0))>=(0|q)){e=3;break}}3!=(0|e)?12==(0|e)&&E(26970,27017,572,27027):D=C}}function Be(e,t,r){e|=0,t|=0,r|=0;var n,o=0,s=0,a=0,A=0,l=0;n=D,D=D+128|0,s=n,A=20240,l=(a=o=n+64|0)+60|0;do{i[a>>2]=i[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));A=20304,l=(a=s)+60|0;do{i[a>>2]=i[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));o=(l=!(0|Ke(0|i[t>>2])))?o:s,_e(s=e+4|0),xe(s),0|Ke(0|i[t>>2])&&(fe(s),i[t>>2]=1+(0|i[t>>2])),i[r>>2]=i[e>>2],se(s,o,t=r+4|0),ie(t),i[r+16>>2]=i[e>>2],se(s,o+12|0,t=r+20|0),ie(t),i[r+32>>2]=i[e>>2],se(s,o+24|0,t=r+36|0),ie(t),i[r+48>>2]=i[e>>2],se(s,o+36|0,t=r+52|0),ie(t),i[r+64>>2]=i[e>>2],se(s,o+48|0,r=r+68|0),ie(r),D=n}function qe(e,t,r,n){r|=0,n|=0;var o,s,a,A,l,u,c=0,h=0,d=0,p=0,f=0;if(u=D,D=D+32|0,l=u+12|0,s=u,f=(e|=0)+4|0,p=0|i[16960+((t|=0)<<2)>>2],p=(A=!!(0|n))?3*p|0:p,c=0|i[f>>2],o=0|i[(a=e+8|0)>>2],A){if((0|(c=o+c+(n=0|i[(h=e+12|0)>>2])|0))==(0|p))return D=u,0|(f=1);d=h}else c=o+c+(n=0|i[(d=e+12|0)>>2])|0;if((0|c)<=(0|p))return D=u,0|(f=0);do{if((0|n)>0){if(n=0|i[e>>2],(0|o)>0){h=18640+(80*n|0)+60|0,n=e;break}n=18640+(80*n|0)+40|0,r?(re(l,p,0,0),ae(f,l,s),ye(s),se(s,l,f),h=n,n=e):(h=n,n=e)}else h=18640+(80*(0|i[e>>2])|0)+20|0,n=e}while(0);if(i[n>>2]=i[h>>2],(0|i[(c=h+16|0)>>2])>0){n=0;do{ge(f),n=n+1|0}while((0|n)<(0|i[c>>2]))}return e=h+4|0,i[l>>2]=i[e>>2],i[l+4>>2]=i[e+4>>2],i[l+8>>2]=i[e+8>>2],t=0|i[16880+(t<<2)>>2],Ae(l,A?3*t|0:t),se(f,l,f),ie(f),n=A&&((0|i[a>>2])+(0|i[f>>2])+(0|i[d>>2])|0)==(0|p)?1:2,D=u,0|(f=n)}function Oe(e,t){e|=0,t|=0;var r=0;do{r=0|qe(e,t,0,1)}while(2==(0|r));return 0|r}function Le(e,t,r,n,s){e|=0,t|=0,r|=0,n|=0,s|=0;var a,A,l,u,c,h,d,p,f,m,g,y,b,v,_,x,w,T,S=0,M=0,N=0,C=0,R=0;if(T=D,D=D+240|0,v=T+208|0,_=T,x=T+192|0,w=T+176|0,f=T+160|0,m=T+144|0,g=T+128|0,y=T+112|0,b=T+96|0,i[(S=T+224|0)>>2]=t,i[v>>2]=i[e>>2],i[v+4>>2]=i[e+4>>2],i[v+8>>2]=i[e+8>>2],i[v+12>>2]=i[e+12>>2],ke(v,S,_),i[s>>2]=0,(0|(p=n+r+(6==(0|n)&1)|0))<=(0|r))D=T;else{A=r+6|0,l=16960+((a=0|i[S>>2])<<2)|0,u=m+8|0,c=g+8|0,h=y+8|0,d=x+4|0,M=0,N=r,n=-1;e:for(;;){if(e=_+((S=(0|N)%6|0)<<4)|0,i[x>>2]=i[e>>2],i[x+4>>2]=i[e+4>>2],i[x+8>>2]=i[e+8>>2],i[x+12>>2]=i[e+12>>2],e=M,M=0|qe(x,a,0,1),(0|N)>(0|r)&!!(0|Ke(t))&&(1!=(0|e)&&(0|i[x>>2])!=(0|n))){switch(oe(_+((S+5|0)%6<<4)+4|0,w),oe(_+(S<<4)+4|0,f),C=+(0|i[l>>2]),o[m>>3]=3*C,o[u>>3]=0,R=-1.5*C,o[g>>3]=R,o[c>>3]=2.598076211353316*C,o[y>>3]=R,o[h>>3]=-2.598076211353316*C,S=0|i[v>>2],0|i[17040+(80*S|0)+(((0|n)==(0|S)?i[x>>2]:n)<<2)>>2]){case 1:e=g,n=m;break;case 3:e=y,n=g;break;case 2:e=m,n=y;break;default:e=8;break e}Ot(w,f,n,e,b),0|Lt(w,b)||0|Lt(f,b)||(Re(b,0|i[v>>2],a,1,s+8+(i[s>>2]<<4)|0),i[s>>2]=1+(0|i[s>>2]))}if((0|N)<(0|A)&&(oe(d,w),Re(w,0|i[x>>2],a,1,s+8+(i[s>>2]<<4)|0),i[s>>2]=1+(0|i[s>>2])),(0|(N=N+1|0))>=(0|p)){e=3;break}n=0|i[x>>2]}3!=(0|e)?8==(0|e)&&E(27054,27017,737,27099):D=T}}function ke(e,t,r){e|=0,t|=0,r|=0;var n,o=0,s=0,a=0,A=0,l=0;n=D,D=D+160|0,s=n,A=20368,l=(a=o=n+80|0)+72|0;do{i[a>>2]=i[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));A=20448,l=(a=s)+72|0;do{i[a>>2]=i[A>>2],a=a+4|0,A=A+4|0}while((0|a)<(0|l));o=(l=!(0|Ke(0|i[t>>2])))?o:s,_e(s=e+4|0),xe(s),0|Ke(0|i[t>>2])&&(fe(s),i[t>>2]=1+(0|i[t>>2])),i[r>>2]=i[e>>2],se(s,o,t=r+4|0),ie(t),i[r+16>>2]=i[e>>2],se(s,o+12|0,t=r+20|0),ie(t),i[r+32>>2]=i[e>>2],se(s,o+24|0,t=r+36|0),ie(t),i[r+48>>2]=i[e>>2],se(s,o+36|0,t=r+52|0),ie(t),i[r+64>>2]=i[e>>2],se(s,o+48|0,t=r+68|0),ie(t),i[r+80>>2]=i[e>>2],se(s,o+60|0,r=r+84|0),ie(r),D=n}function Ie(e,t){return t=0|sr(0|(e|=0),0|(t|=0),45),S(),127&t}function Fe(e,t){e|=0;var r=0,i=0,o=0,s=0;return!0&134217728==(-16777216&(t|=0))?(i=0|sr(0|e,0|t,52),S(),i&=15,r=0|sr(0|e,0|t,45),S(),(r&=127)>>>0>121?0|(e=0):!(613566756&(s=0|ar(0|(o=0|sr(0|e,0|t,0|(s=3*(15^i)|0))),0|S(),0|s))&(0|Zt(-1227133514,-1171,0|s,0|(o=0|S()))))&!(4681&o&S())&&15==(0|i)|!(0|(s=0|sr(0|(0|ar(0|~e,0|~t,0|(s=19+(3*i|0)|0))),0|S(),0|s)))&!(0|S())?0|n[20528+r|0]?!(0|e)&!(0|(t&=8191))?0|(s=1):(s=0|Ar(0|e,0|t),S(),0|!!((63-s|0)%3|0)):0|(s=1):0|(s=0)):0|(e=0)}function Ue(e,t,r,n){e|=0,r|=0,n|=0;var o=0,s=0,a=0,A=0;if(o=0|ar(0|(t|=0),0,52),s=0|S(),r=0|ar(0|r,0,45),r=0|s|S()|134225919,(0|t)<1)return s=-1,n=r,i[(t=e)>>2]=s,void(i[(e=e+4|0)>>2]=n);for(s=1,o=-1;A=0|ar(7,0,0|(a=3*(15-s|0)|0)),r&=~S(),o=o&~A|(a=0|ar(0|n,0,0|a)),r=0|r|S(),(0|s)!=(0|t);)s=s+1|0;i[(a=A=e)>>2]=o,i[(A=A+4|0)>>2]=r}function Ve(e,t,r,n){r|=0,n|=0;var o=0,s=0;if(s=0|sr(0|(e|=0),0|(t|=0),52),S(),r>>>0>15)return 0|(n=4);if((0|(s&=15))<(0|r))return 0|(n=12);if((0|s)==(0|r))return i[n>>2]=e,i[n+4>>2]=t,0|(n=0);if(o=0|ar(0|r,0,52),o|=e,e=S()|-15728641&t,(0|s)>(0|r))do{t=0|ar(7,0,3*(14-r|0)|0),r=r+1|0,o|=t,e=0|S()|e}while((0|r)<(0|s));return i[n>>2]=o,i[n+4>>2]=e,0|(n=0)}function Ge(e,t,r,n){r|=0,n|=0;var o=0,s=0,a=0;if(s=0|sr(0|(e|=0),0|(t|=0),52),S(),!((0|r)<16&(0|(s&=15))<=(0|r)))return 0|(n=4);o=r-s|0,r=0|sr(0|e,0|t,45),S();e:do{if(0|U(127&r)){t:do{if(0|s){for(r=1;!((a=0|ar(7,0,3*(15-r|0)|0))&e|0)&!((0|S())&t);){if(!(r>>>0<s>>>0))break t;r=r+1|0}r=0|xt(7,0,o,((0|o)<0)<<31>>31),o=0|S();break e}}while(0);r=0|Kt(0|(r=0|rr(0|(r=0|xt(7,0,o,((0|o)<0)<<31>>31)),0|S(),5,0)),0|S(),-5,-1),r=0|Kt(0|(r=0|tr(0|r,0|S(),6,0)),0|S(),1,0),o=0|S()}else r=0|xt(7,0,o,((0|o)<0)<<31>>31),o=0|S()}while(0);return i[(a=n)>>2]=r,i[a+4>>2]=o,0|(a=0)}function je(e,t){var r=0,n=0,i=0;if(i=0|sr(0|(e|=0),0|(t|=0),45),S(),!(0|U(127&i)))return 0|(i=0);i=0|sr(0|e,0|t,52),S(),i&=15;e:do{if(i)for(n=1;;){if(r=0|sr(0|e,0|t,3*(15-n|0)|0),S(),0|(r&=7))break e;if(!(n>>>0<i>>>0)){r=0;break}n=n+1|0}else r=0}while(0);return 0|(i=1&!(0|r))}function ze(e,t,r,n){return e|=0,t|=0,(0|(n|=0))<(0|(r|=0))?(n=e,T(0|(r=t)),0|n):(r=0|ar(-1,-1,3+(3*(n-r|0)|0)|0),n=0|ar(0|~r,0|~S(),3*(15-n|0)|0),r=~S()&t,n=~n&e,T(0|r),0|n)}function He(e,t,r,n){r|=0,n|=0;var o=0;return o=0|sr(0|(e|=0),0|(t|=0),52),S(),(0|r)<16&(0|(o&=15))<=(0|r)?((0|o)<(0|r)&&(o=0|ar(-1,-1,3+(3*(r+-1-o|0)|0)|0),o=0|ar(0|~o,0|~S(),3*(15-r|0)|0),t=~S()&t,e&=~o),o=0|ar(0|r,0,52),r=-15728641&t|S(),i[n>>2]=e|o,i[n+4>>2]=r,0|(n=0)):0|(n=4)}function We(e,t){var r=0,n=0,i=0;if(i=0|sr(0|(e|=0),0|(t|=0),52),S(),!(i&=15))return 0|(i=0);for(n=1;;){if(r=0|sr(0|e,0|t,3*(15-n|0)|0),S(),0|(r&=7)){n=5;break}if(!(n>>>0<i>>>0)){r=0,n=5;break}n=n+1|0}return 5==(0|n)?0|r:0}function Qe(e,t){var r=0,n=0,i=0,o=0,s=0,a=0,A=0;if(A=0|sr(0|(e|=0),0|(t|=0),52),S(),!(A&=15))return A=e,T(0|(a=t)),0|A;for(a=1,r=0;;){n=0|ar(7,0,0|(o=3*(15-a|0)|0)),i=0|S(),s=0|sr(0|e,0|t,0|o),S(),e=(o=0|ar(0|be(7&s),0,0|o))|e&~n,t=(s=0|S())|t&~i;e:do{if(!r)if(!(o&n|0)&!(s&i|0))r=0;else if(n=0|sr(0|e,0|t,52),S(),n&=15){r=1;t:for(;;){switch(s=0|sr(0|e,0|t,3*(15-r|0)|0),S(),7&s){case 1:break t;case 0:break;default:r=1;break e}if(!(r>>>0<n>>>0)){r=1;break e}r=r+1|0}for(r=1;;){if(i=0|sr(0|e,0|t,0|(s=3*(15-r|0)|0)),S(),o=0|ar(7,0,0|s),t&=~S(),e=e&~o|(s=0|ar(0|be(7&i),0,0|s)),t=0|t|S(),!(r>>>0<n>>>0)){r=1;break}r=r+1|0}}else r=1}while(0);if(!(a>>>0<A>>>0))break;a=a+1|0}return T(0|t),0|e}function $e(e,t){var r=0,n=0,i=0,o=0,s=0;if(n=0|sr(0|(e|=0),0|(t|=0),52),S(),!(n&=15))return n=e,T(0|(r=t)),0|n;for(r=1;s=0|sr(0|e,0|t,0|(o=3*(15-r|0)|0)),S(),i=0|ar(7,0,0|o),t&=~S(),e=(o=0|ar(0|be(7&s),0,0|o))|e&~i,t=0|S()|t,r>>>0<n>>>0;)r=r+1|0;return T(0|t),0|e}function Ye(e,t){var r=0,n=0,i=0,o=0,s=0,a=0,A=0;if(A=0|sr(0|(e|=0),0|(t|=0),52),S(),!(A&=15))return A=e,T(0|(a=t)),0|A;for(a=1,r=0;;){n=0|ar(7,0,0|(o=3*(15-a|0)|0)),i=0|S(),s=0|sr(0|e,0|t,0|o),S(),e=(o=0|ar(0|ve(7&s),0,0|o))|e&~n,t=(s=0|S())|t&~i;e:do{if(!r)if(!(o&n|0)&!(s&i|0))r=0;else if(n=0|sr(0|e,0|t,52),S(),n&=15){r=1;t:for(;;){switch(s=0|sr(0|e,0|t,3*(15-r|0)|0),S(),7&s){case 1:break t;case 0:break;default:r=1;break e}if(!(r>>>0<n>>>0)){r=1;break e}r=r+1|0}for(r=1;;){if(o=0|ar(7,0,0|(i=3*(15-r|0)|0)),s=t&~S(),t=0|sr(0|e,0|t,0|i),S(),e=e&~o|(t=0|ar(0|ve(7&t),0,0|i)),t=0|s|S(),!(r>>>0<n>>>0)){r=1;break}r=r+1|0}}else r=1}while(0);if(!(a>>>0<A>>>0))break;a=a+1|0}return T(0|t),0|e}function Xe(e,t){var r=0,n=0,i=0,o=0,s=0;if(n=0|sr(0|(e|=0),0|(t|=0),52),S(),!(n&=15))return n=e,T(0|(r=t)),0|n;for(r=1;o=0|ar(7,0,0|(s=3*(15-r|0)|0)),i=t&~S(),t=0|sr(0|e,0|t,0|s),S(),e=(t=0|ar(0|ve(7&t),0,0|s))|e&~o,t=0|S()|i,r>>>0<n>>>0;)r=r+1|0;return T(0|t),0|e}function Ke(e){return(0|(e|=0))%2|0}function Ze(e,t,r){r|=0;var n,o=0;return n=D,D=D+16|0,o=n,(t|=0)>>>0>15?(D=n,0|(o=4)):2146435072&~i[(e|=0)+4>>2]&&2146435072&~i[e+8+4>>2]?(function(e,t,r){var n,i;n=D,D=D+16|0,Ce(e|=0,t|=0,r|=0,i=n),ne(i,r+4|0),D=n}(e,t,o),t=0|function(e,t){e|=0;var r,n=0,o=0,s=0,a=0,A=0,l=0,u=0,c=0;if(r=D,D=D+64|0,l=r+40|0,o=r+24|0,s=r+12|0,a=r,ar(0|(t|=0),0,52),n=134225919|S(),!t)return(0|i[e+4>>2])>2||(0|i[e+8>>2])>2||(0|i[e+12>>2])>2?(l=0,T(0|(A=0)),D=r,0|l):(ar(0|G(e),0,45),A=0|S()|n,l=-1,T(0|A),D=r,0|l);if(i[l>>2]=i[e>>2],i[l+4>>2]=i[e+4>>2],i[l+8>>2]=i[e+8>>2],i[l+12>>2]=i[e+12>>2],A=l+4|0,(0|t)>0)for(e=-1;i[o>>2]=i[A>>2],i[o+4>>2]=i[A+4>>2],i[o+8>>2]=i[A+8>>2],1&t?(he(A),i[s>>2]=i[A>>2],i[s+4>>2]=i[A+4>>2],i[s+8>>2]=i[A+8>>2],pe(s)):(de(A),i[s>>2]=i[A>>2],i[s+4>>2]=i[A+4>>2],i[s+8>>2]=i[A+8>>2],fe(s)),ae(o,s,a),ie(a),u=0|ar(7,0,0|(c=3*(15-t|0)|0)),n&=~S(),e=(c=0|ar(0|le(a),0,0|c))|e&~u,n=0|S()|n,(0|t)>1;)t=t+-1|0;else e=-1;e:do{if((0|i[A>>2])<=2&&(0|i[l+8>>2])<=2&&(0|i[l+12>>2])<=2){if(t=0|ar(0|(o=0|G(l)),0,45),t|=e,e=S()|-1040385&n,a=0|j(l),!(0|U(o))){if((0|a)<=0)break;for(s=0;;){if(o=0|sr(0|t,0|e,52),S(),o&=15)for(n=1;l=0|sr(0|t,0|e,0|(c=3*(15-n|0)|0)),S(),u=0|ar(7,0,0|c),e&=~S(),t=t&~u|(c=0|ar(0|be(7&l),0,0|c)),e=0|e|S(),n>>>0<o>>>0;)n=n+1|0;if((0|(s=s+1|0))==(0|a))break e}}s=0|sr(0|t,0|e,52),S(),s&=15;t:do{if(s){n=1;r:for(;;){switch(c=0|sr(0|t,0|e,3*(15-n|0)|0),S(),7&c){case 1:break r;case 0:break;default:break t}if(!(n>>>0<s>>>0))break t;n=n+1|0}if(0|z(o,0|i[l>>2]))for(n=1;u=0|ar(7,0,0|(l=3*(15-n|0)|0)),c=e&~S(),e=0|sr(0|t,0|e,0|l),S(),t=t&~u|(e=0|ar(0|ve(7&e),0,0|l)),e=0|c|S(),n>>>0<s>>>0;)n=n+1|0;else for(n=1;l=0|sr(0|t,0|e,0|(c=3*(15-n|0)|0)),S(),u=0|ar(7,0,0|c),e&=~S(),t=t&~u|(c=0|ar(0|be(7&l),0,0|c)),e=0|e|S(),n>>>0<s>>>0;)n=n+1|0}}while(0);if((0|a)>0){n=0;do{t=0|Qe(t,e),e=0|S(),n=n+1|0}while((0|n)!=(0|a))}}else t=0,e=0}while(0);return c=t,T(0|(u=e)),D=r,0|c}(o,t),o=0|S(),i[r>>2]=t,i[r+4>>2]=o,!(0|t)&!(0|o)&&E(27795,27122,959,27145),D=n,0|(o=0)):(D=n,0|(o=3))}function Je(e,t,r){var n,o=0,s=0,a=0;if(n=(r|=0)+4|0,s=0|sr(0|(e|=0),0|(t|=0),52),S(),s&=15,a=0|sr(0|e,0|t,45),S(),o=!(0|s),0|U(127&a)){if(o)return 0|(a=1);o=1}else{if(o)return 0|(a=0);o=0|i[n>>2]||0|i[r+8>>2]?1:1&!!(0|i[r+12>>2])}for(r=1;1&r?pe(n):fe(n),a=0|sr(0|e,0|t,3*(15-r|0)|0),S(),me(n,7&a),r>>>0<s>>>0;)r=r+1|0;return 0|o}function et(e,t,r){r|=0;var n,o,s=0,a=0,A=0,l=0,u=0,c=0;if(o=D,D=D+16|0,n=o,c=0|sr(0|(e|=0),0|(t|=0),45),S(),(c&=127)>>>0>121)return i[r>>2]=0,i[r+4>>2]=0,i[r+8>>2]=0,i[r+12>>2]=0,D=o,0|(c=5);e:do{if(0|U(c)&&(A=0|sr(0|e,0|t,52),S(),0|(A&=15))){s=1;t:for(;;){switch(u=0|sr(0|e,0|t,3*(15-s|0)|0),S(),7&u){case 5:break t;case 0:break;default:s=t;break e}if(!(s>>>0<A>>>0)){s=t;break e}s=s+1|0}for(a=1,s=t;l=0|ar(7,0,0|(t=3*(15-a|0)|0)),u=s&~S(),s=0|sr(0|e,0|s,0|t),S(),e=e&~l|(s=0|ar(0|ve(7&s),0,0|t)),s=0|u|S(),a>>>0<A>>>0;)a=a+1|0}else s=t}while(0);if(u=7696+(28*c|0)|0,i[r>>2]=i[u>>2],i[r+4>>2]=i[u+4>>2],i[r+8>>2]=i[u+8>>2],i[r+12>>2]=i[u+12>>2],!(0|Je(e,s,r)))return D=o,0|(c=0);if(l=r+4|0,i[n>>2]=i[l>>2],i[n+4>>2]=i[l+4>>2],i[n+8>>2]=i[l+8>>2],A=0|sr(0|e,0|s,52),S(),u=15&A,1&A?(fe(l),A=u+1|0):A=u,0|U(c)){e:do{if(u)for(t=1;;){if(a=0|sr(0|e,0|s,3*(15-t|0)|0),S(),0|(a&=7)){s=a;break e}if(!(t>>>0<u>>>0)){s=0;break}t=t+1|0}else s=0}while(0);s=4==(0|s)&1}else s=0;if(0|qe(r,A,s,0)){if(0|U(c))do{}while(0|qe(r,A,0,0));(0|A)!=(0|u)&&de(l)}else(0|A)!=(0|u)&&(i[l>>2]=i[n>>2],i[l+4>>2]=i[n+4>>2],i[l+8>>2]=i[n+8>>2]);return D=o,0|(c=0)}function tt(e,t,r){r|=0;var n,i,o=0;return i=D,D=D+16|0,0|(o=0|et(e|=0,t|=0,n=i))?(D=i,0|o):(o=0|sr(0|e,0|t,52),S(),Pe(n,15&o,r),D=i,0|(o=0))}function rt(e,t,r){r|=0;var n,i=0,o=0,s=0;if(n=D,D=D+16|0,0|(i=0|et(e|=0,t|=0,s=n)))return D=n,0|(s=i);i=0|sr(0|e,0|t,45),S(),i=!(0|U(127&i)),o=0|sr(0|e,0|t,52),S(),o&=15;e:do{if(!i){if(0|o)for(i=1;;){if(!(!((0|ar(7,0,3*(15-i|0)|0))&e|0)&!((0|S())&t)))break e;if(!(i>>>0<o>>>0))break;i=i+1|0}return De(s,o,0,5,r),D=n,0|0}}while(0);return Le(s,o,0,6,r),D=n,0|0}function nt(e,t){t|=0;var r=0,n=0,o=0,s=0,a=0,A=0,l=0;if((e|=0)>>>0>15)return 0|(A=4);if(ar(0|e,0,52),A=134225919|S(),!e){r=0,n=0;do{0|U(n)&&(ar(0|n,0,45),a=0|A|S(),i[(e=t+(r<<3)|0)>>2]=-1,i[e+4>>2]=a,r=r+1|0),n=n+1|0}while(122!=(0|n));return 0|(r=0)}r=0,a=0;do{if(0|U(a)){for(ar(0|a,0,45),n=1,o=-1,s=0|A|S();o&=~(l=0|ar(7,0,3*(15-n|0)|0)),s&=~S(),(0|n)!=(0|e);)n=n+1|0;i[(l=t+(r<<3)|0)>>2]=o,i[l+4>>2]=s,r=r+1|0}a=a+1|0}while(122!=(0|a));return 0|(r=0)}function it(e,t,r,n){e|=0,n|=0;var o=0,s=0,a=0;o=0|sr(0|(t|=0),0|(r|=0),52),S(),!(0|t)&!(0|r)|(0|n)>15|(0|(o&=15))>(0|n)?(s=-1,t=-1,r=0,o=0):(t=0|ze(t,r,o+1|0,n),a=-15728641&S(),r=0|ar(0|n,0,52),s=o,t=(t=!(0|je(r|=t,a=0|a|S())))?-1:n,o=a),i[(a=e)>>2]=r,i[a+4>>2]=o,i[e+8>>2]=s,i[e+12>>2]=t}function ot(e,t,r,n){r|=0,n|=0;var o=0,s=0;return o=0|sr(0|(e|=0),0|(t|=0),52),S(),o&=15,i[(s=n+8|0)>>2]=o,!(0|e)&!(0|t)|(0|r)>15|(0|o)>(0|r)?(i[(r=n)>>2]=0,i[r+4>>2]=0,i[s>>2]=-1,void(i[n+12>>2]=-1)):(e=0|ze(e,t,o+1|0,r),s=-15728641&S(),o=0|ar(0|r,0,52),o|=e,s=0|s|S(),i[(e=n)>>2]=o,i[e+4>>2]=s,e=n+12|0,0|je(o,s)?void(i[e>>2]=r):void(i[e>>2]=-1))}function st(e){var t,r=0,n=0,o=0,s=0,a=0,A=0,l=0,u=0;if(!(!(0|(r=0|i[(n=e|=0)>>2]))&!(0|(n=0|i[n+4>>2]))||(o=0|sr(0|r,0|n,52),S(),r=0|Kt(0|(l=0|ar(1,0,3*(15^(o&=15))|0)),0|S(),0|r,0|n),n=0|S(),i[(l=e)>>2]=r,i[l+4>>2]=n,(0|o)<(0|(A=0|i[(l=e+8|0)>>2]))))){for(t=e+12|0,a=o;;){if((0|a)==(0|A)){o=5;break}if(u=(0|a)==(0|i[t>>2]),o=0|sr(0|r,0|n,0|(s=3*(15-a|0)|0)),S(),u&1==(0|(o&=7))&!0){o=7;break}if(!(7==(0|o)&!0)){o=10;break}if(r=0|Kt(0|r,0|n,0|(u=0|ar(1,0,0|s)),0|S()),n=0|S(),i[(u=e)>>2]=r,i[u+4>>2]=n,!((0|a)>(0|A))){o=10;break}a=a+-1|0}if(5==(0|o))return i[(u=e)>>2]=0,i[u+4>>2]=0,i[l>>2]=-1,void(i[t>>2]=-1);if(7==(0|o))return A=0|Kt(0|r,0|n,0|(A=0|ar(1,0,0|s)),0|S()),l=0|S(),i[(u=e)>>2]=A,i[u+4>>2]=l,void(i[t>>2]=a+-1)}}function at(e){var t;return t=(e=+e)<0?e+6.283185307179586:e,+(e>=6.283185307179586?t+-6.283185307179586:t)}function At(e,t){return t|=0,+l(+(+o[(e|=0)>>3]-+o[t>>3]))<17453292519943298e-27?0|(t=+l(+(+o[e+8>>3]-+o[t+8>>3]))<17453292519943298e-27):0|(t=0)}function lt(e,t){switch(e=+e,0|(t|=0)){case 1:e=e<0?e+6.283185307179586:e;break;case 2:e=e>0?e+-6.283185307179586:e}return+e}function ut(e,t){e|=0;var r,n,i,s=0;return n=+o[(t|=0)>>3],r=+o[e>>3],s=(i=+d(.5*(n-r)))*i+(s=+d(.5*(+o[t+8>>3]-+o[e+8>>3])))*(+h(+n)*+h(+r)*s),2*+y(+ +u(+s),+ +u(+(1-s)))*6371.007180918475}function ct(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(o[t>>3]=+o[20656+(e<<3)>>3],0|(t=0))}function ht(e,t){t|=0;var r=0;return(e|=0)>>>0>15?0|(t=4):(r=0|rr(0|(r=0|xt(7,0,e,((0|e)<0)<<31>>31)),0|S(),120,0),e=0|S(),i[t>>2]=2|r,i[t+4>>2]=e,0|(t=0))}function dt(e,t,r){e|=0,r|=0;var n,i,s,a,A=0,l=0,c=0,f=0,m=0,b=0;return b=+o[(t|=0)>>3],s=+o[e>>3],m=+d(.5*(b-s)),c=+o[t+8>>3],i=+o[e+8>>3],f=+d(.5*(c-i)),n=+h(+s),a=+h(+b),f=2*+y(+ +u(+(f=m*m+f*(a*n*f))),+ +u(+(1-f))),m=+o[r>>3],b=+d(.5*(m-b)),A=+o[r+8>>3],c=+d(.5*(A-c)),l=+h(+m),c=2*+y(+ +u(+(c=b*b+c*(a*l*c))),+ +u(+(1-c))),m=+d(.5*(s-m)),A=+d(.5*(i-A)),A=2*+y(+ +u(+(A=m*m+A*(n*l*A))),+ +u(+(1-A))),4*+g(+ +u(+ +p(.5*(l=.5*(f+c+A)))*+p(.5*(l-f))*+p(.5*(l-c))*+p(.5*(l-A))))}function pt(e,t,r){r|=0;var n,s,a,A=0,l=0;if(a=D,D=D+192|0,s=a,0|(l=0|tt(e|=0,t|=0,n=a+168|0)))return D=a,0|(r=l);if(0|rt(e,t,s)&&E(27795,27190,415,27199),(0|(t=0|i[s>>2]))>0){if(A=+dt(s+8|0,s+8+((1!=(0|t)&1)<<4)|0,n)+0,1!=(0|t)){e=1;do{A+=+dt(s+8+((l=e)<<4)|0,s+8+((0|(e=e+1|0))%(0|t)<<4)|0,n)}while((0|e)<(0|t))}}else A=0;return o[r>>3]=A,D=a,0|(r=0)}function ft(e){e|=0;var t,r,n=0;return(t=0|Xt(1,12))||E(27280,27235,49,27293),0|(n=0|i[(r=e+4|0)>>2])?(i[(n=n+8|0)>>2]=t,i[r>>2]=t,0|t):(0|i[e>>2]&&E(27310,27235,61,27333),i[(n=e)>>2]=t,i[r>>2]=t,0|t)}function mt(e,t){e|=0,t|=0;var r,n;return(n=0|$t(24))||E(27347,27235,78,27361),i[n>>2]=i[t>>2],i[n+4>>2]=i[t+4>>2],i[n+8>>2]=i[t+8>>2],i[n+12>>2]=i[t+12>>2],i[n+16>>2]=0,0|(r=0|i[(t=e+4|0)>>2])?(i[r+16>>2]=n,i[t>>2]=n,0|n):(0|i[e>>2]&&E(27376,27235,82,27361),i[e>>2]=n,i[t>>2]=n,0|n)}function gt(e){var t=0,r=0,n=0,o=0;if(e|=0)for(n=1;;){if(0|(t=0|i[e>>2]))do{if(0|(r=0|i[t>>2]))do{o=r,r=0|i[r+16>>2],Yt(o)}while(0|r);o=t,t=0|i[t+8>>2],Yt(o)}while(0|t);if(t=e,e=0|i[e+8>>2],n||Yt(t),!e)break;n=0}}function yt(e){var t,r,n=0,s=0,a=0,A=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0,w=0,T=0,S=0,M=0,N=0,C=0,R=0,P=0,D=0,B=0,q=0,O=0,L=0;if(0|i[(A=(e|=0)+8|0)>>2])return 0|(L=1);if(!(a=0|i[e>>2]))return 0|(L=0);n=a,s=0;do{s=s+1|0,n=0|i[n+8>>2]}while(0|n);if(s>>>0<2)return 0|(L=0);(r=0|$t(s<<2))||E(27396,27235,317,27415),(t=0|$t(s<<5))||E(27437,27235,321,27415),i[e>>2]=0,i[(N=e+4|0)>>2]=0,i[A>>2]=0,s=0,q=0,M=0,m=0;e:for(;;){if(f=0|i[a>>2]){u=0,c=f;do{if(d=+o[c+8>>3],n=c,c=0|i[c+16>>2],h=+o[(A=(p=!(0|c))?f:c)+8>>3],+l(+(d-h))>3.141592653589793){L=14;break}u+=(h-d)*(+o[n>>3]+ +o[A>>3])}while(!p);if(14==(0|L)){L=0,u=0,n=f;do{S=+o[n+8>>3],D=0|i[(B=n+16|0)>>2],T=+o[(D=0|D?D:f)+8>>3],u+=(+o[n>>3]+ +o[D>>3])*((T<0?T+6.283185307179586:T)-(S<0?S+6.283185307179586:S)),n=0|i[(0|n?B:a)>>2]}while(0|n)}u>0?(i[r+(q<<2)>>2]=a,q=q+1|0,A=M,n=m):L=19}else L=19;if(19==(0|L)){L=0;do{if(!s){if(m){A=N,c=m+8|0,n=a,s=e;break}if(0|i[e>>2]){L=27;break e}A=N,c=e,n=a,s=e;break}if(0|i[(n=s+8|0)>>2]){L=21;break e}if(!(s=0|Xt(1,12))){L=23;break e}i[n>>2]=s,A=s+4|0,c=s,n=m}while(0);if(i[c>>2]=a,i[A>>2]=a,c=t+(M<<5)|0,p=0|i[a>>2]){for(o[(f=t+(M<<5)+8|0)>>3]=17976931348623157e292,o[(m=t+(M<<5)+24|0)>>3]=17976931348623157e292,o[c>>3]=-17976931348623157e292,o[(g=t+(M<<5)+16|0)>>3]=-17976931348623157e292,x=17976931348623157e292,w=-17976931348623157e292,A=0,y=p,d=17976931348623157e292,v=17976931348623157e292,_=-17976931348623157e292,h=-17976931348623157e292;u=+o[y>>3],S=+o[y+8>>3],y=0|i[y+16>>2],T=+o[((b=!(0|y))?p:y)+8>>3],u<d&&(o[f>>3]=u,d=u),S<v&&(o[m>>3]=S,v=S),u>_?o[c>>3]=u:u=_,S>h&&(o[g>>3]=S,h=S),x=S>0&S<x?S:x,w=S<0&S>w?S:w,A|=+l(+(S-T))>3.141592653589793,!b;)_=u;A&&(o[g>>3]=w,o[m>>3]=x)}else i[c>>2]=0,i[c+4>>2]=0,i[c+8>>2]=0,i[c+12>>2]=0,i[c+16>>2]=0,i[c+20>>2]=0,i[c+24>>2]=0,i[c+28>>2]=0;A=M+1|0}if(a=0|i[(B=a+8|0)>>2],i[B>>2]=0,!a){L=45;break}M=A,m=n}if(21==(0|L))E(27213,27235,35,27247);else if(23==(0|L))E(27267,27235,37,27247);else if(27==(0|L))E(27310,27235,61,27333);else if(45==(0|L)){e:do{if((0|q)>0){for(B=!(0|A),P=A<<2,D=!(0|e),R=0,n=0;;){if(C=0|i[r+(R<<2)>>2],B)L=73;else{if(!(M=0|$t(P))){L=50;break}if(!(N=0|$t(P))){L=52;break}t:do{if(D)s=0;else{for(A=0,s=0,c=e;a=t+(A<<5)|0,0|bt(0|i[c>>2],a,0|i[C>>2])?(i[M+(s<<2)>>2]=c,i[N+(s<<2)>>2]=a,b=s+1|0):b=s,c=0|i[c+8>>2];)A=A+1|0,s=b;if((0|b)>0)if(a=0|i[M>>2],1==(0|b))s=a;else for(g=0,y=-1,s=a,m=a;;){for(p=0|i[m>>2],a=0,c=0;f=(0|(A=0|i[i[M+(c<<2)>>2]>>2]))==(0|p)?a:a+(1&bt(A,0|i[N+(c<<2)>>2],0|i[p>>2]))|0,(0|(c=c+1|0))!=(0|b);)a=f;if(s=(A=(0|f)>(0|y))?m:s,(0|(a=g+1|0))==(0|b))break t;g=a,y=A?f:y,m=0|i[M+(a<<2)>>2]}else s=0}}while(0);if(Yt(M),Yt(N),s){if(a=0|i[(A=s+4|0)>>2])s=a+8|0;else if(0|i[s>>2]){L=70;break}i[s>>2]=C,i[A>>2]=C}else L=73}if(73==(0|L)){if(L=0,0|(n=0|i[C>>2]))do{N=n,n=0|i[n+16>>2],Yt(N)}while(0|n);Yt(C),n=1}if((0|(R=R+1|0))>=(0|q)){O=n;break e}}50==(0|L)?E(27452,27235,249,27471):52==(0|L)?E(27490,27235,252,27471):70==(0|L)&&E(27310,27235,61,27333)}else O=0}while(0);return Yt(r),Yt(t),0|(L=O)}return 0}function bt(e,t,r){e|=0;var n=0,s=0,a=0,A=0,l=0,u=0,c=0,h=0;if(!(0|X(t|=0,r|=0)))return 0|(e=0);if(t=0|$(t),n=+o[r>>3],s=t&(s=+o[r+8>>3])<0?s+6.283185307179586:s,!(e=0|i[e>>2]))return 0|(e=0);if(t){t=0,c=s,r=e;e:for(;;){for(;A=+o[r>>3],s=+o[r+8>>3],h=0|i[(r=r+16|0)>>2],a=+o[(h=0|h?h:e)>>3],l=+o[h+8>>3],A>a?(u=A,A=l):(u=a,a=A,A=s,s=l),(n=n==a|n==u?n+2220446049250313e-31:n)<a|n>u;)if(!(r=0|i[r>>2])){r=22;break e}if(((u=(l=A<0?A+6.283185307179586:A)+(n-a)/(u-a)*((A=s<0?s+6.283185307179586:s)-l))<0?u+6.283185307179586:u)>(c=l==c|A==c?c+-2220446049250313e-31:c)&&(t^=1),!(r=0|i[r>>2])){r=22;break}}if(22==(0|r))return 0|t}else{t=0,c=s,r=e;e:for(;;){for(;A=+o[r>>3],s=+o[r+8>>3],h=0|i[(r=r+16|0)>>2],a=+o[(h=0|h?h:e)>>3],l=+o[h+8>>3],A>a?(u=A,A=l):(u=a,a=A,A=s,s=l),(n=n==a|n==u?n+2220446049250313e-31:n)<a|n>u;)if(!(r=0|i[r>>2])){r=22;break e}if(A+(n-a)/(u-a)*(s-A)>(c=A==c|s==c?c+-2220446049250313e-31:c)&&(t^=1),!(r=0|i[r>>2])){r=22;break}}if(22==(0|r))return 0|t}return 0}function vt(e,t,r,o,s){r|=0,o|=0,s|=0;var a,A,l,u,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0;if(u=D,D=D+32|0,v=u+16|0,l=u,c=0|sr(0|(e|=0),0|(t|=0),52),S(),c&=15,g=0|sr(0|r,0|o,52),S(),(0|c)!=(15&g))return D=u,0|(v=12);if(f=0|sr(0|e,0|t,45),S(),f&=127,m=0|sr(0|r,0|o,45),S(),f>>>0>121|(m&=127)>>>0>121)return D=u,0|(v=5);if(g=(0|f)!=(0|m)){if(7==(0|(d=0|W(f,m))))return D=u,0|(v=1);7==(0|(p=0|W(m,f)))?E(27514,27538,161,27548):(y=d,h=p)}else y=0,h=0;a=0|U(f),A=0|U(m),i[v>>2]=0,i[v+4>>2]=0,i[v+8>>2]=0,i[v+12>>2]=0;do{if(y){if(d=(0|(m=0|i[4272+(28*f|0)+(y<<2)>>2]))>0,A)if(d){f=0,p=r,d=o;do{p=0|Ye(p,d),d=0|S(),1==(0|(h=0|ve(h)))&&(h=0|ve(1)),f=f+1|0}while((0|f)!=(0|m));m=h,f=p,p=d}else m=h,f=r,p=o;else if(d){f=0,p=r,d=o;do{p=0|Xe(p,d),d=0|S(),h=0|ve(h),f=f+1|0}while((0|f)!=(0|m));m=h,f=p,p=d}else m=h,f=r,p=o;if(Je(f,p,v),g||E(27563,27538,191,27548),(d=!!(0|a))&(h=!!(0|A))&&E(27590,27538,192,27548),d){if(7==(0|(h=0|We(e,t)))){c=5;break}if(0|n[22e3+(7*h|0)+y|0]){c=1;break}f=p=0|i[21168+(28*h|0)+(y<<2)>>2]}else if(h){if(7==(0|(h=0|We(f,p)))){c=5;break}if(0|n[22e3+(7*h|0)+m|0]){c=1;break}f=0,p=0|i[21168+(28*m|0)+(h<<2)>>2]}else f=0,p=0;if((f|p|0)<0)c=5;else{if((0|p)>0){d=v+4|0,h=0;do{ye(d),h=h+1|0}while((0|h)!=(0|p))}if(i[l>>2]=0,i[l+4>>2]=0,i[l+8>>2]=0,me(l,y),0|c)for(;0|Ke(c)?pe(l):fe(l),(0|c)>1;)c=c+-1|0;if((0|f)>0){c=0;do{ye(l),c=c+1|0}while((0|c)!=(0|f))}se(b=v+4|0,l,b),ie(b),b=51}}else if(Je(r,o,v),!!(0|a)&!!(0|A))if((0|m)!=(0|f)&&E(27621,27538,261,27548),7==(0|(h=0|We(e,t)))|7==(0|(c=0|We(r,o))))c=5;else if(0|n[22e3+(7*h|0)+c|0])c=1;else if((0|(h=0|i[21168+(28*h|0)+(c<<2)>>2]))>0){d=v+4|0,c=0;do{ye(d),c=c+1|0}while((0|c)!=(0|h));b=51}else b=51;else b=51}while(0);return 51==(0|b)&&(c=v+4|0,i[s>>2]=i[c>>2],i[s+4>>2]=i[c+4>>2],i[s+8>>2]=i[c+8>>2],c=0),D=u,0|(v=c)}function _t(e,t,r,n){r|=0,n|=0;var o,s,a,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0;if(a=D,D=D+48|0,o=a+36|0,u=a+24|0,c=a+12|0,h=a,A=0|sr(0|(e|=0),0|(t|=0),52),S(),A&=15,p=0|sr(0|e,0|t,45),S(),(p&=127)>>>0>121)return D=a,0|(n=5);if(s=0|U(p),ar(0|A,0,52),g=134225919|S(),i[(l=n)>>2]=-1,i[l+4>>2]=g,!A)return 7==(0|(A=0|le(r)))||127==(0|(A=0|H(p,A)))?(D=a,0|(g=1)):(f=0|ar(0|A,0,45),m=0|S(),m=-1040385&i[(p=n)+4>>2]|m,i[(g=n)>>2]=i[p>>2]|f,i[g+4>>2]=m,D=a,0|(g=0));for(i[o>>2]=i[r>>2],i[o+4>>2]=i[r+4>>2],i[o+8>>2]=i[r+8>>2],r=A;;){if(l=r,r=r+-1|0,i[u>>2]=i[o>>2],i[u+4>>2]=i[o+4>>2],i[u+8>>2]=i[o+8>>2],0|Ke(l)){if(0|(A=0|ue(o))){r=13;break}i[c>>2]=i[o>>2],i[c+4>>2]=i[o+4>>2],i[c+8>>2]=i[o+8>>2],pe(c)}else{if(0|(A=0|ce(o))){r=13;break}i[c>>2]=i[o>>2],i[c+4>>2]=i[o+4>>2],i[c+8>>2]=i[o+8>>2],fe(c)}if(ae(u,c,h),ie(h),b=0|i[(A=n)>>2],A=0|i[A+4>>2],y=0|ar(7,0,0|(v=3*(15-l|0)|0)),A&=~S(),v=0|ar(0|le(h),0,0|v),A=0|S()|A,i[(g=n)>>2]=v|b&~y,i[g+4>>2]=A,(0|l)<=1){r=14;break}}e:do{if(13!=(0|r)&&14==(0|r))if((0|i[o>>2])<=1&&(0|i[o+4>>2])<=1&&(0|i[o+8>>2])<=1){h=127==(0|(A=0|H(p,r=0|le(o))))?0:0|U(A);t:do{if(r){if(s){if(7==(0|(A=0|We(e,t)))){A=5;break e}if((0|(l=0|i[21376+(28*A|0)+(r<<2)>>2]))>0){A=r,r=0;do{A=0|be(A),r=r+1|0}while((0|r)!=(0|l))}else A=r;if(1==(0|A)){A=9;break e}127==(0|(r=0|H(p,A)))&&E(27648,27538,411,27678),0|U(r)?E(27693,27538,412,27678):(m=r,f=l,d=A)}else m=A,f=0,d=r;if((0|(c=0|i[4272+(28*p|0)+(d<<2)>>2]))<=-1&&E(27724,27538,419,27678),!h){if((0|f)<0){A=5;break e}if(0|f){A=0,r=0|i[(l=n)>>2],l=0|i[l+4>>2];do{r=0|$e(r,l),l=0|S(),i[(v=n)>>2]=r,i[v+4>>2]=l,A=A+1|0}while((0|A)<(0|f))}if((0|c)<=0){A=m,r=58;break}for(A=0,r=0|i[(l=n)>>2],l=0|i[l+4>>2];;)if(r=0|$e(r,l),l=0|S(),i[(v=n)>>2]=r,i[v+4>>2]=l,(0|(A=A+1|0))==(0|c)){A=m,r=58;break t}}if(7==(0|(u=0|W(m,p)))&&E(27514,27538,428,27678),r=0|i[(A=n)>>2],A=0|i[A+4>>2],(0|c)>0){l=0;do{r=0|$e(r,A),A=0|S(),i[(v=n)>>2]=r,i[v+4>>2]=A,l=l+1|0}while((0|l)!=(0|c))}if(7==(0|(A=0|We(r,A)))&&E(27795,27538,440,27678),r=0|V(m),(0|(r=0|i[(r?21792:21584)+(28*u|0)+(A<<2)>>2]))<0&&E(27795,27538,454,27678),r){A=0,l=0|i[(u=n)>>2],u=0|i[u+4>>2];do{l=0|Qe(l,u),u=0|S(),i[(v=n)>>2]=l,i[v+4>>2]=u,A=A+1|0}while((0|A)<(0|r));A=m,r=58}else A=m,r=58}else if(!!(0|s)&!!(0|h)){if(7==(0|(r=0|We(e,t)))|7==(0|(l=0|We(0|i[(l=n)>>2],0|i[l+4>>2])))){A=5;break e}if((0|(l=0|i[21376+(28*r|0)+(l<<2)>>2]))<0){A=5;break e}if(l){r=0,u=0|i[(c=n)>>2],c=0|i[c+4>>2];do{u=0|$e(u,c),c=0|S(),i[(v=n)>>2]=u,i[v+4>>2]=c,r=r+1|0}while((0|r)<(0|l));r=58}else r=59}else r=58}while(0);if(58==(0|r)&&h&&(r=59),59==(0|r)&&1==(0|We(0|i[(v=n)>>2],0|i[v+4>>2]))){A=9;break}y=0|i[(v=n)>>2],v=-1040385&i[v+4>>2],b=0|ar(0|A,0,45),v=0|v|S(),i[(A=n)>>2]=y|b,i[A+4>>2]=v,A=0}else A=1}while(0);return D=a,0|(v=A)}function xt(e,t,r,n){e|=0,t|=0;var i=0,o=0,s=0;if(!(0|(r|=0))&!(0|(n|=0)))return o=1,T(0|(i=0)),0|o;o=e,i=t,e=1,t=0;do{e=0|rr(0|((s=!0&!(1&r))?1:o),0|(s?0:i),0|e,0|t),t=0|S(),r=0|or(0|r,0|n,1),n=0|S(),o=0|rr(0|o,0|i,0|o,0|i),i=0|S()}while(!(!(0|r)&!(0|n)));return T(0|t),0|e}function wt(e,t,r,n){r|=0,n|=0;var s,a=0,A=0,l=0,u=0,c=0,d=0;s=D,D=D+16|0,A=s,l=0|sr(0|(e|=0),0|(t|=0),52),S(),l&=15;do{if(l){if(!(a=0|tt(e,t,A))){c=+o[A>>3],u=1/+h(+c),d=+o[25968+(l<<3)>>3],o[r>>3]=c+d,o[r+8>>3]=c-d,c=+o[A+8>>3],u*=d,o[r+16>>3]=u+c,o[r+24>>3]=c-u;break}return D=s,0|(l=a)}if(a=0|sr(0|e,0|t,45),S(),(a&=127)>>>0>121)return D=s,0|(l=5);A=22064+(a<<5)|0,i[r>>2]=i[A>>2],i[r+4>>2]=i[A+4>>2],i[r+8>>2]=i[A+8>>2],i[r+12>>2]=i[A+12>>2],i[r+16>>2]=i[A+16>>2],i[r+20>>2]=i[A+20>>2],i[r+24>>2]=i[A+24>>2],i[r+28>>2]=i[A+28>>2];break}while(0);return function(e,t){t=+t;var r,n,i,s,a,A,l,u=0,c=0;u=(s=+o[(i=16+(e|=0)|0)>>3])-(n=+o[(r=e+24|0)>>3]),u=s<n?u+6.283185307179586:u,c=+o[e>>3],u=.5*(u*t-u),c+=t=.5*((l=c-(A=+o[(a=e+8|0)>>3]))*t-l),o[e>>3]=c>1.5707963267948966?1.5707963267948966:c,t=A-t,o[a>>3]=t<-1.5707963267948966?-1.5707963267948966:t,t=(t=s+u)>3.141592653589793?t+-6.283185307179586:t,o[i>>3]=t<-3.141592653589793?t+6.283185307179586:t,t=(t=n-u)>3.141592653589793?t+-6.283185307179586:t,o[r>>3]=t<-3.141592653589793?t+6.283185307179586:t}(r,n?1.4:1.1),(0|i[(n=26096+(l<<3)|0)>>2])==(0|e)&&(0|i[n+4>>2])==(0|t)&&(o[r>>3]=1.5707963267948966),(0|i[(l=26224+(l<<3)|0)>>2])==(0|e)&&(0|i[l+4>>2])==(0|t)&&(o[r+8>>3]=-1.5707963267948966),1.5707963267948966!=+o[r>>3]&&-1.5707963267948966!=+o[r+8>>3]?(D=s,0|(l=0)):(o[r+16>>3]=3.141592653589793,o[r+24>>3]=-3.141592653589793,D=s,0|(l=0))}function Tt(e,t,r,o){e|=0,t|=0,r|=0,o|=0;var s,a,A,l=0,u=0,c=0,h=0;A=D,D=D+48|0,s=A+40|0,a=A,Ue(u=A+32|0,0,0,0),c=0|i[u>>2],u=0|i[u+4>>2];do{if(r>>>0<=15){if(0|(l=0|Ct(o))){i[(o=a)>>2]=0,i[o+4>>2]=0,i[a+8>>2]=l,i[a+12>>2]=-1,c=a+29|0,i[(o=a+16|0)>>2]=0,i[o+4>>2]=0,i[o+8>>2]=0,n[o+12|0]=0,n[c|0]=0|n[s|0],n[c+1|0]=0|n[s+1|0],n[c+2|0]=0|n[s+2|0];break}if(l=0|Xt(1+(0|i[t+8>>2])|0,32)){Rt(t,l),i[(h=a)>>2]=c,i[h+4>>2]=u,i[a+8>>2]=0,i[a+12>>2]=r,i[a+16>>2]=o,i[a+20>>2]=t,i[a+24>>2]=l,n[a+28|0]=0,n[(c=a+29|0)|0]=0|n[s|0],n[c+1|0]=0|n[s+1|0],n[c+2|0]=0|n[s+2|0];break}i[(o=a)>>2]=0,i[o+4>>2]=0,i[a+8>>2]=13,i[a+12>>2]=-1,c=a+29|0,i[(o=a+16|0)>>2]=0,i[o+4>>2]=0,i[o+8>>2]=0,n[o+12|0]=0,n[c|0]=0|n[s|0],n[c+1|0]=0|n[s+1|0],n[c+2|0]=0|n[s+2|0];break}i[(c=a)>>2]=0,i[c+4>>2]=0,i[a+8>>2]=4,i[a+12>>2]=-1,h=a+29|0,i[(c=a+16|0)>>2]=0,i[c+4>>2]=0,i[c+8>>2]=0,n[c+12|0]=0,n[h|0]=0|n[s|0],n[h+1|0]=0|n[s+1|0],n[h+2|0]=0|n[s+2|0]}while(0);St(a),i[e>>2]=i[a>>2],i[e+4>>2]=i[a+4>>2],i[e+8>>2]=i[a+8>>2],i[e+12>>2]=i[a+12>>2],i[e+16>>2]=i[a+16>>2],i[e+20>>2]=i[a+20>>2],i[e+24>>2]=i[a+24>>2],i[e+28>>2]=i[a+28>>2],D=A}function St(e){var t,r,o,s,a=0,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0;if(s=D,D=D+336|0,t=s+168|0,r=s,!(0|(A=0|i[(l=e|=0)>>2]))&!(0|(l=0|i[l+4>>2])))D=s;else{if(0|n[(a=e+28|0)|0]?(A=0|Et(A,l),l=0|S()):n[a|0]=1,!(0|i[i[(o=e+20|0)>>2]>>2]))return 0|(A=0|i[(a=e+24|0)>>2])&&Yt(A),i[(x=e)>>2]=0,i[x+4>>2]=0,i[e+8>>2]=0,i[o>>2]=0,i[e+12>>2]=-1,i[e+16>>2]=0,i[a>>2]=0,void(D=s);u=15&(a=0|i[(x=e+16|0)>>2]);e:do{if(!(0|A)&!(0|l))_=e+24|0;else{b=e+12|0,g=3==(0|u),m=255&a,p=3==(1|u),y=e+24|0,f=(u+-1|0)>>>0<3,h=3==(2|u),d=r+8|0;t:for(;;){if(c=0|sr(0|A,0|l,52),S(),(0|(c&=15))==(0|i[b>>2])){switch(15&m){case 0:case 2:case 3:if(0|(u=0|tt(A,l,t))){v=15;break t}if(0|Pt(0|i[o>>2],0|i[y>>2],t)){v=19;break t}}if(p&&(u=0|i[4+(0|i[o>>2])>>2],i[t>>2]=i[u>>2],i[t+4>>2]=i[u+4>>2],i[t+8>>2]=i[u+8>>2],i[t+12>>2]=i[u+12>>2],0|X(26832,t))){if(0|Ze(0|i[4+(0|i[o>>2])>>2],c,r)){v=25;break}if((0|i[(u=r)>>2])==(0|A)&&(0|i[u+4>>2])==(0|l)){v=29;break}}if(f){if(0|(u=0|rt(A,l,t))){v=32;break}if(0|wt(A,l,r,0)){v=36;break}if(h&&0|Dt(0|i[o>>2],0|i[y>>2],t,r)){v=42;break}if(p&&0|qt(0|i[o>>2],0|i[y>>2],t,r)){v=42;break}}if(g){if(a=0|wt(A,l,t,1),u=0|i[y>>2],0|a){v=45;break}if(0|K(u,t)){if(J(r,t),0|Z(t,0|i[y>>2])){v=53;break}if(0|Pt(0|i[o>>2],0|i[y>>2],d)){v=53;break}if(0|qt(0|i[o>>2],0|i[y>>2],r,t)){v=53;break}}}}do{if((0|c)<(0|i[b>>2])){if(a=0|wt(A,l,t,1),u=0|i[y>>2],0|a){v=58;break t}if(!(0|K(u,t))){v=73;break}if(0|Z(0|i[y>>2],t)&&(J(r,t),0|Dt(0|i[o>>2],0|i[y>>2],r,t))){v=65;break t}if(0|(A=0|He(A,l,c+1|0,r))){v=67;break t}A=0|i[(l=r)>>2],l=0|i[l+4>>2]}else v=73}while(0);if(73==(0|v)&&(v=0,A=0|Et(A,l),l=0|S()),!(0|A)&!(0|l)){_=y;break e}}switch(0|v){case 15:0|(a=0|i[y>>2])&&Yt(a),i[(v=e)>>2]=0,i[v+4>>2]=0,i[o>>2]=0,i[b>>2]=-1,i[x>>2]=0,i[y>>2]=0,i[e+8>>2]=u,v=20;break;case 19:i[e>>2]=A,i[e+4>>2]=l,v=20;break;case 25:E(27795,27761,470,27772);break;case 29:case 42:return i[e>>2]=A,i[e+4>>2]=l,void(D=s);case 32:return 0|(a=0|i[y>>2])&&Yt(a),i[(_=e)>>2]=0,i[_+4>>2]=0,i[o>>2]=0,i[b>>2]=-1,i[x>>2]=0,i[y>>2]=0,i[e+8>>2]=u,void(D=s);case 36:E(27795,27761,493,27772);break;case 45:0|u&&Yt(u),i[(v=e)>>2]=0,i[v+4>>2]=0,i[o>>2]=0,i[b>>2]=-1,i[x>>2]=0,i[y>>2]=0,i[e+8>>2]=a,v=55;break;case 53:i[e>>2]=A,i[e+4>>2]=l,v=55;break;case 58:0|u&&Yt(u),i[(v=e)>>2]=0,i[v+4>>2]=0,i[o>>2]=0,i[b>>2]=-1,i[x>>2]=0,i[y>>2]=0,i[e+8>>2]=a,v=71;break;case 65:i[e>>2]=A,i[e+4>>2]=l,v=71;break;case 67:return 0|(a=0|i[y>>2])&&Yt(a),i[(_=e)>>2]=0,i[_+4>>2]=0,i[o>>2]=0,i[b>>2]=-1,i[x>>2]=0,i[y>>2]=0,i[e+8>>2]=A,void(D=s)}if(20==(0|v))return void(D=s);if(55==(0|v))return void(D=s);if(71==(0|v))return void(D=s)}}while(0);0|(a=0|i[_>>2])&&Yt(a),i[(v=e)>>2]=0,i[v+4>>2]=0,i[e+8>>2]=0,i[o>>2]=0,i[e+12>>2]=-1,i[x>>2]=0,i[_>>2]=0,D=s}}function Et(e,t){var r,n=0,o=0,s=0,a=0,A=0,l=0,u=0,c=0,h=0;r=D,D=D+16|0,h=r,o=0|sr(0|(e|=0),0|(t|=0),52),S(),o&=15,n=0|sr(0|e,0|t,45),S();do{if(o){for(;n=0|ar(o+4095|0,0,52),s=S()|-15728641&t,n=n|e|(A=0|ar(7,0,0|(a=3*(15-o|0)|0))),s|=l=0|S(),u=0|sr(0|e,0|t,0|a),S(),o=o+-1|0,!((u&=7)>>>0<6);){if(!o){c=4;break}t=s,e=n}if(4==(0|c)){n=0|sr(0|n,0|s,45),S();break}return h=0|ar(((h=!(0|u)&!!(0|je(n,s)))?2:1)+u|0,0,0|a),c=0|S()|t&~l,h|=e&~A,T(0|c),D=r,0|h}}while(0);return(n&=127)>>>0>120?(h=0,T(0|(c=0)),D=r,0|h):(Ue(h,0,n+1|0,0),c=0|i[h+4>>2],h=0|i[h>>2],T(0|c),D=r,0|h)}function Mt(e,t,r){e|=0;var n,s=0,a=0,A=0,l=0,u=0,c=0,h=0,d=0,p=0;if(!(0|X(t|=0,r|=0)))return 0|(p=0);if(t=0|$(t),s=+o[r>>3],a=t&(a=+o[r+8>>3])<0?a+6.283185307179586:a,(0|(p=0|i[e>>2]))<=0)return 0|(p=0);if(n=0|i[e+4>>2],t){t=0,d=a,r=-1,e=0;e:for(;;){for(h=e;l=+o[n+(h<<4)>>3],a=+o[n+(h<<4)+8>>3],A=+o[n+((e=(r+2|0)%(0|p)|0)<<4)>>3],u=+o[n+(e<<4)+8>>3],l>A?(c=l,l=u):(c=A,A=l,l=a,a=u),(s=s==A|s==c?s+2220446049250313e-31:s)<A|s>c;){if((0|(r=h+1|0))>=(0|p)){r=22;break e}e=h,h=r,r=e}if(((c=(u=l<0?l+6.283185307179586:l)+(s-A)/(c-A)*((l=a<0?a+6.283185307179586:a)-u))<0?c+6.283185307179586:c)>(d=u==d|l==d?d+-2220446049250313e-31:d)&&(t^=1),(0|(e=h+1|0))>=(0|p)){r=22;break}r=h}if(22==(0|r))return 0|t}else{t=0,d=a,r=-1,e=0;e:for(;;){for(h=e;l=+o[n+(h<<4)>>3],a=+o[n+(h<<4)+8>>3],A=+o[n+((e=(r+2|0)%(0|p)|0)<<4)>>3],u=+o[n+(e<<4)+8>>3],l>A?(c=l,l=u):(c=A,A=l,l=a,a=u),(s=s==A|s==c?s+2220446049250313e-31:s)<A|s>c;){if((0|(r=h+1|0))>=(0|p)){r=22;break e}e=h,h=r,r=e}if(l+(s-A)/(c-A)*(a-l)>(d=l==d|a==d?d+-2220446049250313e-31:d)&&(t^=1),(0|(e=h+1|0))>=(0|p)){r=22;break}r=h}if(22==(0|r))return 0|t}return 0}function Nt(e,t){t|=0;var r,n,s,a,A,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0;if(!(n=0|i[(e|=0)>>2]))return i[t>>2]=0,i[t+4>>2]=0,i[t+8>>2]=0,i[t+12>>2]=0,i[t+16>>2]=0,i[t+20>>2]=0,i[t+24>>2]=0,void(i[t+28>>2]=0);if(o[(s=t+8|0)>>3]=17976931348623157e292,o[(a=t+24|0)>>3]=17976931348623157e292,o[t>>3]=-17976931348623157e292,o[(A=t+16|0)>>3]=-17976931348623157e292,!((0|n)<=0)){for(r=0|i[e+4>>2],g=17976931348623157e292,y=-17976931348623157e292,b=0,e=-1,d=17976931348623157e292,p=17976931348623157e292,m=-17976931348623157e292,c=-17976931348623157e292,v=0;u=+o[r+(v<<4)>>3],f=+o[r+(v<<4)+8>>3],h=+o[r+(((0|(e=e+2|0))==(0|n)?0:e)<<4)+8>>3],u<d&&(o[s>>3]=u,d=u),f<p&&(o[a>>3]=f,p=f),u>m?o[t>>3]=u:u=m,f>c&&(o[A>>3]=f,c=f),g=f>0&f<g?f:g,y=f<0&f>y?f:y,b|=+l(+(f-h))>3.141592653589793,(0|(e=v+1|0))!=(0|n);)_=v,m=u,v=e,e=_;b&&(o[A>>3]=y,o[a>>3]=g)}}function Ct(e){return 0|((e|=0)>>>0<4?0:15)}function Rt(e,t){t|=0;var r,n=0,s=0,a=0,A=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0,w=0,T=0,S=0,E=0;if(y=0|i[(e|=0)>>2]){if(o[(b=t+8|0)>>3]=17976931348623157e292,o[(v=t+24|0)>>3]=17976931348623157e292,o[t>>3]=-17976931348623157e292,o[(_=t+16|0)>>3]=-17976931348623157e292,(0|y)>0){for(a=0|i[e+4>>2],m=17976931348623157e292,g=-17976931348623157e292,s=0,n=-1,h=17976931348623157e292,d=17976931348623157e292,f=-17976931348623157e292,u=-17976931348623157e292,x=0;A=+o[a+(x<<4)>>3],p=+o[a+(x<<4)+8>>3],c=+o[a+(((0|(S=n+2|0))==(0|y)?0:S)<<4)+8>>3],A<h&&(o[b>>3]=A,h=A),p<d&&(o[v>>3]=p,d=p),A>f?o[t>>3]=A:A=f,p>u&&(o[_>>3]=p,u=p),m=p>0&p<m?p:m,g=p<0&p>g?p:g,s|=+l(+(p-c))>3.141592653589793,(0|(n=x+1|0))!=(0|y);)S=x,f=A,x=n,n=S;s&&(o[_>>3]=g,o[v>>3]=m)}}else i[t>>2]=0,i[t+4>>2]=0,i[t+8>>2]=0,i[t+12>>2]=0,i[t+16>>2]=0,i[t+20>>2]=0,i[t+24>>2]=0,i[t+28>>2]=0;if(!((0|(n=0|i[(S=e+8|0)>>2]))<=0)){r=e+12|0,T=0;do{if(a=0|i[r>>2],s=T,v=t+((T=T+1|0)<<5)|0,_=0|i[a+(s<<3)>>2]){if(o[(x=t+(T<<5)+8|0)>>3]=17976931348623157e292,o[(e=t+(T<<5)+24|0)>>3]=17976931348623157e292,o[v>>3]=-17976931348623157e292,o[(w=t+(T<<5)+16|0)>>3]=-17976931348623157e292,(0|_)>0){for(y=0|i[a+(s<<3)+4>>2],m=17976931348623157e292,g=-17976931348623157e292,a=0,s=-1,b=0,h=17976931348623157e292,d=17976931348623157e292,p=-17976931348623157e292,u=-17976931348623157e292;A=+o[y+(b<<4)>>3],f=+o[y+(b<<4)+8>>3],c=+o[y+(((0|(s=s+2|0))==(0|_)?0:s)<<4)+8>>3],A<h&&(o[x>>3]=A,h=A),f<d&&(o[e>>3]=f,d=f),A>p?o[v>>3]=A:A=p,f>u&&(o[w>>3]=f,u=f),m=f>0&f<m?f:m,g=f<0&f>g?f:g,a|=+l(+(f-c))>3.141592653589793,(0|(s=b+1|0))!=(0|_);)E=b,b=s,p=A,s=E;a&&(o[w>>3]=g,o[e>>3]=m)}}else i[v>>2]=0,i[v+4>>2]=0,i[v+8>>2]=0,i[v+12>>2]=0,i[v+16>>2]=0,i[v+20>>2]=0,i[v+24>>2]=0,i[v+28>>2]=0,n=0|i[S>>2]}while((0|T)<(0|n))}}function Pt(e,t,r){var n=0,o=0,s=0;if(!(0|Mt(e|=0,t|=0,r|=0)))return 0|(o=0);if((0|i[(o=e+8|0)>>2])<=0)return 0|(o=1);for(n=e+12|0,e=0;;){if(s=e,e=e+1|0,0|Mt((0|i[n>>2])+(s<<3)|0,t+(e<<5)|0,r)){e=0,n=6;break}if((0|e)>=(0|i[o>>2])){e=1,n=6;break}}return 6==(0|n)?0|e:0}function Dt(e,t,r,n){n|=0;var o,s,a=0,A=0,l=0,u=0,c=0;if(s=D,D=D+16|0,o=s,!(0|Mt(e|=0,t|=0,l=(r|=0)+8|0)))return D=s,0|(u=0);u=e+8|0;e:do{if((0|i[u>>2])>0){for(A=e+12|0,a=0;;){if(c=a,a=a+1|0,0|Mt((0|i[A>>2])+(c<<3)|0,t+(a<<5)|0,l)){a=0;break}if((0|a)>=(0|i[u>>2]))break e}return D=s,0|a}}while(0);if(0|Bt(e,t,r,n))return D=s,0|(c=0);i[o>>2]=i[r>>2],i[o+4>>2]=l,a=0|i[u>>2];e:do{if((0|a)>0)for(e=e+12|0,l=0,A=a;;){if(a=0|i[e>>2],(0|i[a+(l<<3)>>2])>0){if(0|Mt(o,n,0|i[a+(l<<3)+4>>2])){a=0;break e}if(a=l+1|0,0|Bt((0|i[e>>2])+(l<<3)|0,t+(a<<5)|0,r,n)){a=0;break e}A=0|i[u>>2]}else a=l+1|0;if(!((0|a)<(0|A))){a=1;break}l=a}else a=1}while(0);return D=s,0|(c=a)}function Bt(e,t,r,n){e|=0,r|=0;var s,a,A,l,u,c,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0,w=0,T=0,S=0,E=0;if(c=D,D=D+176|0,l=c+172|0,h=c+168|0,u=c,!(0|K(t|=0,n|=0)))return D=c,0|(e=0);if(function(e,t,r,n){var s,a,A,l,u;t|=0,r|=0,n|=0,e=(a=+o[16+(e|=0)>>3])<(u=+o[e+24>>3]),s=(l=+o[t+16>>3])<(A=+o[t+24>>3]),t=u-l<A-a,i[r>>2]=e?s|t?1:2:0,i[n>>2]=s?e?1:t?2:1:0}(t,n,l,h),hr(0|u,0|r,168),(0|i[r>>2])>0){t=0;do{x=+lt(+o[(S=u+8+(t<<4)+8|0)>>3],0|i[h>>2]),o[S>>3]=x,t=t+1|0}while((0|t)<(0|i[r>>2]))}a=+o[n>>3],A=+o[n+8>>3],x=+lt(+o[n+16>>3],0|i[h>>2]),s=+lt(+o[n+24>>3],0|i[h>>2]);e:do{if((0|i[e>>2])>0){if(n=e+4|0,(0|(h=0|i[u>>2]))<=0)for(t=0;;)if((0|(t=t+1|0))>=(0|i[e>>2])){t=0;break e}for(r=0;;){if(t=0|i[n>>2],v=+o[t+(r<<4)>>3],_=+lt(+o[t+(r<<4)+8>>3],0|i[l>>2]),t=0|i[n>>2],S=(0|(r=r+1|0))%(0|i[e>>2])|0,d=+o[t+(S<<4)>>3],p=+lt(+o[t+(S<<4)+8>>3],0|i[l>>2]),!(v>=a)|!(d>=a)&&!(v<=A)|!(d<=A)&&!(_<=s)|!(p<=s)&&!(_>=x)|!(p>=x)){b=d-v,g=p-_,t=0;do{if(E=t,S=(0|(t=t+1|0))==(0|h)?0:t,d=+o[u+8+(E<<4)+8>>3],p=+o[u+8+(S<<4)+8>>3]-d,f=+o[u+8+(E<<4)>>3],!(0==(y=b*p-g*(m=+o[u+8+(S<<4)>>3]-f))||(w=_-d,T=v-f,m=(w*m-p*T)/y,m<0|m>1))&&(y=(b*w-g*T)/y)>=0&y<=1){t=1;break e}}while((0|t)<(0|h))}if((0|r)>=(0|i[e>>2])){t=0;break}}}else t=0}while(0);return D=c,0|(E=t)}function qt(e,t,r,n){var o=0,s=0,a=0;if(0|Bt(e|=0,t|=0,r|=0,n|=0))return 0|(s=1);if((0|i[(s=e+8|0)>>2])<=0)return 0|(s=0);for(o=e+12|0,e=0;;){if(a=e,e=e+1|0,0|Bt((0|i[o>>2])+(a<<3)|0,t+(e<<5)|0,r,n)){e=1,o=6;break}if((0|e)>=(0|i[s>>2])){e=0,o=6;break}}return 6==(0|o)?0|e:0}function Ot(e,t,r,n,i){t|=0,r|=0,n|=0,i|=0;var s,a,A,l,u,c,h,d=0;l=+o[(e|=0)>>3],A=+o[t>>3]-l,a=+o[e+8>>3],s=+o[t+8>>3]-a,c=+o[r>>3],d=((d=+o[n>>3]-c)*(a-(h=+o[r+8>>3]))-(l-c)*(u=+o[n+8>>3]-h))/(A*u-s*d),o[i>>3]=l+A*d,o[i+8>>3]=a+s*d}function Lt(e,t){return t|=0,+l(+(+o[(e|=0)>>3]-+o[t>>3]))<1.1920928955078125e-7?0|(t=+l(+(+o[e+8>>3]-+o[t+8>>3]))<1.1920928955078125e-7):0|(t=0)}function kt(e,t){t|=0;var r,n,i;return+((i=+o[(e|=0)>>3]-+o[t>>3])*i+(n=+o[e+8>>3]-+o[t+8>>3])*n+(r=+o[e+16>>3]-+o[t+16>>3])*r)}function It(e,t,r){r|=0;var n,o,s,a,A=0,l=0,u=0;if(a=D,D=D+32|0,u=a,0|(A=0|et(e|=0,t|=0,o=a+16|0)))return D=a,0|(r=A);n=0|Ie(e,t),s=0|We(e,t),function(e,t){e=7696+(28*(e|=0)|0)|0,i[(t|=0)>>2]=i[e>>2],i[t+4>>2]=i[e+4>>2],i[t+8>>2]=i[e+8>>2],i[t+12>>2]=i[e+12>>2]}(n,u),A=0|function(e,t){e|=0;var r=0,n=0;if((t|=0)>>>0>20)return-1;do{if((0|i[11120+(216*t|0)>>2])!=(0|e))if((0|i[11120+(216*t|0)+8>>2])!=(0|e))if((0|i[11120+(216*t|0)+16>>2])!=(0|e))if((0|i[11120+(216*t|0)+24>>2])!=(0|e))if((0|i[11120+(216*t|0)+32>>2])!=(0|e))if((0|i[11120+(216*t|0)+40>>2])!=(0|e))if((0|i[11120+(216*t|0)+48>>2])!=(0|e))if((0|i[11120+(216*t|0)+56>>2])!=(0|e))if((0|i[11120+(216*t|0)+64>>2])!=(0|e))if((0|i[11120+(216*t|0)+72>>2])!=(0|e))if((0|i[11120+(216*t|0)+80>>2])!=(0|e))if((0|i[11120+(216*t|0)+88>>2])!=(0|e))if((0|i[11120+(216*t|0)+96>>2])!=(0|e))if((0|i[11120+(216*t|0)+104>>2])!=(0|e))if((0|i[11120+(216*t|0)+112>>2])!=(0|e))if((0|i[11120+(216*t|0)+120>>2])!=(0|e))if((0|i[11120+(216*t|0)+128>>2])!=(0|e)){if((0|i[11120+(216*t|0)+136>>2])!=(0|e)){if((0|i[11120+(216*t|0)+144>>2])==(0|e)){e=0,r=2,n=0;break}if((0|i[11120+(216*t|0)+152>>2])==(0|e)){e=0,r=2,n=1;break}if((0|i[11120+(216*t|0)+160>>2])==(0|e)){e=0,r=2,n=2;break}if((0|i[11120+(216*t|0)+168>>2])==(0|e)){e=1,r=2,n=0;break}if((0|i[11120+(216*t|0)+176>>2])==(0|e)){e=1,r=2,n=1;break}if((0|i[11120+(216*t|0)+184>>2])==(0|e)){e=1,r=2,n=2;break}if((0|i[11120+(216*t|0)+192>>2])==(0|e)){e=2,r=2,n=0;break}if((0|i[11120+(216*t|0)+200>>2])==(0|e)){e=2,r=2,n=1;break}if((0|i[11120+(216*t|0)+208>>2])==(0|e)){e=2,r=2,n=2;break}return-1}e=2,r=1,n=2}else e=2,r=1,n=1;else e=2,r=1,n=0;else e=1,r=1,n=2;else e=1,r=1,n=1;else e=1,r=1,n=0;else e=0,r=1,n=2;else e=0,r=1,n=1;else e=0,r=1,n=0;else e=2,r=0,n=2;else e=2,r=0,n=1;else e=2,r=0,n=0;else e=1,r=0,n=2;else e=1,r=0,n=1;else e=1,r=0,n=0;else e=0,r=0,n=2;else e=0,r=0,n=1;else e=0,r=0,n=0}while(0);return 0|i[11120+(216*t|0)+(72*r|0)+(24*e|0)+(n<<3)+4>>2]}(n,0|i[o>>2]);e:do{if(0|U(n)){switch(0|n){case 4:e=0;break;case 14:e=1;break;case 24:e=2;break;case 38:e=3;break;case 49:e=4;break;case 58:e=5;break;case 63:e=6;break;case 72:e=7;break;case 83:e=8;break;case 97:e=9;break;case 107:e=10;break;case 117:e=11;break;default:A=1;break e}if(l=0|i[26416+(24*e|0)+8>>2],t=0|i[26416+(24*e|0)+16>>2],(0|(e=0|i[o>>2]))!=(0|i[u>>2])&&(u=0|V(n))|(0|(e=0|i[o>>2]))==(0|t)&&(A=(A+1|0)%6|0),3==(0|s)&(0|e)==(0|t)){A=(A+5|0)%6|0,l=22;break}5==(0|s)&(0|e)==(0|l)?(A=(A+1|0)%6|0,l=22):l=22}else l=22}while(0);return 22==(0|l)&&(i[r>>2]=A,A=0),D=a,0|(r=A)}function Ft(e,t,r,n){r|=0,n|=0;var o,s,a,A,l,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0;if(l=D,D=D+32|0,v=l+24|0,A=l+20|0,a=l+8|0,s=l+16|0,o=l,p=(p=!(0|je(e|=0,t|=0)))?6:5,m=0|sr(0|e,0|t,52),S(),p>>>0<=r>>>0)return D=l,0|(n=2);!(g=!(0|(m&=15)))&&!((y=0|ar(7,0,3*(15^m)|0))&e|0)&!((0|S())&t)?u=r:c=4;e:do{if(4==(0|c)){if((0|((u=!!(0|je(e,t)))?4:5))<(0|r))return D=l,0|(n=1);if(0|It(e,t,v))return D=l,0|(n=1);if(c=(0|i[v>>2])+r|0,7==(0|(y=0|i[(u=u?26704+((0|c)%5<<2)|0:26736+((0|c)%6<<2)|0)>>2])))return D=l,0|(n=1);i[A>>2]=0,u=0|k(e,t,y,A,a);do{if(!u){if(f=0|i[(d=a)>>2],c=(h=(d=0|i[d+4>>2])>>>0<t>>>0|(0|d)==(0|t)&f>>>0<e>>>0)?f:e,h=h?d:t,!g&&!(f&(g=0|ar(7,0,3*(15^m)|0))|0)&!(d&(0|S())))u=r;else{if(d=(r+-1+p|0)%(0|p)|0,u=0|je(e,t),(0|d)<0&&E(27795,27797,246,27806),(0|((p=!!(0|u))?4:5))<(0|d)&&E(27795,27797,246,27806),0|It(e,t,v)&&E(27795,27797,246,27806),u=(0|i[v>>2])+d|0,7==(0|(d=0|i[(u=p?26704+((0|u)%5<<2)|0:26736+((0|u)%6<<2)|0)>>2]))&&E(27795,27797,246,27806),i[s>>2]=0,0|(u=0|k(e,t,d,s,o)))break;p=0|i[(f=o)>>2],f=0|i[f+4>>2];do{if(f>>>0<h>>>0|(0|f)==(0|h)&p>>>0<c>>>0){if(c=0|je(p,f)?0|I(p,f,e,t):0|i[26800+(((0|i[s>>2])+(0|i[26768+(d<<2)>>2])|0)%6<<2)>>2],u=0|je(p,f),(c+-1|0)>>>0>5){u=-1,c=p,h=f;break}if(1==(0|c)&(u=!!(0|u))){u=-1,c=p,h=f;break}do{if(!(0|It(p,f,v))){if(u){u=(5+(0|i[26352+(c<<2)>>2])-(0|i[v>>2])|0)%5|0;break}u=(6+(0|i[26384+(c<<2)>>2])-(0|i[v>>2])|0)%6|0;break}u=-1}while(0);c=p,h=f}else u=r}while(0);f=0|i[(d=a)>>2],d=0|i[d+4>>2]}if((0|c)==(0|f)&(0|h)==(0|d)){if(e=(p=!!(0|je(f,d)))?0|I(f,d,e,t):0|i[26800+(((0|i[A>>2])+(0|i[26768+(y<<2)>>2])|0)%6<<2)>>2],u=0|je(f,d),(e+-1|0)>>>0<=5&&!(1==(0|e)&(b=!!(0|u))))do{if(!(0|It(f,d,v))){if(b){u=(5+(0|i[26352+(e<<2)>>2])-(0|i[v>>2])|0)%5|0;break}u=(6+(0|i[26384+(e<<2)>>2])-(0|i[v>>2])|0)%6|0;break}u=-1}while(0);else u=-1;u=6==(0|(u=u+1|0))|p&5==(0|u)?0:u}t=h,e=c;break e}}while(0);return D=l,0|(n=u)}}while(0);return b=0|ar(0|u,0,56),v=S()|-2130706433&t|536870912,i[n>>2]=b|e,i[n+4>>2]=v,D=l,0|(n=0)}function Ut(e,t,r){e|=0,r|=0;var n=0;(0|(t|=0))>0?(n=0|Xt(t,4),i[e>>2]=n,n||E(27819,27842,40,27856)):i[e>>2]=0,i[e+4>>2]=t,i[e+8>>2]=0,i[e+12>>2]=r}function Vt(e){var t,r,n,s=0,a=0,A=0,u=0;t=(e|=0)+4|0,r=e+12|0,n=e+8|0;e:for(;;){for(a=0|i[t>>2],s=0;;){if((0|s)>=(0|a))break e;if(A=0|i[e>>2],u=0|i[A+(s<<2)>>2])break;s=s+1|0}s=A+(~~(+l(+ +c(10,+ +(15-(0|i[r>>2])|0))*(+o[u>>3]+ +o[u+8>>3]))%+(0|a))>>>0<<2)|0,a=0|i[s>>2];t:do{if(0|a){if(A=u+32|0,(0|a)==(0|u))i[s>>2]=i[A>>2];else{if(!(s=0|i[(a=a+32|0)>>2]))break;for(;(0|s)!=(0|u);)if(!(s=0|i[(a=s+32|0)>>2]))break t;i[a>>2]=i[A>>2]}Yt(u),i[n>>2]=(0|i[n>>2])-1}}while(0)}Yt(0|i[e>>2])}function Gt(e){var t,r=0,n=0;for(t=0|i[(e|=0)+4>>2],n=0;;){if((0|n)>=(0|t)){r=0,n=4;break}if(r=0|i[(0|i[e>>2])+(n<<2)>>2]){n=4;break}n=n+1|0}return 4==(0|n)?0|r:0}function jt(e,t){t|=0;var r=0,n=0,s=0,a=0;if(r=~~(+l(+ +c(10,+ +(15-(0|i[(e|=0)+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|i[e+4>>2]))>>>0,r=(0|i[e>>2])+(r<<2)|0,!(n=0|i[r>>2]))return 0|(a=1);a=t+32|0;do{if((0|n)!=(0|t)){if(!(r=0|i[n+32>>2]))return 0|(a=1);for(s=r;;){if((0|s)==(0|t)){s=8;break}if(!(r=0|i[s+32>>2])){r=1,s=10;break}n=s,s=r}if(8==(0|s)){i[n+32>>2]=i[a>>2];break}if(10==(0|s))return 0|r}else i[r>>2]=i[a>>2]}while(0);return Yt(t),i[(a=e+8|0)>>2]=(0|i[a>>2])-1,0|(a=0)}function zt(e,t,r){e|=0,t|=0,r|=0;var n,s=0,a=0,A=0;(n=0|$t(40))||E(27872,27842,98,27885),i[n>>2]=i[t>>2],i[n+4>>2]=i[t+4>>2],i[n+8>>2]=i[t+8>>2],i[n+12>>2]=i[t+12>>2],i[(a=n+16|0)>>2]=i[r>>2],i[a+4>>2]=i[r+4>>2],i[a+8>>2]=i[r+8>>2],i[a+12>>2]=i[r+12>>2],i[n+32>>2]=0,a=~~(+l(+ +c(10,+ +(15-(0|i[e+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|i[e+4>>2]))>>>0,a=(0|i[e>>2])+(a<<2)|0,s=0|i[a>>2];do{if(s){for(;!(0|At(s,t)&&0|At(s+16|0,r));)if(a=0|i[s+32>>2],!(0|i[(s=0|a?a:s)+32>>2])){A=10;break}if(10==(0|A)){i[s+32>>2]=n;break}return Yt(n),0|(A=s)}i[a>>2]=n}while(0);return i[(A=e+8|0)>>2]=1+(0|i[A>>2]),0|(A=n)}function Ht(e,t,r){t|=0,r|=0;var n=0,s=0;if(s=~~(+l(+ +c(10,+ +(15-(0|i[(e|=0)+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|i[e+4>>2]))>>>0,!(s=0|i[(0|i[e>>2])+(s<<2)>>2]))return 0|(r=0);if(!r){for(e=s;;){if(0|At(e,t)){n=10;break}if(!(e=0|i[e+32>>2])){e=0,n=10;break}}if(10==(0|n))return 0|e}for(e=s;;){if(0|At(e,t)&&0|At(e+16|0,r)){n=10;break}if(!(e=0|i[e+32>>2])){e=0,n=10;break}}return 10==(0|n)?0|e:0}function Wt(e,t){t|=0;var r=0;if(r=~~(+l(+ +c(10,+ +(15-(0|i[(e|=0)+12>>2])|0))*(+o[t>>3]+ +o[t+8>>3]))%+(0|i[e+4>>2]))>>>0,!(e=0|i[(0|i[e>>2])+(r<<2)>>2]))return 0|(r=0);for(;;){if(0|At(e,t)){t=5;break}if(!(e=0|i[e+32>>2])){e=0,t=5;break}}return 5==(0|t)?0|e:0}function Qt(e){return 0|+pr(+(e=+e))}function $t(e){e|=0;var t,r=0,n=0,o=0,s=0,a=0,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0;t=D,D=D+16|0,p=t;do{if(e>>>0<245){if(e=(c=e>>>0<11?16:e+11&-8)>>>3,3&(n=(d=0|i[6977])>>>e))return o=0|i[(n=(e=27948+((r=(1&n^1)+e|0)<<1<<2)|0)+8|0)>>2],(0|(a=0|i[(s=o+8|0)>>2]))==(0|e)?i[6977]=d&~(1<<r):(i[a+12>>2]=e,i[n>>2]=a),x=r<<3,i[o+4>>2]=3|x,i[(x=o+x+4|0)>>2]=1|i[x>>2],D=t,0|(x=s);if(c>>>0>(h=0|i[6979])>>>0){if(0|n)return r=((r=n<<e&((r=2<<e)|0-r))&0-r)-1|0,a=0|i[(e=(r=27948+((o=((n=(r>>>=l=r>>>12&16)>>>5&8)|l|(a=(r>>>=n)>>>2&4)|(e=(r>>>=a)>>>1&2)|(o=(r>>>=e)>>>1&1))+(r>>>o)|0)<<1<<2)|0)+8|0)>>2],(0|(n=0|i[(l=a+8|0)>>2]))==(0|r)?(e=d&~(1<<o),i[6977]=e):(i[n+12>>2]=r,i[e>>2]=n,e=d),A=(x=o<<3)-c|0,i[a+4>>2]=3|c,i[(s=a+c|0)+4>>2]=1|A,i[a+x>>2]=A,0|h&&(o=0|i[6982],n=27948+((r=h>>>3)<<1<<2)|0,e&(r=1<<r)?r=0|i[(e=n+8|0)>>2]:(i[6977]=e|r,r=n,e=n+8|0),i[e>>2]=o,i[r+12>>2]=o,i[o+8>>2]=r,i[o+12>>2]=n),i[6979]=A,i[6982]=s,D=t,0|(x=l);if(a=0|i[6978]){for(n=(a&0-a)-1|0,n=u=0|i[28212+(((o=(n>>>=s=n>>>12&16)>>>5&8)|s|(A=(n>>>=o)>>>2&4)|(l=(n>>>=A)>>>1&2)|(u=(n>>>=l)>>>1&1))+(n>>>u)<<2)>>2],l=u,u=(-8&i[u+4>>2])-c|0;(e=0|i[n+16>>2])||(e=0|i[n+20>>2]);)n=e,l=(s=(A=(-8&i[e+4>>2])-c|0)>>>0<u>>>0)?e:l,u=s?A:u;if((A=l+c|0)>>>0>l>>>0){s=0|i[l+24>>2],r=0|i[l+12>>2];do{if((0|r)==(0|l)){if(!(r=0|i[(e=l+20|0)>>2])&&!(r=0|i[(e=l+16|0)>>2])){n=0;break}for(;;)if(n=0|i[(o=r+20|0)>>2])r=n,e=o;else{if(!(n=0|i[(o=r+16|0)>>2]))break;r=n,e=o}i[e>>2]=0,n=r}else n=0|i[l+8>>2],i[n+12>>2]=r,i[r+8>>2]=n,n=r}while(0);do{if(0|s){if(r=0|i[l+28>>2],(0|l)==(0|i[(e=28212+(r<<2)|0)>>2])){if(i[e>>2]=n,!n){i[6978]=a&~(1<<r);break}}else if(i[((0|i[(x=s+16|0)>>2])==(0|l)?x:s+20)>>2]=n,!n)break;i[n+24>>2]=s,0|(r=0|i[l+16>>2])&&(i[n+16>>2]=r,i[r+24>>2]=n),0|(r=0|i[l+20>>2])&&(i[n+20>>2]=r,i[r+24>>2]=n)}}while(0);return u>>>0<16?(x=u+c|0,i[l+4>>2]=3|x,i[(x=l+x+4|0)>>2]=1|i[x>>2]):(i[l+4>>2]=3|c,i[A+4>>2]=1|u,i[A+u>>2]=u,0|h&&(o=0|i[6982],n=27948+((r=h>>>3)<<1<<2)|0,(r=1<<r)&d?r=0|i[(e=n+8|0)>>2]:(i[6977]=r|d,r=n,e=n+8|0),i[e>>2]=o,i[r+12>>2]=o,i[o+8>>2]=r,i[o+12>>2]=n),i[6979]=u,i[6982]=A),D=t,0|(x=l+8|0)}d=c}else d=c}else d=c}else if(e>>>0<=4294967231)if(c=-8&(e=e+11|0),o=0|i[6978]){s=0-c|0,u=(e>>>=8)?c>>>0>16777215?31:c>>>((u=14-((l=((g=e<<(d=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|d|(u=((g<<=l)+245760|0)>>>16&2))+(g<<u>>>15)|0)+7|0)&1|u<<1:0,n=0|i[28212+(u<<2)>>2];e:do{if(n)for(e=0,l=c<<(31==(0|u)?0:25-(u>>>1)|0),a=0;;){if((A=(-8&i[n+4>>2])-c|0)>>>0<s>>>0){if(!A){e=n,s=0,g=65;break e}e=n,s=A}if(a=!(0|(g=0|i[n+20>>2]))|(0|g)==(0|(n=0|i[n+16+(l>>>31<<2)>>2]))?a:g,!n){n=a,g=61;break}l<<=1}else n=0,e=0,g=61}while(0);if(61==(0|g)){if(!(0|n)&!(0|e)){if(!(e=((e=2<<u)|0-e)&o)){d=c;break}d=(e&0-e)-1|0,e=0,n=0|i[28212+(((a=(d>>>=A=d>>>12&16)>>>5&8)|A|(l=(d>>>=a)>>>2&4)|(u=(d>>>=l)>>>1&2)|(n=(d>>>=u)>>>1&1))+(d>>>n)<<2)>>2]}n?g=65:(l=e,A=s)}if(65==(0|g))for(a=n;;){if(s=(n=(d=(-8&i[a+4>>2])-c|0)>>>0<s>>>0)?d:s,e=n?a:e,(n=0|i[a+16>>2])||(n=0|i[a+20>>2]),!n){l=e,A=s;break}a=n}if(0|l&&A>>>0<((0|i[6979])-c|0)>>>0&&(h=l+c|0)>>>0>l>>>0){a=0|i[l+24>>2],r=0|i[l+12>>2];do{if((0|r)==(0|l)){if(!(r=0|i[(e=l+20|0)>>2])&&!(r=0|i[(e=l+16|0)>>2])){r=0;break}for(;;)if(n=0|i[(s=r+20|0)>>2])r=n,e=s;else{if(!(n=0|i[(s=r+16|0)>>2]))break;r=n,e=s}i[e>>2]=0}else x=0|i[l+8>>2],i[x+12>>2]=r,i[r+8>>2]=x}while(0);do{if(a){if(e=0|i[l+28>>2],(0|l)==(0|i[(n=28212+(e<<2)|0)>>2])){if(i[n>>2]=r,!r){o&=~(1<<e),i[6978]=o;break}}else if(i[((0|i[(x=a+16|0)>>2])==(0|l)?x:a+20)>>2]=r,!r)break;i[r+24>>2]=a,0|(e=0|i[l+16>>2])&&(i[r+16>>2]=e,i[e+24>>2]=r),(e=0|i[l+20>>2])&&(i[r+20>>2]=e,i[e+24>>2]=r)}}while(0);e:do{if(A>>>0<16)x=A+c|0,i[l+4>>2]=3|x,i[(x=l+x+4|0)>>2]=1|i[x>>2];else{if(i[l+4>>2]=3|c,i[h+4>>2]=1|A,i[h+A>>2]=A,r=A>>>3,A>>>0<256){n=27948+(r<<1<<2)|0,(e=0|i[6977])&(r=1<<r)?r=0|i[(e=n+8|0)>>2]:(i[6977]=e|r,r=n,e=n+8|0),i[e>>2]=h,i[r+12>>2]=h,i[h+8>>2]=r,i[h+12>>2]=n;break}if(r=28212+((n=(r=A>>>8)?A>>>0>16777215?31:A>>>((n=14-((v=((x=r<<(_=(r+1048320|0)>>>16&8))+520192|0)>>>16&4)|_|(n=((x<<=v)+245760|0)>>>16&2))+(x<<n>>>15)|0)+7|0)&1|n<<1:0)<<2)|0,i[h+28>>2]=n,i[(e=h+16|0)+4>>2]=0,i[e>>2]=0,!(o&(e=1<<n))){i[6978]=o|e,i[r>>2]=h,i[h+24>>2]=r,i[h+12>>2]=h,i[h+8>>2]=h;break}r=0|i[r>>2];t:do{if((-8&i[r+4>>2])!=(0|A)){for(o=A<<(31==(0|n)?0:25-(n>>>1)|0);e=0|i[(n=r+16+(o>>>31<<2)|0)>>2];){if((-8&i[e+4>>2])==(0|A)){r=e;break t}o<<=1,r=e}i[n>>2]=h,i[h+24>>2]=r,i[h+12>>2]=h,i[h+8>>2]=h;break e}}while(0);x=0|i[(_=r+8|0)>>2],i[x+12>>2]=h,i[_>>2]=h,i[h+8>>2]=x,i[h+12>>2]=r,i[h+24>>2]=0}}while(0);return D=t,0|(x=l+8|0)}d=c}else d=c;else d=-1}while(0);if((n=0|i[6979])>>>0>=d>>>0)return r=n-d|0,e=0|i[6982],r>>>0>15?(x=e+d|0,i[6982]=x,i[6979]=r,i[x+4>>2]=1|r,i[e+n>>2]=r,i[e+4>>2]=3|d):(i[6979]=0,i[6982]=0,i[e+4>>2]=3|n,i[(x=e+n+4|0)>>2]=1|i[x>>2]),D=t,0|(x=e+8|0);if((A=0|i[6980])>>>0>d>>>0)return v=A-d|0,i[6980]=v,_=(x=0|i[6983])+d|0,i[6983]=_,i[_+4>>2]=1|v,i[x+4>>2]=3|d,D=t,0|(x=x+8|0);if(0|i[7095]?e=0|i[7097]:(i[7097]=4096,i[7096]=4096,i[7098]=-1,i[7099]=-1,i[7100]=0,i[7088]=0,i[7095]=-16&p^1431655768,e=4096),l=d+48|0,(c=(a=e+(u=d+47|0)|0)&(s=0-e|0))>>>0<=d>>>0)return D=t,0|(x=0);if(0|(e=0|i[7087])&&(p=(h=0|i[7085])+c|0)>>>0<=h>>>0|p>>>0>e>>>0)return D=t,0|(x=0);e:do{if(4&i[7088])r=0,g=143;else{n=0|i[6983];t:do{if(n){for(o=28356;!((p=0|i[o>>2])>>>0<=n>>>0&&(p+(0|i[o+4>>2])|0)>>>0>n>>>0);){if(!(e=0|i[o+8>>2])){g=128;break t}o=e}if((r=a-A&s)>>>0<2147483647)if((0|(e=0|fr(0|r)))==((0|i[o>>2])+(0|i[o+4>>2])|0)){if(-1!=(0|e)){A=r,a=e,g=145;break e}}else o=e,g=136;else r=0}else g=128}while(0);do{if(128==(0|g))if(-1!=(0|(n=0|fr(0)))&&(r=n,m=(r=((m=(f=0|i[7096])+-1|0)&r|0?(m+r&0-f)-r|0:0)+c|0)+(f=0|i[7085])|0,r>>>0>d>>>0&r>>>0<2147483647)){if(0|(p=0|i[7087])&&m>>>0<=f>>>0|m>>>0>p>>>0){r=0;break}if((0|(e=0|fr(0|r)))==(0|n)){A=r,a=n,g=145;break e}o=e,g=136}else r=0}while(0);do{if(136==(0|g)){if(n=0-r|0,!(l>>>0>r>>>0&r>>>0<2147483647&-1!=(0|o))){if(-1==(0|o)){r=0;break}A=r,a=o,g=145;break e}if((e=u-r+(e=0|i[7097])&0-e)>>>0>=2147483647){A=r,a=o,g=145;break e}if(-1==(0|fr(0|e))){fr(0|n),r=0;break}A=e+r|0,a=o,g=145;break e}}while(0);i[7088]=4|i[7088],g=143}}while(0);if(143==(0|g)&&c>>>0<2147483647&&!(-1==(0|(v=0|fr(0|c)))|1^(b=(y=(m=0|fr(0))-v|0)>>>0>(d+40|0)>>>0)|v>>>0<m>>>0&-1!=(0|v)&-1!=(0|m)^1)&&(A=b?y:r,a=v,g=145),145==(0|g)){r=(0|i[7085])+A|0,i[7085]=r,r>>>0>(0|i[7086])>>>0&&(i[7086]=r),u=0|i[6983];e:do{if(u){for(r=28356;;){if((0|a)==((e=0|i[r>>2])+(n=0|i[r+4>>2])|0)){g=154;break}if(!(o=0|i[r+8>>2]))break;r=o}if(!(154!=(0|g)||(_=r+4|0,8&i[r+12>>2]))&&a>>>0>u>>>0&e>>>0<=u>>>0){i[_>>2]=n+A,_=u+(v=7&(v=u+8|0)?0-v&7:0)|0,v=(x=(0|i[6980])+A|0)-v|0,i[6983]=_,i[6980]=v,i[_+4>>2]=1|v,i[u+x+4>>2]=40,i[6984]=i[7099];break}for(a>>>0<(0|i[6981])>>>0&&(i[6981]=a),n=a+A|0,r=28356;;){if((0|i[r>>2])==(0|n)){g=162;break}if(!(e=0|i[r+8>>2]))break;r=e}if(162==(0|g)&&!(8&i[r+12>>2])){i[r>>2]=a,i[(h=r+4|0)>>2]=(0|i[h>>2])+A,c=(h=a+(7&(h=a+8|0)?0-h&7:0)|0)+d|0,l=(r=n+(7&(r=n+8|0)?0-r&7:0)|0)-h-d|0,i[h+4>>2]=3|d;t:do{if((0|u)==(0|r))x=(0|i[6980])+l|0,i[6980]=x,i[6983]=c,i[c+4>>2]=1|x;else{if((0|i[6982])==(0|r)){x=(0|i[6979])+l|0,i[6979]=x,i[6982]=c,i[c+4>>2]=1|x,i[c+x>>2]=x;break}if(1==(3&(e=0|i[r+4>>2]))){A=-8&e,o=e>>>3;r:do{if(e>>>0<256){if(e=0|i[r+8>>2],(0|(n=0|i[r+12>>2]))==(0|e)){i[6977]=i[6977]&~(1<<o);break}i[e+12>>2]=n,i[n+8>>2]=e;break}a=0|i[r+24>>2],e=0|i[r+12>>2];do{if((0|e)==(0|r)){if(e=0|i[(o=(n=r+16|0)+4|0)>>2])n=o;else if(!(e=0|i[n>>2])){e=0;break}for(;;)if(o=0|i[(s=e+20|0)>>2])e=o,n=s;else{if(!(o=0|i[(s=e+16|0)>>2]))break;e=o,n=s}i[n>>2]=0}else x=0|i[r+8>>2],i[x+12>>2]=e,i[e+8>>2]=x}while(0);if(!a)break;o=28212+((n=0|i[r+28>>2])<<2)|0;do{if((0|i[o>>2])==(0|r)){if(i[o>>2]=e,0|e)break;i[6978]=i[6978]&~(1<<n);break r}if(i[((0|i[(x=a+16|0)>>2])==(0|r)?x:a+20)>>2]=e,!e)break r}while(0);if(i[e+24>>2]=a,0|(o=0|i[(n=r+16|0)>>2])&&(i[e+16>>2]=o,i[o+24>>2]=e),!(n=0|i[n+4>>2]))break;i[e+20>>2]=n,i[n+24>>2]=e}while(0);r=r+A|0,s=A+l|0}else s=l;if(i[(r=r+4|0)>>2]=-2&i[r>>2],i[c+4>>2]=1|s,i[c+s>>2]=s,r=s>>>3,s>>>0<256){n=27948+(r<<1<<2)|0,(e=0|i[6977])&(r=1<<r)?r=0|i[(e=n+8|0)>>2]:(i[6977]=e|r,r=n,e=n+8|0),i[e>>2]=c,i[r+12>>2]=c,i[c+8>>2]=r,i[c+12>>2]=n;break}r=s>>>8;do{if(r){if(s>>>0>16777215){o=31;break}o=s>>>((o=14-((v=((x=r<<(_=(r+1048320|0)>>>16&8))+520192|0)>>>16&4)|_|(o=((x<<=v)+245760|0)>>>16&2))+(x<<o>>>15)|0)+7|0)&1|o<<1}else o=0}while(0);if(r=28212+(o<<2)|0,i[c+28>>2]=o,i[(e=c+16|0)+4>>2]=0,i[e>>2]=0,!((e=0|i[6978])&(n=1<<o))){i[6978]=e|n,i[r>>2]=c,i[c+24>>2]=r,i[c+12>>2]=c,i[c+8>>2]=c;break}r=0|i[r>>2];r:do{if((-8&i[r+4>>2])!=(0|s)){for(o=s<<(31==(0|o)?0:25-(o>>>1)|0);e=0|i[(n=r+16+(o>>>31<<2)|0)>>2];){if((-8&i[e+4>>2])==(0|s)){r=e;break r}o<<=1,r=e}i[n>>2]=c,i[c+24>>2]=r,i[c+12>>2]=c,i[c+8>>2]=c;break t}}while(0);x=0|i[(_=r+8|0)>>2],i[x+12>>2]=c,i[_>>2]=c,i[c+8>>2]=x,i[c+12>>2]=r,i[c+24>>2]=0}}while(0);return D=t,0|(x=h+8|0)}for(r=28356;!((e=0|i[r>>2])>>>0<=u>>>0&&(x=e+(0|i[r+4>>2])|0)>>>0>u>>>0);)r=0|i[r+8>>2];r=(e=(e=(s=x+-47|0)+(7&(e=s+8|0)?0-e&7:0)|0)>>>0<(s=u+16|0)>>>0?u:e)+8|0,_=a+(v=7&(v=a+8|0)?0-v&7:0)|0,v=(n=A+-40|0)-v|0,i[6983]=_,i[6980]=v,i[_+4>>2]=1|v,i[a+n+4>>2]=40,i[6984]=i[7099],i[(n=e+4|0)>>2]=27,i[r>>2]=i[7089],i[r+4>>2]=i[7090],i[r+8>>2]=i[7091],i[r+12>>2]=i[7092],i[7089]=a,i[7090]=A,i[7092]=0,i[7091]=r,r=e+24|0;do{_=r,i[(r=r+4|0)>>2]=7}while((_+8|0)>>>0<x>>>0);if((0|e)!=(0|u)){if(a=e-u|0,i[n>>2]=-2&i[n>>2],i[u+4>>2]=1|a,i[e>>2]=a,r=a>>>3,a>>>0<256){n=27948+(r<<1<<2)|0,(e=0|i[6977])&(r=1<<r)?r=0|i[(e=n+8|0)>>2]:(i[6977]=e|r,r=n,e=n+8|0),i[e>>2]=u,i[r+12>>2]=u,i[u+8>>2]=r,i[u+12>>2]=n;break}if(n=28212+((o=(r=a>>>8)?a>>>0>16777215?31:a>>>((o=14-((v=((x=r<<(_=(r+1048320|0)>>>16&8))+520192|0)>>>16&4)|_|(o=((x<<=v)+245760|0)>>>16&2))+(x<<o>>>15)|0)+7|0)&1|o<<1:0)<<2)|0,i[u+28>>2]=o,i[u+20>>2]=0,i[s>>2]=0,!((r=0|i[6978])&(e=1<<o))){i[6978]=r|e,i[n>>2]=u,i[u+24>>2]=n,i[u+12>>2]=u,i[u+8>>2]=u;break}r=0|i[n>>2];t:do{if((-8&i[r+4>>2])!=(0|a)){for(o=a<<(31==(0|o)?0:25-(o>>>1)|0);e=0|i[(n=r+16+(o>>>31<<2)|0)>>2];){if((-8&i[e+4>>2])==(0|a)){r=e;break t}o<<=1,r=e}i[n>>2]=u,i[u+24>>2]=r,i[u+12>>2]=u,i[u+8>>2]=u;break e}}while(0);x=0|i[(_=r+8|0)>>2],i[x+12>>2]=u,i[_>>2]=u,i[u+8>>2]=x,i[u+12>>2]=r,i[u+24>>2]=0}}else!(0|(x=0|i[6981]))|a>>>0<x>>>0&&(i[6981]=a),i[7089]=a,i[7090]=A,i[7092]=0,i[6986]=i[7095],i[6985]=-1,i[6990]=27948,i[6989]=27948,i[6992]=27956,i[6991]=27956,i[6994]=27964,i[6993]=27964,i[6996]=27972,i[6995]=27972,i[6998]=27980,i[6997]=27980,i[7e3]=27988,i[6999]=27988,i[7002]=27996,i[7001]=27996,i[7004]=28004,i[7003]=28004,i[7006]=28012,i[7005]=28012,i[7008]=28020,i[7007]=28020,i[7010]=28028,i[7009]=28028,i[7012]=28036,i[7011]=28036,i[7014]=28044,i[7013]=28044,i[7016]=28052,i[7015]=28052,i[7018]=28060,i[7017]=28060,i[7020]=28068,i[7019]=28068,i[7022]=28076,i[7021]=28076,i[7024]=28084,i[7023]=28084,i[7026]=28092,i[7025]=28092,i[7028]=28100,i[7027]=28100,i[7030]=28108,i[7029]=28108,i[7032]=28116,i[7031]=28116,i[7034]=28124,i[7033]=28124,i[7036]=28132,i[7035]=28132,i[7038]=28140,i[7037]=28140,i[7040]=28148,i[7039]=28148,i[7042]=28156,i[7041]=28156,i[7044]=28164,i[7043]=28164,i[7046]=28172,i[7045]=28172,i[7048]=28180,i[7047]=28180,i[7050]=28188,i[7049]=28188,i[7052]=28196,i[7051]=28196,_=a+(v=7&(v=a+8|0)?0-v&7:0)|0,v=(x=A+-40|0)-v|0,i[6983]=_,i[6980]=v,i[_+4>>2]=1|v,i[a+x+4>>2]=40,i[6984]=i[7099]}while(0);if((r=0|i[6980])>>>0>d>>>0)return v=r-d|0,i[6980]=v,_=(x=0|i[6983])+d|0,i[6983]=_,i[_+4>>2]=1|v,i[x+4>>2]=3|d,D=t,0|(x=x+8|0)}return i[(x=27904)>>2]=12,D=t,0|(x=0)}function Yt(e){var t=0,r=0,n=0,o=0,s=0,a=0,A=0,l=0;if(e|=0){r=e+-8|0,o=0|i[6981],l=r+(t=-8&(e=0|i[e+-4>>2]))|0;do{if(1&e)A=r,a=r;else{if(n=0|i[r>>2],!(3&e))return;if(s=n+t|0,(a=r+(0-n)|0)>>>0<o>>>0)return;if((0|i[6982])==(0|a)){if(3&~(t=0|i[(e=l+4|0)>>2])){A=a,t=s;break}return i[6979]=s,i[e>>2]=-2&t,i[a+4>>2]=1|s,void(i[a+s>>2]=s)}if(r=n>>>3,n>>>0<256){if(e=0|i[a+8>>2],(0|(t=0|i[a+12>>2]))==(0|e)){i[6977]=i[6977]&~(1<<r),A=a,t=s;break}i[e+12>>2]=t,i[t+8>>2]=e,A=a,t=s;break}o=0|i[a+24>>2],e=0|i[a+12>>2];do{if((0|e)==(0|a)){if(e=0|i[(r=(t=a+16|0)+4|0)>>2])t=r;else if(!(e=0|i[t>>2])){e=0;break}for(;;)if(r=0|i[(n=e+20|0)>>2])e=r,t=n;else{if(!(r=0|i[(n=e+16|0)>>2]))break;e=r,t=n}i[t>>2]=0}else A=0|i[a+8>>2],i[A+12>>2]=e,i[e+8>>2]=A}while(0);if(o){if(t=0|i[a+28>>2],(0|i[(r=28212+(t<<2)|0)>>2])==(0|a)){if(i[r>>2]=e,!e){i[6978]=i[6978]&~(1<<t),A=a,t=s;break}}else if(i[((0|i[(A=o+16|0)>>2])==(0|a)?A:o+20)>>2]=e,!e){A=a,t=s;break}i[e+24>>2]=o,0|(r=0|i[(t=a+16|0)>>2])&&(i[e+16>>2]=r,i[r+24>>2]=e),(t=0|i[t+4>>2])?(i[e+20>>2]=t,i[t+24>>2]=e,A=a,t=s):(A=a,t=s)}else A=a,t=s}}while(0);if(!(a>>>0>=l>>>0)&&1&(n=0|i[(e=l+4|0)>>2])){if(2&n)i[e>>2]=-2&n,i[A+4>>2]=1|t,i[a+t>>2]=t,o=t;else{if((0|i[6983])==(0|l)){if(l=(0|i[6980])+t|0,i[6980]=l,i[6983]=A,i[A+4>>2]=1|l,(0|A)!=(0|i[6982]))return;return i[6982]=0,void(i[6979]=0)}if((0|i[6982])==(0|l))return l=(0|i[6979])+t|0,i[6979]=l,i[6982]=a,i[A+4>>2]=1|l,void(i[a+l>>2]=l);o=(-8&n)+t|0,r=n>>>3;do{if(n>>>0<256){if(t=0|i[l+8>>2],(0|(e=0|i[l+12>>2]))==(0|t)){i[6977]=i[6977]&~(1<<r);break}i[t+12>>2]=e,i[e+8>>2]=t;break}s=0|i[l+24>>2],e=0|i[l+12>>2];do{if((0|e)==(0|l)){if(e=0|i[(r=(t=l+16|0)+4|0)>>2])t=r;else if(!(e=0|i[t>>2])){r=0;break}for(;;)if(r=0|i[(n=e+20|0)>>2])e=r,t=n;else{if(!(r=0|i[(n=e+16|0)>>2]))break;e=r,t=n}i[t>>2]=0,r=e}else r=0|i[l+8>>2],i[r+12>>2]=e,i[e+8>>2]=r,r=e}while(0);if(0|s){if(e=0|i[l+28>>2],(0|i[(t=28212+(e<<2)|0)>>2])==(0|l)){if(i[t>>2]=r,!r){i[6978]=i[6978]&~(1<<e);break}}else if(i[((0|i[(n=s+16|0)>>2])==(0|l)?n:s+20)>>2]=r,!r)break;i[r+24>>2]=s,0|(t=0|i[(e=l+16|0)>>2])&&(i[r+16>>2]=t,i[t+24>>2]=r),0|(e=0|i[e+4>>2])&&(i[r+20>>2]=e,i[e+24>>2]=r)}}while(0);if(i[A+4>>2]=1|o,i[a+o>>2]=o,(0|A)==(0|i[6982]))return void(i[6979]=o)}if(e=o>>>3,o>>>0<256)return r=27948+(e<<1<<2)|0,(t=0|i[6977])&(e=1<<e)?e=0|i[(t=r+8|0)>>2]:(i[6977]=t|e,e=r,t=r+8|0),i[t>>2]=A,i[e+12>>2]=A,i[A+8>>2]=e,void(i[A+12>>2]=r);e=28212+((n=(e=o>>>8)?o>>>0>16777215?31:o>>>((n=14-((s=((l=e<<(a=(e+1048320|0)>>>16&8))+520192|0)>>>16&4)|a|(n=((l<<=s)+245760|0)>>>16&2))+(l<<n>>>15)|0)+7|0)&1|n<<1:0)<<2)|0,i[A+28>>2]=n,i[A+20>>2]=0,i[A+16>>2]=0,t=0|i[6978],r=1<<n;e:do{if(t&r){e=0|i[e>>2];t:do{if((-8&i[e+4>>2])!=(0|o)){for(n=o<<(31==(0|n)?0:25-(n>>>1)|0);t=0|i[(r=e+16+(n>>>31<<2)|0)>>2];){if((-8&i[t+4>>2])==(0|o)){e=t;break t}n<<=1,e=t}i[r>>2]=A,i[A+24>>2]=e,i[A+12>>2]=A,i[A+8>>2]=A;break e}}while(0);l=0|i[(a=e+8|0)>>2],i[l+12>>2]=A,i[a>>2]=A,i[A+8>>2]=l,i[A+12>>2]=e,i[A+24>>2]=0}else i[6978]=t|r,i[e>>2]=A,i[A+24>>2]=e,i[A+12>>2]=A,i[A+8>>2]=A}while(0);if(l=(0|i[6985])-1|0,i[6985]=l,!(0|l)){for(e=28364;e=0|i[e>>2];)e=e+8|0;i[6985]=-1}}}}function Xt(e,t){t|=0;var r=0;return(e|=0)?(r=0|v(t,e),(t|e)>>>0>65535&&(r=((r>>>0)/(e>>>0)|0)==(0|t)?r:-1)):r=0,(e=0|$t(r))&&3&i[e+-4>>2]?(dr(0|e,0,0|r),0|e):0|e}function Kt(e,t,r,n){return 0|(T((t|=0)+(n|=0)+((r=(e|=0)+(r|=0)>>>0)>>>0<e>>>0|0)>>>0|0),r)}function Zt(e,t,r,n){return 0|(T(0|(n=(t|=0)-(n|=0)-((r|=0)>>>0>(e|=0)>>>0|0)>>>0)),e-r>>>0)}function Jt(e){return 0|((e|=0)?31-(0|w(e^e-1)):32)}function er(e,t,r,n,o){o|=0;var s=0,a=0,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0;if(c=e|=0,a=r|=0,A=d=n|=0,!(u=l=t|=0))return s=!!(0|o),A?s?(i[o>>2]=0|e,i[o+4>>2]=0&t,o=0,0|(T(0|(d=0)),o)):(o=0,0|(T(0|(d=0)),o)):(s&&(i[o>>2]=(c>>>0)%(a>>>0),i[o+4>>2]=0),o=(c>>>0)/(a>>>0)>>>0,0|(T(0|(d=0)),o));s=!(0|A);do{if(a){if(!s){if((s=(0|w(0|A))-(0|w(0|u))|0)>>>0<=31){a=h=s+1|0,e=c>>>(h>>>0)&(t=s-31>>31)|u<<(A=31-s|0),t&=u>>>(h>>>0),s=0,A=c<<A;break}return o?(i[o>>2]=0|e,i[o+4>>2]=l|0&t,o=0,0|(T(0|(d=0)),o)):(o=0,0|(T(0|(d=0)),o))}if((s=a-1|0)&a|0){a=A=33+(0|w(0|a))-(0|w(0|u))|0,e=(h=32-A|0)-1>>31&u>>>((p=A-32|0)>>>0)|(u<<h|c>>>(A>>>0))&(t=p>>31),t&=u>>>(A>>>0),s=c<<(f=64-A|0)&(l=h>>31),A=(u<<f|c>>>(p>>>0))&l|c<<h&A-33>>31;break}return 0|o&&(i[o>>2]=s&c,i[o+4>>2]=0),1==(0|a)?(f=0|e,0|(T(0|(p=l|0&t)),f)):(p=u>>>((f=0|Jt(0|a))>>>0)|0,f=u<<32-f|c>>>(f>>>0),0|(T(0|p),f))}if(s)return 0|o&&(i[o>>2]=(u>>>0)%(a>>>0),i[o+4>>2]=0),f=(u>>>0)/(a>>>0)>>>0,0|(T(0|(p=0)),f);if(!c)return 0|o&&(i[o>>2]=0,i[o+4>>2]=(u>>>0)%(A>>>0)),f=(u>>>0)/(A>>>0)>>>0,0|(T(0|(p=0)),f);if(!((s=A-1|0)&A))return 0|o&&(i[o>>2]=0|e,i[o+4>>2]=s&u|0&t),p=0,f=u>>>((0|Jt(0|A))>>>0),0|(T(0|p),f);if((s=(0|w(0|A))-(0|w(0|u))|0)>>>0<=30){a=t=s+1|0,e=u<<(A=31-s|0)|c>>>(t>>>0),t=u>>>(t>>>0),s=0,A=c<<A;break}return o?(i[o>>2]=0|e,i[o+4>>2]=l|0&t,f=0,0|(T(0|(p=0)),f)):(f=0,0|(T(0|(p=0)),f))}while(0);if(a){u=0|Kt(0|(h=0|r),0|(c=d|0&n),-1,-1),r=0|S(),l=A,A=0;do{n=l,l=s>>>31|l<<1,s=A|s<<1,Zt(0|u,0|r,0|(n=e<<1|n>>>31),0|(d=e>>>31|t<<1)),A=1&(p=(f=0|S())>>31|((0|f)<0?-1:0)<<1),e=0|Zt(0|n,0|d,p&h|0,(((0|f)<0?-1:0)>>31|((0|f)<0?-1:0)<<1)&c),t=0|S(),a=a-1|0}while(0|a);u=l,l=0}else u=A,l=0,A=0;return a=0,0|o&&(i[o>>2]=e,i[o+4>>2]=t),f=s<<1&-2|A,0|(T(0|(p=(0|s)>>>31|(u|a)<<1|l)),f)}function tr(e,t,r,n){r|=0;var i,o,s,a,A;return o=(n|=0)>>31|((0|n)<0?-1:0)<<1,i=((0|n)<0?-1:0)>>31|((0|n)<0?-1:0)<<1,s=0|Zt((A=(t|=0)>>31|((0|t)<0?-1:0)<<1)^(e|=0)|0,(a=((0|t)<0?-1:0)>>31|((0|t)<0?-1:0)<<1)^t|0,0|A,0|a),e=o^A,t=i^a,0|Zt((0|er(s,0|S(),0|Zt(o^r|0,i^n|0,0|o,0|i),0|S(),0))^e,(0|S())^t,0|e,0|t)}function rr(e,t,r,n){t|=0,n|=0;var i,o;return r=0|function(e,t){var r,n,i,o=0;return e=((r=0|v(o=65535&(t|=0),i=65535&(e|=0)))>>>16)+(0|v(o,n=e>>>16))|0,t=0|v(o=t>>>16,i),0|(T((e>>>16)+(0|v(o,n))+(((65535&e)+t|0)>>>16)|0),e+t<<16|65535&r)}(i=e|=0,o=r|=0),e=0|S(),0|(T((0|v(t,o))+(0|v(n,i))+e|0&e),r)}function nr(e,t,r,n){r|=0;var o,s,a,A,l,u;return o=D,D=D+16|0,A=0|o,u=(n|=0)>>31|((0|n)<0?-1:0)<<1,l=((0|n)<0?-1:0)>>31|((0|n)<0?-1:0)<<1,er(e=0|Zt((a=(t|=0)>>31|((0|t)<0?-1:0)<<1)^(e|=0)|0,(s=((0|t)<0?-1:0)>>31|((0|t)<0?-1:0)<<1)^t|0,0|a,0|s),t=0|S(),0|Zt(u^r|0,l^n|0,0|u,0|l),0|S(),A),n=0|Zt(i[A>>2]^a|0,i[A+4>>2]^s|0,0|a,0|s),r=0|S(),D=o,0|(T(0|r),n)}function ir(e,t,r,n){var o,s;return s=D,D=D+16|0,er(e|=0,t|=0,r|=0,n|=0,o=0|s),D=s,0|(T(0|i[o+4>>2]),i[o>>2])}function or(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(T(t>>r|0),e>>>r|(t&(1<<r)-1)<<32-r):(T(0|((0|t)<0?-1:0)),t>>r-32)}function sr(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(T(t>>>r|0),e>>>r|(t&(1<<r)-1)<<32-r):(T(0),t>>>r-32|0)}function ar(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(T(t<<r|(e&(1<<r)-1<<32-r)>>>32-r),e<<r):(T(e<<r-32),0)}function Ar(e,t,r){return e|=0,32==(0|(t=0|w(t|=0)))&&(t=t+(0|w(e))|0),T(0),0|t}function lr(e,t){return t=+t,(e=+e)!=e?+t:t!=t?+e:+x(+e,+t)}function ur(e,t){return t=+t,(e=+e)!=e?+t:t!=t?+e:+_(+e,+t)}function cr(e){return(e=+e)>=0?+A(e+.5):+b(e-.5)}function hr(e,t,r){e|=0,t|=0;var o,s,a=0;if((0|(r|=0))>=8192)return C(0|e,0|t,0|r),0|e;if(s=0|e,o=e+r|0,(3&e)==(3&t)){for(;3&e;){if(!r)return 0|s;n[e|0]=0|n[t|0],e=e+1|0,t=t+1|0,r=r-1|0}for(a=(r=-4&o)-64|0;(0|e)<=(0|a);)i[e>>2]=i[t>>2],i[e+4>>2]=i[t+4>>2],i[e+8>>2]=i[t+8>>2],i[e+12>>2]=i[t+12>>2],i[e+16>>2]=i[t+16>>2],i[e+20>>2]=i[t+20>>2],i[e+24>>2]=i[t+24>>2],i[e+28>>2]=i[t+28>>2],i[e+32>>2]=i[t+32>>2],i[e+36>>2]=i[t+36>>2],i[e+40>>2]=i[t+40>>2],i[e+44>>2]=i[t+44>>2],i[e+48>>2]=i[t+48>>2],i[e+52>>2]=i[t+52>>2],i[e+56>>2]=i[t+56>>2],i[e+60>>2]=i[t+60>>2],e=e+64|0,t=t+64|0;for(;(0|e)<(0|r);)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0}else for(r=o-4|0;(0|e)<(0|r);)n[e|0]=0|n[t|0],n[e+1|0]=0|n[t+1|0],n[e+2|0]=0|n[t+2|0],n[e+3|0]=0|n[t+3|0],e=e+4|0,t=t+4|0;for(;(0|e)<(0|o);)n[e|0]=0|n[t|0],e=e+1|0,t=t+1|0;return 0|s}function dr(e,t,r){t|=0;var o,s=0,a=0,A=0;if(o=(e|=0)+(r|=0)|0,t&=255,(0|r)>=67){for(;3&e;)n[e|0]=t,e=e+1|0;for(A=t|t<<8|t<<16|t<<24,a=(s=-4&o)-64|0;(0|e)<=(0|a);)i[e>>2]=A,i[e+4>>2]=A,i[e+8>>2]=A,i[e+12>>2]=A,i[e+16>>2]=A,i[e+20>>2]=A,i[e+24>>2]=A,i[e+28>>2]=A,i[e+32>>2]=A,i[e+36>>2]=A,i[e+40>>2]=A,i[e+44>>2]=A,i[e+48>>2]=A,i[e+52>>2]=A,i[e+56>>2]=A,i[e+60>>2]=A,e=e+64|0;for(;(0|e)<(0|s);)i[e>>2]=A,e=e+4|0}for(;(0|e)<(0|o);)n[e|0]=t,e=e+1|0;return o-r|0}function pr(e){return(e=+e)>=0?+A(e+.5):+b(e-.5)}function fr(e){e|=0;var t,r,n;return n=0|N(),(0|e)>0&(0|(t=(r=0|i[a>>2])+e|0))<(0|r)|(0|t)<0?(P(0|t),M(12),-1):(0|t)>(0|n)&&!(0|R(0|t))?(M(12),-1):(i[a>>2]=t,0|r)}return{___divdi3:tr,___muldi3:rr,___remdi3:nr,___uremdi3:ir,_areNeighborCells:function(e,t,r,n,o){o|=0;var s,a,A,l=0,u=0,c=0,h=0;if(A=D,D=D+64|0,a=A,s=A+56|0,!(!0&134217728==(2013265920&(t|=0))&!0&134217728==(2013265920&(n|=0))))return D=A,0|(o=5);if((0|(e|=0))==(0|(r|=0))&(0|t)==(0|n))return i[o>>2]=0,D=A,0|(o=0);if(u=0|sr(0|e,0|t,52),S(),u&=15,h=0|sr(0|r,0|n,52),S(),(0|u)!=(15&h))return D=A,0|(o=12);if(l=u+-1|0,u>>>0>1){Ve(e,t,l,a),Ve(r,n,l,s),c=0|i[(h=a)>>2],h=0|i[h+4>>2];e:do{if((0|c)==(0|i[s>>2])&&(0|h)==(0|i[s+4>>2])){l=0|sr(0|e,0|t,0|(u=3*(15^u)|0)),S(),l&=7,u=0|sr(0|r,0|n,0|u),S(),u&=7;do{if(!(0|l)|!(0|u))i[o>>2]=1,l=0;else if(7==(0|l))l=5;else{if(1==(0|l)|1==(0|u)&&0|je(c,h)){l=5;break}if((0|i[15536+(l<<2)>>2])!=(0|u)&&(0|i[15568+(l<<2)>>2])!=(0|u))break e;i[o>>2]=1,l=0}}while(0);return D=A,0|(o=l)}}while(0)}u=(l=a)+56|0;do{i[l>>2]=0,l=l+4|0}while((0|l)<(0|u));return B(e,t,1,a),l=(0|i[(t=a)>>2])==(0|r)&&(0|i[t+4>>2])==(0|n)||(0|i[(t=a+8|0)>>2])==(0|r)&&(0|i[t+4>>2])==(0|n)||(0|i[(t=a+16|0)>>2])==(0|r)&&(0|i[t+4>>2])==(0|n)||(0|i[(t=a+24|0)>>2])==(0|r)&&(0|i[t+4>>2])==(0|n)||(0|i[(t=a+32|0)>>2])==(0|r)&&(0|i[t+4>>2])==(0|n)||(0|i[(t=a+40|0)>>2])==(0|r)&&(0|i[t+4>>2])==(0|n)?1:1&((0|i[(l=a+48|0)>>2])==(0|r)?(0|i[l+4>>2])==(0|n):0),i[o>>2]=l,D=A,0|(o=0)},_bitshift64Ashr:or,_bitshift64Lshr:sr,_bitshift64Shl:ar,_calloc:Xt,_cellAreaKm2:function(e,t,r){return 0|(e=0|pt(e|=0,t|=0,r|=0))||(o[r>>3]=6371.007180918475*+o[r>>3]*6371.007180918475),0|e},_cellAreaM2:function(e,t,r){return 0|(e=0|pt(e|=0,t|=0,r|=0))||(o[r>>3]=6371.007180918475*+o[r>>3]*6371.007180918475*1e3*1e3),0|e},_cellAreaRads2:pt,_cellToBoundary:rt,_cellToCenterChild:He,_cellToChildPos:function(e,t,r,n){r|=0,n|=0;var o,s=0,a=0,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0;if(o=D,D=D+16|0,y=o,b=0|sr(0|(e|=0),0|(t|=0),52),S(),b&=15,r>>>0>15)return D=o,0|(b=4);if((0|b)<(0|r))return D=o,0|(b=12);if((0|b)!=(0|r))if(a=0|ar(0|r,0,52),a|=e,l=S()|-15728641&t,(0|b)>(0|r)){u=r;do{g=0|ar(7,0,3*(14-u|0)|0),u=u+1|0,a|=g,l=0|S()|l}while((0|u)<(0|b));g=a}else g=a;else g=e,l=t;m=0|sr(0|g,0|l,45),S();e:do{if(0|U(127&m)){if(u=0|sr(0|g,0|l,52),S(),0|(u&=15))for(a=1;;){if(!(!((m=0|ar(7,0,3*(15-a|0)|0))&g|0)&!((0|S())&l))){c=33;break e}if(!(a>>>0<u>>>0))break;a=a+1|0}if(i[(m=n)>>2]=0,i[m+4>>2]=0,(0|b)>(0|r)){for(m=-15728641&t,f=b;;){if(p=f,(f=f+-1|0)>>>0>15|(0|b)<(0|f)){c=19;break}if((0|b)!=(0|f))if(a=0|ar(0|f,0,52),a|=e,u=0|S()|m,(0|b)<(0|p))d=a;else{c=f;do{d=0|ar(7,0,3*(14-c|0)|0),c=c+1|0,a|=d,u=0|S()|u}while((0|c)<(0|b));d=a}else d=e,u=t;if(h=0|sr(0|d,0|u,45),S(),0|U(127&h)){h=0|sr(0|d,0|u,52),S(),h&=15;t:do{if(h)for(c=1;;){if(a=0|sr(0|d,0|u,3*(15-c|0)|0),S(),0|(a&=7))break t;if(!(c>>>0<h>>>0)){a=0;break}c=c+1|0}else a=0}while(0);a=1&!(0|a)}else a=0;if(u=0|sr(0|e,0|t,3*(15-p|0)|0),S(),7==(0|(u&=7))){s=5,c=42;break}if(1==(0|u)&(a=!!(0|a))){s=5,c=42;break}if(0|(d=u+((!!(0|u)&a)<<31>>31)|0)&&(c=0|xt(7,0,c=b-p|0,((0|c)<0)<<31>>31),h=0|S(),a?(a=0|Kt(0|(a=0|rr(0|c,0|h,5,0)),0|S(),-5,-1),a=0|Kt(0|(a=0|tr(0|a,0|S(),6,0)),0|S(),1,0),u=0|S()):(a=c,u=h),p=0|Kt(0|a,0|u,0|(p=0|rr(0|c,0|h,0|(p=d+-1|0),((0|p)<0)<<31>>31)),0|S()),h=0|Kt(0|p,0|(d=0|S()),0|i[(h=n)>>2],0|i[h+4>>2]),d=0|S(),i[(p=n)>>2]=h,i[p+4>>2]=d),(0|f)<=(0|r)){c=37;break}}if(19==(0|c))E(27795,27122,1276,27158);else{if(37==(0|c)){s=0|i[(A=n)+4>>2],A=0|i[A>>2];break}if(42==(0|c))return D=o,0|s}}else s=0,A=0}else c=33}while(0);e:do{if(33==(0|c)){if(i[(m=n)>>2]=0,i[m+4>>2]=0,(0|b)>(0|r)){for(a=b;;){if(s=0|sr(0|e,0|t,3*(15-a|0)|0),S(),7==(0|(s&=7))){s=5;break}if(s=0|rr(0|(A=0|xt(7,0,A=b-a|0,((0|A)<0)<<31>>31)),0|S(),0|s,0),A=0|S(),A=0|Kt(0|i[(m=n)>>2],0|i[m+4>>2],0|s,0|A),s=0|S(),i[(m=n)>>2]=A,i[m+4>>2]=s,(0|(a=a+-1|0))<=(0|r))break e}return D=o,0|s}s=0,A=0}}while(0);return 0|Ge(g,l,b,y)&&E(27795,27122,1236,27173),((0|s)>-1|-1==(0|s)&A>>>0>4294967295)&((0|(y=0|i[(b=y)+4>>2]))>(0|s)|((0|y)==(0|s)?(0|i[b>>2])>>>0>A>>>0:0))?(D=o,0|(b=0)):(E(27795,27122,1316,27158),0)},_cellToChildren:function(e,t,r,n){n|=0;var o,s,a=0,A=0;if(s=D,D=D+16|0,it(o=s,e|=0,t|=0,r|=0),!(0|(e=0|i[(t=o)>>2]))&!(0|(t=0|i[t+4>>2])))return D=s,0;a=0,r=0;do{i[(A=n+(a<<3)|0)>>2]=e,i[A+4>>2]=t,a=0|Kt(0|a,0|r,1,0),r=0|S(),st(o),e=0|i[(A=o)>>2],t=0|i[A+4>>2]}while(!(!(0|e)&!(0|t)));return D=s,0},_cellToChildrenSize:Ge,_cellToLatLng:tt,_cellToLocalIj:function(e,t,r,n,i,o){var s,a;return e|=0,t|=0,r|=0,n|=0,o|=0,a=D,D=D+16|0,s=a,(i|=0)?e=15:(e=0|vt(e,t,r,n,s))||(Te(s,o),e=0),D=a,0|e},_cellToParent:Ve,_cellToVertex:Ft,_cellToVertexes:function(e,t,r){r|=0;var n,o=0,s=0;return s=!(0|je(e|=0,t|=0)),n=!(0|(o=0|Ft(e,t,0,r))),s?n?0|(o=0|Ft(e,t,1,r+8|0))||0|(o=0|Ft(e,t,2,r+16|0))||0|(o=0|Ft(e,t,3,r+24|0))||(o=0|Ft(e,t,4,r+32|0))?0|(s=o):0|Ft(e,t,5,r+40|0):0|(s=o):n?0|(o=0|Ft(e,t,1,r+8|0))||0|(o=0|Ft(e,t,2,r+16|0))||0|(o=0|Ft(e,t,3,r+24|0))||0|(o=0|Ft(e,t,4,r+32|0))?0|(s=o):(i[(s=r+40|0)>>2]=0,i[s+4>>2]=0,0|(s=0)):0|(s=o)},_cellsToDirectedEdge:function(e,t,r,n,o){return o|=0,7==(0|(r=0|I(e|=0,t|=0,r|=0,n|=0)))?0|(o=11):(n=0|ar(0|r,0,56),t=-2130706433&t|S()|268435456,i[o>>2]=e|n,i[o+4>>2]=t,0|(o=0))},_cellsToLinkedMultiPolygon:function(e,t,r){r|=0;var n,o,s,a=0;if(s=D,D=D+32|0,n=s,e=0|function(e,t,r){e|=0,r|=0;var n,o,s=0,a=0,A=0,l=0,u=0,c=0;if(o=D,D=D+176|0,n=o,(0|(t|=0))<1)return Ut(r,0,0),D=o,0;for(u=0|sr(0|i[(u=e)>>2],0|i[u+4>>2],52),S(),Ut(r,(0|t)>6?t:6,15&u),u=0;!(0|(s=0|rt(0|i[(s=e+(u<<3)|0)>>2],0|i[s+4>>2],n)));){if((0|(s=0|i[n>>2]))>0){l=0;do{A=n+8+(l<<4)|0,(a=0|Ht(r,s=n+8+((0|(l=l+1|0))%(0|s)<<4)|0,A))?jt(r,a):zt(r,A,s),s=0|i[n>>2]}while((0|l)<(0|s))}if((0|(u=u+1|0))>=(0|t)){s=0,c=13;break}}return 13==(0|c)?(D=o,0|s):(Vt(r),D=o,0|(c=s))}(e|=0,t|=0,o=s+16|0),0|e)return D=s,0|(r=e);if(i[r>>2]=0,i[r+4>>2]=0,i[r+8>>2]=0,0|(e=0|Gt(o)))do{t=0|ft(r);do{mt(t,e),a=e+16|0,i[n>>2]=i[a>>2],i[n+4>>2]=i[a+4>>2],i[n+8>>2]=i[a+8>>2],i[n+12>>2]=i[a+12>>2],jt(o,e),e=0|Wt(o,n)}while(0|e);e=0|Gt(o)}while(0|e);return Vt(o),(e=0|yt(r))?(gt(r),D=s,0|(a=e)):(D=s,0|(a=0))},_childPosToCell:function(e,t,r,n,o,s){e|=0,t|=0,s|=0;var a,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0;if(a=D,D=D+16|0,A=a,(o|=0)>>>0>15)return D=a,0|(s=4);if(l=0|sr(0|(r|=0),0|(n|=0),52),S(),(0|(l&=15))>(0|o))return D=a,0|(s=12);if(0|Ge(r,n,o,A)&&E(27795,27122,1236,27173),!(((0|t)>-1|-1==(0|t)&e>>>0>4294967295)&((0|(c=0|i[(h=A)+4>>2]))>(0|t)|((0|c)==(0|t)?(0|i[h>>2])>>>0>e>>>0:0))))return D=a,0|(s=2);h=o-l|0,o=0|ar(0|o,0,52),u=S()|-15728641&n,i[(c=s)>>2]=o|r,i[c+4>>2]=u,c=0|sr(0|r,0|n,45),S();e:do{if(0|U(127&c)){if(0|l)for(A=1;;){if(!(!((c=0|ar(7,0,3*(15-A|0)|0))&r|0)&!((0|S())&n)))break e;if(!(A>>>0<l>>>0))break;A=A+1|0}if((0|h)<1)return D=a,0|(s=0);for(c=15^l,n=-1,u=1,A=1;;){l=0|xt(7,0,l=h-u|0,((0|l)<0)<<31>>31),r=0|S();do{if(A){if(A=0|tr(0|(A=0|Kt(0|(A=0|rr(0|l,0|r,5,0)),0|S(),-5,-1)),0|S(),6,0),(0|t)>(0|(o=0|S()))|(0|t)==(0|o)&e>>>0>A>>>0){t=0|Zt(0|(t=0|Kt(0|e,0|t,-1,-1)),0|S(),0|A,0|o),A=0|S(),f=0|i[(d=s)>>2],d=0|i[d+4>>2],p=0|ar(7,0,0|(m=3*(c+n|0)|0)),d&=~S(),m=0|ar(0|(o=0|Kt(0|(n=0|tr(0|t,0|A,0|l,0|r)),0|(e=0|S()),2,0)),0|S(),0|m),d=0|S()|d,i[(o=s)>>2]=m|f&~p,i[o+4>>2]=d,e=0|Zt(0|t,0|A,0|(e=0|rr(0|n,0|e,0|l,0|r)),0|S()),A=0,t=0|S();break}p=0|i[(m=s)>>2],m=0|i[m+4>>2],f=0|ar(7,0,3*(c+n|0)|0),m&=~S(),i[(A=s)>>2]=p&~f,i[A+4>>2]=m,A=1;break}o=0|i[(p=s)>>2],p=0|i[p+4>>2],d=0|ar(7,0,0|(n=3*(c+n|0)|0)),p&=~S(),n=0|ar(0|(m=0|tr(0|e,0|t,0|l,0|r)),0|(A=0|S()),0|n),p=0|S()|p,i[(f=s)>>2]=n|o&~d,i[f+4>>2]=p,e=0|Zt(0|e,0|t,0|(A=0|rr(0|m,0|A,0|l,0|r)),0|S()),A=0,t=0|S()}while(0);if(!((0|h)>(0|u))){t=0;break}n=~u,u=u+1|0}return D=a,0|t}}while(0);if((0|h)<1)return D=a,0|(m=0);for(o=15^l,A=1;;){if(f=0|xt(7,0,f=h-A|0,((0|f)<0)<<31>>31),m=0|S(),r=0|i[(u=s)>>2],u=0|i[u+4>>2],n=0|ar(7,0,0|(l=3*(o-A|0)|0)),u&=~S(),l=0|ar(0|(d=0|tr(0|e,0|t,0|f,0|m)),0|(p=0|S()),0|l),u=0|S()|u,i[(c=s)>>2]=l|r&~n,i[c+4>>2]=u,e=0|Zt(0|e,0|t,0|(m=0|rr(0|d,0|p,0|f,0|m)),0|S()),t=0|S(),(0|h)<=(0|A)){t=0;break}A=A+1|0}return D=a,0|t},_compactCells:function(e,t,r,n){t|=0;var o,s=0,a=0,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0,w=0,T=0,M=0,N=0,C=0,R=0,P=0,D=0;if(!(0|(r|=0))&!(0|(n|=0)))return 0|(D=0);if(a=0|i[(s=e|=0)>>2],!0&!(15728640&(s=0|i[s+4>>2]))){if(!((0|n)>0|!(0|n)&r>>>0>0))return 0|(D=0);if(i[(D=t)>>2]=a,i[D+4>>2]=s,1==(0|r)&!(0|n))return 0|(D=0);s=1,a=0;do{P=0|i[(R=e+(s<<3)|0)+4>>2],i[(D=t+(s<<3)|0)>>2]=i[R>>2],i[D+4>>2]=P,s=0|Kt(0|s,0|a,1,0),a=0|S()}while((0|a)<(0|n)|(0|a)==(0|n)&s>>>0<r>>>0);return 0|(s=0)}if(!(P=0|$t(o=r<<3)))return 0|(D=13);if(hr(0|P,0|e,0|o),!(R=0|Xt(r,8)))return Yt(P),0|(D=13);e:for(;;){N=0|sr(0|(c=0|i[(s=P)>>2]),0|(s=0|i[s+4>>2]),52),S(),C=(N&=15)+-1|0,M=!!(0|N),T=(0|n)>0|!(0|n)&r>>>0>0;t:do{if(M&T){if(v=0|ar(0|C,0,52),_=0|S(),C>>>0>15){if(!(!(0|c)&!(0|s))){D=16;break e}for(a=0,e=0;;){if(a=0|Kt(0|a,0|e,1,0),!((0|(e=0|S()))<(0|n)|(0|e)==(0|n)&a>>>0<r>>>0))break t;if(!(!(0|(w=0|i[(A=P+(a<<3)|0)>>2]))&!(0|(A=0|i[A+4>>2])))){s=A,D=16;break e}}}for(l=c,e=s,a=0,A=0;;){if(!(!(0|l)&!(0|e))){if(!(!0&!(117440512&e))){D=21;break e}if(h=0|sr(0|l,0|e,52),S(),(0|(h&=15))<(0|C)){s=12,D=27;break e}if((0|h)!=(0|C)&&(l|=v,e=-15728641&e|_,h>>>0>=N>>>0)){u=C;do{w=0|ar(7,0,3*(14-u|0)|0),u=u+1|0,l|=w,e=0|S()|e}while(u>>>0<h>>>0)}if(p=0|ir(0|l,0|e,0|r,0|n),f=0|S(),!(!(0|(d=0|i[(h=u=R+(p<<3)|0)>>2]))&!(0|(h=0|i[h+4>>2])))){y=0,b=0;do{if((0|y)>(0|n)|(0|y)==(0|n)&b>>>0>r>>>0){D=31;break e}if((0|d)==(0|l)&(-117440513&h)==(0|e)){m=0|sr(0|d,0|h,56),S(),g=(m&=7)+1|0,w=0|sr(0|d,0|h,45),S();r:do{if(0|U(127&w)){if(d=0|sr(0|d,0|h,52),S(),!(d&=15)){h=6;break}for(h=1;;){if(!(!((w=0|ar(7,0,3*(15-h|0)|0))&l|0)&!((0|S())&e))){h=7;break r}if(!(h>>>0<d>>>0)){h=6;break}h=h+1|0}}else h=7}while(0);if((m+2|0)>>>0>h>>>0){D=41;break e}w=0|ar(0|g,0,56),e=S()|-117440513&e,i[(x=u)>>2]=0,i[x+4>>2]=0,l|=w}else p=0|nr(0|(p=0|Kt(0|p,0|f,1,0)),0|S(),0|r,0|n),f=0|S();b=0|Kt(0|b,0|y,1,0),y=0|S(),d=0|i[(h=u=R+(p<<3)|0)>>2],h=0|i[h+4>>2]}while(!(!(0|d)&!(0|h)))}i[(w=u)>>2]=l,i[w+4>>2]=e}if(a=0|Kt(0|a,0|A,1,0),!((0|(A=0|S()))<(0|n)|(0|A)==(0|n)&a>>>0<r>>>0))break t;l=0|i[(e=P+(a<<3)|0)>>2],e=0|i[e+4>>2]}}}while(0);if(w=0|Kt(0|r,0|n,5,0),(x=0|S())>>>0<0|!(0|x)&w>>>0<11){D=85;break}if(w=0|tr(0|r,0|n,6,0),S(),!(w=0|Xt(w,8))){D=48;break}do{if(T){for(g=0,e=0,m=0,y=0;;){if(!(0|(a=0|i[(A=h=R+(g<<3)|0)>>2]))&!(0|(A=0|i[A+4>>2])))x=m;else{d=0|sr(0|a,0|A,56),S(),l=(d&=7)+1|0,p=-117440513&A,x=0|sr(0|a,0|A,45),S();t:do{if(0|U(127&x)){if(f=0|sr(0|a,0|A,52),S(),0|(f&=15))for(u=1;;){if(!(!(a&(x=0|ar(7,0,3*(15-u|0)|0))|0)&!(p&(0|S()))))break t;if(!(u>>>0<f>>>0))break;u=u+1|0}a|=A=0|ar(0|l,0,56),A=0|S()|p,i[(l=h)>>2]=a,i[l+4>>2]=A,l=d+2|0}}while(0);7==(0|l)?(i[(x=w+(e<<3)|0)>>2]=a,i[x+4>>2]=-117440513&A,e=0|Kt(0|e,0|m,1,0),x=0|S()):x=m}if(g=0|Kt(0|g,0|y,1,0),!((0|(y=0|S()))<(0|n)|(0|y)==(0|n)&g>>>0<r>>>0))break;m=x}if(T){if(b=C>>>0>15,v=0|ar(0|C,0,52),_=0|S(),!M){for(a=0,u=0,l=0,A=0;!(0|c)&!(0|s)||(i[(C=t+(a<<3)|0)>>2]=c,i[C+4>>2]=s,a=0|Kt(0|a,0|u,1,0),u=0|S()),l=0|Kt(0|l,0|A,1,0),(0|(A=0|S()))<(0|n)|(0|A)==(0|n)&l>>>0<r>>>0;)c=0|i[(s=P+(l<<3)|0)>>2],s=0|i[s+4>>2];s=x;break}for(a=0,u=0,A=0,l=0;;){do{if(!(!(0|c)&!(0|s))){if(f=0|sr(0|c,0|s,52),S(),b|(0|(f&=15))<(0|C)){D=80;break e}if((0|f)!=(0|C)){if(h=c|v,d=-15728641&s|_,f>>>0>=N>>>0){p=C;do{M=0|ar(7,0,3*(14-p|0)|0),p=p+1|0,h|=M,d=0|S()|d}while(p>>>0<f>>>0)}}else h=c,d=s;m=0|ir(0|h,0|d,0|r,0|n),p=0,f=0,y=0|S();do{if((0|p)>(0|n)|(0|p)==(0|n)&f>>>0>r>>>0){D=81;break e}if((-117440513&(g=0|i[(M=R+(m<<3)|0)+4>>2]))==(0|d)&&(0|i[M>>2])==(0|h)){D=65;break}m=0|nr(0|(M=0|Kt(0|m,0|y,1,0)),0|S(),0|r,0|n),y=0|S(),f=0|Kt(0|f,0|p,1,0),p=0|S(),M=R+(m<<3)|0}while((0|i[M>>2])!=(0|h)||(0|i[M+4>>2])!=(0|d));if(65==(0|D)&&(D=0,!0&100663296==(117440512&g)))break;i[(M=t+(a<<3)|0)>>2]=c,i[M+4>>2]=s,a=0|Kt(0|a,0|u,1,0),u=0|S()}}while(0);if(A=0|Kt(0|A,0|l,1,0),!((0|(l=0|S()))<(0|n)|(0|l)==(0|n)&A>>>0<r>>>0))break;c=0|i[(s=P+(A<<3)|0)>>2],s=0|i[s+4>>2]}s=x}else a=0,s=x}else a=0,e=0,s=0}while(0);if(dr(0|R,0,0|o),hr(0|P,0|w,e<<3),Yt(w),!(0|e)&!(0|s)){D=89;break}t=t+(a<<3)|0,n=s,r=e}if(16==(0|D))!0&!(117440512&s)?(s=4,D=27):D=21;else if(31==(0|D))E(27795,27122,529,27132);else{if(41==(0|D))return Yt(P),Yt(R),0|(D=10);if(48==(0|D))return Yt(P),Yt(R),0|(D=13);80==(0|D)?E(27795,27122,620,27132):81==(0|D)?E(27795,27122,632,27132):85==(0|D)&&(hr(0|t,0|P,r<<3),D=89)}return 21==(0|D)?(Yt(P),Yt(R),0|(D=5)):27==(0|D)?(Yt(P),Yt(R),0|(D=s)):89==(0|D)?(Yt(P),Yt(R),0|(D=0)):0},_destroyLinkedMultiPolygon:gt,_directedEdgeToBoundary:Ne,_directedEdgeToCells:function(e,t,r){e|=0;var n,o,s,a=0;return n=D,D=D+16|0,a=n,!0&268435456==(2013265920&(t|=0))?(o=-2130706433&t|134217728,i[(s=r|=0)>>2]=e,i[s+4>>2]=o,i[a>>2]=0,t=0|sr(0|e,0|t,56),S(),a=0|k(e,o,7&t,a,r+8|0),D=n,0|a):(D=n,0|(a=6))},_edgeLengthKm:function(e,t,r){r|=0;var n,s=0,a=0,A=0,l=0,c=0,p=0,f=0;if(n=D,D=D+176|0,0|(e=0|Ne(e|=0,t|=0,l=n)))return l=e,A=+o[r>>3],A*=6371.007180918475,o[r>>3]=A,D=n,0|l;if(o[r>>3]=0,(0|(e=0|i[l>>2]))<=1)return l=0,A=0,A*=6371.007180918475,o[r>>3]=A,D=n,0|l;t=e+-1|0,e=0,s=+o[l+8>>3],a=+o[l+16>>3],A=0;do{p=s,s=+o[l+8+((e=e+1|0)<<4)>>3],f=+d(.5*(s-p)),c=a,a=+o[l+8+(e<<4)+8>>3],c=f*f+(c=+d(.5*(a-c)))*(+h(+p)*+h(+s)*c),A+=2*+y(+ +u(+c),+ +u(+(1-c)))}while((0|e)!=(0|t));return o[r>>3]=A,l=0,f=A,f*=6371.007180918475,o[r>>3]=f,D=n,0|l},_edgeLengthM:function(e,t,r){r|=0;var n,s=0,a=0,A=0,l=0,c=0,p=0,f=0;if(n=D,D=D+176|0,0|(e=0|Ne(e|=0,t|=0,l=n)))return l=e,A=+o[r>>3],A*=6371.007180918475,A*=1e3,o[r>>3]=A,D=n,0|l;if(o[r>>3]=0,(0|(e=0|i[l>>2]))<=1)return l=0,A=0,A*=6371.007180918475,A*=1e3,o[r>>3]=A,D=n,0|l;t=e+-1|0,e=0,s=+o[l+8>>3],a=+o[l+16>>3],A=0;do{p=s,s=+o[l+8+((e=e+1|0)<<4)>>3],f=+d(.5*(s-p)),c=a,a=+o[l+8+(e<<4)+8>>3],c=f*f+(c=+d(.5*(a-c)))*(+h(+p)*+h(+s)*c),A+=2*+y(+ +u(+c),+ +u(+(1-c)))}while((0|e)!=(0|t));return o[r>>3]=A,l=0,f=A,f*=6371.007180918475,f*=1e3,o[r>>3]=f,D=n,0|l},_edgeLengthRads:function(e,t,r){r|=0;var n,s=0,a=0,A=0,l=0,c=0,p=0,f=0;if(n=D,D=D+176|0,0|(e=0|Ne(e|=0,t|=0,l=n)))return D=n,0|(l=e);if(o[r>>3]=0,(0|(e=0|i[l>>2]))<=1)return D=n,0|(l=0);t=e+-1|0,e=0,s=+o[l+8>>3],a=+o[l+16>>3],A=0;do{p=s,s=+o[l+8+((e=e+1|0)<<4)>>3],f=+d(.5*(s-p)),c=a,a=+o[l+8+(e<<4)+8>>3],c=f*f+(c=+d(.5*(a-c)))*(+h(+s)*+h(+p)*c),A+=2*+y(+ +u(+c),+ +u(+(1-c)))}while((0|e)<(0|t));return o[r>>3]=A,D=n,0|(l=0)},_emscripten_replace_memory:function(e){return n=new Int8Array(e),i=new Int32Array(e),o=new Float64Array(e),r=e,!0},_free:Yt,_getBaseCellNumber:Ie,_getDirectedEdgeDestination:function(e,t,r){e|=0,t|=0,r|=0;var n,o,s=0;return n=D,D=D+16|0,i[(s=n)>>2]=0,!0&268435456==(2013265920&t)?(o=0|sr(0|e,0|t,56),S(),s=0|k(e,-2130706433&t|134217728,7&o,s,r),D=n,0|s):(D=n,0|(s=6))},_getDirectedEdgeOrigin:function(e,t,r){return e|=0,r|=0,!0&268435456==(2013265920&(t|=0))?(i[r>>2]=e,i[r+4>>2]=-2130706433&t|134217728,0|(r=0)):0|(r=6)},_getHexagonAreaAvgKm2:ct,_getHexagonAreaAvgM2:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(o[t>>3]=+o[20784+(e<<3)>>3],0|(t=0))},_getHexagonEdgeLengthAvgKm:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(o[t>>3]=+o[20912+(e<<3)>>3],0|(t=0))},_getHexagonEdgeLengthAvgM:function(e,t){return t|=0,(e|=0)>>>0>15?0|(t=4):(o[t>>3]=+o[21040+(e<<3)>>3],0|(t=0))},_getIcosahedronFaces:function e(t,r,n){n|=0;var o,s=0,a=0,A=0,l=0,u=0,c=0,h=0,d=0;o=D,D=D+128|0,h=o+112|0,A=o+96|0,d=o,a=0|sr(0|(t|=0),0|(r|=0),52),S(),u=15&a,i[h>>2]=u,l=0|sr(0|t,0|r,45),S(),l&=127;e:do{if(0|U(l)){if(0|u)for(s=1;;){if(!(!((c=0|ar(7,0,3*(15-s|0)|0))&t|0)&!((0|S())&r))){a=0;break e}if(!(s>>>0<u>>>0))break;s=s+1|0}if(!(1&a))return c=0|ar(u+1|0,0,52),d=S()|-15728641&r,d=0|e((c|t)&~(h=0|ar(7,0,3*(14-u|0)|0)),d&~S(),n),D=o,0|d;a=1}else a=0}while(0);if(!(s=0|et(t,r,A))){a?(Be(A,h,d),c=5):(ke(A,h,d),c=6);e:do{if(0|U(l))if(u)for(s=1;;){if(!(!((l=0|ar(7,0,3*(15-s|0)|0))&t|0)&!((0|S())&r))){t=2;break e}if(!(s>>>0<u>>>0)){t=5;break}s=s+1|0}else t=5;else t=2}while(0);dr(0|n,-1,t<<2);e:do{if(a)for(A=0;;){if(Oe(l=d+(A<<4)|0,0|i[h>>2]),l=0|i[l>>2],-1==(0|(u=0|i[n>>2]))|(0|u)==(0|l))s=n;else{a=0;do{if((a=a+1|0)>>>0>=t>>>0){s=1;break e}u=0|i[(s=n+(a<<2)|0)>>2]}while(!(-1==(0|u)|(0|u)==(0|l)))}if(i[s>>2]=l,(A=A+1|0)>>>0>=c>>>0){s=0;break}}else for(A=0;;){if(qe(l=d+(A<<4)|0,0|i[h>>2],0,1),l=0|i[l>>2],-1==(0|(u=0|i[n>>2]))|(0|u)==(0|l))s=n;else{a=0;do{if((a=a+1|0)>>>0>=t>>>0){s=1;break e}u=0|i[(s=n+(a<<2)|0)>>2]}while(!(-1==(0|u)|(0|u)==(0|l)))}if(i[s>>2]=l,(A=A+1|0)>>>0>=c>>>0){s=0;break}}}while(0)}return D=o,0|(d=s)},_getNumCells:ht,_getPentagons:nt,_getRes0Cells:function(e){e|=0;var t=0,r=0,n=0;t=0;do{ar(0|t,0,45),n=134225919|S(),i[(r=e+(t<<3)|0)>>2]=-1,i[r+4>>2]=n,t=t+1|0}while(122!=(0|t));return 0},_getResolution:function(e,t){return t=0|sr(0|(e|=0),0|(t|=0),52),S(),15&t},_greatCircleDistanceKm:ut,_greatCircleDistanceM:function(e,t){e|=0;var r,n,i,s=0;return n=+o[(t|=0)>>3],r=+o[e>>3],s=(i=+d(.5*(n-r)))*i+(s=+d(.5*(+o[t+8>>3]-+o[e+8>>3])))*(+h(+n)*+h(+r)*s),2*+y(+ +u(+s),+ +u(+(1-s)))*6371.007180918475*1e3},_greatCircleDistanceRads:function(e,t){e|=0;var r,n,i,s=0;return n=+o[(t|=0)>>3],r=+o[e>>3],s=(i=+d(.5*(n-r)))*i+(s=+d(.5*(+o[t+8>>3]-+o[e+8>>3])))*(+h(+n)*+h(+r)*s),2*+y(+ +u(+s),+ +u(+(1-s)))},_gridDisk:B,_gridDiskDistances:q,_gridDistance:function(e,t,r,n,o){r|=0,n|=0,o|=0;var s,a,A=0,l=0;return a=D,D=D+32|0,l=a,0|(s=0|vt(e|=0,t|=0,e,t,A=a+12|0))?(D=a,0|(l=s)):0|(e=0|vt(e,t,r,n,l))?(D=a,0|(l=e)):(A=0|we(A,l),i[(l=o)>>2]=A,i[l+4>>2]=((0|A)<0)<<31>>31,D=a,0|(l=0))},_gridPathCells:function(e,t,r,n,o){r|=0,n|=0,o|=0;var s,a,A=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0,w=0,T=0,M=0,N=0;if(a=D,D=D+48|0,u=a+12|0,M=a,!(A=0|vt(e|=0,t|=0,e,t,s=a+24|0))&&!(A=0|vt(e,t,r,n,u))){T=((0|(w=0|we(s,u)))<0)<<31>>31,i[s>>2]=0,i[s+4>>2]=0,i[s+8>>2]=0,i[u>>2]=0,i[u+4>>2]=0,i[u+8>>2]=0,0|vt(e,t,e,t,s)&&E(27795,27538,692,27747),0|vt(e,t,r,n,u)&&E(27795,27538,697,27747),Ee(s),Ee(u),p=0|w?1/+(0|w):0,r=0|i[s>>2],b=p*+((0|i[u>>2])-r|0),n=0|i[(v=s+4|0)>>2],_=p*+((0|i[u+4>>2])-n|0),A=0|i[(x=s+8|0)>>2],p*=+((0|i[u+8>>2])-A|0),i[M>>2]=r,i[(f=M+4|0)>>2]=n,i[(m=M+8|0)>>2]=A;e:do{if((0|w)<0)A=0;else for(g=0,y=0;;){N=b*(h=+(y>>>0)+4294967296*+(0|g))+ +(0|r),c=_*h+ +(0|n),h=p*h+ +(0|A),r=~~+cr(+N),u=~~+cr(+c),A=~~+cr(+h),N=+l(+(+(0|r)-N)),c=+l(+(+(0|u)-c)),h=+l(+(+(0|A)-h));do{if(!(N>c&N>h)){if(d=0-r|0,c>h){n=d-A|0;break}n=u,A=d-u|0;break}r=0-(u+A)|0,n=u}while(0);if(i[M>>2]=r,i[f>>2]=n,i[m>>2]=A,Me(M),0|(A=0|_t(e,t,M,o+(y<<3)|0)))break e;if(!((0|g)<(0|T)|(0|g)==(0|T)&y>>>0<w>>>0)){A=0;break e}r=0|Kt(0|y,0|g,1,0),g=n=0|S(),y=r,r=0|i[s>>2],n=0|i[v>>2],A=0|i[x>>2]}}while(0);return D=a,0|(M=A)}return D=a,0|(M=A)},_gridPathCellsSize:function(e,t,r,n,o){r|=0,n|=0,o|=0;var s,a=0,A=0,l=0;return s=D,D=D+32|0,l=s,(a=0|vt(e|=0,t|=0,e,t,A=s+12|0))||(a=0|vt(e,t,r,n,l))?(D=s,0|(l=a)):(n=0|Kt(0|(n=0|we(A,l)),((0|n)<0)<<31>>31,1,0),A=0|S(),i[(l=o)>>2]=n,i[l+4>>2]=A,D=s,0|(l=0))},_gridRingUnsafe:function(e,t,r,n){e|=0,t|=0,r|=0,n|=0;var o,s,a=0,A=0,l=0,u=0,c=0,h=0,d=0,p=0,f=0;if(s=D,D=D+16|0,f=s+8|0,i[(p=o=s)>>2]=e,i[p+4>>2]=t,!r)return i[(f=n)>>2]=e,i[f+4>>2]=t,D=s,0|(f=0);i[f>>2]=0;e:do{if(0|je(e,t))e=9;else{if(A=(0|r)>0){a=0,p=e;do{if(0|(e=0|k(p,t,4,f,o)))break e;if(a=a+1|0,0|je(p=0|i[(t=o)>>2],t=0|i[t+4>>2])){e=9;break e}}while((0|a)<(0|r));if(i[(d=n)>>2]=p,i[d+4>>2]=t,d=r+-1|0,A){h=0,e=1;do{if(a=26800+(h<<2)|0,5==(0|h))for(l=0|i[a>>2],A=0,a=e;;){if(0|(e=0|k(0|i[(e=o)>>2],0|i[e+4>>2],l,f,o)))break e;if((0|A)!=(0|d)){if(u=0|i[(c=o)>>2],c=0|i[c+4>>2],i[(e=n+(a<<3)|0)>>2]=u,i[e+4>>2]=c,0|je(u,c)){e=9;break e}e=a+1|0}else e=a;if((0|(A=A+1|0))>=(0|r))break;a=e}else for(l=o,c=0|i[a>>2],u=0,a=e,A=0|i[l>>2],l=0|i[l+4>>2];;){if(0|(e=0|k(A,l,c,f,o)))break e;if(A=0|i[(l=o)>>2],l=0|i[l+4>>2],i[(e=n+(a<<3)|0)>>2]=A,i[e+4>>2]=l,e=a+1|0,0|je(A,l)){e=9;break e}if((0|(u=u+1|0))>=(0|r))break;a=e}h=h+1|0}while(h>>>0<6);l=p,a=0|i[(e=o)>>2],A=t,e=0|i[e+4>>2]}else l=p,a=p,A=t,e=t}else i[(l=n)>>2]=e,i[l+4>>2]=t,l=e,a=e,A=t,e=t;e=(0|l)==(0|a)&(0|A)==(0|e)?0:9}}while(0);return D=s,0|(f=e)},_i64Add:Kt,_i64Subtract:Zt,_isPentagon:je,_isResClassIII:function(e,t){return t=0|sr(0|(e|=0),0|(t|=0),52),S(),1&t},_isValidCell:Fe,_isValidDirectedEdge:function(e,t){var r=0;switch(r=0|sr(0|(e|=0),0|(t|=0),56),S(),7&r){case 0:case 7:return 0|(r=0)}return r=-2130706433&t|134217728,!0&268435456==(2013265920&t)?!0&16777216==(117440512&t)&!!(0|je(e,r))?0|(r=0):0|(r=0|Fe(e,r)):0|(r=0)},_isValidVertex:function(e,t){e|=0;var r,n,o=0,s=0;return n=D,D=D+16|0,r=n,!0&536870912==(2013265920&(t|=0))&&0|Fe(e,o=-2130706433&t|134217728)?(s=0|sr(0|e,0|t,56),S(),o=(s=!(0|Ft(e,o,7&s,r)))&((0|i[(o=r)>>2])==(0|e)?(0|i[o+4>>2])==(0|t):0)&1,D=n,0|o):(D=n,0|(o=0))},_latLngToCell:Ze,_llvm_ctlz_i64:Ar,_llvm_maxnum_f64:lr,_llvm_minnum_f64:ur,_llvm_round_f64:cr,_localIjToCell:function(e,t,r,n,i){var o,s;return e|=0,t|=0,r|=0,i|=0,s=D,D=D+16|0,o=s,(n|=0)?r=15:(r=0|Se(r,o))||(r=0|_t(e,t,o,i)),D=s,0|r},_malloc:$t,_maxFaceCount:function(e,t,r){r|=0;var n=0,o=0;if(o=0|sr(0|(e|=0),0|(t|=0),45),S(),!(0|U(127&o)))return o=2,i[r>>2]=o,0;if(o=0|sr(0|e,0|t,52),S(),!(o&=15))return o=5,i[r>>2]=o,0;for(n=1;;){if(!(!((0|ar(7,0,3*(15-n|0)|0))&e|0)&!((0|S())&t))){n=2,e=6;break}if(!(n>>>0<o>>>0)){n=5,e=6;break}n=n+1|0}return 6==(0|e)?(i[r>>2]=n,0):0},_maxGridDiskSize:function(e,t){t|=0;var r=0,n=0,o=0;return(0|(e|=0))<0?0|(t=2):(0|e)>13780509?0|(t=0|ht(15,t)):(o=0|rr(0|e,0|(r=((0|e)<0)<<31>>31),3,0),n=0|S(),r=0|Kt(0|e,0|r,1,0),r=0|Kt(0|(r=0|rr(0|o,0|n,0|r,0|S())),0|S(),1,0),e=0|S(),i[t>>2]=r,i[t+4>>2]=e,0|(t=0))},_maxPolygonToCellsSize:function(e,t,r,n){e|=0,t|=0,n|=0;var o,s=0,a=0,A=0,l=0,u=0;if(o=D,D=D+48|0,s=o+16|0,a=o+8|0,A=o,0|(r=0|Ct(r|=0)))return D=o,0|(A=r);if(l=0|i[(u=e)+4>>2],i[(r=a)>>2]=i[u>>2],i[r+4>>2]=l,Nt(a,s),!(r=0|ee(s,t,A))){if(t=0|i[a>>2],(0|(a=0|i[e+8>>2]))>0){s=0|i[e+12>>2],r=0;do{t=(0|i[s+(r<<3)>>2])+t|0,r=r+1|0}while((0|r)<(0|a))}s=0|i[(r=A)>>2],(0|(r=0|i[r+4>>2]))<(0|(a=((0|t)<0)<<31>>31))|(0|r)==(0|a)&s>>>0<t>>>0?(i[(r=A)>>2]=t,i[r+4>>2]=a,r=a):t=s,l=0|Kt(0|t,0|r,12,0),u=0|S(),i[(r=A)>>2]=l,i[r+4>>2]=u,i[(r=n)>>2]=l,i[r+4>>2]=u,r=0}return D=o,0|(u=r)},_maxPolygonToCellsSizeExperimental:function(e,t,r,s){t|=0,r|=0,s|=0;var a,A,u=0,c=0,d=0,p=0,f=0,m=0,g=0,y=0;if(A=D,D=D+48|0,f=A+32|0,p=A+40|0,a=A,!(0|i[(e|=0)>>2]))return i[(m=s)>>2]=0,i[m+4>>2]=0,D=A,0|(m=0);Ue(f,0,0,0),u=0|i[(d=f)>>2],d=0|i[d+4>>2];do{if(t>>>0>15)i[(m=a)>>2]=0,i[m+4>>2]=0,i[a+8>>2]=4,i[a+12>>2]=-1,r=a+29|0,i[(m=a+16|0)>>2]=0,i[m+4>>2]=0,i[m+8>>2]=0,n[m+12|0]=0,n[r|0]=0|n[p|0],n[r+1|0]=0|n[p+1|0],n[r+2|0]=0|n[p+2|0],r=4,m=9;else{if(0|(r=0|Ct(r))){i[(f=a)>>2]=0,i[f+4>>2]=0,i[a+8>>2]=r,i[a+12>>2]=-1,m=a+29|0,i[(f=a+16|0)>>2]=0,i[f+4>>2]=0,i[f+8>>2]=0,n[f+12|0]=0,n[m|0]=0|n[p|0],n[m+1|0]=0|n[p+1|0],n[m+2|0]=0|n[p+2|0],m=9;break}if(!(r=0|Xt(1+(0|i[e+8>>2])|0,32))){i[(m=a)>>2]=0,i[m+4>>2]=0,i[a+8>>2]=13,i[a+12>>2]=-1,r=a+29|0,i[(m=a+16|0)>>2]=0,i[m+4>>2]=0,i[m+8>>2]=0,n[m+12|0]=0,n[r|0]=0|n[p|0],n[r+1|0]=0|n[p+1|0],n[r+2|0]=0|n[p+2|0],r=13,m=9;break}Rt(e,r),i[(y=a)>>2]=u,i[y+4>>2]=d,i[(d=a+8|0)>>2]=0,i[a+12>>2]=t,i[a+20>>2]=e,i[a+24>>2]=r,n[a+28|0]=0,n[(u=a+29|0)|0]=0|n[p|0],n[u+1|0]=0|n[p+1|0],n[u+2|0]=0|n[p+2|0],i[a+16>>2]=3,g=+Y(r),g*=+Q(r),c=+l(+ +o[r>>3]),c=g/+h(+ +ur(+c,+ +l(+ +o[r+8>>3])))*6371.007180918475*6371.007180918475,r=0|i[(u=a+12|0)>>2];e:do{if((0|r)>0)do{if(ct(r+-1|0,f),!(c/+o[f>>3]>10))break e;r=(y=0|i[u>>2])+-1|0,i[u>>2]=r}while((0|y)>1)}while(0);if(St(a),i[(u=s)>>2]=0,i[u+4>>2]=0,!(!(0|(r=0|i[(u=a)>>2]))&!(0|(u=0|i[u+4>>2]))))do{Ge(r,u,t,f),p=f,p=0|Kt(0|i[(e=s)>>2],0|i[e+4>>2],0|i[p>>2],0|i[p+4>>2]),e=0|S(),i[(y=s)>>2]=p,i[y+4>>2]=e,St(a),r=0|i[(y=a)>>2],u=0|i[y+4>>2]}while(!(!(0|r)&!(0|u)));r=0|i[d>>2]}}while(0);return D=A,0|(y=r)},_memcpy:hr,_memset:dr,_originToDirectedEdges:function(e,t,r){r|=0;var n,o=0;return n=!(0|je(e|=0,t|=0)),t&=-2130706433,i[(o=r)>>2]=n?e:0,i[o+4>>2]=n?285212672|t:0,i[(o=r+8|0)>>2]=e,i[o+4>>2]=301989888|t,i[(o=r+16|0)>>2]=e,i[o+4>>2]=318767104|t,i[(o=r+24|0)>>2]=e,i[o+4>>2]=335544320|t,i[(o=r+32|0)>>2]=e,i[o+4>>2]=352321536|t,i[(r=r+40|0)>>2]=e,i[r+4>>2]=369098752|t,0},_pentagonCount:function(){return 12},_polygonToCells:function(e,t,r,n){e|=0,t|=0,n|=0;var o,s,a,A,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0,y=0,b=0,v=0,_=0,x=0,w=0,T=0,E=0,M=0,N=0,C=0,R=0,P=0,B=0,q=0,k=0,I=0,U=0;if(A=D,D=D+112|0,o=A+80|0,d=A+72|0,s=A,a=A+56|0,0|(l=0|Ct(r|=0)))return D=A,0|(U=l);if(!(U=0|$t(32+(i[(p=e+8|0)>>2]<<5)|0)))return D=A,0|(U=13);if(Rt(e,U),!(l=0|Ct(r))){if(I=0|i[(k=e)+4>>2],i[(l=d)>>2]=i[k>>2],i[l+4>>2]=I,Nt(d,o),l=0|ee(o,t,s))k=0,I=0;else{if(l=0|i[d>>2],(0|(u=0|i[p>>2]))>0){c=0|i[e+12>>2],r=0;do{l=(0|i[c+(r<<3)>>2])+l|0,r=r+1|0}while((0|r)!=(0|u));r=l}else r=l;u=0|i[(l=s)>>2],(0|(l=0|i[l+4>>2]))<(0|(c=((0|r)<0)<<31>>31))|(0|l)==(0|c)&u>>>0<r>>>0?(i[(l=s)>>2]=r,i[l+4>>2]=c,l=c):r=u,k=0|Kt(0|r,0|l,12,0),I=0|S(),i[(l=s)>>2]=k,i[l+4>>2]=I,l=0}if(!l){if(!(r=0|Xt(k,8)))return Yt(U),D=A,0|(U=13);if(!(h=0|Xt(k,8)))return Yt(U),Yt(r),D=A,0|(U=13);i[(B=o)>>2]=0,i[B+4>>2]=0,q=0|i[(B=e)+4>>2],i[(l=d)>>2]=i[B>>2],i[l+4>>2]=q,l=0|F(d,k,I,t,o,r,h);e:do{if(l)Yt(r),Yt(h),Yt(U);else{t:do{if((0|i[p>>2])>0){for(c=e+12|0,u=0;l=0|F((0|i[c>>2])+(u<<3)|0,k,I,t,o,r,h),u=u+1|0,!(0|l);)if((0|u)>=(0|i[p>>2]))break t;Yt(r),Yt(h),Yt(U);break e}}while(0);(0|I)>0|!(0|I)&k>>>0>0&&dr(0|h,0,k<<3),B=0|i[(q=o)+4>>2];t:do{if((0|B)>0|!(0|B)&(0|i[q>>2])>>>0>0){C=r,R=h,P=r,B=h,q=r,l=r,E=r,M=h,N=h,r=h;r:for(;;){for(_=0,x=0,w=0,T=0,u=0,c=0;;){d=(h=s)+56|0;do{i[h>>2]=0,h=h+4|0}while((0|h)<(0|d));if(0|O(p=0|i[(t=C+(_<<3)|0)>>2],t=0|i[t+4>>2],1,s,0)){d=(h=s)+56|0;do{i[h>>2]=0,h=h+4|0}while((0|h)<(0|d));0|(h=0|Xt(7,4))&&(L(p,t,1,s,h,7,0,0),Yt(h))}for(v=0;;){y=0|i[(b=s+(v<<3)|0)>>2],b=0|i[b+4>>2];n:do{if(!(0|y)&!(0|b))h=u,d=c;else{if(f=0|ir(0|y,0|b,0|k,0|I),p=0|S(),!(!(0|(d=0|i[(t=h=n+(f<<3)|0)>>2]))&!(0|(t=0|i[t+4>>2])))){m=0,g=0;do{if((0|m)>(0|I)|(0|m)==(0|I)&g>>>0>k>>>0)break r;if((0|d)==(0|y)&(0|t)==(0|b)){h=u,d=c;break n}f=0|nr(0|(h=0|Kt(0|f,0|p,1,0)),0|S(),0|k,0|I),p=0|S(),g=0|Kt(0|g,0|m,1,0),m=0|S(),d=0|i[(t=h=n+(f<<3)|0)>>2],t=0|i[t+4>>2]}while(!(!(0|d)&!(0|t)))}if(!(0|y)&!(0|b)){h=u,d=c;break}tt(y,b,a),0|Pt(e,U,a)&&(g=0|Kt(0|u,0|c,1,0),c=0|S(),i[(m=h)>>2]=y,i[m+4>>2]=b,i[(u=R+(u<<3)|0)>>2]=y,i[u+4>>2]=b,u=g),h=u,d=c}}while(0);if((v=v+1|0)>>>0>=7)break;u=h,c=d}if(_=0|Kt(0|_,0|x,1,0),x=0|S(),w=0|Kt(0|w,0|T,1,0),T=0|S(),u=0|i[(c=o)>>2],!((0|T)<(0|(c=0|i[c+4>>2]))|(0|T)==(0|c)&w>>>0<u>>>0))break;u=h,c=d}if((0|c)>0|!(0|c)&u>>>0>0){u=0,c=0;do{i[(T=C+(u<<3)|0)>>2]=0,i[T+4>>2]=0,u=0|Kt(0|u,0|c,1,0),c=0|S(),w=0|i[(T=o)+4>>2]}while((0|c)<(0|w)|((0|c)==(0|w)?u>>>0<(0|i[T>>2])>>>0:0))}if(i[(T=o)>>2]=h,i[T+4>>2]=d,!((0|d)>0|!(0|d)&h>>>0>0))break t;v=r,_=N,x=q,w=M,T=R,r=E,N=l,M=P,E=v,l=_,q=B,B=x,P=w,R=C,C=T}Yt(P),Yt(B),Yt(U),l=1;break e}l=h}while(0);Yt(U),Yt(r),Yt(l),l=0}}while(0);return D=A,0|(U=l)}}return Yt(U),D=A,0|(U=l)},_polygonToCellsExperimental:function(e,t,r,n,o,s){n|=0,o|=0,s|=0;var a,A,l,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=0;l=D,D=D+160|0,c=l+64|0,p=l+112|0,g=l,Tt(d=l+80|0,e|=0,t|=0,r|=0),it(c,0|i[(h=d)>>2],0|i[h+4>>2],t),a=0|i[(h=c)>>2],h=0|i[h+4>>2],u=0|i[d+8>>2],i[(f=p+4|0)>>2]=i[d>>2],i[f+4>>2]=i[d+4>>2],i[f+8>>2]=i[d+8>>2],i[f+12>>2]=i[d+12>>2],i[f+16>>2]=i[d+16>>2],i[f+20>>2]=i[d+20>>2],i[f+24>>2]=i[d+24>>2],i[f+28>>2]=i[d+28>>2],i[(f=g)>>2]=a,i[f+4>>2]=h,i[(f=g+8|0)>>2]=u,t=p,r=(e=g+12|0)+36|0;do{i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0}while((0|e)<(0|r));if(i[(p=g+48|0)>>2]=i[c>>2],i[p+4>>2]=i[c+4>>2],i[p+8>>2]=i[c+8>>2],i[p+12>>2]=i[c+12>>2],!(0|a)&!(0|h))return D=l,0|(g=u);r=g+16|0,A=g+24|0,d=g+28|0,u=0,c=0,t=a,e=h;do{if(!((0|u)<(0|o)|(0|u)==(0|o)&c>>>0<n>>>0)){m=4;break}if(h=c,c=0|Kt(0|c,0|u,1,0),u=0|S(),i[(h=s+(h<<3)|0)>>2]=t,i[h+4>>2]=e,st(p),!(0|(t=0|i[(e=p)>>2]))&!(0|(e=0|i[e+4>>2]))){if(St(r),!(0|(e=0|i[(t=r)>>2]))&!(0|(t=0|i[t+4>>2]))){m=10;break}ot(e,t,0|i[d>>2],p),t=0|i[(e=p)>>2],e=0|i[e+4>>2]}i[(h=g)>>2]=t,i[h+4>>2]=e}while(!(!(0|t)&!(0|e)));return 4==(0|m)?(0|(t=0|i[(e=g+40|0)>>2])&&Yt(t),i[(m=g+16|0)>>2]=0,i[m+4>>2]=0,i[A>>2]=0,i[g+36>>2]=0,i[d>>2]=-1,i[g+32>>2]=0,i[e>>2]=0,ot(0,0,0,p),i[g>>2]=0,i[g+4>>2]=0,i[f>>2]=0,D=l,0|(g=14)):(10==(0|m)&&(i[g>>2]=0,i[g+4>>2]=0,i[f>>2]=i[A>>2]),g=0|i[f>>2],D=l,0|g)},_readInt64AsDoubleFromPointer:function(e){return+(+((0|i[(e|=0)>>2])>>>0)+4294967296*+(0|i[e+4>>2]))},_res0CellCount:function(){return 122},_round:pr,_sbrk:fr,_sizeOfCellBoundary:function(){return 168},_sizeOfCoordIJ:function(){return 8},_sizeOfGeoLoop:function(){return 8},_sizeOfGeoPolygon:function(){return 16},_sizeOfH3Index:function(){return 8},_sizeOfLatLng:function(){return 16},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompactCells:function(e,t,r,n,o,s,a){e|=0,n|=0,o|=0,s|=0;var A,l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0;if(A=D,D=D+16|0,m=A,!((0|(r|=0))>0|!(0|r)&(t|=0)>>>0>0))return D=A,0|(m=0);if((0|(a|=0))>=16)return D=A,0|(m=12);p=0,f=0,d=0,l=0;e:for(;;){if(h=0|sr(0|(u=0|i[(c=e+(p<<3)|0)>>2]),0|(c=0|i[c+4>>2]),52),S(),(15&h)>(0|a)){l=12,u=11;break}if(it(m,u,c,a),!(0|(c=0|i[(h=m)>>2]))&!(0|(h=0|i[h+4>>2])))u=d;else{u=d;do{if(!((0|l)<(0|s)|(0|l)==(0|s)&u>>>0<o>>>0)){u=10;break e}i[(d=n+(u<<3)|0)>>2]=c,i[d+4>>2]=h,u=0|Kt(0|u,0|l,1,0),l=0|S(),st(m),c=0|i[(d=m)>>2],h=0|i[d+4>>2]}while(!(!(0|c)&!(0|h)))}if(p=0|Kt(0|p,0|f,1,0),!((0|(f=0|S()))<(0|r)|(0|f)==(0|r)&p>>>0<t>>>0)){l=0,u=11;break}d=u}return 10==(0|u)?(D=A,0|(m=14)):11==(0|u)?(D=A,0|l):0},_uncompactCellsSize:function(e,t,r,n,o){e|=0,t|=0,r|=0,n|=0,o|=0;var s,a,A=0,l=0,u=0,c=0,h=0,d=0;a=D,D=D+16|0,s=a;e:do{if((0|r)>0|!(0|r)&t>>>0>0){for(h=0,l=0,A=0,d=0;;){if(!(!(0|(u=0|i[(c=e+(h<<3)|0)>>2]))&!(0|(c=0|i[c+4>>2]))||(c=!(0|Ge(u,c,n,s)),l=0|Kt(0|i[(u=s)>>2],0|i[u+4>>2],0|l,0|A),A=0|S(),c))){A=12;break}if(h=0|Kt(0|h,0|d,1,0),!((0|(d=0|S()))<(0|r)|(0|d)==(0|r)&h>>>0<t>>>0))break e}return D=a,0|A}l=0,A=0}while(0);return i[o>>2]=l,i[o+4>>2]=A,D=a,0|(o=0)},_vertexToLatLng:function(e,t,r){r|=0;var n,o,s,a,A=0,l=0;return a=D,D=D+192|0,o=a,s=a+168|0,A=0|sr(0|(e|=0),0|(t|=0),56),S(),A&=7,0|(n=0|et(e,l=-2130706433&t|134217728,s))?(D=a,0|(l=n)):(t=0|sr(0|e,0|t,52),S(),t&=15,0|je(e,l)?De(s,t,A,1,o):Le(s,t,A,1,o),l=o+8|0,i[r>>2]=i[l>>2],i[r+4>>2]=i[l+4>>2],i[r+8>>2]=i[l+8>>2],i[r+12>>2]=i[l+12>>2],D=a,0|(l=0))},establishStackSpace:function(e,t){D=e|=0},stackAlloc:function(e){var t;return t=D,D=(D=D+(e|=0)|0)+15&-16,0|t},stackRestore:function(e){D=e|=0},stackSave:function(){return 0|D}}}({Math:Math,Int8Array:Int8Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Float32Array:Float32Array,Float64Array:Float64Array},{b:function(e){A=e},c:function(){return A},d:function(e,t,r,n){ne("Assertion failed: "+v(e)+", at: "+[t?v(t):"unknown filename",r,n?v(n):"unknown function"])},e:function(e){return r.___errno_location&&(m[r.___errno_location()>>2]=e),e},f:G,g:function(e,t,r){p.set(p.subarray(t,t+r),e)},h:function(e){var t=G(),r=16777216,n=2130706432;if(e>n)return!1;for(var i=Math.max(t,16777216);i<e;)i=i<=536870912?_(2*i,r):Math.min(_((3*i+2147483648)/4,r),n);return!!function(e){try{var t=new ArrayBuffer(e);if(t.byteLength!=e)return;return new Int8Array(t).set(d),W(t),x(t),1}catch(tH){}}(i)},i:function(e){ne("OOM")},o:28624,p:28608},h);r.___divdi3=H.___divdi3,r.___muldi3=H.___muldi3,r.___remdi3=H.___remdi3,r.___uremdi3=H.___uremdi3,r._areNeighborCells=H._areNeighborCells,r._bitshift64Ashr=H._bitshift64Ashr,r._bitshift64Lshr=H._bitshift64Lshr,r._bitshift64Shl=H._bitshift64Shl,r._calloc=H._calloc,r._cellAreaKm2=H._cellAreaKm2,r._cellAreaM2=H._cellAreaM2,r._cellAreaRads2=H._cellAreaRads2,r._cellToBoundary=H._cellToBoundary,r._cellToCenterChild=H._cellToCenterChild,r._cellToChildPos=H._cellToChildPos,r._cellToChildren=H._cellToChildren,r._cellToChildrenSize=H._cellToChildrenSize,r._cellToLatLng=H._cellToLatLng,r._cellToLocalIj=H._cellToLocalIj,r._cellToParent=H._cellToParent,r._cellToVertex=H._cellToVertex,r._cellToVertexes=H._cellToVertexes,r._cellsToDirectedEdge=H._cellsToDirectedEdge,r._cellsToLinkedMultiPolygon=H._cellsToLinkedMultiPolygon,r._childPosToCell=H._childPosToCell,r._compactCells=H._compactCells,r._destroyLinkedMultiPolygon=H._destroyLinkedMultiPolygon,r._directedEdgeToBoundary=H._directedEdgeToBoundary,r._directedEdgeToCells=H._directedEdgeToCells,r._edgeLengthKm=H._edgeLengthKm,r._edgeLengthM=H._edgeLengthM,r._edgeLengthRads=H._edgeLengthRads;var W=r._emscripten_replace_memory=H._emscripten_replace_memory;r._free=H._free,r._getBaseCellNumber=H._getBaseCellNumber,r._getDirectedEdgeDestination=H._getDirectedEdgeDestination,r._getDirectedEdgeOrigin=H._getDirectedEdgeOrigin,r._getHexagonAreaAvgKm2=H._getHexagonAreaAvgKm2,r._getHexagonAreaAvgM2=H._getHexagonAreaAvgM2,r._getHexagonEdgeLengthAvgKm=H._getHexagonEdgeLengthAvgKm,r._getHexagonEdgeLengthAvgM=H._getHexagonEdgeLengthAvgM,r._getIcosahedronFaces=H._getIcosahedronFaces,r._getNumCells=H._getNumCells,r._getPentagons=H._getPentagons,r._getRes0Cells=H._getRes0Cells,r._getResolution=H._getResolution,r._greatCircleDistanceKm=H._greatCircleDistanceKm,r._greatCircleDistanceM=H._greatCircleDistanceM,r._greatCircleDistanceRads=H._greatCircleDistanceRads,r._gridDisk=H._gridDisk,r._gridDiskDistances=H._gridDiskDistances,r._gridDistance=H._gridDistance,r._gridPathCells=H._gridPathCells,r._gridPathCellsSize=H._gridPathCellsSize,r._gridRingUnsafe=H._gridRingUnsafe,r._i64Add=H._i64Add,r._i64Subtract=H._i64Subtract,r._isPentagon=H._isPentagon,r._isResClassIII=H._isResClassIII,r._isValidCell=H._isValidCell,r._isValidDirectedEdge=H._isValidDirectedEdge,r._isValidVertex=H._isValidVertex,r._latLngToCell=H._latLngToCell,r._llvm_ctlz_i64=H._llvm_ctlz_i64,r._llvm_maxnum_f64=H._llvm_maxnum_f64,r._llvm_minnum_f64=H._llvm_minnum_f64,r._llvm_round_f64=H._llvm_round_f64,r._localIjToCell=H._localIjToCell,r._malloc=H._malloc,r._maxFaceCount=H._maxFaceCount,r._maxGridDiskSize=H._maxGridDiskSize,r._maxPolygonToCellsSize=H._maxPolygonToCellsSize,r._maxPolygonToCellsSizeExperimental=H._maxPolygonToCellsSizeExperimental,r._memcpy=H._memcpy,r._memset=H._memset,r._originToDirectedEdges=H._originToDirectedEdges,r._pentagonCount=H._pentagonCount,r._polygonToCells=H._polygonToCells,r._polygonToCellsExperimental=H._polygonToCellsExperimental,r._readInt64AsDoubleFromPointer=H._readInt64AsDoubleFromPointer,r._res0CellCount=H._res0CellCount,r._round=H._round,r._sbrk=H._sbrk,r._sizeOfCellBoundary=H._sizeOfCellBoundary,r._sizeOfCoordIJ=H._sizeOfCoordIJ,r._sizeOfGeoLoop=H._sizeOfGeoLoop,r._sizeOfGeoPolygon=H._sizeOfGeoPolygon,r._sizeOfH3Index=H._sizeOfH3Index,r._sizeOfLatLng=H._sizeOfLatLng,r._sizeOfLinkedGeoPolygon=H._sizeOfLinkedGeoPolygon,r._uncompactCells=H._uncompactCells,r._uncompactCellsSize=H._uncompactCellsSize,r._vertexToLatLng=H._vertexToLatLng,r.establishStackSpace=H.establishStackSpace;var Q,$,Y=r.stackAlloc=H.stackAlloc,X=r.stackRestore=H.stackRestore,K=r.stackSave=H.stackSave;if(r.asm=H,r.cwrap=function(e,t,r,n){var i=(r=r||[]).every(function(e){return"number"===e});return"string"!==t&&i&&!n?u(e):function(){return c(e,t,r,arguments)}},r.setValue=function(e,t,r,n){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":d[e|0]=t;break;case"i16":f[e>>1]=t;break;case"i32":m[e>>2]=t;break;case"i64":I=[t>>>0,(k=t,+P(k)>=1?k>0?(0|q(+B(k/4294967296),4294967295))>>>0:~~+D((k-+(~~k>>>0))/4294967296)>>>0:0)],m[e>>2]=I[0],m[e+4>>2]=I[1];break;case"float":g[e>>2]=t;break;case"double":y[e>>3]=t;break;default:ne("invalid type for setValue: "+r)}},r.getValue=function(e,t,r){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return d[e|0];case"i16":return f[e>>1];case"i32":case"i64":return m[e>>2];case"float":return g[e>>2];case"double":return y[e>>3];default:ne("invalid type for getValue: "+t)}return null},F){V(F)||(Q=F,F=r.locateFile?r.locateFile(Q,o):o+Q),O++,r.monitorRunDependencies&&r.monitorRunDependencies(O);var Z=function(e){e.byteLength&&(e=new Uint8Array(e)),p.set(e,8),r.memoryInitializerRequest&&delete r.memoryInitializerRequest.response,function(){if(O--,r.monitorRunDependencies&&r.monitorRunDependencies(O),0==O&&L){var e=L;L=null,e()}}()},J=function(){i(F,Z,function(){throw"could not load memory initializer "+F})},ee=z(F);if(ee)Z(ee.buffer);else if(r.memoryInitializerRequest){var te=function(){var e=r.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var n=z(r.memoryInitializerRequestURL);if(!n)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+F),void J();t=n.buffer}Z(t)};r.memoryInitializerRequest.response?setTimeout(te,0):r.memoryInitializerRequest.addEventListener("load",te)}else J()}function re(e){function t(){$||($=!0,l||(T(E),T(M),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)R(r.postRun.shift());T(N)}()))}O>0||(!function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)C(r.preRun.shift());T(S)}(),O>0||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),t()},1)):t()))}function ne(e){throw r.onAbort&&r.onAbort(e),s(e+=""),a(e),l=!0,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}if(L=function e(){$||re(),$||(L=e)},r.run=re,r.abort=ne,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return re(),e}("object"==typeof Od?Od:{}),Ld="number",kd={0:"Success",1:"The operation failed but a more specific error is not available",2:"Argument was outside of acceptable range",3:"Latitude or longitude arguments were outside of acceptable range",4:"Resolution argument was outside of acceptable range",5:"Cell argument was not valid",6:"Directed edge argument was not valid",7:"Undirected edge argument was not valid",8:"Vertex argument was not valid",9:"Pentagon distortion was encountered",10:"Duplicate input",11:"Cell arguments were not neighbors",12:"Cell arguments had incompatible resolutions",13:"Memory allocation failed",14:"Bounds of provided memory were insufficient",15:"Mode or flags argument was not valid"},Id={1e3:"Unknown unit",1001:"Array length out of bounds",1002:"Got unexpected null value for H3 index"};function Fd(e,t,r){var n=r&&"value"in r,i=new Error((e[t]||"Unknown error")+" (code: "+t+(n?", value: "+r.value:"")+")");return i.code=t,i}function Ud(e,t){return Fd(kd,e,2===arguments.length?{value:t}:{})}function Vd(e,t){return Fd(Id,e,2===arguments.length?{value:t}:{})}function Gd(e){if(0!==e)throw Ud(e)}var jd={};[["sizeOfH3Index",Ld],["sizeOfLatLng",Ld],["sizeOfCellBoundary",Ld],["sizeOfGeoLoop",Ld],["sizeOfGeoPolygon",Ld],["sizeOfLinkedGeoPolygon",Ld],["sizeOfCoordIJ",Ld],["readInt64AsDoubleFromPointer",Ld],["isValidCell",Ld,[Ld,Ld]],["latLngToCell",Ld,[Ld,Ld,Ld,Ld]],["cellToLatLng",Ld,[Ld,Ld,Ld]],["cellToBoundary",Ld,[Ld,Ld,Ld]],["maxGridDiskSize",Ld,[Ld,Ld]],["gridDisk",Ld,[Ld,Ld,Ld,Ld]],["gridDiskDistances",Ld,[Ld,Ld,Ld,Ld,Ld]],["gridRingUnsafe",Ld,[Ld,Ld,Ld,Ld]],["maxPolygonToCellsSize",Ld,[Ld,Ld,Ld,Ld]],["polygonToCells",Ld,[Ld,Ld,Ld,Ld]],["maxPolygonToCellsSizeExperimental",Ld,[Ld,Ld,Ld,Ld]],["polygonToCellsExperimental",Ld,[Ld,Ld,Ld,Ld,Ld,Ld]],["cellsToLinkedMultiPolygon",Ld,[Ld,Ld,Ld]],["destroyLinkedMultiPolygon",null,[Ld]],["compactCells",Ld,[Ld,Ld,Ld,Ld]],["uncompactCells",Ld,[Ld,Ld,Ld,Ld,Ld,Ld]],["uncompactCellsSize",Ld,[Ld,Ld,Ld,Ld,Ld]],["isPentagon",Ld,[Ld,Ld]],["isResClassIII",Ld,[Ld,Ld]],["getBaseCellNumber",Ld,[Ld,Ld]],["getResolution",Ld,[Ld,Ld]],["maxFaceCount",Ld,[Ld,Ld,Ld]],["getIcosahedronFaces",Ld,[Ld,Ld,Ld]],["cellToParent",Ld,[Ld,Ld,Ld,Ld]],["cellToChildren",Ld,[Ld,Ld,Ld,Ld]],["cellToCenterChild",Ld,[Ld,Ld,Ld,Ld]],["cellToChildrenSize",Ld,[Ld,Ld,Ld,Ld]],["cellToChildPos",Ld,[Ld,Ld,Ld,Ld]],["childPosToCell",Ld,[Ld,Ld,Ld,Ld,Ld,Ld]],["areNeighborCells",Ld,[Ld,Ld,Ld,Ld,Ld]],["cellsToDirectedEdge",Ld,[Ld,Ld,Ld,Ld,Ld]],["getDirectedEdgeOrigin",Ld,[Ld,Ld,Ld]],["getDirectedEdgeDestination",Ld,[Ld,Ld,Ld]],["isValidDirectedEdge",Ld,[Ld,Ld]],["directedEdgeToCells",Ld,[Ld,Ld,Ld]],["originToDirectedEdges",Ld,[Ld,Ld,Ld]],["directedEdgeToBoundary",Ld,[Ld,Ld,Ld]],["gridDistance",Ld,[Ld,Ld,Ld,Ld,Ld]],["gridPathCells",Ld,[Ld,Ld,Ld,Ld,Ld]],["gridPathCellsSize",Ld,[Ld,Ld,Ld,Ld,Ld]],["cellToLocalIj",Ld,[Ld,Ld,Ld,Ld,Ld,Ld]],["localIjToCell",Ld,[Ld,Ld,Ld,Ld,Ld]],["getHexagonAreaAvgM2",Ld,[Ld,Ld]],["getHexagonAreaAvgKm2",Ld,[Ld,Ld]],["getHexagonEdgeLengthAvgM",Ld,[Ld,Ld]],["getHexagonEdgeLengthAvgKm",Ld,[Ld,Ld]],["greatCircleDistanceM",Ld,[Ld,Ld]],["greatCircleDistanceKm",Ld,[Ld,Ld]],["greatCircleDistanceRads",Ld,[Ld,Ld]],["cellAreaM2",Ld,[Ld,Ld,Ld]],["cellAreaKm2",Ld,[Ld,Ld,Ld]],["cellAreaRads2",Ld,[Ld,Ld,Ld]],["edgeLengthM",Ld,[Ld,Ld,Ld]],["edgeLengthKm",Ld,[Ld,Ld,Ld]],["edgeLengthRads",Ld,[Ld,Ld,Ld]],["getNumCells",Ld,[Ld,Ld]],["getRes0Cells",Ld,[Ld]],["res0CellCount",Ld],["getPentagons",Ld,[Ld,Ld]],["pentagonCount",Ld],["cellToVertex",Ld,[Ld,Ld,Ld,Ld]],["cellToVertexes",Ld,[Ld,Ld,Ld]],["vertexToLatLng",Ld,[Ld,Ld,Ld]],["isValidVertex",Ld,[Ld,Ld]]].forEach(function(e){jd[e[0]]=Od.cwrap.apply(Od,e)});var zd=16,Hd=jd.sizeOfH3Index(),Wd=jd.sizeOfLatLng(),Qd=jd.sizeOfCellBoundary(),$d=jd.sizeOfGeoPolygon(),Yd=jd.sizeOfGeoLoop();jd.sizeOfLinkedGeoPolygon(),jd.sizeOfCoordIJ();var Xd=Math.pow(2,32)-1;var Kd=/[^0-9a-fA-F]/;function Zd(e){if(Array.isArray(e)&&2===e.length&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if("string"!=typeof e||Kd.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),zd);return[parseInt(e.substring(e.length-8),zd),t]}function Jd(e){if(e>=0)return e.toString(zd);var t=ep(8,(e&=2147483647).toString(zd));return t=(parseInt(t[0],zd)+8).toString(zd)+t.substring(1)}function ep(e,t){for(var r=e-t.length,n="",i=0;i<r;i++)n+="0";return n+=t}function tp(e,t,r){for(var n=e.length,i=Od._calloc(n,Wd),o=r?1:0,s=r?0:1,a=0;a<2*n;a+=2)Od.HEAPF64.set([e[a/2][o],e[a/2][s]].map(lp),i/8+a);return Od.HEAPU32.set([n,i],t/4),t}function rp(e,t){void 0===t&&(t=0);var r=Od.getValue(e+Hd*t,"i32"),n=Od.getValue(e+Hd*t+4,"i32");return n?function(e,t){return Jd(t)+ep(8,Jd(e))}(r,n):null}function np(e){return 180*Od.getValue(e,"double")/Math.PI}function ip(e){return[np(e+8),np(e)]}function op(e,t,r){var n=Od._malloc(Wd);Od.HEAPF64.set([e,t].map(lp),n/8);var i=Od._malloc(Hd);try{return Gd(jd.latLngToCell(n,r,i)),function(e){if(!e)throw Vd(1002);return e}(rp(i))}finally{Od._free(i),Od._free(n)}}function sp(e){var t,r=Od._malloc(Wd),n=Zd(e),i=n[0],o=n[1];try{return Gd(jd.cellToLatLng(i,o,r)),[np(t=r),np(t+8)]}finally{Od._free(r)}}function ap(e,t){var r=Od._malloc(Qd),n=Zd(e),i=n[0],o=n[1];try{return Gd(jd.cellToBoundary(i,o,r)),function(e){for(var t=Od.getValue(e,"i32"),r=e+8,n=[],i=ip,o=0;o<2*t;o+=2)n.push(i(r+8*o));return n.push(n[0]),n}(r)}finally{Od._free(r)}}function Ap(e,t,r){if(function(e){if("number"!=typeof e||e<0||e>15||Math.floor(e)!==e)throw Ud(4,e)}(t),r=Boolean(r),0===e.length||0===e[0].length)return[];var n,i=function(e,t){var r,n=e.length-1,i=Od._calloc($d),o=0+Yd,s=o+4;if(tp(e[0],i+0,t),n>0){r=Od._calloc(n,Yd);for(var a=0;a<n;a++)tp(e[a+1],r+Yd*a,t)}return Od.setValue(i+o,n,"i32"),Od.setValue(i+s,r,"i32"),i}("number"==typeof e[0][0]?[e]:e,r),o=Od._malloc(8);try{Gd(jd.maxPolygonToCellsSize(i,t,0,o));var s=function(e){if(e>Xd)throw Vd(1001,e);return e}((n=o,jd.readInt64AsDoubleFromPointer(n))),a=Od._calloc(s,Hd);try{return Gd(jd.polygonToCells(i,t,0,a)),function(e,t){for(var r=[],n=0;n<t;n++){var i=rp(e,n);null!==i&&r.push(i)}return r}(a,s)}finally{Od._free(a)}}finally{Od._free(o),function(e){var t=0+Yd,r=t+4;Od._free(Od.getValue(e+0+4,"i8*"));var n=Od.getValue(e+t,"i32");if(n>0){for(var i=Od.getValue(e+r,"i32"),o=0;o<n;o++)Od._free(Od.getValue(i+Yd*o+4,"i8*"));Od._free(i)}Od._free(e)}(i)}}function lp(e){return e*Math.PI/180}
/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const up=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class cp{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=!0===e.object.isSkinnedMesh,this.refreshUniforms=up,this.renderId=0}firstInitialization(e){return!1===this.renderObjects.has(e)&&(this.getRenderObjectData(e),!0)}needsVelocity(e){const t=e.getMRT();return null!==t&&t.has("velocity")}getRenderObjectData(e){let t=this.renderObjects.get(e);if(void 0===t){const{geometry:r,material:n,object:i}=e;if(t={material:this.getMaterialData(n),geometry:{id:r.id,attributes:this.getAttributesData(r.attributes),indexVersion:r.index?r.index.version:null,drawRange:{start:r.drawRange.start,count:r.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),null!==e.bundle&&(t.version=e.bundle.version),t.material.transmission>0){const{width:r,height:n}=e.context;t.bufferWidth=r,t.bufferHeight=n}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const r in e){const n=e[r];t[r]={version:n.version}}return t}containsNode(e){const t=e.material;for(const r in t)if(t[r]&&t[r].isNode)return!0;return null!==e.renderer.overrideNodes.modelViewMatrix||null!==e.renderer.overrideNodes.modelNormalViewMatrix}getMaterialData(e){const t={};for(const r of this.refreshUniforms){const n=e[r];null!=n&&("object"==typeof n&&void 0!==n.clone?!0===n.isTexture?t[r]={id:n.id,version:n.version}:t[r]=n.clone():t[r]=n)}return t}equals(e){const{object:t,material:r,geometry:n}=e,i=this.getRenderObjectData(e);if(!0!==i.worldMatrix.equals(t.matrixWorld))return i.worldMatrix.copy(t.matrixWorld),!1;const o=i.material;for(const p in o){const e=o[p],t=r[p];if(void 0!==e.equals){if(!1===e.equals(t))return e.copy(t),!1}else if(!0===t.isTexture){if(e.id!==t.id||e.version!==t.version)return e.id=t.id,e.version=t.version,!1}else if(e!==t)return o[p]=t,!1}if(o.transmission>0){const{width:t,height:r}=e.context;if(i.bufferWidth!==t||i.bufferHeight!==r)return i.bufferWidth=t,i.bufferHeight=r,!1}const s=i.geometry,a=n.attributes,A=s.attributes,l=Object.keys(A),u=Object.keys(a);if(s.id!==n.id)return s.id=n.id,!1;if(l.length!==u.length)return i.geometry.attributes=this.getAttributesData(a),!1;for(const p of l){const e=A[p],t=a[p];if(void 0===t)return delete A[p],!1;if(e.version!==t.version)return e.version=t.version,!1}const c=n.index,h=s.indexVersion,d=c?c.version:null;if(h!==d)return s.indexVersion=d,!1;if(s.drawRange.start!==n.drawRange.start||s.drawRange.count!==n.drawRange.count)return s.drawRange.start=n.drawRange.start,s.drawRange.count=n.drawRange.count,!1;if(i.morphTargetInfluences){let e=!1;for(let r=0;r<i.morphTargetInfluences.length;r++)i.morphTargetInfluences[r]!==t.morphTargetInfluences[r]&&(e=!0);if(e)return!0}return i.center&&!1===i.center.equals(t.center)?(i.center.copy(t.center),!0):(null!==e.bundle&&(i.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e)||this.needsVelocity(t.renderer))return!0;const{renderId:r}=t;if(this.renderId!==r)return this.renderId=r,!0;const n=!0===e.object.static,i=null!==e.bundle&&!0===e.bundle.static&&this.getRenderObjectData(e).version===e.bundle.version;if(n||i)return!1;return!0!==this.equals(e)}}function hp(e,t=0){let r=3735928559^t,n=1103547991^t;if(e instanceof Array)for(let i,o=0;o<e.length;o++)i=e[o],r=Math.imul(r^i,2654435761),n=Math.imul(n^i,1597334677);else for(let i,o=0;o<e.length;o++)i=e.charCodeAt(o),r=Math.imul(r^i,2654435761),n=Math.imul(n^i,1597334677);return r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(r^r>>>13,3266489909),4294967296*(2097151&n)+(r>>>0)}const dp=e=>hp(e),pp=e=>hp(e),fp=(...e)=>hp(e);function mp(e,t=!1){const r=[];!0===e.isNode&&(r.push(e.id),e=e.getSelf());for(const{property:n,childNode:i}of gp(e))r.push(hp(n.slice(0,-4)),i.getCacheKey(t));return hp(r)}function*gp(e,t=!1){for(const r in e){if(!0===r.startsWith("_"))continue;const n=e[r];if(!0===Array.isArray(n))for(let e=0;e<n.length;e++){const i=n[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:r,index:e,childNode:i})}else if(n&&!0===n.isNode)yield{property:r,childNode:n};else if("object"==typeof n)for(const e in n){const i=n[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:r,index:e,childNode:i})}}}const yp=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),bp=new WeakMap;function vp(e){return yp.get(e)}function _p(e){if(/[iu]?vec\d/.test(e))return e.startsWith("ivec")?Int32Array:e.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(e))return Float32Array;if(/float/.test(e))return Float32Array;if(/uint/.test(e))return Uint32Array;if(/int/.test(e))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${e}`)}function xp(e){return/float|int|uint/.test(e)?1:/vec2/.test(e)?2:/vec3/.test(e)?3:/vec4/.test(e)||/mat2/.test(e)?4:/mat3/.test(e)?9:/mat4/.test(e)?16:void console.error("THREE.TSL: Unsupported type:",e)}function wp(e){return/float|int|uint/.test(e)?1:/vec2/.test(e)?2:/vec3/.test(e)?3:/vec4/.test(e)||/mat2/.test(e)?4:/mat3/.test(e)?12:/mat4/.test(e)?16:void console.error("THREE.TSL: Unsupported type:",e)}function Tp(e){return/float|int|uint/.test(e)?4:/vec2/.test(e)?8:/vec3/.test(e)||/vec4/.test(e)?16:/mat2/.test(e)?8:/mat3/.test(e)?48:/mat4/.test(e)?64:void console.error("THREE.TSL: Unsupported type:",e)}function Sp(e){if(null==e)return null;const t=typeof e;return!0===e.isNode?"node":"number"===t?"float":"boolean"===t?"bool":"string"===t?"string":"function"===t?"shader":!0===e.isVector2?"vec2":!0===e.isVector3?"vec3":!0===e.isVector4?"vec4":!0===e.isMatrix2?"mat2":!0===e.isMatrix3?"mat3":!0===e.isMatrix4?"mat4":!0===e.isColor?"color":e instanceof ArrayBuffer?"ArrayBuffer":null}function Ep(e,...t){const r=e?e.slice(-4):void 0;return 1===t.length&&("vec2"===r?t=[t[0],t[0]]:"vec3"===r?t=[t[0],t[0],t[0]]:"vec4"===r&&(t=[t[0],t[0],t[0],t[0]])),"color"===e?new te(...t):"vec2"===r?new n(...t):"vec3"===r?new o(...t):"vec4"===r?new M(...t):"mat2"===r?new en(...t):"mat3"===r?new Te(...t):"mat4"===r?new i(...t):"bool"===e?t[0]||!1:"float"===e||"int"===e||"uint"===e?t[0]||0:"string"===e?t[0]||"":"ArrayBuffer"===e?Cp(t[0]):null}function Mp(e){let t=bp.get(e);return void 0===t&&(t={},bp.set(e,t)),t}function Np(e){let t="";const r=new Uint8Array(e);for(let n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function Cp(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}const Rp={VERTEX:"vertex",FRAGMENT:"fragment"},Pp={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Dp={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},Bp=["fragment","vertex"],qp=["setup","analyze","generate"],Op=[...Bp,"compute"],Lp=["x","y","z","w"],kp={analyze:"setup",generate:"analyze"};let Ip=0;class Fp extends re{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Pp.NONE,this.updateBeforeType=Pp.NONE,this.updateAfterType=Pp.NONE,this.uuid=Jr.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:Ip++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,Pp.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Pp.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Pp.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of gp(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return!0!==(e=e||this.version!==this._cacheKeyVersion)&&null!==this._cacheKey||(this._cacheKey=fp(mp(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let r=0;for(const n of this.getChildren())t["node"+r++]=n;return t.outputNode||null}analyze(e,t=null){const r=e.increaseUsage(this);if(!0===this.parents){const r=e.getDataFromNode(this,"any");r.stages=r.stages||{},r.stages[e.shaderStage]=r.stages[e.shaderStage]||[],r.stages[e.shaderStage].push(t)}if(1===r){const t=e.getNodeProperties(this);for(const r of Object.values(t))r&&!0===r.isNode&&r.build(e,this)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&!0===r.isNode)return r.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);const n=e.getDataFromNode(this);n.buildStages=n.buildStages||{},n.buildStages[e.buildStage]=!0;const i=kp[e.buildStage];if(i&&!0!==n.buildStages[i]){const t=e.getBuildStage();e.setBuildStage(i),this.build(e),e.setBuildStage(t)}e.addNode(this),e.addChain(this);let o=null;const s=e.getBuildStage();if("setup"===s){this.updateReference(e);const t=e.getNodeProperties(this);if(!0!==t.initialized){t.initialized=!0,t.outputNode=this.setup(e)||t.outputNode||null;for(const r of Object.values(t))if(r&&!0===r.isNode){if(!0===r.parents){const t=e.getNodeProperties(r);t.parents=t.parents||[],t.parents.push(this)}r.build(e)}}o=t.outputNode}else if("analyze"===s)this.analyze(e,t);else if("generate"===s){if(1===this.generate.length){const r=this.getNodeType(e),n=e.getDataFromNode(this);o=n.snippet,void 0===o?void 0===n.generated?(n.generated=!0,o=this.generate(e)||"",n.snippet=o):(console.warn("THREE.Node: Recursion detected.",this),o=""):void 0!==n.flowCodes&&void 0!==e.context.nodeBlock&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,r,t)}else o=this.generate(e,t)||""}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return gp(this)}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:n,index:i,childNode:o}of t)void 0!==i?(void 0===r[n]&&(r[n]=Number.isInteger(i)?[]:{}),r[n][i]=o.toJSON(e.meta).uuid):r[n]=o.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(void 0!==e.inputNodes){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const n=[];for(const i of e.inputNodes[r])n.push(t[i]);this[r]=n}else if("object"==typeof e.inputNodes[r]){const n={};for(const i in e.inputNodes[r]){const o=e.inputNodes[r][i];n[i]=t[o]}this[r]=n}else{const n=e.inputNodes[r];this[r]=t[n]}}}toJSON(e){const{uuid:t,type:r}=this,n=void 0===e||"string"==typeof e;n&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];function o(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}if(void 0===i&&(i={uuid:t,type:r,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},!0!==n&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta),n){const t=o(e.textures),r=o(e.images),n=o(e.nodes);t.length>0&&(i.textures=t),r.length>0&&(i.images=r),n.length>0&&(i.nodes=n)}return i}}class Up extends Fp{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e);return`${this.node.build(e)}[ ${this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint")} ]`}}class Vp extends Fp{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const n of this.convertTo.split("|"))null!==r&&e.getTypeLength(t)!==e.getTypeLength(n)||(r=n);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,n=this.getNodeType(e),i=r.build(e,n);return e.format(i,n,t)}}class Gp extends Fp{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if("generate"===e.getBuildStage()){const r=e.getVectorType(this.getNodeType(e,t)),n=e.getDataFromNode(this);if(void 0!==n.propertyName)return e.format(n.propertyName,r,t);if("void"!==r&&"void"!==t&&this.hasDependencies(e)){const i=super.build(e,r),o=e.getVarFromNode(this,null,r),s=e.getPropertyName(o);return e.addLineFlowCode(`${s} = ${i}`,this),n.snippet=i,n.propertyName=s,e.format(n.propertyName,r,t)}}return super.build(e,t)}}class jp extends Gp{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),n=e.getTypeLength(r),i=this.nodes,o=e.getComponentType(r),s=[];let a=0;for(const l of i){if(a>=n){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${r}()' type.`);break}let t,i=l.getNodeType(e),A=e.getTypeLength(i);a+A>n&&(console.error(`THREE.TSL: Length of '${r}()' data exceeds maximum length of output type.`),A=n-a,i=e.getTypeFromLength(A)),a+=A,t=l.build(e,i);const u=e.getComponentType(i);u!==o&&(t=e.format(t,u,o)),s.push(t)}const A=`${e.getType(r)}( ${s.join(", ")} )`;return e.format(A,r,t)}}const zp=Lp.join("");class Hp extends Fp{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Lp.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const r=this.node,n=e.getTypeLength(r.getNodeType(e));let i=null;if(n>1){let o=null;this.getVectorLength()>=n&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const s=r.build(e,o);i=this.components.length===n&&this.components===zp.slice(0,this.components.length)?e.format(s,o,t):e.format(`${s}.${this.components}`,this.getNodeType(e),t)}else i=r.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class Wp extends Gp{static get type(){return"SetNode"}constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:n}=this,i=this.getNodeType(e),o=e.getComponentType(n.getNodeType(e)),s=e.getTypeFromLength(r.length,o),a=n.build(e,s),A=t.build(e,i),l=e.getTypeLength(i),u=[];for(let c=0;c<l;c++){const e=Lp[c];e===r[0]?(u.push(a),c+=r.length-1):u.push(A+"."+e)}return`${e.getType(i)}( ${u.join(", ")} )`}}class Qp extends Gp{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:r}=this,n=this.getNodeType(e),i=r.build(e),o=e.getVarFromNode(this),s=e.getPropertyName(o);e.addLineFlowCode(s+" = "+i,this);const a=e.getTypeLength(n),A=[];let l=0;for(let u=0;u<a;u++){const e=Lp[u];e===t[l]?(A.push("1.0 - "+s+"."+e),l++):A.push(s+"."+e)}return`${e.getType(n)}( ${A.join(", ")} )`}}class $p extends Fp{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?Sp(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Sp(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=Np(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Ep(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const Yp=/float|u?int/;class Xp extends $p{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return Yp.test(r)&&Yp.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),r,t)}}class Kp extends Fp{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let Zp=null;const Jp=new Map;function ef(e,t){if(Jp.has(e))console.warn(`THREE.TSL: Redefinition of method chaining '${e}'.`);else{if("function"!=typeof t)throw new Error(`THREE.TSL: Node element ${e} is not a function`);Jp.set(e,t)}}const tf=e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),rf=e=>tf(e).split("").sort().join(""),nf={setup(e,t){const r=t.shift();return e(Cf(r),...t)},get(e,t,r){if("string"==typeof t&&void 0===e[t]){if(!0!==e.isStackNode&&"assign"===t)return(...e)=>(Zp.assign(r,...e),r);if(Jp.has(t)){const n=Jp.get(t);return e.isStackNode?(...e)=>r.add(n(...e)):(...e)=>n(r,...e)}if("self"===t)return e;if(t.endsWith("Assign")&&Jp.has(t.slice(0,t.length-6))){const n=Jp.get(t.slice(0,t.length-6));return e.isStackNode?(...e)=>r.assign(e[0],n(...e)):(...e)=>r.assign(n(r,...e))}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return t=tf(t),Nf(new Hp(r,t));if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(t))return t=rf(t.slice(3).toLowerCase()),r=>Nf(new Wp(e,t,Nf(r)));if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(t))return t=rf(t.slice(4).toLowerCase()),()=>Nf(new Qp(Nf(e),t));if("width"===t||"height"===t||"depth"===t)return"width"===t?t="x":"height"===t?t="y":"depth"===t&&(t="z"),Nf(new Hp(e,t));if(!0===/^\d+$/.test(t))return Nf(new Up(r,new Xp(Number(t),"uint")));if(!0===/^get$/.test(t))return e=>Nf(new Kp(r,e))}return Reflect.get(e,t,r)},set:(e,t,r,n)=>"string"!=typeof t||void 0!==e[t]||!0!==/^[xyzwrgbastpq]{1,4}$/.test(t)&&"width"!==t&&"height"!==t&&"depth"!==t&&!0!==/^\d+$/.test(t)?Reflect.set(e,t,r,n):(n[t].assign(r),!0)},of=new WeakMap,sf=new WeakMap,af=function(e,t=null){for(const r in e)e[r]=Nf(e[r],t);return e},Af=function(e,t=null){const r=e.length;for(let n=0;n<r;n++)e[n]=Nf(e[n],t);return e},lf=function(e,t=null,r=null,n=null){const i=e=>Nf(null!==n?Object.assign(e,n):e);let o,s,a,A=t;function l(t){let r;return r=A?/[a-z]/i.test(A)?A+"()":A:e.type,void 0!==s&&t.length<s?(console.error(`THREE.TSL: "${r}" parameter length is less than minimum required.`),t.concat(new Array(s-t.length).fill(0))):void 0!==a&&t.length>a?(console.error(`THREE.TSL: "${r}" parameter length exceeds limit.`),t.slice(0,a)):t}return null===t?o=(...t)=>i(new e(...Rf(l(t)))):null!==r?(r=Nf(r),o=(...n)=>i(new e(t,...Rf(l(n)),r))):o=(...r)=>i(new e(t,...Rf(l(r)))),o.setParameterLength=(...e)=>(1===e.length?s=a=e[0]:2===e.length&&([s,a]=e),o),o.setName=e=>(A=e,o),o},uf=function(e,...t){return Nf(new e(...Rf(t)))};class cf extends Fp{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:r}=this,n=e.getNodeProperties(t),i=t.namespace&&t.namespace===e.namespace?e.getNamespace("once"):"once";if(n[i])return n[i];let o=null;if(t.layout){let n=sf.get(e.constructor);void 0===n&&(n=new WeakMap,sf.set(e.constructor,n));let i=n.get(t);void 0===i&&(i=Nf(e.buildFunctionNode(t)),n.set(t,i)),e.addInclude(i),o=Nf(i.call(r))}else{const n=t.jsFunc,i=null!==r||n.length>1?n(r||[],e):n(e);o=Nf(i)}return t.once&&(n[i]=o),o}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),r=e.getOutputNamespace();return t[r]=t[r]||this.setupOutput(e),t[r]}build(e,t=null){let r=null;const n=e.getBuildStage(),i=e.getNodeProperties(this),o=e.getOutputNamespace(),s=this.getOutputNode(e);if("setup"===n){const t=e.getNamespace("initialized");!0!==i[t]&&(i[t]=!0,i[o]=this.getOutputNode(e),i[o].build(e)),r=i[o]}else"analyze"===n?s.build(e,t):"generate"===n&&(r=s.build(e,t)||"");return r}}class hf extends Fp{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1,this.namespace=null}setLayout(e){return this.layout=e,this}call(e=null){return Cf(e),Nf(new cf(this,e))}setup(){return this.call()}}const df=[!1,!0],pf=[0,1,2,3],ff=[-1,-2],mf=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],gf=new Map;for(const hW of df)gf.set(hW,new Xp(hW));const yf=new Map;for(const hW of pf)yf.set(hW,new Xp(hW,"uint"));const bf=new Map([...yf].map(e=>new Xp(e.value,"int")));for(const hW of ff)bf.set(hW,new Xp(hW,"int"));const vf=new Map([...bf].map(e=>new Xp(e.value)));for(const hW of mf)vf.set(hW,new Xp(hW));for(const hW of mf)vf.set(-hW,new Xp(-hW));const _f={bool:gf,uint:yf,ints:bf,float:vf},xf=new Map([...gf,...vf]),wf=(e,t)=>xf.has(e)?xf.get(e):!0===e.isNode?e:new Xp(e,t),Tf=function(e,t=null){return(...r)=>{if((0===r.length||!["bool","float","int","uint"].includes(e)&&r.every(e=>"object"!=typeof e))&&(r=[Ep(e,...r)]),1===r.length&&null!==t&&t.has(r[0]))return Nf(t.get(r[0]));if(1===r.length){const t=wf(r[0],e);return(e=>{try{return e.getNodeType()}catch(t){return}})(t)===e?Nf(t):Nf(new Vp(t,e))}const n=r.map(e=>wf(e));return Nf(new jp(n,e))}},Sf=e=>"object"==typeof e&&null!==e?e.value:e,Ef=e=>null!=e?e.nodeType||e.convertTo||("string"==typeof e?e:null):null;function Mf(e,t){return new Proxy(new hf(e,t),nf)}const Nf=(e,t=null)=>function(e,t=null){const r=Sp(e);if("node"===r){let t=of.get(e);return void 0===t&&(t=new Proxy(e,nf),of.set(e,t),of.set(t,t)),t}return null===t&&("float"===r||"boolean"===r)||r&&"shader"!==r&&"string"!==r?Nf(wf(e,t)):"shader"===r?qf(e):e}(e,t),Cf=(e,t=null)=>new af(e,t),Rf=(e,t=null)=>new Af(e,t),Pf=(...e)=>new lf(...e),Df=(...e)=>new uf(...e);let Bf=0;const qf=(e,t=null)=>{let r=null;null!==t&&("object"==typeof t?r=t.return:("string"==typeof t?r=t:console.error("THREE.TSL: Invalid layout type."),t=null));const n=new Mf(e,r),i=(...e)=>{let t;Cf(e);t=e[0]&&(e[0].isNode||Object.getPrototypeOf(e[0])!==Object.prototype)?[...e]:e[0];const i=n.call(t);return"void"===r&&i.toStack(),i};if(i.shaderNode=n,i.id=n.id,i.getNodeType=(...e)=>n.getNodeType(...e),i.getCacheKey=(...e)=>n.getCacheKey(...e),i.setLayout=e=>(n.setLayout(e),i),i.once=(e=null)=>(n.once=!0,n.namespace=e,i),null!==t){if("object"!=typeof t.inputs){const e={name:"fn"+Bf++,type:r,inputs:[]};for(const r in t)"return"!==r&&e.inputs.push({name:r,type:t[r]});t=e}i.setLayout(t)}return i},Of=e=>{Zp=e},Lf=()=>Zp,kf=(...e)=>Zp.If(...e);function If(e){return Zp&&Zp.add(e),e}ef("toStack",If);const Ff=new Tf("color"),Uf=new Tf("float",_f.float),Vf=new Tf("int",_f.ints),Gf=new Tf("uint",_f.uint),jf=new Tf("bool",_f.bool),zf=new Tf("vec2"),Hf=new Tf("ivec2"),Wf=new Tf("uvec2"),Qf=new Tf("bvec2"),$f=new Tf("vec3"),Yf=new Tf("ivec3"),Xf=new Tf("uvec3"),Kf=new Tf("bvec3"),Zf=new Tf("vec4"),Jf=new Tf("ivec4"),em=new Tf("uvec4"),tm=new Tf("bvec4"),rm=new Tf("mat2"),nm=new Tf("mat3"),im=new Tf("mat4");ef("toColor",Ff),ef("toFloat",Uf),ef("toInt",Vf),ef("toUint",Gf),ef("toBool",jf),ef("toVec2",zf),ef("toIVec2",Hf),ef("toUVec2",Wf),ef("toBVec2",Qf),ef("toVec3",$f),ef("toIVec3",Yf),ef("toUVec3",Xf),ef("toBVec3",Kf),ef("toVec4",Zf),ef("toIVec4",Jf),ef("toUVec4",em),ef("toBVec4",tm),ef("toMat2",rm),ef("toMat3",nm),ef("toMat4",im);const om=Pf(Up).setParameterLength(2),sm=(e,t)=>Nf(new Vp(Nf(e),t));ef("element",om),ef("convert",sm);ef("append",e=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),If(e)));class am extends Fp{static get type(){return"PropertyNode"}constructor(e,t=null,r=!1){super(e),this.name=t,this.varying=r,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return!0===this.varying?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Am=(e,t)=>Nf(new am(e,t)),lm=(e,t)=>Nf(new am(e,t,!0)),um=Df(am,"vec4","DiffuseColor"),cm=Df(am,"vec3","EmissiveColor"),hm=Df(am,"float","Roughness"),dm=Df(am,"float","Metalness"),pm=Df(am,"float","Clearcoat"),fm=Df(am,"float","ClearcoatRoughness"),mm=Df(am,"vec3","Sheen"),gm=Df(am,"float","SheenRoughness"),ym=Df(am,"float","Iridescence"),bm=Df(am,"float","IridescenceIOR"),vm=Df(am,"float","IridescenceThickness"),_m=Df(am,"float","AlphaT"),xm=Df(am,"float","Anisotropy"),wm=Df(am,"vec3","AnisotropyT"),Tm=Df(am,"vec3","AnisotropyB"),Sm=Df(am,"color","SpecularColor"),Em=Df(am,"float","SpecularF90"),Mm=Df(am,"float","Shininess"),Nm=Df(am,"vec4","Output"),Cm=Df(am,"float","dashSize"),Rm=Df(am,"float","gapSize"),Pm=Df(am,"float","pointWidth"),Dm=Df(am,"float","IOR"),Bm=Df(am,"float","Transmission"),qm=Df(am,"float","Thickness"),Om=Df(am,"float","AttenuationDistance"),Lm=Df(am,"color","AttenuationColor"),km=Df(am,"float","Dispersion");class Im extends Fp{static get type(){return"UniformGroupNode"}constructor(e,t=!1,r=1){super("string"),this.name=e,this.shared=t,this.order=r,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Fm=e=>new Im(e),Um=(e,t=0)=>new Im(e,!0,t),Vm=Um("frame"),Gm=Um("render"),jm=Fm("object");class zm extends $p{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=jm}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const r=this.getSelf();return e=e.bind(r),super.onUpdate(t=>{const n=e(t,r);void 0!==n&&(this.value=n)},t)}generate(e,t){const r=this.getNodeType(e),n=this.getUniformHash(e);let i=e.getNodeFromHash(n);void 0===i&&(e.setHashNode(this,n),i=this);const o=i.getInputType(e),s=e.getUniformFromNode(i,o,e.shaderStage,this.name||e.context.label),a=e.getPropertyName(s);return void 0!==e.context.label&&delete e.context.label,e.format(a,r,t)}}const Hm=(e,t)=>{const r=Ef(t||e),n=e&&!0===e.isNode?e.node&&e.node.value||e.value:e;return Nf(new zm(n,r))};class Wm extends Gp{static get type(){return"ArrayNode"}constructor(e,t,r=null){super(e),this.count=t,this.values=r,this.isArrayNode=!0}getNodeType(e){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const Qm=(...e)=>{let t;if(1===e.length){const r=e[0];t=new Wm(null,r.length,r)}else{const r=e[0],n=e[1];t=new Wm(r,n)}return Nf(t)};ef("toArray",(e,t)=>Qm(Array(t).fill(e)));class $m extends Gp{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return"void"!==t?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(!1===e.isAvailable("swizzleAssign")&&t.isSplitNode&&t.components.length>1){const r=e.getTypeLength(t.node.getNodeType(e));return Lp.join("").slice(0,r)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:r}=this,n=e.getNodeProperties(this);n.sourceNode=r,n.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:r,sourceNode:n}=e.getNodeProperties(this),i=this.needsSplitAssign(e),o=r.getNodeType(e),s=r.build(e),a=n.build(e,o),A=n.getNodeType(e),l=e.getDataFromNode(this);let u;if(!0===l.initialized)"void"!==t&&(u=s);else if(i){const n=e.getVarFromNode(this,null,o),i=e.getPropertyName(n);e.addLineFlowCode(`${i} = ${a}`,this);const A=r.node,l=A.node.context({assign:!0}).build(e);for(let t=0;t<A.components.length;t++){const r=A.components[t];e.addLineFlowCode(`${l}.${r} = ${i}[ ${t} ]`,this)}"void"!==t&&(u=s)}else u=`${s} = ${a}`,"void"!==t&&"void"!==A||(e.addLineFlowCode(u,this),"void"!==t&&(u=s));return l.initialized=!0,e.format(u,o,t)}}const Ym=Pf($m).setParameterLength(2);ef("assign",Ym);class Xm extends Gp{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],r=this.functionNode,n=r.getInputs(e),i=this.parameters,o=(t,r)=>{const n=r.type;let i;return i="pointer"===n?"&"+t.build(e):t.build(e,n),i};if(Array.isArray(i)){if(i.length>n.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=n.length;else if(i.length<n.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<n.length;)i.push(Uf(0));for(let e=0;e<i.length;e++)t.push(o(i[e],n[e]))}else for(const s of n){const e=i[s.name];void 0!==e?t.push(o(e,s)):(console.error(`THREE.TSL: Input '${s.name}' not found in 'Fn()'.`),t.push(o(Uf(0),s)))}return`${r.build(e,"property")}( ${t.join(", ")} )`}}const Km=(e,...t)=>(t=t.length>1||t[0]&&!0===t[0].isNode?Rf(t):Cf(t[0]),Nf(new Xm(Nf(e),t)));ef("call",Km);const Zm={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Jm extends Gp{static get type(){return"OperatorNode"}constructor(e,t,r,...n){if(super(),n.length>0){let i=new Jm(e,t,r);for(let t=0;t<n.length-1;t++)i=new Jm(e,i,n[t]);t=i,r=n[n.length-1]}this.op=e,this.aNode=t,this.bNode=r,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(Zm[this.op],t)}getNodeType(e){const t=this.op,r=this.aNode,n=this.bNode,i=r.getNodeType(e),o=n?n.getNodeType(e):null;if("void"===i||"void"===o)return"void";if("%"===t)return i;if("~"===t||"&"===t||"|"===t||"^"===t||">>"===t||"<<"===t)return e.getIntegerType(i);if("!"===t||"&&"===t||"||"===t||"^^"===t)return"bool";if("=="===t||"!="===t||"<"===t||">"===t||"<="===t||">="===t){const t=Math.max(e.getTypeLength(i),e.getTypeLength(o));return t>1?`bvec${t}`:"bool"}if(e.isMatrix(i)){if("float"===o)return i;if(e.isVector(o))return e.getVectorFromMatrix(i);if(e.isMatrix(o))return i}else if(e.isMatrix(o)){if("float"===i)return o;if(e.isVector(i))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(i)?o:i}generate(e,t){const r=this.op,{aNode:n,bNode:i}=this,o=this.getNodeType(e);let s=null,a=null;"void"!==o?(s=n.getNodeType(e),a=i?i.getNodeType(e):null,"<"===r||">"===r||"<="===r||">="===r||"=="===r||"!="===r?e.isVector(s)?a=s:e.isVector(a)?s=a:s!==a&&(s=a="float"):">>"===r||"<<"===r?(s=o,a=e.changeComponentType(a,"uint")):"%"===r?(s=o,a=e.isInteger(s)&&e.isInteger(a)?a:s):e.isMatrix(s)?"float"===a?a="float":e.isVector(a)?a=e.getVectorFromMatrix(s):e.isMatrix(a)||(s=a=o):s=e.isMatrix(a)?"float"===s?"float":e.isVector(s)?e.getVectorFromMatrix(a):a=o:a=o):s=a=o;const A=n.build(e,s),l=i?i.build(e,a):null,u=e.getFunctionOperator(r);if("void"!==t){const n=e.renderer.coordinateSystem===I;if("=="===r||"!="===r||"<"===r||">"===r||"<="===r||">="===r)return n&&e.isVector(s)?e.format(`${this.getOperatorMethod(e,t)}( ${A}, ${l} )`,o,t):e.format(`( ${A} ${r} ${l} )`,o,t);if("%"===r)return e.isInteger(a)?e.format(`( ${A} % ${l} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${A}, ${l} )`,o,t);if("!"===r||"~"===r)return e.format(`(${r}${A})`,s,t);if(u)return e.format(`${u}( ${A}, ${l} )`,o,t);if(e.isMatrix(s)&&"float"===a)return e.format(`( ${l} ${r} ${A} )`,o,t);if("float"===s&&e.isMatrix(a))return e.format(`${A} ${r} ${l}`,o,t);{let i=`( ${A} ${r} ${l} )`;return!n&&"bool"===o&&e.isVector(s)&&e.isVector(a)&&(i=`all${i}`),e.format(i,o,t)}}if("void"!==s)return u?e.format(`${u}( ${A}, ${l} )`,o,t):e.isMatrix(s)&&"float"===a?e.format(`${l} ${r} ${A}`,o,t):e.format(`${A} ${r} ${l}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const eg=Pf(Jm,"+").setParameterLength(2,1/0).setName("add"),tg=Pf(Jm,"-").setParameterLength(2,1/0).setName("sub"),rg=Pf(Jm,"*").setParameterLength(2,1/0).setName("mul"),ng=Pf(Jm,"/").setParameterLength(2,1/0).setName("div"),ig=Pf(Jm,"%").setParameterLength(2).setName("mod"),og=Pf(Jm,"==").setParameterLength(2).setName("equal"),sg=Pf(Jm,"!=").setParameterLength(2).setName("notEqual"),ag=Pf(Jm,"<").setParameterLength(2).setName("lessThan"),Ag=Pf(Jm,">").setParameterLength(2).setName("greaterThan"),lg=Pf(Jm,"<=").setParameterLength(2).setName("lessThanEqual"),ug=Pf(Jm,">=").setParameterLength(2).setName("greaterThanEqual"),cg=Pf(Jm,"&&").setParameterLength(2,1/0).setName("and"),hg=Pf(Jm,"||").setParameterLength(2,1/0).setName("or"),dg=Pf(Jm,"!").setParameterLength(1).setName("not"),pg=Pf(Jm,"^^").setParameterLength(2).setName("xor"),fg=Pf(Jm,"&").setParameterLength(2).setName("bitAnd"),mg=Pf(Jm,"~").setParameterLength(2).setName("bitNot"),gg=Pf(Jm,"|").setParameterLength(2).setName("bitOr"),yg=Pf(Jm,"^").setParameterLength(2).setName("bitXor"),bg=Pf(Jm,"<<").setParameterLength(2).setName("shiftLeft"),vg=Pf(Jm,">>").setParameterLength(2).setName("shiftRight"),_g=qf(([e])=>(e.addAssign(1),e)),xg=qf(([e])=>(e.subAssign(1),e)),wg=qf(([e])=>{const t=Vf(e).toConst();return e.addAssign(1),t}),Tg=qf(([e])=>{const t=Vf(e).toConst();return e.subAssign(1),t});ef("add",eg),ef("sub",tg),ef("mul",rg),ef("div",ng),ef("mod",ig),ef("equal",og),ef("notEqual",sg),ef("lessThan",ag),ef("greaterThan",Ag),ef("lessThanEqual",lg),ef("greaterThanEqual",ug),ef("and",cg),ef("or",hg),ef("not",dg),ef("xor",pg),ef("bitAnd",fg),ef("bitNot",mg),ef("bitOr",gg),ef("bitXor",yg),ef("shiftLeft",bg),ef("shiftRight",vg),ef("incrementBefore",_g),ef("decrementBefore",xg),ef("increment",wg),ef("decrement",Tg);const Sg=(e,t)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),ig(e,t)),Eg=(e,t)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),ig(Vf(e),Vf(t)));ef("remainder",Sg),ef("modInt",Eg);class Mg extends Gp{static get type(){return"MathNode"}constructor(e,t,r=null,n=null){if(super(),(e===Mg.MAX||e===Mg.MIN)&&arguments.length>3){let i=new Mg(e,t,r);for(let t=2;t<arguments.length-1;t++)i=new Mg(e,i,arguments[t]);t=i,r=arguments[arguments.length-1],n=null}this.method=e,this.aNode=t,this.bNode=r,this.cNode=n,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(r)?0:e.getTypeLength(r),s=e.isMatrix(n)?0:e.getTypeLength(n);return i>o&&i>s?t:o>s?r:s>i?n:t}getNodeType(e){const t=this.method;return t===Mg.LENGTH||t===Mg.DISTANCE||t===Mg.DOT?"float":t===Mg.CROSS?"vec3":t===Mg.ALL||t===Mg.ANY?"bool":t===Mg.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:r,method:n}=this;let i=null;if(n===Mg.ONE_MINUS)i=tg(1,t);else if(n===Mg.RECIPROCAL)i=ng(1,t);else if(n===Mg.DIFFERENCE)i=Zg(tg(t,r));else if(n===Mg.TRANSFORM_DIRECTION){let n=t,o=r;e.isMatrix(n.getNodeType(e))?o=Zf($f(o),0):n=Zf($f(n),0);const s=rg(n,o).xyz;i=zg(s)}return null!==i?i:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let r=this.method;const n=this.getNodeType(e),i=this.getInputType(e),o=this.aNode,s=this.bNode,a=this.cNode,A=e.renderer.coordinateSystem;if(r===Mg.NEGATE)return e.format("( - "+o.build(e,i)+" )",n,t);{const l=[];return r===Mg.CROSS?l.push(o.build(e,n),s.build(e,n)):A===I&&r===Mg.STEP?l.push(o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":i),s.build(e,i)):A!==I||r!==Mg.MIN&&r!==Mg.MAX?r===Mg.REFRACT?l.push(o.build(e,i),s.build(e,i),a.build(e,"float")):r===Mg.MIX?l.push(o.build(e,i),s.build(e,i),a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":i)):(A===Ee&&r===Mg.ATAN&&null!==s&&(r="atan2"),"fragment"===e.shaderStage||r!==Mg.DFDX&&r!==Mg.DFDY||(console.warn(`THREE.TSL: '${r}' is not supported in the ${e.shaderStage} stage.`),r="/*"+r+"*/"),l.push(o.build(e,i)),null!==s&&l.push(s.build(e,i)),null!==a&&l.push(a.build(e,i))):l.push(o.build(e,i),s.build(e,1===e.getTypeLength(s.getNodeType(e))?"float":i)),e.format(`${e.getMethod(r,n)}( ${l.join(", ")} )`,n,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Mg.ALL="all",Mg.ANY="any",Mg.RADIANS="radians",Mg.DEGREES="degrees",Mg.EXP="exp",Mg.EXP2="exp2",Mg.LOG="log",Mg.LOG2="log2",Mg.SQRT="sqrt",Mg.INVERSE_SQRT="inversesqrt",Mg.FLOOR="floor",Mg.CEIL="ceil",Mg.NORMALIZE="normalize",Mg.FRACT="fract",Mg.SIN="sin",Mg.COS="cos",Mg.TAN="tan",Mg.ASIN="asin",Mg.ACOS="acos",Mg.ATAN="atan",Mg.ABS="abs",Mg.SIGN="sign",Mg.LENGTH="length",Mg.NEGATE="negate",Mg.ONE_MINUS="oneMinus",Mg.DFDX="dFdx",Mg.DFDY="dFdy",Mg.ROUND="round",Mg.RECIPROCAL="reciprocal",Mg.TRUNC="trunc",Mg.FWIDTH="fwidth",Mg.TRANSPOSE="transpose",Mg.BITCAST="bitcast",Mg.EQUALS="equals",Mg.MIN="min",Mg.MAX="max",Mg.STEP="step",Mg.REFLECT="reflect",Mg.DISTANCE="distance",Mg.DIFFERENCE="difference",Mg.DOT="dot",Mg.CROSS="cross",Mg.POW="pow",Mg.TRANSFORM_DIRECTION="transformDirection",Mg.MIX="mix",Mg.CLAMP="clamp",Mg.REFRACT="refract",Mg.SMOOTHSTEP="smoothstep",Mg.FACEFORWARD="faceforward";const Ng=Uf(1e-6),Cg=Uf(1e6),Rg=Uf(Math.PI),Pg=Uf(2*Math.PI),Dg=Pf(Mg,Mg.ALL).setParameterLength(1),Bg=Pf(Mg,Mg.ANY).setParameterLength(1),qg=Pf(Mg,Mg.RADIANS).setParameterLength(1),Og=Pf(Mg,Mg.DEGREES).setParameterLength(1),Lg=Pf(Mg,Mg.EXP).setParameterLength(1),kg=Pf(Mg,Mg.EXP2).setParameterLength(1),Ig=Pf(Mg,Mg.LOG).setParameterLength(1),Fg=Pf(Mg,Mg.LOG2).setParameterLength(1),Ug=Pf(Mg,Mg.SQRT).setParameterLength(1),Vg=Pf(Mg,Mg.INVERSE_SQRT).setParameterLength(1),Gg=Pf(Mg,Mg.FLOOR).setParameterLength(1),jg=Pf(Mg,Mg.CEIL).setParameterLength(1),zg=Pf(Mg,Mg.NORMALIZE).setParameterLength(1),Hg=Pf(Mg,Mg.FRACT).setParameterLength(1),Wg=Pf(Mg,Mg.SIN).setParameterLength(1),Qg=Pf(Mg,Mg.COS).setParameterLength(1),$g=Pf(Mg,Mg.TAN).setParameterLength(1),Yg=Pf(Mg,Mg.ASIN).setParameterLength(1),Xg=Pf(Mg,Mg.ACOS).setParameterLength(1),Kg=Pf(Mg,Mg.ATAN).setParameterLength(1,2),Zg=Pf(Mg,Mg.ABS).setParameterLength(1),Jg=Pf(Mg,Mg.SIGN).setParameterLength(1),ey=Pf(Mg,Mg.LENGTH).setParameterLength(1),ty=Pf(Mg,Mg.NEGATE).setParameterLength(1),ry=Pf(Mg,Mg.ONE_MINUS).setParameterLength(1),ny=Pf(Mg,Mg.DFDX).setParameterLength(1),iy=Pf(Mg,Mg.DFDY).setParameterLength(1),oy=Pf(Mg,Mg.ROUND).setParameterLength(1),sy=Pf(Mg,Mg.RECIPROCAL).setParameterLength(1),ay=Pf(Mg,Mg.TRUNC).setParameterLength(1),Ay=Pf(Mg,Mg.FWIDTH).setParameterLength(1),ly=Pf(Mg,Mg.TRANSPOSE).setParameterLength(1),uy=Pf(Mg,Mg.BITCAST).setParameterLength(2),cy=(e,t)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),og(e,t)),hy=Pf(Mg,Mg.MIN).setParameterLength(2,1/0),dy=Pf(Mg,Mg.MAX).setParameterLength(2,1/0),py=Pf(Mg,Mg.STEP).setParameterLength(2),fy=Pf(Mg,Mg.REFLECT).setParameterLength(2),my=Pf(Mg,Mg.DISTANCE).setParameterLength(2),gy=Pf(Mg,Mg.DIFFERENCE).setParameterLength(2),yy=Pf(Mg,Mg.DOT).setParameterLength(2),by=Pf(Mg,Mg.CROSS).setParameterLength(2),vy=Pf(Mg,Mg.POW).setParameterLength(2),_y=Pf(Mg,Mg.POW,2).setParameterLength(1),xy=Pf(Mg,Mg.POW,3).setParameterLength(1),wy=Pf(Mg,Mg.POW,4).setParameterLength(1),Ty=Pf(Mg,Mg.TRANSFORM_DIRECTION).setParameterLength(2),Sy=e=>rg(Jg(e),vy(Zg(e),1/3)),Ey=e=>yy(e,e),My=Pf(Mg,Mg.MIX).setParameterLength(3),Ny=(e,t=0,r=1)=>Nf(new Mg(Mg.CLAMP,Nf(e),Nf(t),Nf(r))),Cy=e=>Ny(e),Ry=Pf(Mg,Mg.REFRACT).setParameterLength(3),Py=Pf(Mg,Mg.SMOOTHSTEP).setParameterLength(3),Dy=Pf(Mg,Mg.FACEFORWARD).setParameterLength(3),By=qf(([e])=>{const t=yy(e.xy,zf(12.9898,78.233)),r=ig(t,Rg);return Hg(Wg(r).mul(43758.5453))}),qy=(e,t,r)=>My(t,r,e),Oy=(e,t,r)=>Py(t,r,e),Ly=(e,t)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),Kg(e,t)),ky=Dy,Iy=Vg;ef("all",Dg),ef("any",Bg),ef("equals",cy),ef("radians",qg),ef("degrees",Og),ef("exp",Lg),ef("exp2",kg),ef("log",Ig),ef("log2",Fg),ef("sqrt",Ug),ef("inverseSqrt",Vg),ef("floor",Gg),ef("ceil",jg),ef("normalize",zg),ef("fract",Hg),ef("sin",Wg),ef("cos",Qg),ef("tan",$g),ef("asin",Yg),ef("acos",Xg),ef("atan",Kg),ef("abs",Zg),ef("sign",Jg),ef("length",ey),ef("lengthSq",Ey),ef("negate",ty),ef("oneMinus",ry),ef("dFdx",ny),ef("dFdy",iy),ef("round",oy),ef("reciprocal",sy),ef("trunc",ay),ef("fwidth",Ay),ef("atan2",Ly),ef("min",hy),ef("max",dy),ef("step",py),ef("reflect",fy),ef("distance",my),ef("dot",yy),ef("cross",by),ef("pow",vy),ef("pow2",_y),ef("pow3",xy),ef("pow4",wy),ef("transformDirection",Ty),ef("mix",qy),ef("clamp",Ny),ef("refract",Ry),ef("smoothstep",Oy),ef("faceForward",Dy),ef("difference",gy),ef("saturate",Cy),ef("cbrt",Sy),ef("transpose",ly),ef("rand",By);class Fy extends Fp{static get type(){return"ConditionalNode"}constructor(e,t,r=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=r}getNodeType(e){const{ifNode:t,elseNode:r}=e.getNodeProperties(this);if(void 0===t)return this.setup(e),this.getNodeType(e);const n=t.getNodeType(e);if(null!==r){const t=r.getNodeType(e);if(e.getTypeLength(t)>e.getTypeLength(n))return t}return n}setup(e){const t=this.condNode.cache(),r=this.ifNode.cache(),n=this.elseNode?this.elseNode.cache():null,i=e.context.nodeBlock;e.getDataFromNode(r).parentNodeBlock=i,null!==n&&(e.getDataFromNode(n).parentNodeBlock=i);const o=e.getNodeProperties(this);o.condNode=t,o.ifNode=r.context({nodeBlock:r}),o.elseNode=n?n.context({nodeBlock:n}):null}generate(e,t){const r=this.getNodeType(e),n=e.getDataFromNode(this);if(void 0!==n.nodeProperty)return n.nodeProperty;const{condNode:i,ifNode:o,elseNode:s}=e.getNodeProperties(this),a=e.currentFunctionNode,A="void"!==t,l=A?Am(r).build(e):"";n.nodeProperty=l;const u=i.build(e,"bool");e.addFlowCode(`\n${e.tab}if ( ${u} ) {\n\n`).addFlowTab();let c=o.build(e,r);if(c&&(A?c=l+" = "+c+";":(c="return "+c+";",null===a&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),c="// "+c))),e.removeFlowTab().addFlowCode(e.tab+"\t"+c+"\n\n"+e.tab+"}"),null!==s){e.addFlowCode(" else {\n\n").addFlowTab();let t=s.build(e,r);t&&(A?t=l+" = "+t+";":(t="return "+t+";",null===a&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),t="// "+t))),e.removeFlowTab().addFlowCode(e.tab+"\t"+t+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(l,r,t)}}const Uy=Pf(Fy).setParameterLength(2,3);ef("select",Uy);const Vy=(...e)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),Uy(...e));ef("cond",Vy);class Gy extends Fp{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const r=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e,t);return e.setContext(r),n}}const jy=Pf(Gy).setParameterLength(1,2),zy=(e,t)=>jy(e,{label:t});ef("context",jy),ef("label",zy);class Hy extends Fp{static get type(){return"VarNode"}constructor(e,t=null,r=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=r,this.parents=!0}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:r,readOnly:n}=this,{renderer:i}=e,o=!0===i.backend.isWebGPUBackend;let s=!1,a=!1;n&&(s=e.isDeterministic(t),a=o?n:s);const A=e.getVectorType(this.getNodeType(e)),l=t.build(e,A),u=e.getVarFromNode(this,r,A,void 0,a),c=e.getPropertyName(u);let h=c;if(a)if(o)h=s?`const ${c}`:`let ${c}`;else{const r=e.getArrayCount(t);h=`const ${e.getVar(u.type,c,r)}`}return e.addLineFlowCode(`${h} = ${l}`,this),c}}const Wy=Pf(Hy),Qy=(e,t=null)=>Wy(e,t).toStack(),$y=(e,t=null)=>Wy(e,t,!0).toStack();ef("toVar",Qy),ef("toConst",$y);const Yy=e=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),Wy(e));ef("temp",Yy);class Xy extends Fp{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let r=t.varying;if(void 0===r){const n=this.name,i=this.getNodeType(e),o=this.interpolationType,s=this.interpolationSampling;t.varying=r=e.getVaryingFromNode(this,n,i,o,s),t.node=this.node}return r.needsInterpolation||(r.needsInterpolation="fragment"===e.shaderStage),r}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(Rp.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(Rp.VERTEX,this.node)}generate(e){const t=e.getNodeProperties(this),r=this.setupVarying(e);if(void 0===t.propertyName){const n=this.getNodeType(e),i=e.getPropertyName(r,Rp.VERTEX);e.flowNodeFromShaderStage(Rp.VERTEX,this.node,n,i),t.propertyName=i}return e.getPropertyName(r)}}const Ky=Pf(Xy).setParameterLength(1,2),Zy=e=>Ky(e);ef("toVarying",Ky),ef("toVertexStage",Zy),ef("varying",(...e)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),Ky(...e))),ef("vertexStage",(...e)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),Ky(...e)));const Jy=qf(([e])=>{const t=e.mul(.9478672986).add(.0521327014).pow(2.4),r=e.mul(.0773993808),n=e.lessThanEqual(.04045);return My(t,r,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),eb=qf(([e])=>{const t=e.pow(.41666).mul(1.055).sub(.055),r=e.mul(12.92),n=e.lessThanEqual(.0031308);return My(t,r,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),tb="WorkingColorSpace";class rb extends Gp{static get type(){return"ColorSpaceNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.source=t,this.target=r}resolveColorSpace(e,t){return t===tb?$e.workingColorSpace:"OutputColorSpace"===t?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,r=this.resolveColorSpace(e,this.source),n=this.resolveColorSpace(e,this.target);let i=t;return!1!==$e.enabled&&r!==n&&r&&n?($e.getTransfer(r)===Ye&&(i=Zf(Jy(i.rgb),i.a)),$e.getPrimaries(r)!==$e.getPrimaries(n)&&(i=Zf(nm($e._getMatrix(new Te,r,n)).mul(i.rgb),i.a)),$e.getTransfer(n)===Ye&&(i=Zf(eb(i.rgb),i.a)),i):i}}const nb=(e,t)=>Nf(new rb(Nf(e),tb,t)),ib=(e,t)=>Nf(new rb(Nf(e),t,tb));ef("workingToColorSpace",nb),ef("colorSpaceToWorking",ib);let ob=class extends Up{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,r,n)}};class sb extends Fp{static get type(){return"ReferenceBaseNode"}constructor(e,t,r=null,n=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=n,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.updateType=Pp.OBJECT}setGroup(e){return this.group=e,this}element(e){return Nf(new ob(this,Nf(e)))}setNodeType(e){const t=Hm(null,e).getSelf();null!==this.group&&t.setGroup(this.group),this.node=t}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let n=1;n<t.length;n++)r=r[t[n]];return r}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class ab extends sb{static get type(){return"RendererReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.renderer=r,this.setGroup(Gm)}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}const Ab=(e,t,r=null)=>Nf(new ab(e,t,r));class lb extends Gp{static get type(){return"ToneMappingNode"}constructor(e,t=cb,r=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=r}customCacheKey(){return fp(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,r=this.toneMapping;if(r===E)return t;let n=null;const i=e.renderer.library.getToneMappingFunction(r);return null!==i?n=Zf(i(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",r),n=t),n}}const ub=(e,t,r)=>Nf(new lb(e,Nf(t),Nf(r))),cb=Ab("toneMappingExposure","float");ef("toneMapping",(e,t,r)=>ub(t,r,e));class hb extends $p{static get type(){return"BufferAttributeNode"}constructor(e,t=null,r=0,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=r,this.bufferOffset=n,this.usage=fn,this.instanced=!1,this.attribute=null,this.global=!0,e&&!0===e.isBufferAttribute&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(0===this.bufferStride&&0===this.bufferOffset){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;const t=this.getNodeType(e),r=this.value,n=e.getTypeLength(t),i=this.bufferStride||n,o=this.bufferOffset,s=!0===r.isInterleavedBuffer?r:new b(r,i),a=new v(s,n,o);s.setUsage(this.usage),this.attribute=a,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),r=e.getBufferAttributeFromNode(this,t),n=e.getPropertyName(r);let i=null;if("vertex"===e.shaderStage||"compute"===e.shaderStage)this.name=n,i=n;else{i=Ky(this).build(e,t)}return i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const db=(e,t=null,r=0,n=0)=>Nf(new hb(e,t,r,n)),pb=(e,t=null,r=0,n=0)=>db(e,t,r,n).setUsage(we),fb=(e,t=null,r=0,n=0)=>db(e,t,r,n).setInstanced(!0),mb=(e,t=null,r=0,n=0)=>pb(e,t,r,n).setInstanced(!0);ef("toAttribute",e=>db(e.value));class gb extends Fp{static get type(){return"ComputeNode"}constructor(e,t,r=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=r,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=Pp.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let r=t[0];for(let n=1;n<t.length;n++)r*=t[n];this.dispatchCount=Math.ceil(e/r)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){e.getNodeProperties(this).outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:r}=e;if("compute"===r){const t=this.computeNode.build(e,"void");""!==t&&e.addLineFlowCode(t,this)}else{const r=e.getNodeProperties(this).outputComputeNode;if(r)return r.build(e,t)}}}const yb=(e,t,r)=>Nf(new gb(Nf(e),t,r));ef("compute",yb);class bb extends Fp{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const n=this.node.getNodeType(e);return e.setCache(t),n}build(e,...t){const r=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const i=this.node.build(e,...t);return e.setCache(r),i}}const vb=(e,t)=>Nf(new bb(Nf(e),t)),_b=(e,t)=>e.context({namespace:t});ef("cache",vb);class xb extends Fp{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const wb=Pf(xb).setParameterLength(2);ef("bypass",wb);class Tb extends Fp{static get type(){return"RemapNode"}constructor(e,t,r,n=Uf(0),i=Uf(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=r,this.outLowNode=n,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:r,outLowNode:n,outHighNode:i,doClamp:o}=this;let s=e.sub(t).div(r.sub(t));return!0===o&&(s=s.clamp()),s.mul(i.sub(n)).add(n)}}const Sb=Pf(Tb,null,null,{doClamp:!1}).setParameterLength(3,5),Eb=Pf(Tb).setParameterLength(3,5);ef("remap",Sb),ef("remapClamp",Eb);class Mb extends Fp{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const r=this.getNodeType(e),n=this.snippet;if("void"!==r)return e.format(n,r,t);e.addLineFlowCode(n,this)}}const Nb=Pf(Mb).setParameterLength(1,2),Cb=e=>(e?Uy(e,Nb("discard")):Nb("discard")).toStack();ef("discard",Cb);class Rb extends Gp{static get type(){return"RenderOutputNode"}constructor(e,t,r){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=r,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const r=(null!==this.toneMapping?this.toneMapping:e.toneMapping)||E,n=(null!==this.outputColorSpace?this.outputColorSpace:e.outputColorSpace)||Xe;return r!==E&&(t=t.toneMapping(r)),n!==Xe&&n!==$e.workingColorSpace&&(t=t.workingToColorSpace(n)),t}}const Pb=(e,t=null,r=null)=>Nf(new Rb(Nf(e),t,r));ef("renderOutput",Pb);class Db extends Gp{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,r=this.node.build(e),n="--- TSL debug - "+e.shaderStage+" shader ---",i="-".repeat(n.length);let o="";return o+="// #"+n+"#\n",o+=e.flow.code.replace(/^\t/gm,"")+"\n",o+="/* ... */ "+r+" /* ... */\n",o+="// #"+i+"#\n",null!==t?t(e,o):console.log(o),r}}const Bb=(e,t=null)=>Nf(new Db(Nf(e),t));ef("debug",Bb);class qb extends Fp{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(null===t){const r=this.getAttributeName(e);if(e.hasGeometryAttribute(r)){const n=e.geometry.getAttribute(r);t=e.getTypeFromAttribute(n)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),r=this.getNodeType(e);if(!0===e.hasGeometryAttribute(t)){const n=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(n),o=e.getAttribute(t,i);if("vertex"===e.shaderStage)return e.format(o.name,i,r);return Ky(this).build(e,r)}return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Ob=(e,t=null)=>Nf(new qb(e,t)),Lb=(e=0)=>Ob("uv"+(e>0?e:""),"vec2");class kb extends Fp{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const r=this.textureNode.build(e,"property"),n=null===this.levelNode?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${r}, ${n} )`,this.getNodeType(e),t)}}const Ib=Pf(kb).setParameterLength(1,2);class Fb extends zm{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Pp.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,r=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(r&&void 0!==r.width){const{width:e,height:t}=r;this.value=Math.log2(Math.max(e,t))}}}const Ub=Pf(Fb).setParameterLength(1),Vb=new xe;class Gb extends zm{static get type(){return"TextureNode"}constructor(e=Vb,t=null,r=null,n=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=r,this.biasNode=n,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Pp.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(null===t)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===le?"uvec4":this.value.type===Re?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Lb(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return null===this._matrixUniform&&(this._matrixUniform=Hm(this.value.matrix)),this._matrixUniform.mul($f(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Pp.OBJECT:Pp.NONE,this}setupUV(e,t){const r=this.value;return e.isFlipY()&&(r.image instanceof ImageBitmap&&!0===r.flipY||!0===r.isRenderTargetTexture||!0===r.isFramebufferTexture||!0===r.isDepthTexture)&&(t=this.sampler?t.flipY():t.setY(Vf(Ib(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const r=this.value;if(!r||!0!==r.isTexture)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let n=this.uvNode;null!==n&&!0!==e.context.forceUVContext||!e.context.getUV||(n=e.context.getUV(this,e)),n||(n=this.getDefaultUV()),!0===this.updateMatrix&&(n=this.getTransformedUV(n)),n=this.setupUV(e,n);let i=this.levelNode;null===i&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),t.uvNode=n,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,!0===this.sampler?"vec2":"ivec2")}generateSnippet(e,t,r,n,i,o,s,a){const A=this.value;let l;return l=n?e.generateTextureLevel(A,t,r,n,o):i?e.generateTextureBias(A,t,r,i,o):a?e.generateTextureGrad(A,t,r,a,o):s?e.generateTextureCompare(A,t,r,s,o):!1===this.sampler?e.generateTextureLoad(A,t,r,o):e.generateTexture(A,t,r,o),l}generate(e,t){const r=this.value,n=e.getNodeProperties(this),i=super.generate(e,"property");if(/^sampler/.test(t))return i+"_sampler";if(e.isReference(t))return i;{const o=e.getDataFromNode(this);let s=o.propertyName;if(void 0===s){const{uvNode:t,levelNode:r,biasNode:a,compareNode:A,depthNode:l,gradNode:u}=n,c=this.generateUV(e,t),h=r?r.build(e,"float"):null,d=a?a.build(e,"float"):null,p=l?l.build(e,"int"):null,f=A?A.build(e,"float"):null,m=u?[u[0].build(e,"vec2"),u[1].build(e,"vec2")]:null,g=e.getVarFromNode(this);s=e.getPropertyName(g);const y=this.generateSnippet(e,i,c,h,d,p,f,m);e.addLineFlowCode(`${s} = ${y}`,this),o.snippet=y,o.propertyName=s}let a=s;const A=this.getNodeType(e);return e.needsToWorkingColorSpace(r)&&(a=ib(Nb(a,A),r.colorSpace).setup(e).build(e,A)),e.format(a,A,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Nf(e),t.referenceNode=this.getSelf(),Nf(t)}blur(e){const t=this.clone();t.biasNode=Nf(e).mul(Ub(t)),t.referenceNode=this.getSelf();const r=t.value;return!1===t.generateMipmaps&&(r&&!1===r.generateMipmaps||r.minFilter===Ie||r.magFilter===Ie)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),Nf(t)}level(e){const t=this.clone();return t.levelNode=Nf(e),t.referenceNode=this.getSelf(),Nf(t)}size(e){return Ib(this,e)}bias(e){const t=this.clone();return t.biasNode=Nf(e),t.referenceNode=this.getSelf(),Nf(t)}compare(e){const t=this.clone();return t.compareNode=Nf(e),t.referenceNode=this.getSelf(),Nf(t)}grad(e,t){const r=this.clone();return r.gradNode=[Nf(e),Nf(t)],r.referenceNode=this.getSelf(),Nf(r)}depth(e){const t=this.clone();return t.depthNode=Nf(e),t.referenceNode=this.getSelf(),Nf(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;null!==t&&(t.value=e.matrix),!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e.depthNode=this.depthNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e}}const jb=Pf(Gb).setParameterLength(1,4).setName("texture"),zb=(e=Vb,t=null,r=null,n=null)=>{let i;return e&&!0===e.isTextureNode?(i=Nf(e.clone()),i.referenceNode=e.getSelf(),null!==t&&(i.uvNode=Nf(t)),null!==r&&(i.levelNode=Nf(r)),null!==n&&(i.biasNode=Nf(n))):i=jb(e,t,r,n),i},Hb=(...e)=>zb(...e).setSampler(!1);class Wb extends zm{static get type(){return"BufferNode"}constructor(e,t,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=r}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Qb=(e,t,r)=>Nf(new Wb(e,t,r));class $b extends Up{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),r=this.getNodeType(),n=this.node.getPaddedType();return e.format(t,n,r)}}class Yb extends Wb{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=null===t?Sp(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Pp.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return"mat2"===e?t="mat2":!0===/mat/.test(e)?t="mat4":"i"===e.charAt(0)?t="ivec4":"u"===e.charAt(0)&&(t="uvec4"),t}update(){const{array:e,value:t}=this,r=this.elementType;if("float"===r||"int"===r||"uint"===r)for(let n=0;n<e.length;n++){t[4*n]=e[n]}else if("color"===r)for(let n=0;n<e.length;n++){const r=4*n,i=e[n];t[r]=i.r,t[r+1]=i.g,t[r+2]=i.b||0}else if("mat2"===r)for(let n=0;n<e.length;n++){const r=4*n,i=e[n];t[r]=i.elements[0],t[r+1]=i.elements[1],t[r+2]=i.elements[2],t[r+3]=i.elements[3]}else if("mat3"===r)for(let n=0;n<e.length;n++){const r=16*n,i=e[n];t[r]=i.elements[0],t[r+1]=i.elements[1],t[r+2]=i.elements[2],t[r+4]=i.elements[3],t[r+5]=i.elements[4],t[r+6]=i.elements[5],t[r+8]=i.elements[6],t[r+9]=i.elements[7],t[r+10]=i.elements[8],t[r+15]=1}else if("mat4"===r)for(let n=0;n<e.length;n++){const r=16*n,i=e[n];for(let e=0;e<i.elements.length;e++)t[r+e]=i.elements[e]}else for(let n=0;n<e.length;n++){const r=4*n,i=e[n];t[r]=i.x,t[r+1]=i.y,t[r+2]=i.z||0,t[r+3]=i.w||0}}setup(e){const t=this.array.length,r=this.elementType;let n=Float32Array;const i=this.paddedType,o=e.getTypeLength(i);return"i"===r.charAt(0)&&(n=Int32Array),"u"===r.charAt(0)&&(n=Uint32Array),this.value=new n(t*o),this.bufferCount=t,this.bufferType=i,super.setup(e)}element(e){return Nf(new $b(this,Nf(e)))}}const Xb=(e,t)=>Nf(new Yb(e,t));const Kb=Pf(class extends Fp{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}).setParameterLength(1),Zb=Hm(0,"uint").label("u_cameraIndex").setGroup(Um("cameraIndex")).toVarying("v_cameraIndex"),Jb=Hm("float").label("cameraNear").setGroup(Gm).onRenderUpdate(({camera:e})=>e.near),ev=Hm("float").label("cameraFar").setGroup(Gm).onRenderUpdate(({camera:e})=>e.far),tv=qf(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const r=[];for(const t of e.cameras)r.push(t.projectionMatrix);t=Xb(r).setGroup(Gm).label("cameraProjectionMatrices").element(e.isMultiViewCamera?Kb("gl_ViewID_OVR"):Zb).toVar("cameraProjectionMatrix")}else t=Hm("mat4").label("cameraProjectionMatrix").setGroup(Gm).onRenderUpdate(({camera:e})=>e.projectionMatrix);return t}).once()(),rv=qf(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const r=[];for(const t of e.cameras)r.push(t.projectionMatrixInverse);t=Xb(r).setGroup(Gm).label("cameraProjectionMatricesInverse").element(e.isMultiViewCamera?Kb("gl_ViewID_OVR"):Zb).toVar("cameraProjectionMatrixInverse")}else t=Hm("mat4").label("cameraProjectionMatrixInverse").setGroup(Gm).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse);return t}).once()(),nv=qf(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const r=[];for(const t of e.cameras)r.push(t.matrixWorldInverse);t=Xb(r).setGroup(Gm).label("cameraViewMatrices").element(e.isMultiViewCamera?Kb("gl_ViewID_OVR"):Zb).toVar("cameraViewMatrix")}else t=Hm("mat4").label("cameraViewMatrix").setGroup(Gm).onRenderUpdate(({camera:e})=>e.matrixWorldInverse);return t}).once()(),iv=Hm("mat4").label("cameraWorldMatrix").setGroup(Gm).onRenderUpdate(({camera:e})=>e.matrixWorld),ov=Hm("mat3").label("cameraNormalMatrix").setGroup(Gm).onRenderUpdate(({camera:e})=>e.normalMatrix),sv=Hm(new o).label("cameraPosition").setGroup(Gm).onRenderUpdate(({camera:e},t)=>t.value.setFromMatrixPosition(e.matrixWorld)),av=new cn;class Av extends Fp{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Pp.OBJECT,this.uniformNode=new zm(null)}getNodeType(){const e=this.scope;return e===Av.WORLD_MATRIX?"mat4":e===Av.POSITION||e===Av.VIEW_POSITION||e===Av.DIRECTION||e===Av.SCALE?"vec3":e===Av.RADIUS?"float":void 0}update(e){const t=this.object3d,r=this.uniformNode,n=this.scope;if(n===Av.WORLD_MATRIX)r.value=t.matrixWorld;else if(n===Av.POSITION)r.value=r.value||new o,r.value.setFromMatrixPosition(t.matrixWorld);else if(n===Av.SCALE)r.value=r.value||new o,r.value.setFromMatrixScale(t.matrixWorld);else if(n===Av.DIRECTION)r.value=r.value||new o,t.getWorldDirection(r.value);else if(n===Av.VIEW_POSITION){const n=e.camera;r.value=r.value||new o,r.value.setFromMatrixPosition(t.matrixWorld),r.value.applyMatrix4(n.matrixWorldInverse)}else if(n===Av.RADIUS){const n=e.object.geometry;null===n.boundingSphere&&n.computeBoundingSphere(),av.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),r.value=av.radius}}generate(e){const t=this.scope;return t===Av.WORLD_MATRIX?this.uniformNode.nodeType="mat4":t===Av.POSITION||t===Av.VIEW_POSITION||t===Av.DIRECTION||t===Av.SCALE?this.uniformNode.nodeType="vec3":t===Av.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Av.WORLD_MATRIX="worldMatrix",Av.POSITION="position",Av.SCALE="scale",Av.VIEW_POSITION="viewPosition",Av.DIRECTION="direction",Av.RADIUS="radius";const lv=Pf(Av,Av.DIRECTION).setParameterLength(1),uv=Pf(Av,Av.WORLD_MATRIX).setParameterLength(1),cv=Pf(Av,Av.POSITION).setParameterLength(1),hv=Pf(Av,Av.SCALE).setParameterLength(1),dv=Pf(Av,Av.VIEW_POSITION).setParameterLength(1),pv=Pf(Av,Av.RADIUS).setParameterLength(1);class fv extends Av{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const mv=Df(fv,fv.DIRECTION),gv=Df(fv,fv.WORLD_MATRIX),yv=Df(fv,fv.POSITION),bv=Df(fv,fv.SCALE),vv=Df(fv,fv.VIEW_POSITION),_v=Df(fv,fv.RADIUS),xv=Hm(new Te).onObjectUpdate(({object:e},t)=>t.value.getNormalMatrix(e.matrixWorld)),wv=Hm(new i).onObjectUpdate(({object:e},t)=>t.value.copy(e.matrixWorld).invert()),Tv=qf(e=>e.renderer.overrideNodes.modelViewMatrix||Sv).once()().toVar("modelViewMatrix"),Sv=nv.mul(gv),Ev=qf(e=>(e.context.isHighPrecisionModelViewMatrix=!0,Hm("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),Mv=qf(e=>{const t=e.context.isHighPrecisionModelViewMatrix;return Hm("mat3").onObjectUpdate(({object:e,camera:r})=>(!0!==t&&e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),Nv=Ob("position","vec3"),Cv=Nv.toVarying("positionLocal"),Rv=Nv.toVarying("positionPrevious"),Pv=qf(e=>gv.mul(Cv).xyz.toVarying(e.getNamespace("v_positionWorld")),"vec3").once("POSITION")(),Dv=qf(e=>Cv.transformDirection(gv).toVarying(e.getNamespace("v_positionWorldDirection")).normalize().toVar("positionWorldDirection"),"vec3").once("POSITION")(),Bv=qf(e=>e.context.setupPositionView().toVarying(e.getNamespace("v_positionView")),"vec3").once("POSITION")(),qv=Bv.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Ov extends Fp{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:r}=e;return t.coordinateSystem===I&&r.side===O?"false":e.getFrontFacing()}}const Lv=Df(Ov),kv=Uf(Lv).mul(2).sub(1),Iv=Ob("normal","vec3"),Fv=qf(e=>!1===e.geometry.hasAttribute("normal")?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),$f(0,1,0)):Iv,"vec3").once()().toVar("normalLocal"),Uv=Bv.dFdx().cross(Bv.dFdy()).normalize().toVar("normalFlat"),Vv=qf(e=>{let t;return t=!0===e.material.flatShading?Uv:Ky(Qv(Fv),"v_normalView").normalize(),t},"vec3").once()().toVar("normalView"),Gv=qf(e=>{let t=Vv.transformDirection(nv);return!0!==e.material.flatShading&&(t=Ky(t,"v_normalWorld")),t},"vec3").once()().normalize().toVar("normalWorld"),jv=qf(e=>{let t=e.context.setupNormal().context({getUV:null});return!0!==e.material.flatShading&&(t=t.mul(kv)),t},"vec3").once()().toVar("transformedNormalView"),zv=jv.transformDirection(nv).toVar("transformedNormalWorld"),Hv=qf(e=>{let t=e.context.setupClearcoatNormal().context({getUV:null});return!0!==e.material.flatShading&&(t=t.mul(kv)),t},"vec3").once()().toVar("transformedClearcoatNormalView"),Wv=qf(([e,t=gv])=>{const r=nm(t),n=e.div($f(r[0].dot(r[0]),r[1].dot(r[1]),r[2].dot(r[2])));return r.mul(n).xyz}),Qv=qf(([e],t)=>{const r=t.renderer.overrideNodes.modelNormalViewMatrix;if(null!==r)return r.transformDirection(e);const n=xv.mul(e);return nv.transformDirection(n)}),$v=new rn,Yv=new i,Xv=Hm(0).onReference(({material:e})=>e).onObjectUpdate(({material:e})=>e.refractionRatio),Kv=Hm(1).onReference(({material:e})=>e).onObjectUpdate(function({material:e,scene:t}){return e.envMap?e.envMapIntensity:t.environmentIntensity}),Zv=Hm(new i).onReference(function(e){return e.material}).onObjectUpdate(function({material:e,scene:t}){const r=null!==t.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation;return r?($v.copy(r),Yv.makeRotationFromEuler($v)):Yv.identity(),Yv}),Jv=qv.negate().reflect(jv),e_=qv.negate().refract(jv,Xv),t_=Jv.transformDirection(nv).toVar("reflectVector"),r_=e_.transformDirection(nv).toVar("reflectVector"),n_=new _e;class i_ extends Gb{static get type(){return"CubeTextureNode"}constructor(e,t=null,r=null,n=null){super(e,t,r,n),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===ln?t_:e.mapping===un?r_:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),$f(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return e.renderer.coordinateSystem!==Ee&&r.isRenderTargetTexture||(t=$f(t.x.negate(),t.yz)),Zv.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const o_=Pf(i_).setParameterLength(1,4).setName("cubeTexture"),s_=(e=n_,t=null,r=null,n=null)=>{let i;return e&&!0===e.isCubeTextureNode?(i=Nf(e.clone()),i.referenceNode=e.getSelf(),null!==t&&(i.uvNode=Nf(t)),null!==r&&(i.levelNode=Nf(r)),null!==n&&(i.biasNode=Nf(n))):i=o_(e,t,r,n),i};class a_ extends Up{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),r=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,r,n)}}class A_ extends Fp{static get type(){return"ReferenceNode"}constructor(e,t,r=null,n=null){super(),this.property=e,this.uniformType=t,this.object=r,this.count=n,this.properties=e.split("."),this.reference=r,this.node=null,this.group=null,this.name=null,this.updateType=Pp.OBJECT}element(e){return Nf(new a_(this,Nf(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;t=null!==this.count?Qb(null,e,this.count):Array.isArray(this.getValueFromReference())?Xb(null,e):"texture"===e?zb(null):"cubeTexture"===e?s_(null):Hm(null,e),null!==this.group&&t.setGroup(this.group),null!==this.name&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let r=e[t[0]];for(let n=1;n<t.length;n++)r=r[t[n]];return r}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const l_=(e,t,r)=>Nf(new A_(e,t,r)),u_=(e,t,r,n)=>Nf(new A_(e,t,n,r));class c_ extends A_{static get type(){return"MaterialReferenceNode"}constructor(e,t,r=null){super(e,t,r),this.material=r,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}const h_=(e,t,r=null)=>Nf(new c_(e,t,r)),d_=qf(e=>(!1===e.geometry.hasAttribute("tangent")&&e.geometry.computeTangents(),Ob("tangent","vec4")))(),p_=d_.xyz.toVar("tangentLocal"),f_=Tv.mul(Zf(p_,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),m_=f_.transformDirection(nv).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),g_=f_.toVar("transformedTangentView"),y_=g_.transformDirection(nv).normalize().toVar("transformedTangentWorld"),b_=qf(([e,t],r)=>{let n=e.mul(d_.w).xyz;return!0!==r.material.flatShading&&(n=Ky(n,t)),n}).once(),v_=b_(Iv.cross(d_),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),__=b_(Fv.cross(p_),"v_bitangentLocal").normalize().toVar("bitangentLocal"),x_=b_(Vv.cross(f_),"v_bitangentView").normalize().toVar("bitangentView"),w_=b_(Gv.cross(m_),"v_bitangentWorld").normalize().toVar("bitangentWorld"),T_=b_(jv.cross(g_),"v_transformedBitangentView").normalize().toVar("transformedBitangentView"),S_=T_.transformDirection(nv).normalize().toVar("transformedBitangentWorld"),E_=nm(f_,x_,Vv),M_=qv.mul(E_),N_=(()=>{let e=Tm.cross(qv);return e=e.cross(Tm).normalize(),e=My(e,jv,xm.mul(hm.oneMinus()).oneMinus().pow2().pow2()).normalize(),e})(),C_=qf(e=>{const{eye_pos:t,surf_norm:r,mapN:n,uv:i}=e,o=t.dFdx(),s=t.dFdy(),a=i.dFdx(),A=i.dFdy(),l=r,u=s.cross(l),c=l.cross(o),h=u.mul(a.x).add(c.mul(A.x)),d=u.mul(a.y).add(c.mul(A.y)),p=h.dot(h).max(d.dot(d)),f=kv.mul(p.inverseSqrt());return eg(h.mul(n.x,f),d.mul(n.y,f),l.mul(n.z)).normalize()});class R_ extends Gp{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=dn}setup(e){const{normalMapType:t,scaleNode:r}=this;let n=this.node.mul(2).sub(1);null!==r&&(n=$f(n.xy.mul(r),n.z));let i=null;if(t===pn)i=Qv(n);else if(t===dn){i=!0===e.hasGeometryAttribute("tangent")?E_.mul(n).normalize():C_({eye_pos:Bv,surf_norm:Vv,mapN:n,uv:Lb()})}return i}}const P_=Pf(R_).setParameterLength(1,2),D_=qf(({textureNode:e,bumpScale:t})=>{const r=t=>e.cache().context({getUV:e=>t(e.uvNode||Lb()),forceUVContext:!0}),n=Uf(r(e=>e));return zf(Uf(r(e=>e.add(e.dFdx()))).sub(n),Uf(r(e=>e.add(e.dFdy()))).sub(n)).mul(t)}),B_=qf(e=>{const{surf_pos:t,surf_norm:r,dHdxy:n}=e,i=t.dFdx().normalize(),o=r,s=t.dFdy().normalize().cross(o),a=o.cross(i),A=i.dot(s).mul(kv),l=A.sign().mul(n.x.mul(s).add(n.y.mul(a)));return A.abs().mul(r).sub(l).normalize()});class q_ extends Gp{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=null!==this.scaleNode?this.scaleNode:1,t=D_({textureNode:this.textureNode,bumpScale:e});return B_({surf_pos:Bv,surf_norm:Vv,dHdxy:t})}}const O_=Pf(q_).setParameterLength(1,2),L_=new Map;class k_ extends Fp{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let r=L_.get(e);return void 0===r&&(r=h_(e,t),L_.set(e,r)),r}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){const t=e.context.material,r=this.scope;let n=null;if(r===k_.COLOR){const e=void 0!==t.color?this.getColor(r):$f();n=t.map&&!0===t.map.isTexture?e.mul(this.getTexture("map")):e}else if(r===k_.OPACITY){const e=this.getFloat(r);n=t.alphaMap&&!0===t.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(r===k_.SPECULAR_STRENGTH)n=t.specularMap&&!0===t.specularMap.isTexture?this.getTexture("specular").r:Uf(1);else if(r===k_.SPECULAR_INTENSITY){const e=this.getFloat(r);n=t.specularIntensityMap&&!0===t.specularIntensityMap.isTexture?e.mul(this.getTexture(r).a):e}else if(r===k_.SPECULAR_COLOR){const e=this.getColor(r);n=t.specularColorMap&&!0===t.specularColorMap.isTexture?e.mul(this.getTexture(r).rgb):e}else if(r===k_.ROUGHNESS){const e=this.getFloat(r);n=t.roughnessMap&&!0===t.roughnessMap.isTexture?e.mul(this.getTexture(r).g):e}else if(r===k_.METALNESS){const e=this.getFloat(r);n=t.metalnessMap&&!0===t.metalnessMap.isTexture?e.mul(this.getTexture(r).b):e}else if(r===k_.EMISSIVE){const e=this.getFloat("emissiveIntensity"),i=this.getColor(r).mul(e);n=t.emissiveMap&&!0===t.emissiveMap.isTexture?i.mul(this.getTexture(r)):i}else if(r===k_.NORMAL)t.normalMap?(n=P_(this.getTexture("normal"),this.getCache("normalScale","vec2")),n.normalMapType=t.normalMapType):n=t.bumpMap?O_(this.getTexture("bump").r,this.getFloat("bumpScale")):Vv;else if(r===k_.CLEARCOAT){const e=this.getFloat(r);n=t.clearcoatMap&&!0===t.clearcoatMap.isTexture?e.mul(this.getTexture(r).r):e}else if(r===k_.CLEARCOAT_ROUGHNESS){const e=this.getFloat(r);n=t.clearcoatRoughnessMap&&!0===t.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(r).r):e}else if(r===k_.CLEARCOAT_NORMAL)n=t.clearcoatNormalMap?P_(this.getTexture(r),this.getCache(r+"Scale","vec2")):Vv;else if(r===k_.SHEEN){const e=this.getColor("sheenColor").mul(this.getFloat("sheen"));n=t.sheenColorMap&&!0===t.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(r===k_.SHEEN_ROUGHNESS){const e=this.getFloat(r);n=t.sheenRoughnessMap&&!0===t.sheenRoughnessMap.isTexture?e.mul(this.getTexture(r).a):e,n=n.clamp(.07,1)}else if(r===k_.ANISOTROPY)if(t.anisotropyMap&&!0===t.anisotropyMap.isTexture){const e=this.getTexture(r);n=rm(_x.x,_x.y,_x.y.negate(),_x.x).mul(e.rg.mul(2).sub(zf(1)).normalize().mul(e.b))}else n=_x;else if(r===k_.IRIDESCENCE_THICKNESS){const e=l_("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const i=l_("0","float",t.iridescenceThicknessRange);n=e.sub(i).mul(this.getTexture(r).g).add(i)}else n=e}else if(r===k_.TRANSMISSION){const e=this.getFloat(r);n=t.transmissionMap?e.mul(this.getTexture(r).r):e}else if(r===k_.THICKNESS){const e=this.getFloat(r);n=t.thicknessMap?e.mul(this.getTexture(r).g):e}else if(r===k_.IOR)n=this.getFloat(r);else if(r===k_.LIGHT_MAP)n=this.getTexture(r).rgb.mul(this.getFloat("lightMapIntensity"));else if(r===k_.AO)n=this.getTexture(r).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(r===k_.LINE_DASH_OFFSET)n=t.dashOffset?this.getFloat(r):Uf(0);else{const t=this.getNodeType(e);n=this.getCache(r,t)}return n}}k_.ALPHA_TEST="alphaTest",k_.COLOR="color",k_.OPACITY="opacity",k_.SHININESS="shininess",k_.SPECULAR="specular",k_.SPECULAR_STRENGTH="specularStrength",k_.SPECULAR_INTENSITY="specularIntensity",k_.SPECULAR_COLOR="specularColor",k_.REFLECTIVITY="reflectivity",k_.ROUGHNESS="roughness",k_.METALNESS="metalness",k_.NORMAL="normal",k_.CLEARCOAT="clearcoat",k_.CLEARCOAT_ROUGHNESS="clearcoatRoughness",k_.CLEARCOAT_NORMAL="clearcoatNormal",k_.EMISSIVE="emissive",k_.ROTATION="rotation",k_.SHEEN="sheen",k_.SHEEN_ROUGHNESS="sheenRoughness",k_.ANISOTROPY="anisotropy",k_.IRIDESCENCE="iridescence",k_.IRIDESCENCE_IOR="iridescenceIOR",k_.IRIDESCENCE_THICKNESS="iridescenceThickness",k_.IOR="ior",k_.TRANSMISSION="transmission",k_.THICKNESS="thickness",k_.ATTENUATION_DISTANCE="attenuationDistance",k_.ATTENUATION_COLOR="attenuationColor",k_.LINE_SCALE="scale",k_.LINE_DASH_SIZE="dashSize",k_.LINE_GAP_SIZE="gapSize",k_.LINE_WIDTH="linewidth",k_.LINE_DASH_OFFSET="dashOffset",k_.POINT_SIZE="size",k_.DISPERSION="dispersion",k_.LIGHT_MAP="light",k_.AO="ao";const I_=Df(k_,k_.ALPHA_TEST),F_=Df(k_,k_.COLOR),U_=Df(k_,k_.SHININESS),V_=Df(k_,k_.EMISSIVE),G_=Df(k_,k_.OPACITY),j_=Df(k_,k_.SPECULAR),z_=Df(k_,k_.SPECULAR_INTENSITY),H_=Df(k_,k_.SPECULAR_COLOR),W_=Df(k_,k_.SPECULAR_STRENGTH),Q_=Df(k_,k_.REFLECTIVITY),$_=Df(k_,k_.ROUGHNESS),Y_=Df(k_,k_.METALNESS),X_=Df(k_,k_.NORMAL),K_=Df(k_,k_.CLEARCOAT),Z_=Df(k_,k_.CLEARCOAT_ROUGHNESS),J_=Df(k_,k_.CLEARCOAT_NORMAL),ex=Df(k_,k_.ROTATION),tx=Df(k_,k_.SHEEN),rx=Df(k_,k_.SHEEN_ROUGHNESS),nx=Df(k_,k_.ANISOTROPY),ix=Df(k_,k_.IRIDESCENCE),ox=Df(k_,k_.IRIDESCENCE_IOR),sx=Df(k_,k_.IRIDESCENCE_THICKNESS),ax=Df(k_,k_.TRANSMISSION),Ax=Df(k_,k_.THICKNESS),lx=Df(k_,k_.IOR),ux=Df(k_,k_.ATTENUATION_DISTANCE),cx=Df(k_,k_.ATTENUATION_COLOR),hx=Df(k_,k_.LINE_SCALE),dx=Df(k_,k_.LINE_DASH_SIZE),px=Df(k_,k_.LINE_GAP_SIZE),fx=Df(k_,k_.LINE_WIDTH),mx=Df(k_,k_.LINE_DASH_OFFSET),gx=Df(k_,k_.POINT_SIZE),yx=Df(k_,k_.DISPERSION),bx=Df(k_,k_.LIGHT_MAP),vx=Df(k_,k_.AO),_x=Hm(new n).onReference(function(e){return e.material}).onRenderUpdate(function({material:e}){this.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation))}),xx=qf(e=>e.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class wx extends Fp{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),r=this.scope;let n,i;if(r===wx.VERTEX)n=e.getVertexIndex();else if(r===wx.INSTANCE)n=e.getInstanceIndex();else if(r===wx.DRAW)n=e.getDrawIndex();else if(r===wx.INVOCATION_LOCAL)n=e.getInvocationLocalIndex();else if(r===wx.INVOCATION_SUBGROUP)n=e.getInvocationSubgroupIndex();else{if(r!==wx.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+r);n=e.getSubgroupIndex()}if("vertex"===e.shaderStage||"compute"===e.shaderStage)i=n;else{i=Ky(this).build(e,t)}return i}}wx.VERTEX="vertex",wx.INSTANCE="instance",wx.SUBGROUP="subgroup",wx.INVOCATION_LOCAL="invocationLocal",wx.INVOCATION_SUBGROUP="invocationSubgroup",wx.DRAW="draw";const Tx=Df(wx,wx.VERTEX),Sx=Df(wx,wx.INSTANCE),Ex=Df(wx,wx.SUBGROUP),Mx=Df(wx,wx.INVOCATION_SUBGROUP),Nx=Df(wx,wx.INVOCATION_LOCAL),Cx=Df(wx,wx.DRAW);class Rx extends Fp{static get type(){return"InstanceNode"}constructor(e,t,r=null){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=r,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Pp.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:r,instanceColor:n}=this;let{instanceMatrixNode:i,instanceColorNode:o}=this;if(null===i){if(t<=1e3)i=Qb(r.array,"mat4",Math.max(t,1)).element(Sx);else{const e=new An(r.array,16,1);this.buffer=e;const t=r.usage===we?mb:fb,n=[t(e,"vec4",16,0),t(e,"vec4",16,4),t(e,"vec4",16,8),t(e,"vec4",16,12)];i=im(...n)}this.instanceMatrixNode=i}if(n&&null===o){const e=new y(n.array,3),t=n.usage===we?mb:fb;this.bufferColor=e,o=$f(t(e,"vec3",3,0)),this.instanceColorNode=o}const s=i.mul(Cv).xyz;if(Cv.assign(s),e.hasGeometryAttribute("normal")){const e=Wv(Fv,i);Fv.assign(e)}null!==this.instanceColorNode&&lm("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==we&&null!==this.buffer&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==we&&null!==this.bufferColor&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}const Px=Pf(Rx).setParameterLength(2,3);class Dx extends Rx{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:r,instanceColor:n}=e;super(t,r,n),this.instancedMesh=e}}const Bx=Pf(Dx).setParameterLength(1);class qx extends Fp{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(null===e.getDrawIndex()?this.batchingIdNode=Sx:this.batchingIdNode=Cx);const t=qf(([e])=>{const t=Vf(Ib(Hb(this.batchMesh._indirectTexture),0).x),r=Vf(e).mod(t),n=Vf(e).div(t);return Hb(this.batchMesh._indirectTexture,Hf(r,n)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),r=t(Vf(this.batchingIdNode)),n=this.batchMesh._matricesTexture,i=Vf(Ib(Hb(n),0).x),o=Uf(r).mul(4).toInt().toVar(),s=o.mod(i),a=o.div(i),A=im(Hb(n,Hf(s,a)),Hb(n,Hf(s.add(1),a)),Hb(n,Hf(s.add(2),a)),Hb(n,Hf(s.add(3),a))),l=this.batchMesh._colorsTexture;if(null!==l){const e=qf(([e])=>{const t=Vf(Ib(Hb(l),0).x),r=e,n=r.mod(t),i=r.div(t);return Hb(l,Hf(n,i)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),t=e(r);lm("vec3","vBatchColor").assign(t)}const u=nm(A);Cv.assign(A.mul(Cv));const c=Fv.div($f(u[0].dot(u[0]),u[1].dot(u[1]),u[2].dot(u[2]))),h=u.mul(c).xyz;Fv.assign(h),e.hasGeometryAttribute("tangent")&&p_.mulAssign(u)}}const Ox=Pf(qx).setParameterLength(1);class Lx extends Up{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const r=this.storageBufferNode.structTypeNode;return r?r.getMemberType(e,t):"void"}setup(e){return!1===e.isAvailable("storageBuffer")&&!0===this.node.isPBO&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let r;const n=e.context.assign;if(r=!1===e.isAvailable("storageBuffer")?!0!==this.node.isPBO||!0===n||!this.node.value.isInstancedBufferAttribute&&"compute"===e.shaderStage?this.node.build(e):e.generatePBO(this):super.generate(e),!0!==n){const n=this.getNodeType(e);r=e.format(r,n,t)}return r}}const kx=Pf(Lx).setParameterLength(2);class Ix extends Wb{static get type(){return"StorageBufferNode"}constructor(e,t=null,r=0){let n,i=null;t&&t.isStruct?(n="struct",i=t.layout,(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)&&(r=e.count)):null===t&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(n=vp(e.itemSize),r=e.count):n=t,super(e,n,r),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=Dp.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,!0!==e.isStorageBufferAttribute&&!0!==e.isStorageInstancedBufferAttribute&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(0===this.bufferCount){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return kx(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Dp.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return null===this._attribute&&(this._attribute=db(this.value),this._varying=Ky(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(null!==this.structTypeNode)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}getMemberType(e,t){return null!==this.structTypeNode?this.structTypeNode.getMemberType(e,t):"void"}generate(e){if(null!==this.structTypeNode&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:r}=this.getAttributeData(),n=r.build(e);return e.registerTransform(n,t),n}}const Fx=(e,t=null,r=0)=>Nf(new Ix(e,t,r)),Ux=new WeakMap;class Vx extends Fp{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Pp.OBJECT,this.skinIndexNode=Ob("skinIndex","uvec4"),this.skinWeightNode=Ob("skinWeight","vec4"),this.bindMatrixNode=l_("bindMatrix","mat4"),this.bindMatrixInverseNode=l_("bindMatrixInverse","mat4"),this.boneMatricesNode=u_("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Cv,this.toPositionNode=Cv,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:r,skinWeightNode:n,bindMatrixNode:i,bindMatrixInverseNode:o}=this,s=e.element(r.x),a=e.element(r.y),A=e.element(r.z),l=e.element(r.w),u=i.mul(t),c=eg(s.mul(n.x).mul(u),a.mul(n.y).mul(u),A.mul(n.z).mul(u),l.mul(n.w).mul(u));return o.mul(c).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Fv){const{skinIndexNode:r,skinWeightNode:n,bindMatrixNode:i,bindMatrixInverseNode:o}=this,s=e.element(r.x),a=e.element(r.y),A=e.element(r.z),l=e.element(r.w);let u=eg(n.x.mul(s),n.y.mul(a),n.z.mul(A),n.w.mul(l));return u=o.mul(u).mul(i),u.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return null===this.previousBoneMatricesNode&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=u_("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Rv)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||!0===Mp(e.object).useVelocity}setup(e){this.needsPreviousBoneMatrices(e)&&Rv.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const t=this.getSkinnedNormal();Fv.assign(t),e.hasGeometryAttribute("tangent")&&p_.assign(t)}return t}generate(e,t){if("void"!==t)return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Ux.get(t)!==e.frameId&&(Ux.set(t,e.frameId),null!==this.previousBoneMatricesNode&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const Gx=e=>Nf(new Vx(e));class jx extends Fp{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(void 0!==t.stackNode)return t;const r={};for(let o=0,s=this.params.length-1;o<s;o++){const e=this.params[o],t=!0!==e.isNode&&e.name||this.getVarName(o),n=!0!==e.isNode&&e.type||"int";r[t]=Nb(t,n)}const n=e.addStack();t.returnsNode=this.params[this.params.length-1](r,e),t.stackNode=n;const i=this.params[0];return!0!==i.isNode&&"function"==typeof i.update&&(t.updateNode=qf(this.params[0].update)(r)),e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),r=this.params,n=t.stackNode;for(let s=0,a=r.length-1;s<a;s++){const n=r[s];let i,o=!1,a=null,A=null,l=null,u=null,c=null,h=null;if(n.isNode?"bool"===n.getNodeType(e)?(o=!0,u="bool",A=n.build(e,u)):(u="int",l=this.getVarName(s),a="0",A=n.build(e,u),c="<"):(u=n.type||"int",l=n.name||this.getVarName(s),a=n.start,A=n.end,c=n.condition,h=n.update,"number"==typeof a?a=e.generateConst(u,a):a&&a.isNode&&(a=a.build(e,u)),"number"==typeof A?A=e.generateConst(u,A):A&&A.isNode&&(A=A.build(e,u)),void 0!==a&&void 0===A?(a+=" - 1",A="0",c=">="):void 0!==A&&void 0===a&&(a="0",c="<"),void 0===c&&(c=Number(a)>Number(A)?">=":"<")),o)i=`while ( ${A} )`;else{const r={start:a,end:A},n=r.start,o=r.end;let s;const d=()=>c.includes("<")?"+=":"-=";if(null!=h)switch(typeof h){case"function":s=e.flowStagesNode(t.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":s=l+" "+d()+" "+e.generateConst(u,h);break;case"string":s=l+" "+h;break;default:h.isNode?s=l+" "+d()+" "+h.build(e):(console.error("THREE.TSL: 'Loop( { update: ... } )' is not a function, string or number."),s="break /* invalid update */")}else h="int"===u||"uint"===u?c.includes("<")?"++":"--":d()+" 1.",s=l+" "+h;i=`for ( ${e.getVar(u,l)+" = "+n}; ${l+" "+c+" "+o}; ${s} )`}e.addFlowCode((0===s?"\n":"")+e.tab+i+" {\n\n").addFlowTab()}const i=n.build(e,"void"),o=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode("\n"+e.tab+i);for(let s=0,a=this.params.length-1;s<a;s++)e.addFlowCode((0===s?"":e.tab)+"}\n\n").removeFlowTab();return e.addFlowTab(),o}}const zx=(...e)=>Nf(new jx(Rf(e,"int"))).toStack(),Hx=()=>Nb("break").toStack(),Wx=new WeakMap,Qx=new M,$x=qf(({bufferMap:e,influence:t,stride:r,width:n,depth:i,offset:o})=>{const s=Vf(Tx).mul(r).add(o),a=s.div(n),A=s.sub(a.mul(n));return Hb(e,Hf(A,a)).depth(i).xyz.mul(t)});class Yx extends Fp{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Hm(1),this.updateType=Pp.OBJECT}setup(e){const{geometry:t}=e,r=void 0!==t.morphAttributes.position,i=t.hasAttribute("normal")&&void 0!==t.morphAttributes.normal,o=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,s=void 0!==o?o.length:0,{texture:a,stride:A,size:l}=function(e){const t=void 0!==e.morphAttributes.position,r=void 0!==e.morphAttributes.normal,i=void 0!==e.morphAttributes.color,o=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,s=void 0!==o?o.length:0;let a=Wx.get(e);if(void 0===a||a.count!==s){void 0!==a&&a.texture.dispose();const A=e.morphAttributes.position||[],l=e.morphAttributes.normal||[],u=e.morphAttributes.color||[];let c=0;!0===t&&(c=1),!0===r&&(c=2),!0===i&&(c=3);let h=e.attributes.position.count*c,d=1;const p=4096;h>p&&(d=Math.ceil(h/p),h=p);const f=new Float32Array(h*d*4*s),m=new gn(f,h,d,s);m.type=Ke,m.needsUpdate=!0;const g=4*c;for(let b=0;b<s;b++){const v=A[b],_=l[b],x=u[b],w=h*d*4*b;for(let T=0;T<v.count;T++){const S=T*g;!0===t&&(Qx.fromBufferAttribute(v,T),f[w+S+0]=Qx.x,f[w+S+1]=Qx.y,f[w+S+2]=Qx.z,f[w+S+3]=0),!0===r&&(Qx.fromBufferAttribute(_,T),f[w+S+4]=Qx.x,f[w+S+5]=Qx.y,f[w+S+6]=Qx.z,f[w+S+7]=0),!0===i&&(Qx.fromBufferAttribute(x,T),f[w+S+8]=Qx.x,f[w+S+9]=Qx.y,f[w+S+10]=Qx.z,f[w+S+11]=4===x.itemSize?Qx.w:1)}}function y(){m.dispose(),Wx.delete(e),e.removeEventListener("dispose",y)}a={count:s,texture:m,stride:c,size:new n(h,d)},Wx.set(e,a),e.addEventListener("dispose",y)}return a}(t);!0===r&&Cv.mulAssign(this.morphBaseInfluence),!0===i&&Fv.mulAssign(this.morphBaseInfluence);const u=Vf(l.width);zx(s,({i:e})=>{const t=Uf(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?t.assign(Hb(this.mesh.morphTexture,Hf(Vf(e).add(1),Vf(Sx))).r):t.assign(l_("morphTargetInfluences","float").element(e).toVar()),kf(t.notEqual(0),()=>{!0===r&&Cv.addAssign($x({bufferMap:a,influence:t,stride:A,width:u,depth:e,offset:Vf(0)})),!0===i&&Fv.addAssign($x({bufferMap:a,influence:t,stride:A,width:u,depth:e,offset:Vf(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}const Xx=Pf(Yx).setParameterLength(1);class Kx extends Fp{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class Zx extends Kx{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Jx extends Gy{static get type(){return"LightingContextNode"}constructor(e,t=null,r=null,n=null){super(e),this.lightingModel=t,this.backdropNode=r,this.backdropAlphaNode=n,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,r={directDiffuse:$f().toVar("directDiffuse"),directSpecular:$f().toVar("directSpecular"),indirectDiffuse:$f().toVar("indirectDiffuse"),indirectSpecular:$f().toVar("indirectSpecular")};return{radiance:$f().toVar("radiance"),irradiance:$f().toVar("irradiance"),iblIrradiance:$f().toVar("iblIrradiance"),ambientOcclusion:Uf(1).toVar("ambientOcclusion"),reflectedLight:r,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const ew=Pf(Jx);class tw extends Kx{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let rw,nw;class iw extends Fp{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===iw.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Pp.NONE;return this.scope!==iw.SIZE&&this.scope!==iw.VIEWPORT||(e=Pp.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===iw.VIEWPORT?null!==t?nw.copy(t.viewport):(e.getViewport(nw),nw.multiplyScalar(e.getPixelRatio())):null!==t?(rw.width=t.width,rw.height=t.height):e.getDrawingBufferSize(rw)}setup(){const e=this.scope;let t=null;return t=e===iw.SIZE?Hm(rw||(rw=new n)):e===iw.VIEWPORT?Hm(nw||(nw=new M)):zf(aw.div(sw)),t}generate(e){if(this.scope===iw.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const r=e.getNodeProperties(sw).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${r}.y - ${t}.y )`}return t}return super.generate(e)}}iw.COORDINATE="coordinate",iw.VIEWPORT="viewport",iw.SIZE="size",iw.UV="uv";const ow=Df(iw,iw.UV),sw=Df(iw,iw.SIZE),aw=Df(iw,iw.COORDINATE),Aw=Df(iw,iw.VIEWPORT),lw=Aw.zw,uw=aw.sub(Aw.xy),cw=uw.div(lw),hw=qf(()=>(console.warn('THREE.TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),sw),"vec2").once()(),dw=qf(()=>(console.warn('THREE.TSL: "viewportTopLeft" is deprecated. Use "screenUV" instead.'),ow),"vec2").once()(),pw=qf(()=>(console.warn('THREE.TSL: "viewportBottomLeft" is deprecated. Use "screenUV.flipY()" instead.'),ow.flipY()),"vec2").once()(),fw=new n;class mw extends Gb{static get type(){return"ViewportTextureNode"}constructor(e=ow,t=null,r=null){null===r&&((r=new mn).minFilter=qe),super(r,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Pp.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(fw);const r=this.value;r.image.width===fw.width&&r.image.height===fw.height||(r.image.width=fw.width,r.image.height=fw.height,r.needsUpdate=!0);const n=r.generateMipmaps;r.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(r),r.generateMipmaps=n}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const gw=Pf(mw).setParameterLength(0,3),yw=Pf(mw,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let bw=null;class vw extends mw{static get type(){return"ViewportDepthTextureNode"}constructor(e=ow,t=null){null===bw&&(bw=new se),super(e,t,bw)}}const _w=Pf(vw).setParameterLength(0,2);class xw extends Fp{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===xw.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,r=this.valueNode;let n=null;if(t===xw.DEPTH_BASE)null!==r&&(n=Mw().assign(r));else if(t===xw.DEPTH)n=e.isPerspectiveCamera?Tw(Bv.z,Jb,ev):ww(Bv.z,Jb,ev);else if(t===xw.LINEAR_DEPTH)if(null!==r)if(e.isPerspectiveCamera){const e=Sw(r,Jb,ev);n=ww(e,Jb,ev)}else n=r;else n=ww(Bv.z,Jb,ev);return n}}xw.DEPTH_BASE="depthBase",xw.DEPTH="depth",xw.LINEAR_DEPTH="linearDepth";const ww=(e,t,r)=>e.add(t).div(t.sub(r)),Tw=(e,t,r)=>t.add(e).mul(r).div(r.sub(t).mul(e)),Sw=(e,t,r)=>t.mul(r).div(r.sub(t).mul(e).sub(r)),Ew=(e,t,r)=>{t=t.max(1e-6).toVar();const n=Fg(e.negate().div(t)),i=Fg(r.div(t));return n.div(i)},Mw=Pf(xw,xw.DEPTH_BASE),Nw=Df(xw,xw.DEPTH),Cw=Pf(xw,xw.LINEAR_DEPTH).setParameterLength(0,1),Rw=Cw(_w());Nw.assign=e=>Mw(e);class Pw extends Fp{static get type(){return"ClippingNode"}constructor(e=Pw.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:r,unionPlanes:n}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Pw.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(r,n):this.scope===Pw.HARDWARE?this.setupHardwareClipping(n,e):this.setupDefault(r,n)}setupAlphaToCoverage(e,t){return qf(()=>{const r=Uf().toVar("distanceToPlane"),n=Uf().toVar("distanceToGradient"),i=Uf(1).toVar("clipOpacity"),o=t.length;if(!1===this.hardwareClipping&&o>0){const e=Xb(t);zx(o,({i:t})=>{const o=e.element(t);r.assign(Bv.dot(o.xyz).negate().add(o.w)),n.assign(r.fwidth().div(2)),i.mulAssign(Py(n.negate(),n,r))})}const s=e.length;if(s>0){const t=Xb(e),o=Uf(1).toVar("intersectionClipOpacity");zx(s,({i:e})=>{const i=t.element(e);r.assign(Bv.dot(i.xyz).negate().add(i.w)),n.assign(r.fwidth().div(2)),o.mulAssign(Py(n.negate(),n,r).oneMinus())}),i.mulAssign(o.oneMinus())}um.a.mulAssign(i),um.a.equal(0).discard()})()}setupDefault(e,t){return qf(()=>{const r=t.length;if(!1===this.hardwareClipping&&r>0){const e=Xb(t);zx(r,({i:t})=>{const r=e.element(t);Bv.dot(r.xyz).greaterThan(r.w).discard()})}const n=e.length;if(n>0){const t=Xb(e),r=jf(!0).toVar("clipped");zx(n,({i:e})=>{const n=t.element(e);r.assign(Bv.dot(n.xyz).greaterThan(n.w).and(r))}),r.discard()}})()}setupHardwareClipping(e,t){const r=e.length;return t.enableHardwareClipping(r),qf(()=>{const n=Xb(e),i=Kb(t.getClipDistance());zx(r,({i:e})=>{const t=n.element(e),r=Bv.dot(t.xyz).sub(t.w).negate();i.element(e).assign(r)})})()}}Pw.ALPHA_TO_COVERAGE="alphaToCoverage",Pw.DEFAULT="default",Pw.HARDWARE="hardware";const Dw=qf(([e])=>Hg(rg(1e4,Wg(rg(17,e.x).add(rg(.1,e.y)))).mul(eg(.1,Zg(Wg(rg(13,e.y).add(e.x))))))),Bw=qf(([e])=>Dw(zf(Dw(e.xy),e.z))),qw=qf(([e])=>{const t=dy(ey(ny(e.xyz)),ey(iy(e.xyz))),r=Uf(1).div(Uf(.05).mul(t)).toVar("pixScale"),n=zf(kg(Gg(Fg(r))),kg(jg(Fg(r)))),i=zf(Bw(Gg(n.x.mul(e.xyz))),Bw(Gg(n.y.mul(e.xyz)))),o=Hg(Fg(r)),s=eg(rg(o.oneMinus(),i.x),rg(o,i.y)),a=hy(o,o.oneMinus()),A=$f(s.mul(s).div(rg(2,a).mul(tg(1,a))),s.sub(rg(.5,a)).div(tg(1,a)),tg(1,tg(1,s).mul(tg(1,s)).div(rg(2,a).mul(tg(1,a))))),l=s.lessThan(a.oneMinus()).select(s.lessThan(a).select(A.x,A.y),A.z);return Ny(l,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Ow extends qb{static get type(){return"VertexColorNode"}constructor(e){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e);let r;return r=!0===e.hasGeometryAttribute(t)?super.generate(e):e.generateConst(this.nodeType,new M(1,1,1,1)),r}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const Lw=(e=0)=>Nf(new Ow(e));class kw extends J{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:e=>{console.warn('THREE.NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=e}})}customProgramCacheKey(){return this.type+mp(this)}build(e){this.setup(e)}setupObserver(e){return new cp(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,r=t.getRenderTarget();e.addStack();const n=this.setupVertex(e),i=this.vertexNode||n;let o;e.stack.outputNode=i,this.setupHardwareClipping(e),null!==this.geometryNode&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();const s=this.setupClipping(e);if(!0!==this.depthWrite&&!0!==this.depthTest||(null!==r?!0===r.depthBuffer&&this.setupDepth(e):!0===t.depth&&this.setupDepth(e)),null===this.fragmentNode){this.setupDiffuseColor(e),this.setupVariants(e);const n=this.setupLighting(e);null!==s&&e.stack.add(s);const i=Zf(n,um.a).max(0);o=this.setupOutput(e,i),Nm.assign(o);const a=null!==this.outputNode;if(a&&(o=this.outputNode),null!==r){const e=t.getMRT(),r=this.mrtNode;null!==e?(a&&Nm.assign(o),o=e,null!==r&&(o=e.merge(r))):null!==r&&(o=r)}}else{let t=this.fragmentNode;!0!==t.isOutputStructNode&&(t=Zf(t)),o=this.setupOutput(e,t)}e.stack.outputNode=o,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(null===e.clippingContext)return null;const{unionPlanes:t,intersectionPlanes:r}=e.clippingContext;let n=null;if(t.length>0||r.length>0){const t=e.renderer.samples;this.alphaToCoverage&&t>1?n=Nf(new Pw(Pw.ALPHA_TO_COVERAGE)):e.stack.add(Nf(new Pw))}return n}setupHardwareClipping(e){if(this.hardwareClipping=!1,null===e.clippingContext)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(Nf(new Pw(Pw.HARDWARE))),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:r}=e;let n=this.depthNode;if(null===n){const e=t.getMRT();e&&e.has("depth")?n=e.get("depth"):!0===t.logarithmicDepthBuffer&&(n=r.isPerspectiveCamera?Ew(Bv.z,Jb,ev):ww(Bv.z,Jb,ev))}null!==n&&Nw.assign(n).toStack()}setupPositionView(){return Tv.mul(Cv).xyz}setupModelViewProjection(){return tv.mul(Bv)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),xx}setupPosition(e){const{object:t,geometry:r}=e;if((r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color)&&Xx(t).toStack(),!0===t.isSkinnedMesh&&Gx(t).toStack(),this.displacementMap){const e=h_("displacementMap","texture"),t=h_("displacementScale","float"),r=h_("displacementBias","float");Cv.addAssign(Fv.normalize().mul(e.x.mul(t).add(r)))}return t.isBatchedMesh&&Ox(t).toStack(),t.isInstancedMesh&&t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&Bx(t).toStack(),null!==this.positionNode&&Cv.assign(_b(this.positionNode,"POSITION")),Cv}setupDiffuseColor({object:e,geometry:t}){null!==this.maskNode&&jf(this.maskNode).not().discard();let r=this.colorNode?Zf(this.colorNode):F_;if(!0===this.vertexColors&&t.hasAttribute("color")&&(r=r.mul(Lw())),e.instanceColor){r=lm("vec3","vInstanceColor").mul(r)}if(e.isBatchedMesh&&e._colorsTexture){r=lm("vec3","vBatchColor").mul(r)}um.assign(r);const n=this.opacityNode?Uf(this.opacityNode):G_;um.a.assign(um.a.mul(n));let i=null;(null!==this.alphaTestNode||this.alphaTest>0)&&(i=null!==this.alphaTestNode?Uf(this.alphaTestNode):I_,um.a.lessThanEqual(i).discard()),!0===this.alphaHash&&um.a.lessThan(qw(Cv)).discard();!1===this.transparent&&this.blending===ee&&!1===this.alphaToCoverage?um.a.assign(1):null===i&&um.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return!0===this.lights?$f(0):um.rgb}setupNormal(){return this.normalNode?$f(this.normalNode):X_}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?h_("envMap","cubeTexture"):h_("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new tw(bx)),t}setupLights(e){const t=[],r=this.setupEnvironment(e);r&&r.isLightingNode&&t.push(r);const n=this.setupLightMap(e);if(n&&n.isLightingNode&&t.push(n),null!==this.aoNode||e.material.aoMap){const e=null!==this.aoNode?this.aoNode:vx;t.push(new Zx(e))}let i=this.lightsNode||e.lightsNode;return t.length>0&&(i=e.renderer.lighting.createNode([...i.getLights(),...t])),i}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:r,backdropAlphaNode:n,emissiveNode:i}=this,o=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null;let s=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const t=this.setupLightingModel(e)||null;s=ew(o,t,r,n)}else null!==r&&(s=$f(null!==n?My(s,r,n):r));return(i&&!0===i.isNode||t.emissive&&!0===t.emissive.isColor)&&(cm.assign($f(i||V_)),s=s.add(cm)),s}setupFog(e,t){const r=e.fogNode;return r&&(Nm.assign(t),t=Zf(r)),t}setupOutput(e,t){return!0===this.fog&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const r in e){const t=e[r];void 0===this[r]&&(this[r]=t,t&&t.clone&&(this[r]=t.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const r in t)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,r)&&void 0!==t[r].get&&Object.defineProperty(this.constructor.prototype,r,t[r])}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{},nodes:{}});const r=J.prototype.toJSON.call(this,e),n=gp(this);r.inputNodes={};for(const{property:o,childNode:s}of n)r.inputNodes[o]=s.toJSON(e).uuid;function i(e){const t=[];for(const r in e){const n=e[r];delete n.metadata,t.push(n)}return t}if(t){const t=i(e.textures),n=i(e.images),o=i(e.nodes);t.length>0&&(r.textures=t),n.length>0&&(r.images=n),o.length>0&&(r.nodes=o)}return r}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.maskNode=e.maskNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.receivedShadowPositionNode=e.receivedShadowPositionNode,this.castShadowPositionNode=e.castShadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const Iw=new _r;class Fw extends kw{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(Iw),this.setValues(e)}}const Uw=new xr;class Vw extends kw{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(Uw),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Uf(this.offsetNode):mx,t=this.dashScaleNode?Uf(this.dashScaleNode):hx,r=this.dashSizeNode?Uf(this.dashSizeNode):dx,n=this.gapSizeNode?Uf(this.gapSizeNode):px;Cm.assign(r),Rm.assign(n);const i=Ky(Ob("lineDistance").mul(t));(e?i.add(e):i).mod(Cm.add(Rm)).greaterThan(Cm).discard()}}let Gw=null;class jw extends mw{static get type(){return"ViewportSharedTextureNode"}constructor(e=ow,t=null){null===Gw&&(Gw=new mn),super(e,t,Gw)}updateReference(){return this}}const zw=Pf(jw).setParameterLength(0,2),Hw=e=>Nf(e).mul(.5).add(.5),Ww=new br;class Qw extends kw{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Ww),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Uf(this.opacityNode):G_;um.assign(ib(Zf(Hw(jv),e),p))}}class $w extends Gp{static get type(){return"EquirectUVNode"}constructor(e=Dv){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(2*Math.PI)).add(.5),r=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return zf(t,r)}}const Yw=Pf($w).setParameterLength(0,1);class Xw extends nn{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const r=t.minFilter,n=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new on(5,5,5),o=Yw(Dv),s=new kw;s.colorNode=zb(t,o,0),s.side=O,s.blending=dt;const a=new A(i,s),l=new C;l.add(a),t.minFilter===qe&&(t.minFilter=P);const u=new sn(1,10,this),c=e.getMRT();return e.setMRT(null),u.update(e,l),e.setMRT(c),t.minFilter=r,t.currentGenerateMipmaps=n,a.geometry.dispose(),a.material.dispose(),this}}const Kw=new WeakMap;class Zw extends Gp{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=s_(null);const t=new _e;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Pp.RENDER}updateBefore(e){const{renderer:t,material:r}=e,n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const e=n.isTextureNode?n.value:r[n.property];if(e&&e.isTexture){const r=e.mapping;if(r===ye||r===be){if(Kw.has(e)){const t=Kw.get(e);eT(t,e.mapping),this._cubeTexture=t}else{const r=e.image;if(function(e){return null!=e&&e.height>0}(r)){const n=new Xw(r.height);n.fromEquirectangularTexture(t,e),eT(n.texture,e.mapping),this._cubeTexture=n.texture,Kw.set(e,n.texture),e.addEventListener("dispose",Jw)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function Jw(e){const t=e.target;t.removeEventListener("dispose",Jw);const r=Kw.get(t);void 0!==r&&(Kw.delete(t),r.dispose())}function eT(e,t){t===ye?e.mapping=ln:t===be&&(e.mapping=un)}const tT=Pf(Zw).setParameterLength(1);class rT extends Kx{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=tT(this.envNode)}}class nT extends Kx{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Uf(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class iT{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class oT extends iT{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,r=e.reflectedLight,n=e.irradianceLightMap;r.indirectDiffuse.assign(Zf(0)),n?r.indirectDiffuse.addAssign(n):r.indirectDiffuse.addAssign(Zf(1,1,1,0)),r.indirectDiffuse.mulAssign(t),r.indirectDiffuse.mulAssign(um.rgb)}finish(e){const{material:t,context:r}=e,n=r.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case Zr:n.rgb.assign(My(n.rgb,n.rgb.mul(i.rgb),W_.mul(Q_)));break;case Kr:n.rgb.assign(My(n.rgb,i.rgb,W_.mul(Q_)));break;case Xr:n.rgb.addAssign(i.rgb.mul(W_.mul(Q_)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine)}}}const sT=new u;class aT extends kw{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(sT),this.setValues(e)}setupNormal(){return Vv}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new rT(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new nT(bx)),t}setupOutgoingLight(){return um.rgb}setupLightingModel(){return new oT}}const AT=qf(({f0:e,f90:t,dotVH:r})=>{const n=r.mul(-5.55473).sub(6.98316).mul(r).exp2();return e.mul(n.oneMinus()).add(t.mul(n))}),lT=qf(e=>e.diffuseColor.mul(1/Math.PI)),uT=qf(({dotNH:e})=>Mm.mul(Uf(.5)).add(1).mul(Uf(1/Math.PI)).mul(e.pow(Mm))),cT=qf(({lightDirection:e})=>{const t=e.add(qv).normalize(),r=jv.dot(t).clamp(),n=qv.dot(t).clamp(),i=AT({f0:Sm,f90:1,dotVH:n}),o=Uf(.25),s=uT({dotNH:r});return i.mul(o).mul(s)});class hT extends oT{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const n=jv.dot(e).clamp().mul(t);r.directDiffuse.addAssign(n.mul(lT({diffuseColor:um.rgb}))),!0===this.specular&&r.directSpecular.addAssign(n.mul(cT({lightDirection:e})).mul(W_))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(r.mul(lT({diffuseColor:um}))),n.indirectDiffuse.mulAssign(t)}}const dT=new h;class pT extends kw{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(dT),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new rT(t):null}setupLightingModel(){return new hT(!1)}}const fT=new fr;class mT extends kw{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(fT),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new rT(t):null}setupLightingModel(){return new hT}setupVariants(){const e=(this.shininessNode?Uf(this.shininessNode):U_).max(1e-4);Mm.assign(e);const t=this.specularNode||j_;Sm.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const gT=qf(e=>{if(!1===e.geometry.hasAttribute("normal"))return Uf(0);const t=Vv.dFdx().abs().max(Vv.dFdy().abs());return t.x.max(t.y).max(t.z)}),yT=qf(e=>{const{roughness:t}=e,r=gT();let n=t.max(.0525);return n=n.add(r),n=n.min(1),n}),bT=qf(({alpha:e,dotNL:t,dotNV:r})=>{const n=e.pow2(),i=t.mul(n.add(n.oneMinus().mul(r.pow2())).sqrt()),o=r.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt());return ng(.5,i.add(o).max(Ng))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),vT=qf(({alphaT:e,alphaB:t,dotTV:r,dotBV:n,dotTL:i,dotBL:o,dotNV:s,dotNL:a})=>{const A=a.mul($f(e.mul(r),t.mul(n),s).length()),l=s.mul($f(e.mul(i),t.mul(o),a).length());return ng(.5,A.add(l)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),_T=qf(({alpha:e,dotNH:t})=>{const r=e.pow2(),n=t.pow2().mul(r.oneMinus()).oneMinus();return r.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),xT=Uf(1/Math.PI),wT=qf(({alphaT:e,alphaB:t,dotNH:r,dotTH:n,dotBH:i})=>{const o=e.mul(t),s=$f(t.mul(n),e.mul(i),o.mul(r)),a=s.dot(s),A=o.div(a);return xT.mul(o.mul(A.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),TT=qf(e=>{const{lightDirection:t,f0:r,f90:n,roughness:i,f:o,USE_IRIDESCENCE:s,USE_ANISOTROPY:a}=e,A=e.normalView||jv,l=i.pow2(),u=t.add(qv).normalize(),c=A.dot(t).clamp(),h=A.dot(qv).clamp(),d=A.dot(u).clamp(),p=qv.dot(u).clamp();let f,m,g=AT({f0:r,f90:n,dotVH:p});if(Sf(s)&&(g=ym.mix(g,o)),Sf(a)){const e=wm.dot(t),r=wm.dot(qv),n=wm.dot(u),i=Tm.dot(t),o=Tm.dot(qv),s=Tm.dot(u);f=vT({alphaT:_m,alphaB:l,dotTV:r,dotBV:o,dotTL:e,dotBL:i,dotNV:h,dotNL:c}),m=wT({alphaT:_m,alphaB:l,dotNH:d,dotTH:n,dotBH:s})}else f=bT({alpha:l,dotNL:c,dotNV:h}),m=_T({alpha:l,dotNH:d});return g.mul(f).mul(m)}),ST=qf(({roughness:e,dotNV:t})=>{const r=Zf(-1,-.0275,-.572,.022),n=Zf(1,.0425,1.04,-.04),i=e.mul(r).add(n),o=i.x.mul(i.x).min(t.mul(-9.28).exp2()).mul(i.x).add(i.y);return zf(-1.04,1.04).mul(o).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),ET=qf(e=>{const{dotNV:t,specularColor:r,specularF90:n,roughness:i}=e,o=ST({dotNV:t,roughness:i});return r.mul(o.x).add(n.mul(o.y))}),MT=qf(({f:e,f90:t,dotVH:r})=>{const n=r.oneMinus().saturate(),i=n.mul(n),o=n.mul(i,i).clamp(0,.9999);return e.sub($f(t).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),NT=qf(({roughness:e,dotNH:t})=>{const r=e.pow2(),n=Uf(1).div(r),i=t.pow2().oneMinus().max(.0078125);return Uf(2).add(n).mul(i.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),CT=qf(({dotNV:e,dotNL:t})=>Uf(1).div(Uf(4).mul(t.add(e).sub(t.mul(e))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),RT=qf(({lightDirection:e})=>{const t=e.add(qv).normalize(),r=jv.dot(e).clamp(),n=jv.dot(qv).clamp(),i=jv.dot(t).clamp(),o=NT({roughness:gm,dotNH:i}),s=CT({dotNV:n,dotNL:r});return mm.mul(o).mul(s)}),PT=qf(({N:e,V:t,roughness:r})=>{const n=e.dot(t).saturate(),i=zf(r,n.oneMinus().sqrt());return i.assign(i.mul(.984375).add(.0078125)),i}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),DT=qf(({f:e})=>{const t=e.length();return dy(t.mul(t).add(e.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),BT=qf(({v1:e,v2:t})=>{const r=e.dot(t),n=r.abs().toVar(),i=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),o=n.add(4.1616724).mul(n).add(3.417594).toVar(),s=i.div(o),a=r.greaterThan(0).select(s,dy(r.mul(r).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(s));return e.cross(t).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),qT=qf(({N:e,V:t,P:r,mInv:n,p0:i,p1:o,p2:s,p3:a})=>{const A=o.sub(i).toVar(),l=a.sub(i).toVar(),u=A.cross(l),c=$f().toVar();return kf(u.dot(r.sub(i)).greaterThanEqual(0),()=>{const A=t.sub(e.mul(t.dot(e))).normalize(),l=e.cross(A).negate(),u=n.mul(nm(A,l,e).transpose()).toVar(),h=u.mul(i.sub(r)).normalize().toVar(),d=u.mul(o.sub(r)).normalize().toVar(),p=u.mul(s.sub(r)).normalize().toVar(),f=u.mul(a.sub(r)).normalize().toVar(),m=$f(0).toVar();m.addAssign(BT({v1:h,v2:d})),m.addAssign(BT({v1:d,v2:p})),m.addAssign(BT({v1:p,v2:f})),m.addAssign(BT({v1:f,v2:h})),c.assign($f(DT({f:m})))}),c}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),OT=1/6,LT=e=>rg(OT,rg(e,rg(e,e.negate().add(3)).sub(3)).add(1)),kT=e=>rg(OT,rg(e,rg(e,rg(3,e).sub(6))).add(4)),IT=e=>rg(OT,rg(e,rg(e,rg(-3,e).add(3)).add(3)).add(1)),FT=e=>rg(OT,vy(e,3)),UT=e=>LT(e).add(kT(e)),VT=e=>IT(e).add(FT(e)),GT=e=>eg(-1,kT(e).div(LT(e).add(kT(e)))),jT=e=>eg(1,FT(e).div(IT(e).add(FT(e)))),zT=(e,t,r)=>{const n=e.uvNode,i=rg(n,t.zw).add(.5),o=Gg(i),s=Hg(i),a=UT(s.x),A=VT(s.x),l=GT(s.x),u=jT(s.x),c=GT(s.y),h=jT(s.y),d=zf(o.x.add(l),o.y.add(c)).sub(.5).mul(t.xy),p=zf(o.x.add(u),o.y.add(c)).sub(.5).mul(t.xy),f=zf(o.x.add(l),o.y.add(h)).sub(.5).mul(t.xy),m=zf(o.x.add(u),o.y.add(h)).sub(.5).mul(t.xy),g=UT(s.y).mul(eg(a.mul(e.sample(d).level(r)),A.mul(e.sample(p).level(r)))),y=VT(s.y).mul(eg(a.mul(e.sample(f).level(r)),A.mul(e.sample(m).level(r))));return g.add(y)},HT=qf(([e,t=Uf(3)])=>{const r=zf(e.size(Vf(t))),n=zf(e.size(Vf(t.add(1)))),i=ng(1,r),o=ng(1,n),s=zT(e,Zf(i,r),Gg(t)),a=zT(e,Zf(o,n),jg(t));return Hg(t).mix(s,a)}),WT=qf(([e,t,r,n,i])=>{const o=$f(Ry(t.negate(),zg(e),ng(1,n))),s=$f(ey(i[0].xyz),ey(i[1].xyz),ey(i[2].xyz));return zg(o).mul(r.mul(s))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),QT=qf(([e,t])=>e.mul(Ny(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),$T=yw(),YT=yw(),XT=qf(([e,t,r],{material:n})=>{const i=(n.side===O?$T:YT).sample(e),o=Fg(sw.x).mul(QT(t,r));return HT(i,o)}),KT=qf(([e,t,r])=>(kf(r.notEqual(0),()=>{const n=Ig(t).negate().div(r);return Lg(n.negate().mul(e))}),$f(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),ZT=qf(([e,t,r,n,i,o,s,a,A,l,u,c,h,d,p])=>{let f,m;if(p){f=Zf().toVar(),m=$f().toVar();const i=u.sub(1).mul(p.mul(.025)),o=$f(u.sub(i),u,u.add(i));zx({start:0,end:3},({i:i})=>{const u=o.element(i),p=WT(e,t,c,u,a),g=s.add(p),y=l.mul(A.mul(Zf(g,1))),b=zf(y.xy.div(y.w)).toVar();b.addAssign(1),b.divAssign(2),b.assign(zf(b.x,b.y.oneMinus()));const v=XT(b,r,u);f.element(i).assign(v.element(i)),f.a.addAssign(v.a),m.element(i).assign(n.element(i).mul(KT(ey(p),h,d).element(i)))}),f.a.divAssign(3)}else{const i=WT(e,t,c,u,a),o=s.add(i),p=l.mul(A.mul(Zf(o,1))),g=zf(p.xy.div(p.w)).toVar();g.addAssign(1),g.divAssign(2),g.assign(zf(g.x,g.y.oneMinus())),f=XT(g,r,u),m=n.mul(KT(ey(i),h,d))}const g=m.rgb.mul(f.rgb),y=e.dot(t).clamp(),b=$f(ET({dotNV:y,specularColor:i,specularF90:o,roughness:r})),v=m.r.add(m.g,m.b).div(3);return Zf(b.oneMinus().mul(g),f.a.oneMinus().mul(v).oneMinus())}),JT=nm(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),eS=(e,t)=>e.sub(t).div(e.add(t)).pow2(),tS=qf(({outsideIOR:e,eta2:t,cosTheta1:r,thinFilmThickness:n,baseF0:i})=>{const o=My(e,t,Py(0,.03,n)),s=e.div(o).pow2().mul(r.pow2().oneMinus()).oneMinus();kf(s.lessThan(0),()=>$f(1));const a=s.sqrt(),A=eS(o,e),l=AT({f0:A,f90:1,dotVH:r}),u=l.oneMinus(),c=o.lessThan(e).select(Math.PI,0),h=Uf(Math.PI).sub(c),d=(e=>{const t=e.sqrt();return $f(1).add(t).div($f(1).sub(t))})(i.clamp(0,.9999)),p=eS(d,o.toVec3()),f=AT({f0:p,f90:1,dotVH:a}),m=$f(d.x.lessThan(o).select(Math.PI,0),d.y.lessThan(o).select(Math.PI,0),d.z.lessThan(o).select(Math.PI,0)),g=o.mul(n,a,2),y=$f(h).add(m),b=l.mul(f).clamp(1e-5,.9999),v=b.sqrt(),_=u.pow2().mul(f).div($f(1).sub(b)),x=l.add(_).toVar(),w=_.sub(u).toVar();return zx({start:1,end:2,condition:"<=",name:"m"},({m:e})=>{w.mulAssign(v);const t=((e,t)=>{const r=e.mul(2*Math.PI*1e-9),n=$f(54856e-17,44201e-17,52481e-17),i=$f(1681e3,1795300,2208400),o=$f(43278e5,93046e5,66121e5),s=Uf(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(r.mul(2239900).add(t.x).cos()).mul(r.pow2().mul(-45282e5).exp());let a=n.mul(o.mul(2*Math.PI).sqrt()).mul(i.mul(r).add(t).cos()).mul(r.pow2().negate().mul(o).exp());return a=$f(a.x.add(s),a.y,a.z).div(1.0685e-7),JT.mul(a)})(Uf(e).mul(g),Uf(e).mul(y)).mul(2);x.addAssign(w.mul(t))}),x.max($f(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),rS=qf(({normal:e,viewDir:t,roughness:r})=>{const n=e.dot(t).saturate(),i=r.pow2(),o=Uy(r.lessThan(.25),Uf(-339.2).mul(i).add(Uf(161.4).mul(r)).sub(25.9),Uf(-8.48).mul(i).add(Uf(14.3).mul(r)).sub(9.95)),s=Uy(r.lessThan(.25),Uf(44).mul(i).sub(Uf(23.7).mul(r)).add(3.26),Uf(1.97).mul(i).sub(Uf(3.27).mul(r)).add(.72));return Uy(r.lessThan(.25),0,Uf(.1).mul(r).sub(.025)).add(o.mul(n).add(s).exp()).mul(1/Math.PI).saturate()}),nS=$f(.04),iS=Uf(1);class oS extends iT{constructor(e=!1,t=!1,r=!1,n=!1,i=!1,o=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=r,this.anisotropy=n,this.transmission=i,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(!0===this.clearcoat&&(this.clearcoatRadiance=$f().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=$f().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=$f().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=$f().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=$f().toVar("sheenSpecularIndirect")),!0===this.iridescence){const e=jv.dot(qv).clamp();this.iridescenceFresnel=tS({outsideIOR:Uf(1),eta2:bm,cosTheta1:e,thinFilmThickness:vm,baseF0:Sm}),this.iridescenceF0=MT({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(!0===this.transmission){const t=Pv,r=sv.sub(Pv).normalize(),n=zv,i=e.context;i.backdrop=ZT(n,r,hm,um,Sm,Em,t,gv,nv,tv,Dm,qm,Lm,Om,this.dispersion?km:null),i.backdropAlpha=Bm,um.a.mulAssign(My(1,i.backdrop.a,Bm))}super.start(e)}computeMultiscattering(e,t,r){const n=jv.dot(qv).clamp(),i=ST({roughness:hm,dotNV:n}),o=(this.iridescenceF0?ym.mix(Sm,this.iridescenceF0):Sm).mul(i.x).add(r.mul(i.y)),s=i.x.add(i.y).oneMinus(),a=Sm.add(Sm.oneMinus().mul(.047619)),A=o.mul(a).div(s.mul(a).oneMinus());e.addAssign(o),t.addAssign(A.mul(s))}direct({lightDirection:e,lightColor:t,reflectedLight:r}){const n=jv.dot(e).clamp().mul(t);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(n.mul(RT({lightDirection:e}))),!0===this.clearcoat){const r=Hv.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(r.mul(TT({lightDirection:e,f0:nS,f90:iS,roughness:fm,normalView:Hv})))}r.directDiffuse.addAssign(n.mul(lT({diffuseColor:um.rgb}))),r.directSpecular.addAssign(n.mul(TT({lightDirection:e,f0:Sm,f90:1,roughness:hm,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:r,halfHeight:n,reflectedLight:i,ltc_1:o,ltc_2:s}){const a=t.add(r).sub(n),A=t.sub(r).sub(n),l=t.sub(r).add(n),u=t.add(r).add(n),c=jv,h=qv,d=Bv.toVar(),p=PT({N:c,V:h,roughness:hm}),f=o.sample(p).toVar(),m=s.sample(p).toVar(),g=nm($f(f.x,0,f.y),$f(0,1,0),$f(f.z,0,f.w)).toVar(),y=Sm.mul(m.x).add(Sm.oneMinus().mul(m.y)).toVar();i.directSpecular.addAssign(e.mul(y).mul(qT({N:c,V:h,P:d,mInv:g,p0:a,p1:A,p2:l,p3:u}))),i.directDiffuse.addAssign(e.mul(um).mul(qT({N:c,V:h,P:d,mInv:nm(1,0,0,0,1,0,0,0,1),p0:a,p1:A,p2:l,p3:u})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(t.mul(lT({diffuseColor:um})))}indirectSpecular(e){const{radiance:t,iblIrradiance:r,reflectedLight:n}=e.context;if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(r.mul(mm,rS({normal:jv,viewDir:qv,roughness:gm}))),!0===this.clearcoat){const e=Hv.dot(qv).clamp(),t=ET({dotNV:e,specularColor:nS,specularF90:iS,roughness:fm});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(t))}const i=$f().toVar("singleScattering"),o=$f().toVar("multiScattering"),s=r.mul(1/Math.PI);this.computeMultiscattering(i,o,Em);const a=i.add(o),A=um.mul(a.r.max(a.g).max(a.b).oneMinus());n.indirectSpecular.addAssign(t.mul(i)),n.indirectSpecular.addAssign(o.mul(s)),n.indirectDiffuse.addAssign(A.mul(s))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:r}=e.context,n=jv.dot(qv).clamp().add(t),i=hm.mul(-16).oneMinus().negate().exp2(),o=t.sub(n.pow(i).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(t),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(t),r.indirectDiffuse.mulAssign(t),r.indirectSpecular.mulAssign(o)}finish({context:e}){const{outgoingLight:t}=e;if(!0===this.clearcoat){const e=Hv.dot(qv).clamp(),r=AT({dotVH:e,f0:nS,f90:iS}),n=t.mul(pm.mul(r).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(pm));t.assign(n)}if(!0===this.sheen){const e=mm.r.max(mm.g).max(mm.b).mul(.157).oneMinus(),r=t.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(r)}}}const sS=Uf(1),aS=Uf(-2),AS=Uf(.8),lS=Uf(-1),uS=Uf(.4),cS=Uf(2),hS=Uf(.305),dS=Uf(3),pS=Uf(.21),fS=Uf(4),mS=Uf(4),gS=Uf(16),yS=qf(([e])=>{const t=$f(Zg(e)).toVar(),r=Uf(-1).toVar();return kf(t.x.greaterThan(t.z),()=>{kf(t.x.greaterThan(t.y),()=>{r.assign(Uy(e.x.greaterThan(0),0,3))}).Else(()=>{r.assign(Uy(e.y.greaterThan(0),1,4))})}).Else(()=>{kf(t.z.greaterThan(t.y),()=>{r.assign(Uy(e.z.greaterThan(0),2,5))}).Else(()=>{r.assign(Uy(e.y.greaterThan(0),1,4))})}),r}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),bS=qf(([e,t])=>{const r=zf().toVar();return kf(t.equal(0),()=>{r.assign(zf(e.z,e.y).div(Zg(e.x)))}).ElseIf(t.equal(1),()=>{r.assign(zf(e.x.negate(),e.z.negate()).div(Zg(e.y)))}).ElseIf(t.equal(2),()=>{r.assign(zf(e.x.negate(),e.y).div(Zg(e.z)))}).ElseIf(t.equal(3),()=>{r.assign(zf(e.z.negate(),e.y).div(Zg(e.x)))}).ElseIf(t.equal(4),()=>{r.assign(zf(e.x.negate(),e.z).div(Zg(e.y)))}).Else(()=>{r.assign(zf(e.x,e.y).div(Zg(e.z)))}),rg(.5,r.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),vS=qf(([e])=>{const t=Uf(0).toVar();return kf(e.greaterThanEqual(AS),()=>{t.assign(sS.sub(e).mul(lS.sub(aS)).div(sS.sub(AS)).add(aS))}).ElseIf(e.greaterThanEqual(uS),()=>{t.assign(AS.sub(e).mul(cS.sub(lS)).div(AS.sub(uS)).add(lS))}).ElseIf(e.greaterThanEqual(hS),()=>{t.assign(uS.sub(e).mul(dS.sub(cS)).div(uS.sub(hS)).add(cS))}).ElseIf(e.greaterThanEqual(pS),()=>{t.assign(hS.sub(e).mul(fS.sub(dS)).div(hS.sub(pS)).add(dS))}).Else(()=>{t.assign(Uf(-2).mul(Fg(rg(1.16,e))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),_S=qf(([e,t])=>{const r=e.toVar();r.assign(rg(2,r).sub(1));const n=$f(r,1).toVar();return kf(t.equal(0),()=>{n.assign(n.zyx)}).ElseIf(t.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),xS=qf(([e,t,r,n,i,o])=>{const s=Uf(r),a=$f(t),A=Ny(vS(s),aS,o),l=Hg(A),u=Gg(A),c=$f(wS(e,a,u,n,i,o)).toVar();return kf(l.notEqual(0),()=>{const t=$f(wS(e,a,u.add(1),n,i,o)).toVar();c.assign(My(c,t,l))}),c}),wS=qf(([e,t,r,n,i,o])=>{const s=Uf(r).toVar(),a=$f(t),A=Uf(yS(a)).toVar(),l=Uf(dy(mS.sub(s),0)).toVar();s.assign(dy(s,mS));const u=Uf(kg(s)).toVar(),c=zf(bS(a,A).mul(u.sub(2)).add(1)).toVar();return kf(A.greaterThan(2),()=>{c.y.addAssign(u),A.subAssign(3)}),c.x.addAssign(A.mul(u)),c.x.addAssign(l.mul(rg(3,gS))),c.y.addAssign(rg(4,kg(o).sub(u))),c.x.mulAssign(n),c.y.mulAssign(i),e.sample(c).grad(zf(),zf())}),TS=qf(({envMap:e,mipInt:t,outputDirection:r,theta:n,axis:i,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:s,CUBEUV_MAX_MIP:a})=>{const A=Qg(n),l=r.mul(A).add(i.cross(r).mul(Wg(n))).add(i.mul(i.dot(r).mul(A.oneMinus())));return wS(e,l,t,o,s,a)}),SS=qf(({n:e,latitudinal:t,poleAxis:r,outputDirection:n,weights:i,samples:o,dTheta:s,mipInt:a,envMap:A,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c})=>{const h=$f(Uy(t,r,by(r,n))).toVar();kf(h.equal($f(0)),()=>{h.assign($f(n.z,0,n.x.negate()))}),h.assign(zg(h));const d=$f().toVar();return d.addAssign(i.element(0).mul(TS({theta:0,axis:h,outputDirection:n,mipInt:a,envMap:A,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c}))),zx({start:Vf(1),end:e},({i:e})=>{kf(e.greaterThanEqual(o),()=>{Hx()});const t=Uf(s.mul(Uf(e))).toVar();d.addAssign(i.element(e).mul(TS({theta:t.mul(-1),axis:h,outputDirection:n,mipInt:a,envMap:A,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c}))),d.addAssign(i.element(e).mul(TS({theta:t,axis:h,outputDirection:n,mipInt:a,envMap:A,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c})))}),Zf(d,1)}),ES=[.125,.215,.35,.446,.526,.582],MS=20,NS=new Z(-1,1,1,-1,0,1),CS=new ne(90,1),RS=new te;let PS=null,DS=0,BS=0;const qS=(1+Math.sqrt(5))/2,OS=1/qS,LS=[new o(-qS,OS,0),new o(qS,OS,0),new o(-OS,0,qS),new o(OS,0,qS),new o(0,qS,-OS),new o(0,qS,OS),new o(-1,1,-1),new o(1,1,-1),new o(-1,1,1),new o(1,1,1)],kS=new o,IS=new WeakMap,FS=[3,1,5,0,4,2],US=_S(Lb(),Ob("faceIndex")).normalize(),VS=$f(US.x,US.y,US.z);class GS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,r=.1,n=100,i={}){const{size:o=256,position:s=kS,renderTarget:a=null}=i;if(this._setSize(o),!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const o=a||this._allocateTarget();return i.renderTarget=o,this.fromSceneAsync(e,t,r,n,i),o}PS=this._renderer.getRenderTarget(),DS=this._renderer.getActiveCubeFace(),BS=this._renderer.getActiveMipmapLevel();const A=a||this._allocateTarget();return A.depthBuffer=!0,this._init(A),this._sceneToCubeUV(e,r,n,A,s),t>0&&this._blur(A,0,0,t),this._applyPMREM(A),this._cleanup(A),A}async fromSceneAsync(e,t=0,r=.1,n=100,i={}){return!1===this._hasInitialized&&await this._renderer.init(),this.fromScene(e,t,r,n,i)}fromEquirectangular(e,t=null){if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromEquirectangularAsync(e,r),r}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(!1===this._hasInitialized){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const r=t||this._allocateTarget();return this.fromCubemapAsync(e,t),r}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=WS(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=QS(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===ln||e.mapping===un?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(PS,DS,BS),e.scissorTest=!1,zS(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),PS=this._renderer.getRenderTarget(),DS=this._renderer.getActiveCubeFace(),BS=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTarget();return this._init(r),this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTarget(){return jS(3*Math.max(this._cubeSize,112),4*this._cubeSize)}_init(e){if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e.width||this._pingPongRenderTarget.height!==e.height){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=jS(e.width,e.height);const{_lodMax:t}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=function(e){const t=[],r=[],n=[],i=[];let o=e;const s=e-4+1+ES.length;for(let a=0;a<s;a++){const s=Math.pow(2,o);r.push(s);let l=1/s;a>e-4?l=ES[a-e+4-1]:0===a&&(l=0),n.push(l);const u=1/(s-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],p=6,m=6,y=3,b=2,v=1,_=new Float32Array(y*m*p),x=new Float32Array(b*m*p),w=new Float32Array(v*m*p);for(let e=0;e<p;e++){const t=e%3*2/3-1,r=e>2?0:-1,n=[t,r,0,t+2/3,r,0,t+2/3,r+1,0,t,r,0,t+2/3,r+1,0,t,r+1,0],i=FS[e];_.set(n,y*m*i),x.set(d,b*m*i);const o=[i,i,i,i,i,i];w.set(o,v*m*i)}const T=new f;T.setAttribute("position",new g(_,y)),T.setAttribute("uv",new g(x,b)),T.setAttribute("faceIndex",new g(w,v)),t.push(T),i.push(new A(T,null)),o>4&&o--}return{lodPlanes:t,sizeLods:r,sigmas:n,lodMeshes:i}}(t)),this._blurMaterial=function(e,t,r){const n=Xb(new Array(MS).fill(0)),i=Hm(new o(0,1,0)),s=Hm(0),a=Uf(MS),A=Hm(0),l=Hm(1),u=zb(null),c=Hm(0),h=Uf(1/t),d=Uf(1/r),p=Uf(e),f={n:a,latitudinal:A,weights:n,poleAxis:i,outputDirection:VS,dTheta:s,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:p},m=HS("blur");return m.fragmentNode=SS({...f,latitudinal:A.equal(1)}),IS.set(m,f),m}(t,e.width,e.height)}}async _compileMaterial(e){const t=new A(this._lodPlanes[0],e);await this._renderer.compile(t,NS)}_sceneToCubeUV(e,t,r,n,i){const o=CS;o.near=t,o.far=r;const s=[1,1,1,1,-1,1],a=[1,-1,1,-1,1,-1],l=this._renderer,c=l.autoClear;l.getClearColor(RS),l.autoClear=!1;let h=this._backgroundBox;if(null===h){const e=new u({name:"PMREM.Background",side:O,depthWrite:!1,depthTest:!1});h=new A(new on,e)}let d=!1;const p=e.background;p?p.isColor&&(h.material.color.copy(p),e.background=null,d=!0):(h.material.color.copy(RS),d=!0),l.setRenderTarget(n),l.clear(),d&&l.render(h,o);for(let A=0;A<6;A++){const t=A%3;0===t?(o.up.set(0,s[A],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x+a[A],i.y,i.z)):1===t?(o.up.set(0,0,s[A]),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y+a[A],i.z)):(o.up.set(0,s[A],0),o.position.set(i.x,i.y,i.z),o.lookAt(i.x,i.y,i.z+a[A]));const r=this._cubeSize;zS(n,t*r,A>2?r:0,r,r),l.render(e,o)}l.autoClear=c,e.background=p}_textureToCubeUV(e,t){const r=this._renderer,n=e.mapping===ln||e.mapping===un;n?null===this._cubemapMaterial&&(this._cubemapMaterial=WS(e)):null===this._equirectMaterial&&(this._equirectMaterial=QS(e));const i=n?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;const o=this._lodMeshes[0];o.material=i;const s=this._cubeSize;zS(t,0,0,3*s,2*s),r.setRenderTarget(t),r.render(o,NS)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const n=this._lodPlanes.length;for(let i=1;i<n;i++){const t=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),r=LS[(n-i-1)%LS.length];this._blur(e,i-1,i,t,r)}t.autoClear=r}_blur(e,t,r,n,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,n,"latitudinal",i),this._halfBlur(o,e,r,r,n,"longitudinal",i)}_halfBlur(e,t,r,n,i,o,s){const a=this._renderer,A=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const l=this._lodMeshes[n];l.material=A;const u=IS.get(A),c=this._sizeLods[r]-1,h=isFinite(i)?Math.PI/(2*c):2*Math.PI/39,d=i/h,p=isFinite(i)?1+Math.floor(3*d):MS;p>MS&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const f=[];let m=0;for(let b=0;b<MS;++b){const e=b/d,t=Math.exp(-e*e/2);f.push(t),0===b?m+=t:b<p&&(m+=2*t)}for(let b=0;b<f.length;b++)f[b]=f[b]/m;e.texture.frame=(e.texture.frame||0)+1,u.envMap.value=e.texture,u.samples.value=p,u.weights.array=f,u.latitudinal.value="latitudinal"===o?1:0,s&&(u.poleAxis.value=s);const{_lodMax:g}=this;u.dTheta.value=h,u.mipInt.value=g-r;const y=this._sizeLods[n];zS(t,3*y*(n>g-4?n-g+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(t),a.render(l,NS)}}function jS(e,t){const r=new R(e,t,{magFilter:P,minFilter:P,generateMipmaps:!1,type:S,format:B,colorSpace:D});return r.texture.mapping=ve,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function zS(e,t,r,n,i){e.viewport.set(t,r,n,i),e.scissor.set(t,r,n,i)}function HS(e){const t=new kw;return t.depthTest=!1,t.depthWrite=!1,t.blending=dt,t.name=`PMREM_${e}`,t}function WS(e){const t=HS("cubemap");return t.fragmentNode=s_(e,VS),t}function QS(e){const t=HS("equirect");return t.fragmentNode=zb(e,Yw(VS),0),t}const $S=new WeakMap;function YS(e,t,r){const n=function(e){let t=$S.get(e);void 0===t&&(t=new WeakMap,$S.set(e,t));return t}(t);let i=n.get(e);if((void 0!==i?i.pmremVersion:-1)!==e.pmremVersion){const t=e.image;if(e.isCubeTexture){if(!function(e){if(null==e)return!1;let t=0;const r=6;for(let n=0;n<r;n++)void 0!==e[n]&&t++;return t===r}(t))return null;i=r.fromCubemap(e,i)}else{if(!function(e){return null!=e&&e.height>0}(t))return null;i=r.fromEquirectangular(e,i)}i.pmremVersion=e.pmremVersion,n.set(e,i)}return i.texture}class XS extends Gp{static get type(){return"PMREMNode"}constructor(e,t=null,r=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=r,this._generator=null;const n=new xe;n.isRenderTargetTexture=!0,this._texture=zb(n),this._width=Hm(0),this._height=Hm(0),this._maxMip=Hm(0),this.updateBeforeType=Pp.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=function(e){const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const r=t?t.pmremVersion:-1,n=this._value;r!==n.pmremVersion&&(t=!0===n.isPMREMTexture?n:YS(n,e.renderer,this._generator),null!==t&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){null===this._generator&&(this._generator=new GS(e.renderer)),this.updateBefore(e);let t=this.uvNode;null===t&&e.context.getUV&&(t=e.context.getUV(this)),t=Zv.mul($f(t.x,t.y.negate(),t.z));let r=this.levelNode;return null===r&&e.context.getTextureLevel&&(r=e.context.getTextureLevel(this)),xS(this._texture,t,r,this._width,this._height,this._maxMip)}dispose(){super.dispose(),null!==this._generator&&this._generator.dispose()}}const KS=Pf(XS).setParameterLength(1,3),ZS=new WeakMap;class JS extends Kx{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const e=r.isTextureNode?r.value:t[r.property];let n=ZS.get(e);void 0===n&&(n=KS(e),ZS.set(e,n)),r=n}const n=!0===t.useAnisotropy||t.anisotropy>0?N_:jv,i=r.context(eE(hm,n)).mul(Kv),o=r.context(tE(zv)).mul(Math.PI).mul(Kv),s=vb(i),a=vb(o);e.context.radiance.addAssign(s),e.context.iblIrradiance.addAssign(a);const A=e.context.lightingModel.clearcoatRadiance;if(A){const e=r.context(eE(fm,Hv)).mul(Kv),t=vb(e);A.addAssign(t)}}}const eE=(e,t)=>{let r=null;return{getUV:()=>(null===r&&(r=qv.negate().reflect(t),r=e.mul(e).mix(r,t).normalize(),r=r.transformDirection(nv)),r),getTextureLevel:()=>e}},tE=e=>({getUV:()=>e,getTextureLevel:()=>Uf(1)}),rE=new mr;class nE extends kw{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(rE),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return null===t&&e.environmentNode&&(t=e.environmentNode),t?new JS(t):null}setupLightingModel(){return new oS}setupSpecular(){const e=My($f(.04),um.rgb,dm);Sm.assign(e),Em.assign(1)}setupVariants(){const e=this.metalnessNode?Uf(this.metalnessNode):Y_;dm.assign(e);let t=this.roughnessNode?Uf(this.roughnessNode):$_;t=yT({roughness:t}),hm.assign(t),this.setupSpecular(),um.assign(Zf(um.rgb.mul(e.oneMinus()),um.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const iE=new gr;class oE extends nE{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(iE),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){const e=this.iorNode?Uf(this.iorNode):lx;Dm.assign(e),Sm.assign(My(hy(_y(Dm.sub(1).div(Dm.add(1))).mul(H_),$f(1)).mul(z_),um.rgb,dm)),Em.assign(My(z_,1,dm))}setupLightingModel(){return new oS(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const e=this.clearcoatNode?Uf(this.clearcoatNode):K_,t=this.clearcoatRoughnessNode?Uf(this.clearcoatRoughnessNode):Z_;pm.assign(e),fm.assign(yT({roughness:t}))}if(this.useSheen){const e=this.sheenNode?$f(this.sheenNode):tx,t=this.sheenRoughnessNode?Uf(this.sheenRoughnessNode):rx;mm.assign(e),gm.assign(t)}if(this.useIridescence){const e=this.iridescenceNode?Uf(this.iridescenceNode):ix,t=this.iridescenceIORNode?Uf(this.iridescenceIORNode):ox,r=this.iridescenceThicknessNode?Uf(this.iridescenceThicknessNode):sx;ym.assign(e),bm.assign(t),vm.assign(r)}if(this.useAnisotropy){const e=(this.anisotropyNode?zf(this.anisotropyNode):nx).toVar();xm.assign(e.length()),kf(xm.equal(0),()=>{e.assign(zf(1,0))}).Else(()=>{e.divAssign(zf(xm)),xm.assign(xm.saturate())}),_m.assign(xm.pow2().mix(hm.pow2(),1)),wm.assign(E_[0].mul(e.x).add(E_[1].mul(e.y))),Tm.assign(E_[1].mul(e.x).sub(E_[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?Uf(this.transmissionNode):ax,t=this.thicknessNode?Uf(this.thicknessNode):Ax,r=this.attenuationDistanceNode?Uf(this.attenuationDistanceNode):ux,n=this.attenuationColorNode?$f(this.attenuationColorNode):cx;if(Bm.assign(e),qm.assign(t),Om.assign(r),Lm.assign(n),this.useDispersion){const e=this.dispersionNode?Uf(this.dispersionNode):yx;km.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?$f(this.clearcoatNormalNode):J_}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const sE=qf(({normal:e,lightDirection:t,builder:r})=>{const n=e.dot(t),i=zf(n.mul(.5).add(.5),0);if(r.material.gradientMap){const e=h_("gradientMap","texture").context({getUV:()=>i});return $f(e.r)}{const e=i.fwidth().mul(.5);return My($f(.7),$f(1),Py(Uf(.7).sub(e.x),Uf(.7).add(e.x),i.x))}});class aE extends iT{direct({lightDirection:e,lightColor:t,reflectedLight:r},n){const i=sE({normal:Iv,lightDirection:e,builder:n}).mul(t);r.directDiffuse.addAssign(i.mul(lT({diffuseColor:um.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:r,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(r.mul(lT({diffuseColor:um}))),n.indirectDiffuse.mulAssign(t)}}const AE=new yr;class lE extends kw{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(AE),this.setValues(e)}setupLightingModel(){return new aE}}class uE extends Gp{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=$f(qv.z,0,qv.x.negate()).normalize(),t=qv.cross(e);return zf(e.dot(jv),t.dot(jv)).mul(.495).add(.5)}}const cE=Df(uE),hE=new vr;class dE extends kw{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(hE),this.setValues(e)}setupVariants(e){const t=cE;let r;r=e.material.matcap?h_("matcap","texture").context({getUV:()=>t}):$f(My(.2,.8,t.y)),um.rgb.mulAssign(r.rgb)}}class pE extends Gp{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:r}=this;if("vec2"===this.getNodeType(e)){const e=t.cos(),n=t.sin();return rm(e,n,n.negate(),e).mul(r)}{const e=t,n=im(Zf(1,0,0,0),Zf(0,Qg(e.x),Wg(e.x).negate(),0),Zf(0,Wg(e.x),Qg(e.x),0),Zf(0,0,0,1)),i=im(Zf(Qg(e.y),0,Wg(e.y),0),Zf(0,1,0,0),Zf(Wg(e.y).negate(),0,Qg(e.y),0),Zf(0,0,0,1)),o=im(Zf(Qg(e.z),Wg(e.z).negate(),0,0),Zf(Wg(e.z),Qg(e.z),0,0),Zf(0,0,1,0),Zf(0,0,0,1));return n.mul(i).mul(o).mul(Zf(r,1)).xyz}}}const fE=Pf(pE).setParameterLength(2),mE=new Tr;class gE extends kw{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(mE),this.setValues(e)}setupPositionView(e){const{object:t,camera:r}=e,n=this.sizeAttenuation,{positionNode:i,rotationNode:o,scaleNode:s}=this,a=Tv.mul($f(i||0));let A=zf(gv[0].xyz.length(),gv[1].xyz.length());if(null!==s&&(A=A.mul(zf(s))),!1===n)if(r.isPerspectiveCamera)A=A.mul(a.z.negate());else{const e=Uf(2).div(tv.element(1).element(1));A=A.mul(e.mul(2))}let l=Nv.xy;if(t.center&&!0===t.center.isVector2){const e=((e,t,r)=>Nf(new sb(e,t,r)))("center","vec2",t);l=l.sub(e.sub(.5))}l=l.mul(A);const u=Uf(o||ex),c=fE(l,u);return Zf(a.xy.add(c),a.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const yE=new wr;class bE extends gE{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(yE),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Tv.mul($f(e||Cv)).xyz}setupVertex(e){const t=super.setupVertex(e);if(!0!==e.material.isNodeMaterial)return t;const{rotationNode:r,scaleNode:n,sizeNode:i}=this,o=Nv.xy.toVar(),s=Aw.z.div(Aw.w);if(r&&r.isNode){const e=Uf(r);o.assign(fE(o,e))}let a=null!==i?zf(i):gx;return!0===this.sizeAttenuation&&(a=a.mul(a.div(Bv.z.negate()))),n&&n.isNode&&(a=a.mul(zf(n))),o.mulAssign(a.mul(2)),o.assign(o.div(Aw.z)),o.y.assign(o.y.mul(s)),o.assign(o.mul(t.w)),t.addAssign(Zf(o,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class vE extends iT{constructor(){super(),this.shadowNode=Uf(1).toVar("shadowMask")}direct({lightNode:e}){null!==e.shadowNode&&this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){um.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(um.rgb)}}const _E=new Sr;class xE extends kw{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(_E),this.setValues(e)}setupLightingModel(){return new vE}}Am("vec3"),Am("vec3"),Am("vec3");class wE{constructor(e,t){this.nodes=e,this.info=t,this._context="undefined"!=typeof self?self:null,this._animationLoop=null,this._requestId=null}start(){const e=(t,r)=>{this._requestId=this._context.requestAnimationFrame(e),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,null!==this._animationLoop&&this._animationLoop(t,r)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class TE{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),void 0===t)return;return t.get(e[e.length-1])}set(e,t){let r=this.weakMap;for(let n=0;n<e.length-1;n++){const t=e[n];!1===r.has(t)&&r.set(t,new WeakMap),r=r.get(t)}return r.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let r=0;r<e.length-1;r++)if(t=t.get(e[r]),void 0===t)return!1;return t.delete(e[e.length-1])}}let SE=0;class EE{constructor(e,t,r,n,i,o,s,a,A,l){this.id=SE++,this._nodes=e,this._geometries=t,this.renderer=r,this.object=n,this.material=i,this.scene=o,this.camera=s,this.lightsNode=a,this.context=A,this.geometry=n.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=l,this.clippingContextCacheKey=null!==l?l.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(null!==this.attributes)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,r=[],n=new Set;for(const i of e){const e=i.node&&i.node.attribute?i.node.attribute:t.getAttribute(i.name);if(void 0===e)continue;r.push(e);const o=e.isInterleavedBufferAttribute?e.data:e;n.add(o)}return this.attributes=r,this.vertexBuffers=Array.from(n.values()),r}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:r,group:n,drawRange:i}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),s=this.getIndex(),a=null!==s;let A=1;if(!0===r.isInstancedBufferGeometry?A=r.instanceCount:void 0!==e.count&&(A=Math.max(0,e.count)),0===A)return null;if(o.instanceCount=A,!0===e.isBatchedMesh)return o;let l=1;!0!==t.wireframe||e.isPoints||e.isLineSegments||e.isLine||e.isLineLoop||(l=2);let u=i.start*l,c=(i.start+i.count)*l;null!==n&&(u=Math.max(u,n.start*l),c=Math.min(c,(n.start+n.count)*l));const h=r.attributes.position;let d=1/0;a?d=s.count:null!=h&&(d=h.count),u=Math.max(u,0),c=Math.min(c,d);const p=c-u;return p<0||p===1/0?null:(o.vertexCount=p,o.firstVertex=u,o)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const r of Object.keys(e.attributes).sort()){const n=e.attributes[r];t+=r+",",n.data&&(t+=n.data.stride+","),n.offset&&(t+=n.offset+","),n.itemSize&&(t+=n.itemSize+","),n.normalized&&(t+="n,")}for(const r of Object.keys(e.morphAttributes).sort()){const n=e.morphAttributes[r];t+="morph-"+r+",";for(let e=0,r=n.length;e<r;e++){t+=n[e].id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let r=t.customProgramCacheKey();for(const n of function(e){const t=Object.keys(e);let r=Object.getPrototypeOf(e);for(;r;){const e=Object.getOwnPropertyDescriptors(r);for(const r in e)if(void 0!==e[r]){const n=e[r];n&&"function"==typeof n.get&&t.push(r)}r=Object.getPrototypeOf(r)}return t}(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(n))continue;const e=t[n];let i;if(null!==e){const t=typeof e;"number"===t?i=0!==e?"1":"0":"object"===t?(i="{",e.isTexture&&(i+=e.mapping),i+="}"):i=String(e)}else i=String(e);r+=i+","}return r+=this.clippingContextCacheKey+",",e.geometry&&(r+=this.getGeometryCacheKey()),e.skeleton&&(r+=e.skeleton.bones.length+","),e.isBatchedMesh&&(r+=e._matricesTexture.uuid+",",null!==e._colorsTexture&&(r+=e._colorsTexture.uuid+",")),e.count>1&&(r+=e.uuid+","),r+=e.receiveShadow+",",dp(r)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return!0!==this.material.isShadowPassMaterial&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=fp(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=fp(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const ME=[];class NE{constructor(e,t,r,n,i,o){this.renderer=e,this.nodes=t,this.geometries=r,this.pipelines=n,this.bindings=i,this.info=o,this.chainMaps={}}get(e,t,r,n,i,o,s,a){const A=this.getChainMap(a);ME[0]=e,ME[1]=t,ME[2]=o,ME[3]=i;let l=A.get(ME);return void 0===l?(l=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,r,n,i,o,s,a),A.set(ME,l)):(l.updateClipping(s),l.needsGeometryUpdate&&l.setGeometry(e.geometry),(l.version!==t.version||l.needsUpdate)&&(l.initialCacheKey!==l.getCacheKey()?(l.dispose(),l=this.get(e,t,r,n,i,o,s,a)):l.version=t.version)),ME.length=0,l}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new TE)}dispose(){this.chainMaps={}}createRenderObject(e,t,r,n,i,o,s,a,A,l,u){const c=this.getChainMap(u),h=new EE(e,t,r,n,i,o,s,a,A,l);return h.onDispose=()=>{this.pipelines.delete(h),this.bindings.delete(h),this.nodes.delete(h),c.delete(h.getChainArray())},h}}class CE{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const RE=1,PE=2,DE=3,BE=4,qE=16;class OE extends CE{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return null!==t&&this.backend.destroyAttribute(e),t}update(e,t){const r=this.get(e);if(void 0===r.version)t===RE?this.backend.createAttribute(e):t===PE?this.backend.createIndexAttribute(e):t===DE?this.backend.createStorageAttribute(e):t===BE&&this.backend.createIndirectStorageAttribute(e),r.version=this._getBufferAttribute(e).version;else{const t=this._getBufferAttribute(e);(r.version<t.version||t.usage===we)&&(this.backend.updateAttribute(e),r.version=t.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function LE(e){return null!==e.index?e.index.version:e.attributes.position.version}function kE(e){const t=[],r=e.index,n=e.attributes.position;if(null!==r){const e=r.array;for(let r=0,n=e.length;r<n;r+=3){const n=e[r+0],i=e[r+1],o=e[r+2];t.push(n,i,i,o,o,n)}}else{for(let e=0,r=n.array.length/3-1;e<r;e+=3){const r=e+0,n=e+1,i=e+2;t.push(r,n,n,i,i,r)}}const i=new(Cr(t)?Mr:Nr)(t,1);return i.version=LE(e),i}class IE extends CE{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&!0===this.get(t).initialized}updateForRender(e){!1===this.has(e)&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry;this.get(t).initialized=!0,this.info.memory.geometries++;const r=()=>{this.info.memory.geometries--;const n=t.index,i=e.getAttributes();null!==n&&this.attributes.delete(n);for(const e of i)this.attributes.delete(e);const o=this.wireframes.get(t);void 0!==o&&this.attributes.delete(o),t.removeEventListener("dispose",r)};t.addEventListener("dispose",r)}updateAttributes(e){const t=e.getAttributes();for(const i of t)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,DE):this.updateAttribute(i,RE);const r=this.getIndex(e);null!==r&&this.updateAttribute(r,PE);const n=e.geometry.indirect;null!==n&&this.updateAttribute(n,BE)}updateAttribute(e,t){const r=this.info.render.calls;e.isInterleavedBufferAttribute?void 0===this.attributeCall.get(e)?(this.attributes.update(e,t),this.attributeCall.set(e,r)):this.attributeCall.get(e.data)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e.data,r),this.attributeCall.set(e,r)):this.attributeCall.get(e)!==r&&(this.attributes.update(e,t),this.attributeCall.set(e,r))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:r}=e;let n=t.index;if(!0===r.wireframe){const e=this.wireframes;let r=e.get(t);void 0===r?(r=kE(t),e.set(t,r)):r.version!==LE(t)&&(this.attributes.delete(r),r=kE(t),e.set(t,r)),n=r}return n}}class FE{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,r){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=r*(t/3):e.isPoints?this.render.points+=r*t:e.isLineSegments?this.render.lines+=r*(t/2):e.isLine?this.render.lines+=r*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class UE{constructor(e){this.cacheKey=e,this.usedTimes=0}}class VE extends UE{constructor(e,t,r){super(e),this.vertexProgram=t,this.fragmentProgram=r}}class GE extends UE{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let jE=0;class zE{constructor(e,t,r,n=null,i=null){this.id=jE++,this.code=e,this.stage=t,this.name=r,this.transforms=n,this.attributes=i,this.usedTimes=0}}class HE extends CE{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:r}=this,n=this.get(e);if(this._needsComputeUpdate(e)){const i=n.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const o=this.nodes.getForCompute(e);let s=this.programs.compute.get(o.computeShader);void 0===s&&(i&&0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram),s=new zE(o.computeShader,"compute",e.name,o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,s),r.createProgram(s));const a=this._getComputeCacheKey(e,s);let A=this.caches.get(a);void 0===A&&(i&&0===i.usedTimes&&this._releasePipeline(i),A=this._getComputePipeline(e,s,a,t)),A.usedTimes++,s.usedTimes++,n.version=e.version,n.pipeline=A}return n.pipeline}getForRender(e,t=null){const{backend:r}=this,n=this.get(e);if(this._needsRenderUpdate(e)){const i=n.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const o=e.getNodeBuilderState(),s=e.material?e.material.name:"";let a=this.programs.vertex.get(o.vertexShader);void 0===a&&(i&&0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),a=new zE(o.vertexShader,"vertex",s),this.programs.vertex.set(o.vertexShader,a),r.createProgram(a));let A=this.programs.fragment.get(o.fragmentShader);void 0===A&&(i&&0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram),A=new zE(o.fragmentShader,"fragment",s),this.programs.fragment.set(o.fragmentShader,A),r.createProgram(A));const l=this._getRenderCacheKey(e,a,A);let u=this.caches.get(l);void 0===u?(i&&0===i.usedTimes&&this._releasePipeline(i),u=this._getRenderPipeline(e,a,A,l,t)):e.pipeline=u,u.usedTimes++,a.usedTimes++,A.usedTimes++,n.pipeline=u}return n.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,0===t.usedTimes&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,0===t.computeProgram.usedTimes&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,0===t.vertexProgram.usedTimes&&this._releaseProgram(t.vertexProgram),0===t.fragmentProgram.usedTimes&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,r,n){r=r||this._getComputeCacheKey(e,t);let i=this.caches.get(r);return void 0===i&&(i=new GE(r,t),this.caches.set(r,i),this.backend.createComputePipeline(i,n)),i}_getRenderPipeline(e,t,r,n,i){n=n||this._getRenderCacheKey(e,t,r);let o=this.caches.get(n);return void 0===o&&(o=new VE(n,t,r),this.caches.set(n,o),e.pipeline=o,this.backend.createRenderPipeline(e,i)),o}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,r){return t.id+","+r.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,r=e.stage;this.programs[r].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return void 0===t.pipeline||t.version!==e.version}_needsRenderUpdate(e){return void 0===this.get(e).pipeline||this.backend.needsRenderUpdate(e)}}class WE extends CE{constructor(e,t,r,n,i,o){super(),this.backend=e,this.textures=r,this.pipelines=i,this.attributes=n,this.nodes=t,this.info=o,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const r of t){const e=this.get(r);void 0===e.bindGroup&&(this._init(r),this.backend.createBindings(r,t,0),e.bindGroup=r)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const r of t){const e=this.get(r);void 0===e.bindGroup&&(this._init(r),this.backend.createBindings(r,t,0),e.bindGroup=r)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const e=t.attribute,r=e.isIndirectStorageBufferAttribute?BE:DE;this.attributes.update(e,r)}}_update(e,t){const{backend:r}=this;let n=!1,i=!0,o=0,s=0;for(const a of e.bindings){if(a.isNodeUniformsGroup){if(!1===this.nodes.updateGroup(a))continue}if(a.isStorageBuffer){const e=a.attribute,t=e.isIndirectStorageBufferAttribute?BE:DE;this.attributes.update(e,t)}if(a.isUniformBuffer){a.update()&&r.updateBinding(a)}else if(a.isSampler)a.update();else if(a.isSampledTexture){const e=this.textures.get(a.texture);a.needsBindingsUpdate(e.generation)&&(n=!0);const t=a.update(),A=a.texture;t&&this.textures.updateTexture(A);const l=r.get(A);if(void 0!==l.externalTexture||e.isDefaultTexture?i=!1:(o=10*o+A.id,s+=A.version),!0===r.isWebGPUBackend&&void 0===l.texture&&void 0===l.externalTexture&&(console.error("Bindings._update: binding should be available:",a,t,A,a.textureNode.value,n),this.textures.updateTexture(A),n=!0),!0===A.isStorageTexture){const e=this.get(A);!0===a.store?e.needsMipmap=!0:this.textures.needsMipmaps(A)&&!0===e.needsMipmap&&(this.backend.generateMipmaps(A),e.needsMipmap=!1)}}}!0===n&&this.backend.updateBindings(e,t,i?o:0,s)}}function QE(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?e.z-t.z:e.id-t.id}function $E(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function YE(e){return(e.transmission>0||e.transmissionNode)&&e.side===k&&!1===e.forceSinglePass}class XE{constructor(e,t,r){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,r),this.lightsArray=[],this.scene=t,this.camera=r,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,r,n,i,o,s){let a=this.renderItems[this.renderItemsIndex];return void 0===a?(a={id:e.id,object:e,geometry:t,material:r,groupOrder:n,renderOrder:e.renderOrder,z:i,group:o,clippingContext:s},this.renderItems[this.renderItemsIndex]=a):(a.id=e.id,a.object=e,a.geometry=t,a.material=r,a.groupOrder=n,a.renderOrder=e.renderOrder,a.z=i,a.group=o,a.clippingContext=s),this.renderItemsIndex++,a}push(e,t,r,n,i,o,s){const a=this.getNextRenderItem(e,t,r,n,i,o,s);!0===e.occlusionTest&&this.occlusionQueryCount++,!0===r.transparent||r.transmission>0?(YE(r)&&this.transparentDoublePass.push(a),this.transparent.push(a)):this.opaque.push(a)}unshift(e,t,r,n,i,o,s){const a=this.getNextRenderItem(e,t,r,n,i,o,s);!0===r.transparent||r.transmission>0?(YE(r)&&this.transparentDoublePass.unshift(a),this.transparent.unshift(a)):this.opaque.unshift(a)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||QE),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||$E),this.transparent.length>1&&this.transparent.sort(t||$E)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const t=this.renderItems[e];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.groupOrder=null,t.renderOrder=null,t.z=null,t.group=null,t.clippingContext=null}}}const KE=[];class ZE{constructor(e){this.lighting=e,this.lists=new TE}get(e,t){const r=this.lists;KE[0]=e,KE[1]=t;let n=r.get(KE);return void 0===n&&(n=new XE(this.lighting,e,t),r.set(KE,n)),KE.length=0,n}dispose(){this.lists=new TE}}let JE=0;class eM{constructor(){this.id=JE++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new M,this.scissor=!1,this.scissorValue=new M,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return tM(this)}}function tM(e){const{textures:t,activeCubeFace:r}=e,n=[r];for(const i of t)n.push(i.id);return pp(n)}const rM=[],nM=new C,iM=new s;class oM{constructor(){this.chainMaps={}}get(e,t,r=null){let n;if(rM[0]=e,rM[1]=t,null===r)n="default";else{const e=r.texture.format;n=`${r.textures.length}:${e}:${r.samples}:${r.depthBuffer}:${r.stencilBuffer}`}const i=this._getChainMap(n);let o=i.get(rM);return void 0===o&&(o=new eM,i.set(rM,o)),rM.length=0,null!==r&&(o.sampleCount=0===r.samples?1:r.samples),o}getForClear(e=null){return this.get(nM,iM,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new TE)}dispose(){this.chainMaps={}}}const sM=new o;class aM extends CE{constructor(e,t,r){super(),this.renderer=e,this.backend=t,this.info=r}updateRenderTarget(e,t=0){const r=this.get(e),n=0===e.samples?1:e.samples,i=r.depthTextureMips||(r.depthTextureMips={}),o=e.textures,s=this.getSize(o[0]),a=s.width>>t,A=s.height>>t;let l=e.depthTexture||i[t];const u=!0===e.depthBuffer||!0===e.stencilBuffer;let c=!1;void 0===l&&u&&(l=new se,l.format=e.stencilBuffer?ue:ce,l.type=e.stencilBuffer?Ae:le,l.image.width=a,l.image.height=A,l.image.depth=s.depth,l.isArrayTexture=!0===e.multiview&&s.depth>1,i[t]=l),r.width===s.width&&s.height===r.height||(c=!0,l&&(l.needsUpdate=!0,l.image.width=a,l.image.height=A,l.image.depth=l.isArrayTexture?l.image.depth:1)),r.width=s.width,r.height=s.height,r.textures=o,r.depthTexture=l||null,r.depth=e.depthBuffer,r.stencil=e.stencilBuffer,r.renderTarget=e,r.sampleCount!==n&&(c=!0,l&&(l.needsUpdate=!0),r.sampleCount=n);const h={sampleCount:n};if(!0!==e.isXRRenderTarget){for(let e=0;e<o.length;e++){const t=o[e];c&&(t.needsUpdate=!0),this.updateTexture(t,h)}l&&this.updateTexture(l,h)}if(!0!==r.initialized){r.initialized=!0;const t=()=>{e.removeEventListener("dispose",t);for(let e=0;e<o.length;e++)this._destroyTexture(o[e]);l&&this._destroyTexture(l),this.delete(e)};e.addEventListener("dispose",t)}}updateTexture(e,t={}){const r=this.get(e);if(!0===r.initialized&&r.version===e.version)return;const n=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(n&&!0===r.initialized&&(i.destroySampler(e),i.destroyTexture(e)),e.isFramebufferTexture){const t=this.renderer.getRenderTarget();e.type=t?t.texture.type:ae}const{width:o,height:s,depth:a}=this.getSize(e);if(t.width=o,t.height=s,t.depth=a,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,o,s):1,n||!0===e.isStorageTexture)i.createSampler(e),i.createTexture(e,t),r.generation=e.version;else{if(!0!==r.initialized&&i.createSampler(e),e.version>0){const n=e.image;if(void 0===n)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(!1===n.complete)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const r=[];for(const t of e.images)r.push(t);t.images=r}else t.image=n;void 0!==r.isDefaultTexture&&!0!==r.isDefaultTexture||(i.createTexture(e,t),r.isDefaultTexture=!1,r.generation=e.version),!0===e.source.dataReady&&i.updateTexture(e,t),t.needsMipmaps&&0===e.mipmaps.length&&i.generateMipmaps(e)}}else i.createDefaultTexture(e),r.isDefaultTexture=!0,r.generation=e.version}if(!0!==r.initialized){r.initialized=!0,r.generation=e.version,this.info.memory.textures++;const t=()=>{e.removeEventListener("dispose",t),this._destroyTexture(e)};e.addEventListener("dispose",t)}r.version=e.version}getSize(e,t=sM){let r=e.images?e.images[0]:e.image;return r?(void 0!==r.image&&(r=r.image),t.width=r.width||1,t.height=r.height||1,t.depth=e.isCubeTexture?6:r.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,r){let n;return n=e.isCompressedTexture?e.mipmaps?e.mipmaps.length:1:Math.floor(Math.log2(Math.max(t,r)))+1,n}needsMipmaps(e){return!0===e.isCompressedTexture||e.generateMipmaps}_destroyTexture(e){!0===this.has(e)&&(this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e),this.info.memory.textures--)}}class AM extends te{constructor(e,t,r,n=1){super(e,t,r),this.a=n}set(e,t,r,n=1){return this.a=n,super.set(e,t,r)}copy(e){return void 0!==e.a&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class lM extends am{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class uM extends Fp{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const r=new Mf(t);return this._currentCond=Uy(e,r),this.add(this._currentCond)}ElseIf(e,t){const r=new Mf(t),n=Uy(e,r);return this._currentCond.elseNode=n,this._currentCond=n,this}Else(e){return this._currentCond.elseNode=new Mf(e),this}Switch(e){return this._expressionNode=Nf(e),this}Case(...e){const t=[];if(!(e.length>=2))throw new Error("TSL: Invalid parameter length. Case() requires at least two parameters.");for(let o=0;o<e.length-1;o++)t.push(this._expressionNode.equal(Nf(e[o])));const r=new Mf(e[e.length-1]);let n=t[0];for(let o=1;o<t.length;o++)n=n.or(t[o]);const i=Uy(n,r);return null===this._currentCond?(this._currentCond=i,this.add(this._currentCond)):(this._currentCond.elseNode=i,this._currentCond=i,this)}Default(e){return this.Else(e),this}build(e,...t){const r=Lf();Of(this);const n=e.buildStage;for(const i of this.nodes)if("setup"===n)i.build(e);else if("analyze"===n)i.build(e,this);else if("generate"===n){const t=e.getDataFromNode(i,"any").stages,r=t&&t[e.shaderStage];if(i.isVarNode&&r&&1===r.length&&r[0]&&r[0].isStackNode)continue;i.build(e,"void")}return Of(r),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const cM=Pf(uM).setParameterLength(0,1);class hM extends Fp{static get type(){return"StructTypeNode"}constructor(e,t=null){var r;super("struct"),this.membersLayout=(r=e,Object.entries(r).map(([e,t])=>"string"==typeof t?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})),this.name=t,this.isStructLayoutNode=!0}getLength(){const e=Float32Array.BYTES_PER_ELEMENT;let t=0;for(const r of this.membersLayout){const n=r.type,i=wp(n)*e,o=t%8,s=o%Tp(n),a=o+s;t+=s,0!==a&&8-a<i&&(t+=8-a),t+=i}return 8*Math.ceil(t/8)/e}getMemberType(e,t){const r=this.membersLayout.find(e=>e.name===t);return r?r.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.addInclude(this)}generate(e){return this.getNodeType(e)}}class dM extends Fp{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structLayoutNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structLayoutNode.getNodeType(e)}getMemberType(e,t){return this.structLayoutNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),r=t.type,n=e.getPropertyName(t);return e.addLineFlowCode(`${n} = ${e.generateStruct(r,this.structLayoutNode.membersLayout,this.values)}`,this),t.name}}class pM extends Fp{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(void 0===t.membersLayout){const r=this.members,n=[];for(let t=0;t<r.length;t++){const i="m"+t,o=r[t].getNodeType(e);n.push({name:i,type:o,index:t})}t.membersLayout=n,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),r=this.members,n=""!==t?t+".":"";for(let i=0;i<r.length;i++){const t=r[i].build(e);e.addLineFlowCode(`${n}m${i} = ${t}`,this)}return t}}const fM=Pf(pM);function mM(e,t){for(let r=0;r<e.length;r++)if(e[r].name===t)return r;return-1}class gM extends pM{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return void 0!==this.outputNodes[e]}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return yM(t)}setup(e){const t=this.outputNodes,r=[],n=e.renderer.getRenderTarget().textures;for(const i in t){r[mM(n,i)]=Zf(t[i])}return this.members=r,super.setup(e)}}const yM=Pf(gM),bM=qf(([e])=>{const t=e.toUint().mul(747796405).add(2891336453),r=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return r.shiftRight(22).bitXor(r).toFloat().mul(1/2**32)}),vM=(e,t)=>vy(rg(4,e.mul(tg(1,e))),t),_M=qf(([e])=>e.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),xM=qf(([e])=>$f(_M(e.z.add(_M(e.y.mul(1)))),_M(e.z.add(_M(e.x.mul(1)))),_M(e.y.add(_M(e.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),wM=qf(([e,t,r])=>{const n=$f(e).toVar(),i=Uf(1.4).toVar(),o=Uf(0).toVar(),s=$f(n).toVar();return zx({start:Uf(0),end:Uf(3),type:"float",condition:"<="},()=>{const e=$f(xM(s.mul(2))).toVar();n.addAssign(e.add(r.mul(Uf(.1).mul(t)))),s.mulAssign(1.8),i.mulAssign(1.5),n.mulAssign(1.2);const a=Uf(_M(n.z.add(_M(n.x.add(_M(n.y)))))).toVar();o.addAssign(a.div(i)),s.addAssign(.14)}),o}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class TM extends Fp{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let r=this._candidateFnCall;if(null===r){let n=null,i=-1;for(const r of this.functionNodes){const o=r.shaderNode.layout;if(null===o)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const s=o.inputs;if(t.length===s.length){let o=0;for(let r=0;r<t.length;r++){const n=t[r],i=s[r];n.getNodeType(e)===i.type?o++:o=0}o>i&&(n=r,i=o)}}this._candidateFnCall=r=n(...t)}return r}}const SM=Pf(TM),EM=e=>(...t)=>SM(e,...t),MM=Hm(0).setGroup(Gm).onRenderUpdate(e=>e.time),NM=Hm(0).setGroup(Gm).onRenderUpdate(e=>e.deltaTime),CM=Hm(0,"uint").setGroup(Gm).onRenderUpdate(e=>e.frameId),RM=qf(([e,t,r=zf(.5)])=>fE(e.sub(r),t).add(r)),PM=qf(([e,t,r=zf(.5)])=>{const n=e.sub(r),i=n.dot(n),o=i.mul(i).mul(t);return e.add(n.mul(o))}),DM=qf(({position:e=null,horizontal:t=!0,vertical:r=!1})=>{let n;null!==e?(n=gv.toVar(),n[3][0]=e.x,n[3][1]=e.y,n[3][2]=e.z):n=gv;const i=nv.mul(n);return Sf(t)&&(i[0][0]=gv[0].length(),i[0][1]=0,i[0][2]=0),Sf(r)&&(i[1][0]=0,i[1][1]=gv[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,tv.mul(i).mul(Cv)}),BM=qf(([e=null])=>{const t=Cw();return Cw(_w(e)).sub(t).lessThan(0).select(ow,e)});class qM extends Fp{static get type(){return"SpriteSheetUVNode"}constructor(e,t=Lb(),r=Uf(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=r}setup(){const{frameNode:e,uvNode:t,countNode:r}=this,{width:n,height:i}=r,o=e.mod(n.mul(i)).floor(),s=o.mod(n),a=i.sub(o.add(1).div(n).ceil()),A=r.reciprocal(),l=zf(s,a);return t.add(l).mul(A)}}const OM=Pf(qM).setParameterLength(3);class LM extends Fp{static get type(){return"TriplanarTexturesNode"}constructor(e,t=null,r=null,n=Uf(1),i=Cv,o=Fv){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=r,this.scaleNode=n,this.positionNode=i,this.normalNode=o}setup(){const{textureXNode:e,textureYNode:t,textureZNode:r,scaleNode:n,positionNode:i,normalNode:o}=this;let s=o.abs().normalize();s=s.div(s.dot($f(1)));const a=i.yz.mul(n),A=i.zx.mul(n),l=i.xy.mul(n),u=e.value,c=null!==t?t.value:u,h=null!==r?r.value:u,d=zb(u,a).mul(s.x),p=zb(c,A).mul(s.y),f=zb(h,l).mul(s.z);return eg(d,p,f)}}const kM=Pf(LM).setParameterLength(1,6),IM=new Se,FM=new o,UM=new o,VM=new o,GM=new i,jM=new o(0,0,-1),zM=new M,HM=new o,WM=new o,QM=new M,$M=new n,YM=new R,XM=ow.flipX();YM.depthTexture=new se(1,1);let KM=!1;class ZM extends Gb{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||YM.texture,XM),this._reflectorBaseNode=e.reflector||new JM(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(null===this._depthNode){if(!0!==this._reflectorBaseNode.depth)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Nf(new ZM({defaultTexture:YM.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e._reflectorBaseNode=this._reflectorBaseNode,e}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class JM extends Fp{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new r,resolution:i=1,generateMipmaps:o=!1,bounces:s=!0,depth:a=!1}=t;this.textureNode=e,this.target=n,this.resolution=i,this.generateMipmaps=o,this.bounces=s,this.depth=a,this.updateBeforeType=s?Pp.RENDER:Pp.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(e,t){const r=this.resolution;t.getDrawingBufferSize($M),e.setSize(Math.round($M.width*r),Math.round($M.height*r))}setup(e){return this._updateResolution(YM,e.renderer),super.setup(e)}dispose(){super.dispose();for(const e of this.renderTargets.values())e.dispose()}getVirtualCamera(e){let t=this.virtualCameras.get(e);return void 0===t&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return void 0===t&&(t=new R(0,0,{type:S}),!0===this.generateMipmaps&&(t.texture.minFilter=yn,t.texture.generateMipmaps=!0),!0===this.depth&&(t.depthTexture=new se),this.renderTargets.set(e,t)),t}updateBefore(e){if(!1===this.bounces&&KM)return!1;KM=!0;const{scene:t,camera:r,renderer:n,material:i}=e,{target:o}=this,s=this.getVirtualCamera(r),a=this.getRenderTarget(s);n.getDrawingBufferSize($M),this._updateResolution(a,n),UM.setFromMatrixPosition(o.matrixWorld),VM.setFromMatrixPosition(r.matrixWorld),GM.extractRotation(o.matrixWorld),FM.set(0,0,1),FM.applyMatrix4(GM),HM.subVectors(UM,VM);let A=!1;if(!0===HM.dot(FM)>0&&!1===this.forceUpdate){if(!1===this.hasOutput)return void(KM=!1);A=!0}HM.reflect(FM).negate(),HM.add(UM),GM.extractRotation(r.matrixWorld),jM.set(0,0,-1),jM.applyMatrix4(GM),jM.add(VM),WM.subVectors(UM,jM),WM.reflect(FM).negate(),WM.add(UM),s.coordinateSystem=r.coordinateSystem,s.position.copy(HM),s.up.set(0,1,0),s.up.applyMatrix4(GM),s.up.reflect(FM),s.lookAt(WM),s.near=r.near,s.far=r.far,s.updateMatrixWorld(),s.projectionMatrix.copy(r.projectionMatrix),IM.setFromNormalAndCoplanarPoint(FM,UM),IM.applyMatrix4(s.matrixWorldInverse),zM.set(IM.normal.x,IM.normal.y,IM.normal.z,IM.constant);const l=s.projectionMatrix;QM.x=(Math.sign(zM.x)+l.elements[8])/l.elements[0],QM.y=(Math.sign(zM.y)+l.elements[9])/l.elements[5],QM.z=-1,QM.w=(1+l.elements[10])/l.elements[14],zM.multiplyScalar(1/zM.dot(QM));l.elements[2]=zM.x,l.elements[6]=zM.y,l.elements[10]=n.coordinateSystem===Ee?zM.z-0:zM.z+1-0,l.elements[14]=zM.w,this.textureNode.value=a.texture,!0===this.depth&&(this.textureNode.getDepthNode().value=a.depthTexture),i.visible=!1;const u=n.getRenderTarget(),c=n.getMRT(),h=n.autoClear;n.setMRT(null),n.setRenderTarget(a),n.autoClear=!0,A?(n.clear(),this.hasOutput=!1):(n.render(t,s),this.hasOutput=!0),n.setMRT(c),n.setRenderTarget(u),n.autoClear=h,i.visible=!0,KM=!1,this.forceUpdate=!1}}const eN=new Z(-1,1,1,-1,0,1);class tN extends f{constructor(e=!1){super();const t=!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new m([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new m(t,2))}}const rN=new tN;class nN extends A{constructor(e=null){super(rN,e),this.camera=eN,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,eN)}render(e){e.render(this,eN)}}const iN=new n;class oN extends Gb{static get type(){return"RTTNode"}constructor(e,t=null,r=null,n={type:S}){const i=new R(t,r,n);super(i.texture,Lb()),this.node=e,this.width=t,this.height=r,this.pixelRatio=1,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new nN(new kw),this.updateBeforeType=Pp.RENDER}get autoSize(){return null===this.width}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const r=e*this.pixelRatio,n=t*this.pixelRatio;this.renderTarget.setSize(r,n),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(!1===this.textureNeedsUpdate&&!1===this.autoUpdate)return;if(this.textureNeedsUpdate=!1,!0===this.autoSize){this.pixelRatio=e.getPixelRatio();const t=e.getSize(iN);this.setSize(t.width,t.height)}this._quadMesh.material.fragmentNode=this._rttNode;const t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(t)}clone(){const e=new Gb(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const sN=(e,...t)=>Nf(new oN(Nf(e),...t)),aN=qf(([e,t,r],n)=>{let i;n.renderer.coordinateSystem===Ee?(e=zf(e.x,e.y.oneMinus()).mul(2).sub(1),i=Zf($f(e,t),1)):i=Zf($f(e.x,e.y.oneMinus(),t).mul(2).sub(1),1);const o=Zf(r.mul(i));return o.xyz.div(o.w)}),AN=qf(([e,t])=>{const r=t.mul(Zf(e,1)),n=r.xy.div(r.w).mul(.5).add(.5).toVar();return zf(n.x,n.y.oneMinus())}),lN=qf(([e,t,r])=>{const n=Ib(Hb(t)),i=Hf(e.mul(n)).toVar(),o=Hb(t,i).toVar(),s=Hb(t,i.sub(Hf(2,0))).toVar(),a=Hb(t,i.sub(Hf(1,0))).toVar(),A=Hb(t,i.add(Hf(1,0))).toVar(),l=Hb(t,i.add(Hf(2,0))).toVar(),u=Hb(t,i.add(Hf(0,2))).toVar(),c=Hb(t,i.add(Hf(0,1))).toVar(),h=Hb(t,i.sub(Hf(0,1))).toVar(),d=Hb(t,i.sub(Hf(0,2))).toVar(),p=Zg(tg(Uf(2).mul(a).sub(s),o)).toVar(),f=Zg(tg(Uf(2).mul(A).sub(l),o)).toVar(),m=Zg(tg(Uf(2).mul(c).sub(u),o)).toVar(),g=Zg(tg(Uf(2).mul(h).sub(d),o)).toVar(),y=aN(e,o,r).toVar(),b=p.lessThan(f).select(y.sub(aN(e.sub(zf(Uf(1).div(n.x),0)),a,r)),y.negate().add(aN(e.add(zf(Uf(1).div(n.x),0)),A,r))),v=m.lessThan(g).select(y.sub(aN(e.add(zf(0,Uf(1).div(n.y))),c,r)),y.negate().add(aN(e.sub(zf(0,Uf(1).div(n.y))),h,r)));return zg(by(b,v))});class uN extends y{constructor(e,t,r=Float32Array){super(ArrayBuffer.isView(e)?e:new r(e*t),t),this.isStorageInstancedBufferAttribute=!0}}class cN extends g{constructor(e,t,r=Float32Array){super(ArrayBuffer.isView(e)?e:new r(e*t),t),this.isStorageBufferAttribute=!0}}class hN extends Fp{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const dN=Df(hN),pN=new rn,fN=new i;class mN extends Fp{static get type(){return"SceneNode"}constructor(e=mN.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,r=null!==this.scene?this.scene:e.scene;let n;return t===mN.BACKGROUND_BLURRINESS?n=l_("backgroundBlurriness","float",r):t===mN.BACKGROUND_INTENSITY?n=l_("backgroundIntensity","float",r):t===mN.BACKGROUND_ROTATION?n=Hm("mat4").label("backgroundRotation").setGroup(Gm).onRenderUpdate(()=>{const e=r.background;return null!==e&&e.isTexture&&e.mapping!==tn?(pN.copy(r.backgroundRotation),pN.x*=-1,pN.y*=-1,pN.z*=-1,fN.makeRotationFromEuler(pN)):fN.identity(),fN}):console.error("THREE.SceneNode: Unknown scope:",t),n}}mN.BACKGROUND_BLURRINESS="backgroundBlurriness",mN.BACKGROUND_INTENSITY="backgroundIntensity",mN.BACKGROUND_ROTATION="backgroundRotation";const gN=Df(mN,mN.BACKGROUND_BLURRINESS),yN=Df(mN,mN.BACKGROUND_INTENSITY),bN=Df(mN,mN.BACKGROUND_ROTATION);class vN extends Gb{static get type(){return"StorageTextureNode"}constructor(e,t,r=null){super(e,t),this.storeNode=r,this.isStorageTextureNode=!0,this.access=Dp.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);return t.storeNode=this.storeNode,t}setAccess(e){return this.access=e,this}generate(e,t){let r;return r=null!==this.storeNode?this.generateStore(e):super.generate(e,t),r}toReadWrite(){return this.setAccess(Dp.READ_WRITE)}toReadOnly(){return this.setAccess(Dp.READ_ONLY)}toWriteOnly(){return this.setAccess(Dp.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:r,storeNode:n,depthNode:i}=t,o=super.generate(e,"property"),s=r.build(e,"uvec2"),a=n.build(e,"vec4"),A=i?i.build(e,"int"):null,l=e.generateTextureStore(e,o,s,A,a);e.addLineFlowCode(l,this)}clone(){const e=super.clone();return e.storeNode=this.storeNode,e}}const _N=Pf(vN).setParameterLength(1,3),xN=qf(({texture:e,uv:t})=>{const r=1e-4,n=$f().toVar();return kf(t.x.lessThan(r),()=>{n.assign($f(1,0,0))}).ElseIf(t.y.lessThan(r),()=>{n.assign($f(0,1,0))}).ElseIf(t.z.lessThan(r),()=>{n.assign($f(0,0,1))}).ElseIf(t.x.greaterThan(.9999),()=>{n.assign($f(-1,0,0))}).ElseIf(t.y.greaterThan(.9999),()=>{n.assign($f(0,-1,0))}).ElseIf(t.z.greaterThan(.9999),()=>{n.assign($f(0,0,-1))}).Else(()=>{const r=.01,i=e.sample(t.add($f(-.01,0,0))).r.sub(e.sample(t.add($f(r,0,0))).r),o=e.sample(t.add($f(0,-.01,0))).r.sub(e.sample(t.add($f(0,r,0))).r),s=e.sample(t.add($f(0,0,-.01))).r.sub(e.sample(t.add($f(0,0,r))).r);n.assign($f(i,o,s))}),n.normalize()});class wN extends Gb{static get type(){return"Texture3DNode"}constructor(e,t=null,r=null){super(e,t,r),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return $f(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const r=this.value;return!e.isFlipY()||!0!==r.isRenderTargetTexture&&!0!==r.isFramebufferTexture||(t=this.sampler?t.flipY():t.setY(Vf(Ib(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return xN({texture:this,uv:e})}}const TN=Pf(wN).setParameterLength(1,3);class SN extends A_{static get type(){return"UserDataNode"}constructor(e,t,r=null){super(e,t,r),this.userData=r}updateReference(e){return this.reference=null!==this.userData?this.userData:e.object.userData,this.reference}}const EN=new WeakMap;class MN extends Gp{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Pp.OBJECT,this.updateAfterType=Pp.OBJECT,this.previousModelWorldMatrix=Hm(new i),this.previousProjectionMatrix=Hm(new i).setGroup(Gm),this.previousCameraViewMatrix=Hm(new i)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:r}){const n=CN(r);this.previousModelWorldMatrix.value.copy(n);const o=NN(t);o.frameId!==e&&(o.frameId=e,void 0===o.previousProjectionMatrix?(o.previousProjectionMatrix=new i,o.previousCameraViewMatrix=new i,o.currentProjectionMatrix=new i,o.currentCameraViewMatrix=new i,o.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),o.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(o.previousProjectionMatrix.copy(o.currentProjectionMatrix),o.previousCameraViewMatrix.copy(o.currentCameraViewMatrix)),o.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),o.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(o.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(o.previousCameraViewMatrix))}updateAfter({object:e}){CN(e).copy(e.matrixWorld)}setup(){const e=null===this.projectionMatrix?tv:Hm(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),r=e.mul(Tv).mul(Cv),n=this.previousProjectionMatrix.mul(t).mul(Rv),i=r.xy.div(r.w),o=n.xy.div(n.w);return tg(i,o)}}function NN(e){let t=EN.get(e);return void 0===t&&(t={},EN.set(e,t)),t}function CN(e,t=0){const r=NN(e);let n=r[t];return void 0===n&&(r[t]=n=new i,r[t].copy(e.matrixWorld)),n}const RN=Df(MN),PN=qf(([e,t])=>hy(1,e.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),DN=qf(([e,t])=>hy(e.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),BN=qf(([e,t])=>e.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),qN=qf(([e,t])=>My(e.mul(2).mul(t),e.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),py(.5,e))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),ON=qf(([e,t])=>{const r=t.a.add(e.a.mul(t.a.oneMinus()));return Zf(t.rgb.mul(t.a).add(e.rgb.mul(e.a).mul(t.a.oneMinus())).div(r),r)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),LN=qf(([e])=>Zf(e.rgb.mul(e.a),e.a),{color:"vec4",return:"vec4"}),kN=qf(([e])=>(kf(e.a.equal(0),()=>Zf(0)),Zf(e.rgb.div(e.a),e.a)),{color:"vec4",return:"vec4"}),IN=qf(([e])=>GN(e.rgb)),FN=qf(([e,t=Uf(1)])=>t.mix(GN(e.rgb),e.rgb)),UN=qf(([e,t=Uf(1)])=>{const r=eg(e.r,e.g,e.b).div(3),n=e.r.max(e.g.max(e.b)),i=n.sub(r).mul(t).mul(-3);return My(e.rgb,n,i)}),VN=qf(([e,t=Uf(1)])=>{const r=$f(.57735,.57735,.57735),n=t.cos();return $f(e.rgb.mul(n).add(r.cross(e.rgb).mul(t.sin()).add(r.mul(yy(r,e.rgb).mul(n.oneMinus())))))}),GN=(e,t=$f($e.getLuminanceCoefficients(new o)))=>yy(e,t),jN=qf(([e,t=$f(1),r=$f(0),n=$f(1),i=Uf(1),s=$f($e.getLuminanceCoefficients(new o,D))])=>{const a=e.rgb.dot($f(s)),A=dy(e.rgb.mul(t).add(r),0).toVar(),l=A.pow(n).toVar();return kf(A.r.greaterThan(0),()=>{A.r.assign(l.r)}),kf(A.g.greaterThan(0),()=>{A.g.assign(l.g)}),kf(A.b.greaterThan(0),()=>{A.b.assign(l.b)}),A.assign(a.add(A.sub(a).mul(i))),Zf(A.rgb,e.a)});class zN extends Gp{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const HN=Pf(zN).setParameterLength(2),WN=new n;class QN extends Gb{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class $N extends QN{static get type(){return"PassMultipleTextureNode"}constructor(e,t,r=!1){super(e,null),this.textureName=t,this.previousTexture=r}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class YN extends Gp{static get type(){return"PassNode"}constructor(e,t,r,n={}){super("vec4"),this.scope=e,this.scene=t,this.camera=r,this.options=n,this._pixelRatio=1,this._width=1,this._height=1;const i=new se;i.isRenderTargetTexture=!0,i.name="depth";const o=new R(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:S,...n});o.texture.name="output",o.depthTexture=i,this.renderTarget=o,this._textures={output:o.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Hm(0),this._cameraFar=Hm(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=Pp.FRAME,this.global=!0}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getTexture(e){let t=this._textures[e];if(void 0===t){t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)}return t}getPreviousTexture(e){let t=this._previousTextures[e];return void 0===t&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(void 0!==t){const r=this._textures[e],n=this.renderTarget.textures.indexOf(r);this.renderTarget.textures[n]=t,this._textures[e]=t,this._previousTextures[e]=r,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return void 0===t&&(t=Nf(new $N(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return void 0===t&&(void 0===this._textureNodes[e]&&this.getTextureNode(e),t=Nf(new $N(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(void 0===t){const r=this._cameraNear,n=this._cameraFar;this._viewZNodes[e]=t=Sw(this.getTextureNode(e),r,n)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(void 0===t){const r=this._cameraNear,n=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=ww(i,r,n)}return t}setup({renderer:e}){return this.renderTarget.samples=void 0===this.options.samples?e.samples:this.options.samples,!0===e.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===YN.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:r}=this;let n,i;const o=t.getOutputRenderTarget();o&&!0===o.isXRRenderTarget?(i=1,n=t.xr.getCamera(),t.xr.updateCamera(n),WN.set(o.width,o.height)):(n=this.camera,i=t.getPixelRatio(),t.getSize(WN)),this._pixelRatio=i,this.setSize(WN.width,WN.height);const s=t.getRenderTarget(),a=t.getMRT(),A=n.layers.mask;this._cameraNear.value=n.near,this._cameraFar.value=n.far,null!==this._layers&&(n.layers.mask=this._layers.mask);for(const l in this._previousTextures)this.toggleTexture(l);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(r,n),t.setRenderTarget(s),t.setMRT(a),n.layers.mask=A}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio*this._resolution,n=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(r,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}YN.COLOR="color",YN.DEPTH="depth";class XN extends YN{static get type(){return"ToonOutlinePassNode"}constructor(e,t,r,n,i){super(YN.COLOR,e,t),this.colorNode=r,this.thicknessNode=n,this.alphaNode=i,this._materialCache=new WeakMap}updateBefore(e){const{renderer:t}=e,r=t.getRenderObjectFunction();t.setRenderObjectFunction((e,r,n,i,o,s,a,A)=>{if((o.isMeshToonMaterial||o.isMeshToonNodeMaterial)&&!1===o.wireframe){const l=this._getOutlineMaterial(o);t.renderObject(e,r,n,i,l,s,a,A)}t.renderObject(e,r,n,i,o,s,a,A)}),super.updateBefore(e),t.setRenderObjectFunction(r)}_createMaterial(){const e=new kw;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=O;const t=Fv.negate(),r=tv.mul(Tv),n=Uf(1),i=r.mul(Zf(Cv,1)),o=r.mul(Zf(Cv.add(t),1)),s=zg(i.sub(o));return e.vertexNode=i.add(s.mul(this.thicknessNode).mul(i.w).mul(n)),e.colorNode=Zf(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return void 0===t&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const KN=qf(([e,t])=>e.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),ZN=qf(([e,t])=>(e=e.mul(t)).div(e.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),JN=qf(([e,t])=>{const r=(e=(e=e.mul(t)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),n=e.mul(e.mul(6.2).add(1.7)).add(.06);return r.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),eC=qf(([e])=>{const t=e.mul(e.add(.0245786)).sub(90537e-9),r=e.mul(e.add(.432951).mul(.983729)).add(.238081);return t.div(r)}),tC=qf(([e,t])=>{const r=nm(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=nm(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(t).div(.6),e=r.mul(e),e=eC(e),(e=n.mul(e)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),rC=nm($f(1.6605,-.1246,-.0182),$f(-.5876,1.1329,-.1006),$f(-.0728,-.0083,1.1187)),nC=nm($f(.6274,.0691,.0164),$f(.3293,.9195,.088),$f(.0433,.0113,.8956)),iC=qf(([e])=>{const t=$f(e).toVar(),r=$f(t.mul(t)).toVar(),n=$f(r.mul(r)).toVar();return Uf(15.5).mul(n.mul(r)).sub(rg(40.14,n.mul(t))).add(rg(31.96,n).sub(rg(6.868,r.mul(t))).add(rg(.4298,r).add(rg(.1191,t).sub(.00232))))}),oC=qf(([e,t])=>{const r=$f(e).toVar(),n=nm($f(.856627153315983,.137318972929847,.11189821299995),$f(.0951212405381588,.761241990602591,.0767994186031903),$f(.0482516061458583,.101439036467562,.811302368396859)),i=nm($f(1.1271005818144368,-.1413297634984383,-.14132976349843826),$f(-.11060664309660323,1.157823702216272,-.11060664309660294),$f(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=Uf(-12.47393),s=Uf(4.026069);return r.mulAssign(t),r.assign(nC.mul(r)),r.assign(n.mul(r)),r.assign(dy(r,1e-10)),r.assign(Fg(r)),r.assign(r.sub(o).div(s.sub(o))),r.assign(Ny(r,0,1)),r.assign(iC(r)),r.assign(i.mul(r)),r.assign(vy(dy($f(0),r),$f(2.2))),r.assign(rC.mul(r)),r.assign(Ny(r,0,1)),r}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sC=qf(([e,t])=>{const r=Uf(.76),n=Uf(.15);e=e.mul(t);const i=hy(e.r,hy(e.g,e.b)),o=Uy(i.lessThan(.08),i.sub(rg(6.25,i.mul(i))),.04);e.subAssign(o);const s=dy(e.r,dy(e.g,e.b));kf(s.lessThan(r),()=>e);const a=tg(1,r),A=tg(1,a.mul(a).div(s.add(a.sub(r))));e.mulAssign(A.div(s));const l=tg(1,ng(1,n.mul(s.sub(A)).add(1)));return My(e,$f(A),l)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class aC extends Fp{static get type(){return"CodeNode"}constructor(e="",t=[],r=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=e,this.includes=t,this.language=r}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const n of t)n.build(e);const r=e.getCodeFromNode(this,this.getNodeType(e));return r.code=this.code,r.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const AC=Pf(aC).setParameterLength(1,3);class lC extends aC{static get type(){return"FunctionNode"}constructor(e="",t=[],r=""){super(e,t,r)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let r=t.nodeFunction;return void 0===r&&(r=e.parser.parseFunction(this.code),t.nodeFunction=r),r}generate(e,t){super.generate(e);const r=this.getNodeFunction(e),n=r.name,i=r.type,o=e.getCodeFromNode(this,i);""!==n&&(o.name=n);const s=e.getPropertyName(o),a=this.getNodeFunction(e).getCode(s);return o.code=a+"\n","property"===t?s:e.format(`${s}()`,i,t)}}const uC=(e,t=[],r="")=>{for(let o=0;o<t.length;o++){const e=t[o];"function"==typeof e&&(t[o]=e.functionNode)}const n=Nf(new lC(e,t,r)),i=(...e)=>n.call(...e);return i.functionNode=n,i};class cC extends Fp{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new re,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(e){this._value!==e&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&null===this._cache&&"URL"===this.inputType&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&null!==e.value&&void 0!==e.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof e.value||"Number"===this.inputType&&"number"==typeof e.value||"Vector2"===this.inputType&&e.value.isVector2||"Vector3"===this.inputType&&e.value.isVector3||"Vector4"===this.inputType&&e.value.isVector4||"Color"===this.inputType&&e.value.isColor||"Matrix3"===this.inputType&&e.value.isMatrix3||"Matrix4"===this.inputType&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:Uf()}serialize(e){super.serialize(e),null!==this.value?"ArrayBuffer"===this.inputType?e.value=Np(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;null!==e.value&&(t="ArrayBuffer"===e.inputType?Cp(e.value):"Texture"===e.inputType?e.meta.textures[e.value]:e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const hC=Pf(cC).setParameterLength(1);class dC extends Map{get(e,t=null,...r){if(this.has(e))return super.get(e);if(null!==t){const n=t(...r);return this.set(e,n),n}}}class pC{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const fC=new dC;class mC extends Fp{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new dC,this._output=hC(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const r=this._outputs;return void 0===r[e]?r[e]=hC(t):r[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const r=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),r[e]=t,r[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),r[e]=t,r[e].events.addEventListener("refresh",this.onRefresh)):void 0===r[e]?(r[e]=hC(t),r[e].events.addEventListener("refresh",this.onRefresh)):r[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const r=this.getObject()[e];if("function"==typeof r)return r(...t)}async callAsync(e,...t){const r=this.getObject()[e];if("function"==typeof r)return"AsyncFunction"===r.constructor.name?await r(...t):r(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){null!==e?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;const e=new pC(this),t=fC.get("THREE"),r=fC.get("TSL"),n=this.getMethod(),i=[e,this._local,fC,()=>this.refresh(),(e,t)=>this.setOutput(e,t),t,r];this._object=n(...i);const o=this._object.layout;if(o&&(!1===o.cache&&this._local.clear(),this._output.outputType=o.outputType||null,Array.isArray(o.elements)))for(const s of o.elements){const e=s.id||s.name;s.inputType&&(void 0===this.getParameter(e)&&this.setParameter(e,null),this.getParameter(e).inputType=s.inputType),s.outputType&&(void 0===this.getOutput(e)&&this.setOutput(e,null),this.getOutput(e).outputType=s.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let e=this.parameters[t];e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:Uf()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;const e=["layout","init","main","dispose"].join(", "),t="\nreturn { ...output, "+e+" };",r="var "+e+"; var output = {};\n"+this.codeNode.code+t;return this._method=new Function(...["parameters","local","global","refresh","setOutput","THREE","TSL"],r),this._method}dispose(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[dp(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const r in this.parameters)t.push(this.parameters[r].getCacheKey(e));return pp(t)}set needsUpdate(e){!0===e&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const gC=Pf(mC).setParameterLength(1,2);function yC(e){let t;const r=e.context.getViewZ;return void 0!==r&&(t=r(this)),(t||Bv.z).negate()}const bC=qf(([e,t],r)=>{const n=yC(r);return Py(e,t,n)}),vC=qf(([e],t)=>{const r=yC(t);return e.mul(e,r,r).negate().exp().oneMinus()}),_C=qf(([e,t])=>Zf(t.toFloat().mix(Nm.rgb,e.toVec3()),Nm.a));let xC=null,wC=null;class TC extends Fp{static get type(){return"RangeNode"}constructor(e=Uf(),t=Uf()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(Sp(this.minNode.value)),r=e.getTypeLength(Sp(this.maxNode.value));return t>r?t:r}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let r=null;if(t.count>1){const n=this.minNode.value,i=this.maxNode.value,o=e.getTypeLength(Sp(n)),s=e.getTypeLength(Sp(i));xC=xC||new M,wC=wC||new M,xC.setScalar(0),wC.setScalar(0),1===o?xC.setScalar(n):n.isColor?xC.set(n.r,n.g,n.b,1):xC.set(n.x,n.y,n.z||0,n.w||0),1===s?wC.setScalar(i):i.isColor?wC.set(i.r,i.g,i.b,1):wC.set(i.x,i.y,i.z||0,i.w||0);const a=4,A=a*t.count,l=new Float32Array(A);for(let e=0;e<A;e++){const t=e%a,r=xC.getComponent(t),n=wC.getComponent(t);l[e]=Jr.lerp(r,n,Math.random())}const u=this.getNodeType(e);if(t.count<=4096)r=Qb(l,"vec4",t.count).element(Sx).convert(u);else{const t=new y(l,4);e.geometry.setAttribute("__range"+this.id,t),r=fb(t).convert(u)}}else r=Uf(0);return r}}const SC=Pf(TC).setParameterLength(2);class EC extends Fp{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const r=this.getBuiltinName(e),n=this.getNodeType(e);return"compute"===e.shaderStage?e.format(r,n,t):(console.warn(`ComputeBuiltinNode: Compute built-in value ${r} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(n))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const MC=(e,t)=>Nf(new EC(e,t)),NC=MC("numWorkgroups","uvec3"),CC=MC("workgroupId","uvec3"),RC=MC("globalId","uvec3"),PC=MC("localId","uvec3"),DC=MC("subgroupSize","uint");const BC=Pf(class extends Fp{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:r}=e;!0===r.backend.isWebGLBackend?e.addFlowCode(`\t// ${t}Barrier \n`):e.addLineFlowCode(`${t}Barrier()`,this)}});class qC extends Up{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let r;const n=e.context.assign;if(r=super.generate(e),!0!==n){const n=this.getNodeType(e);r=e.format(r,n,t)}return r}}class OC extends Fp{constructor(e,t,r=0){super(t),this.bufferType=t,this.bufferCount=r,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e}label(e){return this.name=e,this}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return Nf(new qC(this,e))}generate(e){return e.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}class LC extends Fp{static get type(){return"AtomicFunctionNode"}constructor(e,t,r){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=r,this.parents=!0}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=e.getNodeProperties(this),r=t.parents,n=this.method,i=this.getNodeType(e),o=this.getInputType(e),s=this.pointerNode,a=this.valueNode,A=[];A.push(`&${s.build(e,o)}`),null!==a&&A.push(a.build(e,o));const l=`${e.getMethod(n,i)}( ${A.join(", ")} )`;if(!(1===r.length&&!0===r[0].isStackNode))return void 0===t.constNode&&(t.constNode=Nb(l,i).toConst()),t.constNode.build(e);e.addLineFlowCode(l,this)}}LC.ATOMIC_LOAD="atomicLoad",LC.ATOMIC_STORE="atomicStore",LC.ATOMIC_ADD="atomicAdd",LC.ATOMIC_SUB="atomicSub",LC.ATOMIC_MAX="atomicMax",LC.ATOMIC_MIN="atomicMin",LC.ATOMIC_AND="atomicAnd",LC.ATOMIC_OR="atomicOr",LC.ATOMIC_XOR="atomicXor";const kC=Pf(LC),IC=(e,t,r)=>kC(e,t,r).toStack();let FC;function UC(e){FC=FC||new WeakMap;let t=FC.get(e);return void 0===t&&FC.set(e,t={}),t}function VC(e){const t=UC(e);return t.shadowMatrix||(t.shadowMatrix=Hm("mat4").setGroup(Gm).onRenderUpdate(t=>(!0===e.castShadow&&!1!==t.renderer.shadowMap.enabled||e.shadow.updateMatrices(e),e.shadow.matrix)))}function GC(e,t=Pv){const r=VC(e).mul(t);return r.xyz.div(r.w)}function jC(e){const t=UC(e);return t.position||(t.position=Hm(new o).setGroup(Gm).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(e.matrixWorld)))}function zC(e){const t=UC(e);return t.targetPosition||(t.targetPosition=Hm(new o).setGroup(Gm).onRenderUpdate((t,r)=>r.value.setFromMatrixPosition(e.target.matrixWorld)))}function HC(e){const t=UC(e);return t.viewPosition||(t.viewPosition=Hm(new o).setGroup(Gm).onRenderUpdate(({camera:t},r)=>{r.value=r.value||new o,r.value.setFromMatrixPosition(e.matrixWorld),r.value.applyMatrix4(t.matrixWorldInverse)}))}const WC=e=>nv.transformDirection(jC(e).sub(zC(e))),QC=(e,t)=>{for(const r of t)if(r.isAnalyticLightNode&&r.light.id===e)return r;return null},$C=new WeakMap,YC=[];class XC extends Fp{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=$f().toVar(),this.totalSpecularNode=$f().toVar(),this.outgoingLightNode=$f().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=this._lights;for(let r=0;r<e.length;r++){const t=e[r];if(YC.push(t.id),YC.push(t.castShadow?1:0),!0===t.isSpotLight){const e=null!==t.map?t.map.id:-1,r=t.colorNode?t.colorNode.getCacheKey():-1;YC.push(e,r)}}const t=pp(YC);return YC.length=0,t}getHash(e){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(e);const t=[];for(const e of this._lightNodes)t.push(e.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getNodeProperties(this);for(const r of t.nodes)r.build(e);t.outputNode.build(e)}setupLightsNode(e){const t=[],r=this._lightNodes,n=(e=>e.sort((e,t)=>e.id-t.id))(this._lights),i=e.renderer.library;for(const o of n)if(o.isNode)t.push(Nf(o));else{let e=null;if(null!==r&&(e=QC(o.id,r)),null===e){const e=i.getLightNodeClass(o.constructor);if(null===e){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let r=null;$C.has(o)?r=$C.get(o):(r=Nf(new e(o)),$C.set(o,r)),t.push(r)}}this._lightNodes=t}setupDirectLight(e,t,r){const{lightingModel:n,reflectedLight:i}=e.context;n.direct({...r,lightNode:t,reflectedLight:i},e)}setupDirectRectAreaLight(e,t,r){const{lightingModel:n,reflectedLight:i}=e.context;n.directRectArea({...r,lightNode:t,reflectedLight:i},e)}setupLights(e,t){for(const r of t)r.build(e)}getLightNodes(e){return null===this._lightNodes&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let r=this.outgoingLightNode;const n=e.context,i=n.lightingModel,o=e.getNodeProperties(this);if(i){const{totalDiffuseNode:t,totalSpecularNode:s}=this;n.outgoingLight=r;const a=e.addStack();o.nodes=a.nodes,i.start(e);const{backdrop:A,backdropAlpha:l}=n,{directDiffuse:u,directSpecular:c,indirectDiffuse:h,indirectSpecular:d}=n.reflectedLight;let p=u.add(h);null!==A&&(p=$f(null!==l?l.mix(p,A):A),n.material.transparent=!0),t.assign(p),s.assign(c.add(d)),r.assign(t.add(s)),i.finish(e),r=r.bypass(e.removeStack())}else o.nodes=[];return e.lightsNode=t,r}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class KC extends Fp{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Pp.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){ZC.assign(t.receivedShadowPositionNode||e.shadowPositionWorld||Pv)}}const ZC=Am("vec3","shadowPositionWorld");function JC(e,t){return t=function(e,t={}){return t.toneMapping=e.toneMapping,t.toneMappingExposure=e.toneMappingExposure,t.outputColorSpace=e.outputColorSpace,t.renderTarget=e.getRenderTarget(),t.activeCubeFace=e.getActiveCubeFace(),t.activeMipmapLevel=e.getActiveMipmapLevel(),t.renderObjectFunction=e.getRenderObjectFunction(),t.pixelRatio=e.getPixelRatio(),t.mrt=e.getMRT(),t.clearColor=e.getClearColor(t.clearColor||new te),t.clearAlpha=e.getClearAlpha(),t.autoClear=e.autoClear,t.scissorTest=e.getScissorTest(),t}(e,t),e.setMRT(null),e.setRenderObjectFunction(null),e.setClearColor(0,1),e.autoClear=!0,t}const eR=new WeakMap,tR=qf(({depthTexture:e,shadowCoord:t,depthLayer:r})=>{let n=zb(e,t.xy).label("t_basic");return e.isArrayTexture&&(n=n.depth(r)),n.compare(t.z)}),rR=qf(({depthTexture:e,shadowCoord:t,shadow:r,depthLayer:n})=>{const i=(t,r)=>{let i=zb(e,t);return e.isArrayTexture&&(i=i.depth(n)),i.compare(r)},o=l_("mapSize","vec2",r).setGroup(Gm),s=l_("radius","float",r).setGroup(Gm),a=zf(1).div(o),A=a.x.negate().mul(s),l=a.y.negate().mul(s),u=a.x.mul(s),c=a.y.mul(s),h=A.div(2),d=l.div(2),p=u.div(2),f=c.div(2);return eg(i(t.xy.add(zf(A,l)),t.z),i(t.xy.add(zf(0,l)),t.z),i(t.xy.add(zf(u,l)),t.z),i(t.xy.add(zf(h,d)),t.z),i(t.xy.add(zf(0,d)),t.z),i(t.xy.add(zf(p,d)),t.z),i(t.xy.add(zf(A,0)),t.z),i(t.xy.add(zf(h,0)),t.z),i(t.xy,t.z),i(t.xy.add(zf(p,0)),t.z),i(t.xy.add(zf(u,0)),t.z),i(t.xy.add(zf(h,f)),t.z),i(t.xy.add(zf(0,f)),t.z),i(t.xy.add(zf(p,f)),t.z),i(t.xy.add(zf(A,c)),t.z),i(t.xy.add(zf(0,c)),t.z),i(t.xy.add(zf(u,c)),t.z)).mul(1/17)}),nR=qf(({depthTexture:e,shadowCoord:t,shadow:r,depthLayer:n})=>{const i=(t,r)=>{let i=zb(e,t);return e.isArrayTexture&&(i=i.depth(n)),i.compare(r)},o=l_("mapSize","vec2",r).setGroup(Gm),s=zf(1).div(o),a=s.x,A=s.y,l=t.xy,u=Hg(l.mul(o).add(.5));return l.subAssign(u.mul(s)),eg(i(l,t.z),i(l.add(zf(a,0)),t.z),i(l.add(zf(0,A)),t.z),i(l.add(s),t.z),My(i(l.add(zf(a.negate(),0)),t.z),i(l.add(zf(a.mul(2),0)),t.z),u.x),My(i(l.add(zf(a.negate(),A)),t.z),i(l.add(zf(a.mul(2),A)),t.z),u.x),My(i(l.add(zf(0,A.negate())),t.z),i(l.add(zf(0,A.mul(2))),t.z),u.y),My(i(l.add(zf(a,A.negate())),t.z),i(l.add(zf(a,A.mul(2))),t.z),u.y),My(My(i(l.add(zf(a.negate(),A.negate())),t.z),i(l.add(zf(a.mul(2),A.negate())),t.z),u.x),My(i(l.add(zf(a.negate(),A.mul(2))),t.z),i(l.add(zf(a.mul(2),A.mul(2))),t.z),u.x),u.y)).mul(1/9)}),iR=qf(({depthTexture:e,shadowCoord:t,depthLayer:r})=>{const n=Uf(1).toVar();let i=zb(e).sample(t.xy);e.isArrayTexture&&(i=i.depth(r)),i=i.rg;const o=py(t.z,i.x);return kf(o.notEqual(Uf(1)),()=>{const e=t.z.sub(i.x),r=dy(0,i.y.mul(i.y));let s=r.div(r.add(e.mul(e)));s=Ny(tg(s,.3).div(.95-.3)),n.assign(Ny(dy(o,s)))}),n}),oR=qf(([e,t,r])=>{let n=Pv.sub(e).length();return n=n.sub(t).div(r.sub(t)),n=n.saturate(),n}),sR=e=>{let t=eR.get(e);if(void 0===t){const r=e.isPointLight?(e=>{const t=e.shadow.camera,r=l_("near","float",t).setGroup(Gm),n=l_("far","float",t).setGroup(Gm),i=cv(e);return oR(i,r,n)})(e):null;t=new kw,t.colorNode=Zf(0,0,0,1),t.depthNode=r,t.isShadowPassMaterial=!0,t.name="ShadowMaterial",t.fog=!1,eR.set(e,t)}return t},aR=new TE,AR=[],lR=(e,t,r,n)=>{AR[0]=e,AR[1]=t;let i=aR.get(AR);return void 0!==i&&i.shadowType===r&&i.useVelocity===n||(i=(i,o,s,a,A,l,...u)=>{(!0===i.castShadow||i.receiveShadow&&r===hn)&&(n&&(Mp(i).useVelocity=!0),i.onBeforeShadow(e,i,s,t.camera,a,o.overrideMaterial,l),e.renderObject(i,o,s,a,A,l,...u),i.onAfterShadow(e,i,s,t.camera,a,o.overrideMaterial,l))},i.shadowType=r,i.useVelocity=n,aR.set(AR,i)),AR[0]=null,AR[1]=null,i},uR=qf(({samples:e,radius:t,size:r,shadowPass:n,depthLayer:i})=>{const o=Uf(0).toVar("meanVertical"),s=Uf(0).toVar("squareMeanVertical"),a=e.lessThanEqual(Uf(1)).select(Uf(0),Uf(2).div(e.sub(1))),A=e.lessThanEqual(Uf(1)).select(Uf(0),Uf(-1));zx({start:Vf(0),end:Vf(e),type:"int",condition:"<"},({i:e})=>{const l=A.add(Uf(e).mul(a));let u=n.sample(eg(aw.xy,zf(0,l).mul(t)).div(r));n.value.isArrayTexture&&(u=u.depth(i)),u=u.x,o.addAssign(u),s.addAssign(u.mul(u))}),o.divAssign(e),s.divAssign(e);const l=Ug(s.sub(o.mul(o)));return zf(o,l)}),cR=qf(({samples:e,radius:t,size:r,shadowPass:n,depthLayer:i})=>{const o=Uf(0).toVar("meanHorizontal"),s=Uf(0).toVar("squareMeanHorizontal"),a=e.lessThanEqual(Uf(1)).select(Uf(0),Uf(2).div(e.sub(1))),A=e.lessThanEqual(Uf(1)).select(Uf(0),Uf(-1));zx({start:Vf(0),end:Vf(e),type:"int",condition:"<"},({i:e})=>{const l=A.add(Uf(e).mul(a));let u=n.sample(eg(aw.xy,zf(l,0).mul(t)).div(r));n.value.isArrayTexture&&(u=u.depth(i)),o.addAssign(u.x),s.addAssign(eg(u.y.mul(u.y),u.x.mul(u.x)))}),o.divAssign(e),s.divAssign(e);const l=Ug(s.sub(o.mul(o)));return zf(o,l)}),hR=[tR,rR,nR,iR];let dR;const pR=new nN;class fR extends KC{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(e,{filterFn:t,depthTexture:r,shadowCoord:n,shadow:i,depthLayer:o}){const s=n.x.greaterThanEqual(0).and(n.x.lessThanEqual(1)).and(n.y.greaterThanEqual(0)).and(n.y.lessThanEqual(1)).and(n.z.lessThanEqual(1)),a=t({depthTexture:r,shadowCoord:n,shadow:i,depthLayer:o});return s.select(a,Uf(1))}setupShadowCoord(e,t){const{shadow:r}=this,{renderer:n}=e,i=l_("bias","float",r).setGroup(Gm);let o,s=t;if(r.camera.isOrthographicCamera||!0!==n.logarithmicDepthBuffer)s=s.xyz.div(s.w),o=s.z,n.coordinateSystem===Ee&&(o=o.mul(2).sub(1));else{const e=s.w;s=s.xy.div(e);const t=l_("near","float",r.camera).setGroup(Gm),n=l_("far","float",r.camera).setGroup(Gm);o=Ew(e.negate(),t,n)}return s=$f(s.x,s.y.oneMinus(),o.add(i)),s}getShadowFilterFn(e){return hR[e]}setupRenderTarget(e,t){const r=new se(e.mapSize.width,e.mapSize.height);r.name="ShadowDepthTexture",r.compareFunction=ze;const n=t.createRenderTarget(e.mapSize.width,e.mapSize.height);return n.texture.name="ShadowMap",n.texture.type=e.mapType,n.depthTexture=r,{shadowMap:n,depthTexture:r}}setupShadow(e){const{renderer:t}=e,{light:r,shadow:n}=this,i=t.shadowMap.type,{depthTexture:o,shadowMap:s}=this.setupRenderTarget(n,e);if(n.camera.updateProjectionMatrix(),i===hn&&!0!==n.isPointLightShadow){o.compareFunction=null,s.depth>1?(s._vsmShadowMapVertical||(s._vsmShadowMapVertical=e.createRenderTarget(n.mapSize.width,n.mapSize.height,{format:Ot,type:S,depth:s.depth,depthBuffer:!1}),s._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=s._vsmShadowMapVertical,s._vsmShadowMapHorizontal||(s._vsmShadowMapHorizontal=e.createRenderTarget(n.mapSize.width,n.mapSize.height,{format:Ot,type:S,depth:s.depth,depthBuffer:!1}),s._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=s._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=e.createRenderTarget(n.mapSize.width,n.mapSize.height,{format:Ot,type:S,depthBuffer:!1}),this.vsmShadowMapHorizontal=e.createRenderTarget(n.mapSize.width,n.mapSize.height,{format:Ot,type:S,depthBuffer:!1}));let t=zb(o);o.isArrayTexture&&(t=t.depth(this.depthLayer));let r=zb(this.vsmShadowMapVertical.texture);o.isArrayTexture&&(r=r.depth(this.depthLayer));const i=l_("blurSamples","float",n).setGroup(Gm),a=l_("radius","float",n).setGroup(Gm),A=l_("mapSize","vec2",n).setGroup(Gm);let l=this.vsmMaterialVertical||(this.vsmMaterialVertical=new kw);l.fragmentNode=uR({samples:i,radius:a,size:A,shadowPass:t,depthLayer:this.depthLayer}).context(e.getSharedContext()),l.name="VSMVertical",l=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new kw),l.fragmentNode=cR({samples:i,radius:a,size:A,shadowPass:r,depthLayer:this.depthLayer}).context(e.getSharedContext()),l.name="VSMHorizontal"}const a=l_("intensity","float",n).setGroup(Gm),A=l_("normalBias","float",n).setGroup(Gm),l=VC(r).mul(ZC.add(zv.mul(A))),u=this.setupShadowCoord(e,l),c=n.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(null===c)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const h=i===hn&&!0!==n.isPointLightShadow?this.vsmShadowMapHorizontal.texture:o,d=this.setupShadowFilter(e,{filterFn:c,shadowTexture:s.texture,depthTexture:h,shadowCoord:u,shadow:n,depthLayer:this.depthLayer});let p=zb(s.texture,u);o.isArrayTexture&&(p=p.depth(this.depthLayer));const f=My(1,d.rgb.mix(p,1),a.mul(p.a)).toVar();return this.shadowMap=s,this.shadow.map=s,f}setup(e){if(!1!==e.renderer.shadowMap.enabled)return qf(()=>{let t=this._node;return this.setupShadowPosition(e),null===t&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:r,light:n}=this,{renderer:i,scene:o}=e;t.updateMatrices(n),r.setSize(t.mapSize.width,t.mapSize.height,r.depth),i.render(o,t.camera)}updateShadow(e){const{shadowMap:t,light:r,shadow:n}=this,{renderer:i,scene:o,camera:s}=e,a=i.shadowMap.type,A=t.depthTexture.version;this._depthVersionCached=A;const l=n.camera.layers.mask;4294967294&n.camera.layers.mask||(n.camera.layers.mask=s.layers.mask);const u=i.getRenderObjectFunction(),c=i.getMRT(),h=!!c&&c.has("velocity");dR=function(e,t,r){return r=function(e,t){return t=function(e,t={}){return t.background=e.background,t.backgroundNode=e.backgroundNode,t.overrideMaterial=e.overrideMaterial,t}(e,t),e.background=null,e.backgroundNode=null,e.overrideMaterial=null,t}(t,r=JC(e,r)),r}(i,o,dR),o.overrideMaterial=sR(r),i.setRenderObjectFunction(lR(i,n,a,h)),i.setClearColor(0,0),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(u),a===hn&&!0!==n.isPointLightShadow&&this.vsmPass(i),n.camera.layers.mask=l,function(e,t,r){!function(e,t){e.toneMapping=t.toneMapping,e.toneMappingExposure=t.toneMappingExposure,e.outputColorSpace=t.outputColorSpace,e.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),e.setRenderObjectFunction(t.renderObjectFunction),e.setPixelRatio(t.pixelRatio),e.setMRT(t.mrt),e.setClearColor(t.clearColor,t.clearAlpha),e.autoClear=t.autoClear,e.setScissorTest(t.scissorTest)}(e,r),function(e,t){e.background=t.background,e.backgroundNode=t.backgroundNode,e.overrideMaterial=t.overrideMaterial}(t,r)}(i,o,dR)}vsmPass(e){const{shadow:t}=this,r=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height,r),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height,r),e.setRenderTarget(this.vsmShadowMapVertical),pR.material=this.vsmMaterialVertical,pR.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),pR.material=this.vsmMaterialHorizontal,pR.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let r=t.needsUpdate||t.autoUpdate;r&&(this._cameraFrameId[e.camera]===e.frameId&&(r=!1),this._cameraFrameId[e.camera]=e.frameId),r&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const mR=(e,t)=>Nf(new fR(e,t)),gR=new te,yR=qf(([e,t])=>{const r=e.toVar(),n=Zg(r),i=ng(1,dy(n.x,dy(n.y,n.z)));n.mulAssign(i),r.mulAssign(i.mul(t.mul(2).oneMinus()));const o=zf(r.xy).toVar(),s=t.mul(1.5).oneMinus();return kf(n.z.greaterThanEqual(s),()=>{kf(r.z.greaterThan(0),()=>{o.x.assign(tg(4,r.x))})}).ElseIf(n.x.greaterThanEqual(s),()=>{const e=Jg(r.x);o.x.assign(r.z.mul(e).add(e.mul(2)))}).ElseIf(n.y.greaterThanEqual(s),()=>{const e=Jg(r.y);o.x.assign(r.x.add(e.mul(2)).add(2)),o.y.assign(r.z.mul(e).sub(2))}),zf(.125,.25).mul(o).add(zf(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),bR=qf(({depthTexture:e,bd3D:t,dp:r,texelSize:n})=>zb(e,yR(t,n.y)).compare(r)),vR=qf(({depthTexture:e,bd3D:t,dp:r,texelSize:n,shadow:i})=>{const o=l_("radius","float",i).setGroup(Gm),s=zf(-1,1).mul(o).mul(n.y);return zb(e,yR(t.add(s.xyy),n.y)).compare(r).add(zb(e,yR(t.add(s.yyy),n.y)).compare(r)).add(zb(e,yR(t.add(s.xyx),n.y)).compare(r)).add(zb(e,yR(t.add(s.yyx),n.y)).compare(r)).add(zb(e,yR(t,n.y)).compare(r)).add(zb(e,yR(t.add(s.xxy),n.y)).compare(r)).add(zb(e,yR(t.add(s.yxy),n.y)).compare(r)).add(zb(e,yR(t.add(s.xxx),n.y)).compare(r)).add(zb(e,yR(t.add(s.yxx),n.y)).compare(r)).mul(1/9)}),_R=qf(({filterFn:e,depthTexture:t,shadowCoord:r,shadow:n})=>{const i=r.xyz.toVar(),o=i.length(),s=Hm("float").setGroup(Gm).onRenderUpdate(()=>n.camera.near),a=Hm("float").setGroup(Gm).onRenderUpdate(()=>n.camera.far),A=l_("bias","float",n).setGroup(Gm),l=Hm(n.mapSize).setGroup(Gm),u=Uf(1).toVar();return kf(o.sub(a).lessThanEqual(0).and(o.sub(s).greaterThanEqual(0)),()=>{const r=o.sub(s).div(a.sub(s)).toVar();r.addAssign(A);const c=i.normalize(),h=zf(1).div(l.mul(zf(4,2)));u.assign(e({depthTexture:t,bd3D:c,dp:r,texelSize:h,shadow:n}))}),u}),xR=new M,wR=new n,TR=new n;class SR extends fR{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===an?bR:vR}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:r,depthTexture:n,shadowCoord:i,shadow:o}){return _R({filterFn:t,shadowTexture:r,depthTexture:n,shadowCoord:i,shadow:o})}renderShadow(e){const{shadow:t,shadowMap:r,light:n}=this,{renderer:i,scene:o}=e,s=t.getFrameExtents();TR.copy(t.mapSize),TR.multiply(s),r.setSize(TR.width,TR.height),wR.copy(t.mapSize);const a=i.autoClear,A=i.getClearColor(gR),l=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha),i.clear();const u=t.getViewportCount();for(let c=0;c<u;c++){const e=t.getViewport(c),s=wR.x*e.x,a=TR.y-wR.y-wR.y*e.y;xR.set(s,a,wR.x*e.z,wR.y*e.w),r.viewport.copy(xR),t.updateMatrices(n,c),i.render(o,t.camera)}i.autoClear=a,i.setClearColor(A,l)}}const ER=(e,t)=>Nf(new SR(e,t));class MR extends Kx{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new te,this.colorNode=e&&e.colorNode||Hm(this.color).setGroup(Gm),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Pp.FRAME}getHash(){return this.light.uuid}getLightVector(e){return HC(this.light).sub(e.context.positionView||Bv)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return mR(this.light)}setupShadow(e){const{renderer:t}=e;if(!1===t.shadowMap.enabled)return;let r=this.shadowColorNode;if(null===r){const e=this.light.shadow.shadowNode;let t;t=void 0!==e?Nf(e):this.setupShadowNode(),this.shadowNode=t,this.shadowColorNode=r=this.colorNode.mul(t),this.baseColorNode=this.colorNode}this.colorNode=r}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),r=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),r&&e.lightsNode.setupDirectRectAreaLight(e,this,r)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const NR=qf(({lightDistance:e,cutoffDistance:t,decayExponent:r})=>{const n=e.pow(r).max(.01).reciprocal();return t.greaterThan(0).select(n.mul(e.div(t).pow4().oneMinus().clamp().pow2()),n)}),CR=({color:e,lightVector:t,cutoffDistance:r,decayExponent:n})=>{const i=t.normalize(),o=t.length(),s=NR({lightDistance:o,cutoffDistance:r,decayExponent:n});return{lightDirection:i,lightColor:e.mul(s)}};class RR extends MR{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Hm(0).setGroup(Gm),this.decayExponentNode=Hm(2).setGroup(Gm)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return ER(this.light)}setupDirect(e){return CR({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const PR=qf(([e=t()])=>{const t=e.mul(2),r=t.x.floor(),n=t.y.floor();return r.add(n).mod(2).sign()}),DR=qf(([e=Lb()],{renderer:t,material:r})=>{const n=Ey(e.mul(2).sub(1));let i;if(r.alphaToCoverage&&t.samples>1){const e=Uf(n.fwidth()).toVar();i=Py(e.oneMinus(),e.add(1),n).oneMinus()}else i=Uy(n.greaterThan(1),0,1);return i}),BR=qf(([e,t,r])=>{const n=Uf(r).toVar(),i=Uf(t).toVar(),o=jf(e).toVar();return Uy(o,i,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),qR=qf(([e,t])=>{const r=jf(t).toVar(),n=Uf(e).toVar();return Uy(r,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),OR=qf(([e])=>{const t=Uf(e).toVar();return Vf(Gg(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),LR=qf(([e,t])=>{const r=Uf(e).toVar();return t.assign(OR(r)),r.sub(Uf(t))}),kR=qf(([e,t,r,n,i,o])=>{const s=Uf(o).toVar(),a=Uf(i).toVar(),A=Uf(n).toVar(),l=Uf(r).toVar(),u=Uf(t).toVar(),c=Uf(e).toVar(),h=Uf(tg(1,a)).toVar();return tg(1,s).mul(c.mul(h).add(u.mul(a))).add(s.mul(l.mul(h).add(A.mul(a))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),IR=qf(([e,t,r,n,i,o])=>{const s=Uf(o).toVar(),a=Uf(i).toVar(),A=$f(n).toVar(),l=$f(r).toVar(),u=$f(t).toVar(),c=$f(e).toVar(),h=Uf(tg(1,a)).toVar();return tg(1,s).mul(c.mul(h).add(u.mul(a))).add(s.mul(l.mul(h).add(A.mul(a))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),FR=EM([kR,IR]),UR=qf(([e,t,r,n,i,o,s,a,A,l,u])=>{const c=Uf(u).toVar(),h=Uf(l).toVar(),d=Uf(A).toVar(),p=Uf(a).toVar(),f=Uf(s).toVar(),m=Uf(o).toVar(),g=Uf(i).toVar(),y=Uf(n).toVar(),b=Uf(r).toVar(),v=Uf(t).toVar(),_=Uf(e).toVar(),x=Uf(tg(1,d)).toVar(),w=Uf(tg(1,h)).toVar();return Uf(tg(1,c)).toVar().mul(w.mul(_.mul(x).add(v.mul(d))).add(h.mul(b.mul(x).add(y.mul(d))))).add(c.mul(w.mul(g.mul(x).add(m.mul(d))).add(h.mul(f.mul(x).add(p.mul(d))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),VR=qf(([e,t,r,n,i,o,s,a,A,l,u])=>{const c=Uf(u).toVar(),h=Uf(l).toVar(),d=Uf(A).toVar(),p=$f(a).toVar(),f=$f(s).toVar(),m=$f(o).toVar(),g=$f(i).toVar(),y=$f(n).toVar(),b=$f(r).toVar(),v=$f(t).toVar(),_=$f(e).toVar(),x=Uf(tg(1,d)).toVar(),w=Uf(tg(1,h)).toVar();return Uf(tg(1,c)).toVar().mul(w.mul(_.mul(x).add(v.mul(d))).add(h.mul(b.mul(x).add(y.mul(d))))).add(c.mul(w.mul(g.mul(x).add(m.mul(d))).add(h.mul(f.mul(x).add(p.mul(d))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),GR=EM([UR,VR]),jR=qf(([e,t,r])=>{const n=Uf(r).toVar(),i=Uf(t).toVar(),o=Gf(e).toVar(),s=Gf(o.bitAnd(Gf(7))).toVar(),a=Uf(BR(s.lessThan(Gf(4)),i,n)).toVar(),A=Uf(rg(2,BR(s.lessThan(Gf(4)),n,i))).toVar();return qR(a,jf(s.bitAnd(Gf(1)))).add(qR(A,jf(s.bitAnd(Gf(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),zR=qf(([e,t,r,n])=>{const i=Uf(n).toVar(),o=Uf(r).toVar(),s=Uf(t).toVar(),a=Gf(e).toVar(),A=Gf(a.bitAnd(Gf(15))).toVar(),l=Uf(BR(A.lessThan(Gf(8)),s,o)).toVar(),u=Uf(BR(A.lessThan(Gf(4)),o,BR(A.equal(Gf(12)).or(A.equal(Gf(14))),s,i))).toVar();return qR(l,jf(A.bitAnd(Gf(1)))).add(qR(u,jf(A.bitAnd(Gf(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),HR=EM([jR,zR]),WR=qf(([e,t,r])=>{const n=Uf(r).toVar(),i=Uf(t).toVar(),o=Xf(e).toVar();return $f(HR(o.x,i,n),HR(o.y,i,n),HR(o.z,i,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),QR=qf(([e,t,r,n])=>{const i=Uf(n).toVar(),o=Uf(r).toVar(),s=Uf(t).toVar(),a=Xf(e).toVar();return $f(HR(a.x,s,o,i),HR(a.y,s,o,i),HR(a.z,s,o,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),$R=EM([WR,QR]),YR=qf(([e])=>{const t=Uf(e).toVar();return rg(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),XR=qf(([e])=>{const t=Uf(e).toVar();return rg(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),KR=qf(([e])=>{const t=$f(e).toVar();return rg(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),ZR=EM([YR,KR]),JR=qf(([e])=>{const t=$f(e).toVar();return rg(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),eP=EM([XR,JR]),tP=qf(([e,t])=>{const r=Vf(t).toVar(),n=Gf(e).toVar();return n.shiftLeft(r).bitOr(n.shiftRight(Vf(32).sub(r)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),rP=qf(([e,t,r])=>{e.subAssign(r),e.bitXorAssign(tP(r,Vf(4))),r.addAssign(t),t.subAssign(e),t.bitXorAssign(tP(e,Vf(6))),e.addAssign(r),r.subAssign(t),r.bitXorAssign(tP(t,Vf(8))),t.addAssign(e),e.subAssign(r),e.bitXorAssign(tP(r,Vf(16))),r.addAssign(t),t.subAssign(e),t.bitXorAssign(tP(e,Vf(19))),e.addAssign(r),r.subAssign(t),r.bitXorAssign(tP(t,Vf(4))),t.addAssign(e)}),nP=qf(([e,t,r])=>{const n=Gf(r).toVar(),i=Gf(t).toVar(),o=Gf(e).toVar();return n.bitXorAssign(i),n.subAssign(tP(i,Vf(14))),o.bitXorAssign(n),o.subAssign(tP(n,Vf(11))),i.bitXorAssign(o),i.subAssign(tP(o,Vf(25))),n.bitXorAssign(i),n.subAssign(tP(i,Vf(16))),o.bitXorAssign(n),o.subAssign(tP(n,Vf(4))),i.bitXorAssign(o),i.subAssign(tP(o,Vf(14))),n.bitXorAssign(i),n.subAssign(tP(i,Vf(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),iP=qf(([e])=>{const t=Gf(e).toVar();return Uf(t).div(Uf(Gf(Vf(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),oP=qf(([e])=>{const t=Uf(e).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),sP=qf(([e])=>{const t=Vf(e).toVar(),r=Gf(Gf(1)).toVar(),n=Gf(Gf(Vf(3735928559)).add(r.shiftLeft(Gf(2))).add(Gf(13))).toVar();return nP(n.add(Gf(t)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),aP=qf(([e,t])=>{const r=Vf(t).toVar(),n=Vf(e).toVar(),i=Gf(Gf(2)).toVar(),o=Gf().toVar(),s=Gf().toVar(),a=Gf().toVar();return o.assign(s.assign(a.assign(Gf(Vf(3735928559)).add(i.shiftLeft(Gf(2))).add(Gf(13))))),o.addAssign(Gf(n)),s.addAssign(Gf(r)),nP(o,s,a)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),AP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Vf(t).toVar(),o=Vf(e).toVar(),s=Gf(Gf(3)).toVar(),a=Gf().toVar(),A=Gf().toVar(),l=Gf().toVar();return a.assign(A.assign(l.assign(Gf(Vf(3735928559)).add(s.shiftLeft(Gf(2))).add(Gf(13))))),a.addAssign(Gf(o)),A.addAssign(Gf(i)),l.addAssign(Gf(n)),nP(a,A,l)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),lP=qf(([e,t,r,n])=>{const i=Vf(n).toVar(),o=Vf(r).toVar(),s=Vf(t).toVar(),a=Vf(e).toVar(),A=Gf(Gf(4)).toVar(),l=Gf().toVar(),u=Gf().toVar(),c=Gf().toVar();return l.assign(u.assign(c.assign(Gf(Vf(3735928559)).add(A.shiftLeft(Gf(2))).add(Gf(13))))),l.addAssign(Gf(a)),u.addAssign(Gf(s)),c.addAssign(Gf(o)),rP(l,u,c),l.addAssign(Gf(i)),nP(l,u,c)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),uP=qf(([e,t,r,n,i])=>{const o=Vf(i).toVar(),s=Vf(n).toVar(),a=Vf(r).toVar(),A=Vf(t).toVar(),l=Vf(e).toVar(),u=Gf(Gf(5)).toVar(),c=Gf().toVar(),h=Gf().toVar(),d=Gf().toVar();return c.assign(h.assign(d.assign(Gf(Vf(3735928559)).add(u.shiftLeft(Gf(2))).add(Gf(13))))),c.addAssign(Gf(l)),h.addAssign(Gf(A)),d.addAssign(Gf(a)),rP(c,h,d),c.addAssign(Gf(s)),h.addAssign(Gf(o)),nP(c,h,d)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),cP=EM([sP,aP,AP,lP,uP]),hP=qf(([e,t])=>{const r=Vf(t).toVar(),n=Vf(e).toVar(),i=Gf(cP(n,r)).toVar(),o=Xf().toVar();return o.x.assign(i.bitAnd(Vf(255))),o.y.assign(i.shiftRight(Vf(8)).bitAnd(Vf(255))),o.z.assign(i.shiftRight(Vf(16)).bitAnd(Vf(255))),o}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),dP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Vf(t).toVar(),o=Vf(e).toVar(),s=Gf(cP(o,i,n)).toVar(),a=Xf().toVar();return a.x.assign(s.bitAnd(Vf(255))),a.y.assign(s.shiftRight(Vf(8)).bitAnd(Vf(255))),a.z.assign(s.shiftRight(Vf(16)).bitAnd(Vf(255))),a}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),pP=EM([hP,dP]),fP=qf(([e])=>{const t=zf(e).toVar(),r=Vf().toVar(),n=Vf().toVar(),i=Uf(LR(t.x,r)).toVar(),o=Uf(LR(t.y,n)).toVar(),s=Uf(oP(i)).toVar(),a=Uf(oP(o)).toVar(),A=Uf(FR(HR(cP(r,n),i,o),HR(cP(r.add(Vf(1)),n),i.sub(1),o),HR(cP(r,n.add(Vf(1))),i,o.sub(1)),HR(cP(r.add(Vf(1)),n.add(Vf(1))),i.sub(1),o.sub(1)),s,a)).toVar();return ZR(A)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),mP=qf(([e])=>{const t=$f(e).toVar(),r=Vf().toVar(),n=Vf().toVar(),i=Vf().toVar(),o=Uf(LR(t.x,r)).toVar(),s=Uf(LR(t.y,n)).toVar(),a=Uf(LR(t.z,i)).toVar(),A=Uf(oP(o)).toVar(),l=Uf(oP(s)).toVar(),u=Uf(oP(a)).toVar(),c=Uf(GR(HR(cP(r,n,i),o,s,a),HR(cP(r.add(Vf(1)),n,i),o.sub(1),s,a),HR(cP(r,n.add(Vf(1)),i),o,s.sub(1),a),HR(cP(r.add(Vf(1)),n.add(Vf(1)),i),o.sub(1),s.sub(1),a),HR(cP(r,n,i.add(Vf(1))),o,s,a.sub(1)),HR(cP(r.add(Vf(1)),n,i.add(Vf(1))),o.sub(1),s,a.sub(1)),HR(cP(r,n.add(Vf(1)),i.add(Vf(1))),o,s.sub(1),a.sub(1)),HR(cP(r.add(Vf(1)),n.add(Vf(1)),i.add(Vf(1))),o.sub(1),s.sub(1),a.sub(1)),A,l,u)).toVar();return eP(c)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),gP=EM([fP,mP]),yP=qf(([e])=>{const t=zf(e).toVar(),r=Vf().toVar(),n=Vf().toVar(),i=Uf(LR(t.x,r)).toVar(),o=Uf(LR(t.y,n)).toVar(),s=Uf(oP(i)).toVar(),a=Uf(oP(o)).toVar(),A=$f(FR($R(pP(r,n),i,o),$R(pP(r.add(Vf(1)),n),i.sub(1),o),$R(pP(r,n.add(Vf(1))),i,o.sub(1)),$R(pP(r.add(Vf(1)),n.add(Vf(1))),i.sub(1),o.sub(1)),s,a)).toVar();return ZR(A)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),bP=qf(([e])=>{const t=$f(e).toVar(),r=Vf().toVar(),n=Vf().toVar(),i=Vf().toVar(),o=Uf(LR(t.x,r)).toVar(),s=Uf(LR(t.y,n)).toVar(),a=Uf(LR(t.z,i)).toVar(),A=Uf(oP(o)).toVar(),l=Uf(oP(s)).toVar(),u=Uf(oP(a)).toVar(),c=$f(GR($R(pP(r,n,i),o,s,a),$R(pP(r.add(Vf(1)),n,i),o.sub(1),s,a),$R(pP(r,n.add(Vf(1)),i),o,s.sub(1),a),$R(pP(r.add(Vf(1)),n.add(Vf(1)),i),o.sub(1),s.sub(1),a),$R(pP(r,n,i.add(Vf(1))),o,s,a.sub(1)),$R(pP(r.add(Vf(1)),n,i.add(Vf(1))),o.sub(1),s,a.sub(1)),$R(pP(r,n.add(Vf(1)),i.add(Vf(1))),o,s.sub(1),a.sub(1)),$R(pP(r.add(Vf(1)),n.add(Vf(1)),i.add(Vf(1))),o.sub(1),s.sub(1),a.sub(1)),A,l,u)).toVar();return eP(c)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),vP=EM([yP,bP]),_P=qf(([e])=>{const t=Uf(e).toVar(),r=Vf(OR(t)).toVar();return iP(cP(r))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),xP=qf(([e])=>{const t=zf(e).toVar(),r=Vf(OR(t.x)).toVar(),n=Vf(OR(t.y)).toVar();return iP(cP(r,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),wP=qf(([e])=>{const t=$f(e).toVar(),r=Vf(OR(t.x)).toVar(),n=Vf(OR(t.y)).toVar(),i=Vf(OR(t.z)).toVar();return iP(cP(r,n,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),TP=qf(([e])=>{const t=Zf(e).toVar(),r=Vf(OR(t.x)).toVar(),n=Vf(OR(t.y)).toVar(),i=Vf(OR(t.z)).toVar(),o=Vf(OR(t.w)).toVar();return iP(cP(r,n,i,o))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),SP=EM([_P,xP,wP,TP]),EP=qf(([e])=>{const t=Uf(e).toVar(),r=Vf(OR(t)).toVar();return $f(iP(cP(r,Vf(0))),iP(cP(r,Vf(1))),iP(cP(r,Vf(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),MP=qf(([e])=>{const t=zf(e).toVar(),r=Vf(OR(t.x)).toVar(),n=Vf(OR(t.y)).toVar();return $f(iP(cP(r,n,Vf(0))),iP(cP(r,n,Vf(1))),iP(cP(r,n,Vf(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),NP=qf(([e])=>{const t=$f(e).toVar(),r=Vf(OR(t.x)).toVar(),n=Vf(OR(t.y)).toVar(),i=Vf(OR(t.z)).toVar();return $f(iP(cP(r,n,i,Vf(0))),iP(cP(r,n,i,Vf(1))),iP(cP(r,n,i,Vf(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),CP=qf(([e])=>{const t=Zf(e).toVar(),r=Vf(OR(t.x)).toVar(),n=Vf(OR(t.y)).toVar(),i=Vf(OR(t.z)).toVar(),o=Vf(OR(t.w)).toVar();return $f(iP(cP(r,n,i,o,Vf(0))),iP(cP(r,n,i,o,Vf(1))),iP(cP(r,n,i,o,Vf(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),RP=EM([EP,MP,NP,CP]),PP=qf(([e,t,r,n])=>{const i=Uf(n).toVar(),o=Uf(r).toVar(),s=Vf(t).toVar(),a=$f(e).toVar(),A=Uf(0).toVar(),l=Uf(1).toVar();return zx(s,()=>{A.addAssign(l.mul(gP(a))),l.mulAssign(i),a.mulAssign(o)}),A}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),DP=qf(([e,t,r,n])=>{const i=Uf(n).toVar(),o=Uf(r).toVar(),s=Vf(t).toVar(),a=$f(e).toVar(),A=$f(0).toVar(),l=Uf(1).toVar();return zx(s,()=>{A.addAssign(l.mul(vP(a))),l.mulAssign(i),a.mulAssign(o)}),A}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),BP=qf(([e,t,r,n])=>{const i=Uf(n).toVar(),o=Uf(r).toVar(),s=Vf(t).toVar(),a=$f(e).toVar();return zf(PP(a,s,o,i),PP(a.add($f(Vf(19),Vf(193),Vf(17))),s,o,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),qP=qf(([e,t,r,n])=>{const i=Uf(n).toVar(),o=Uf(r).toVar(),s=Vf(t).toVar(),a=$f(e).toVar(),A=$f(DP(a,s,o,i)).toVar(),l=Uf(PP(a.add($f(Vf(19),Vf(193),Vf(17))),s,o,i)).toVar();return Zf(A,l)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),OP=qf(([e,t,r,n,i,o,s])=>{const a=Vf(s).toVar(),A=Uf(o).toVar(),l=Vf(i).toVar(),u=Vf(n).toVar(),c=Vf(r).toVar(),h=Vf(t).toVar(),d=zf(e).toVar(),p=$f(RP(zf(h.add(u),c.add(l)))).toVar(),f=zf(p.x,p.y).toVar();f.subAssign(.5),f.mulAssign(A),f.addAssign(.5);const m=zf(zf(Uf(h),Uf(c)).add(f)).toVar(),g=zf(m.sub(d)).toVar();return kf(a.equal(Vf(2)),()=>Zg(g.x).add(Zg(g.y))),kf(a.equal(Vf(3)),()=>dy(Zg(g.x),Zg(g.y))),yy(g,g)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),LP=qf(([e,t,r,n,i,o,s,a,A])=>{const l=Vf(A).toVar(),u=Uf(a).toVar(),c=Vf(s).toVar(),h=Vf(o).toVar(),d=Vf(i).toVar(),p=Vf(n).toVar(),f=Vf(r).toVar(),m=Vf(t).toVar(),g=$f(e).toVar(),y=$f(RP($f(m.add(d),f.add(h),p.add(c)))).toVar();y.subAssign(.5),y.mulAssign(u),y.addAssign(.5);const b=$f($f(Uf(m),Uf(f),Uf(p)).add(y)).toVar(),v=$f(b.sub(g)).toVar();return kf(l.equal(Vf(2)),()=>Zg(v.x).add(Zg(v.y)).add(Zg(v.z))),kf(l.equal(Vf(3)),()=>dy(Zg(v.x),Zg(v.y),Zg(v.z))),yy(v,v)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),kP=EM([OP,LP]),IP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Uf(t).toVar(),o=zf(e).toVar(),s=Vf().toVar(),a=Vf().toVar(),A=zf(LR(o.x,s),LR(o.y,a)).toVar(),l=Uf(1e6).toVar();return zx({start:-1,end:Vf(1),name:"x",condition:"<="},({x:e})=>{zx({start:-1,end:Vf(1),name:"y",condition:"<="},({y:t})=>{const r=Uf(kP(A,e,t,s,a,i,n)).toVar();l.assign(hy(l,r))})}),kf(n.equal(Vf(0)),()=>{l.assign(Ug(l))}),l}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),FP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Uf(t).toVar(),o=zf(e).toVar(),s=Vf().toVar(),a=Vf().toVar(),A=zf(LR(o.x,s),LR(o.y,a)).toVar(),l=zf(1e6,1e6).toVar();return zx({start:-1,end:Vf(1),name:"x",condition:"<="},({x:e})=>{zx({start:-1,end:Vf(1),name:"y",condition:"<="},({y:t})=>{const r=Uf(kP(A,e,t,s,a,i,n)).toVar();kf(r.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(r)}).ElseIf(r.lessThan(l.y),()=>{l.y.assign(r)})})}),kf(n.equal(Vf(0)),()=>{l.assign(Ug(l))}),l}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),UP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Uf(t).toVar(),o=zf(e).toVar(),s=Vf().toVar(),a=Vf().toVar(),A=zf(LR(o.x,s),LR(o.y,a)).toVar(),l=$f(1e6,1e6,1e6).toVar();return zx({start:-1,end:Vf(1),name:"x",condition:"<="},({x:e})=>{zx({start:-1,end:Vf(1),name:"y",condition:"<="},({y:t})=>{const r=Uf(kP(A,e,t,s,a,i,n)).toVar();kf(r.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(r)}).ElseIf(r.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(r)}).ElseIf(r.lessThan(l.z),()=>{l.z.assign(r)})})}),kf(n.equal(Vf(0)),()=>{l.assign(Ug(l))}),l}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),VP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Uf(t).toVar(),o=$f(e).toVar(),s=Vf().toVar(),a=Vf().toVar(),A=Vf().toVar(),l=$f(LR(o.x,s),LR(o.y,a),LR(o.z,A)).toVar(),u=Uf(1e6).toVar();return zx({start:-1,end:Vf(1),name:"x",condition:"<="},({x:e})=>{zx({start:-1,end:Vf(1),name:"y",condition:"<="},({y:t})=>{zx({start:-1,end:Vf(1),name:"z",condition:"<="},({z:r})=>{const o=Uf(kP(l,e,t,r,s,a,A,i,n)).toVar();u.assign(hy(u,o))})})}),kf(n.equal(Vf(0)),()=>{u.assign(Ug(u))}),u}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),GP=EM([IP,VP]),jP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Uf(t).toVar(),o=$f(e).toVar(),s=Vf().toVar(),a=Vf().toVar(),A=Vf().toVar(),l=$f(LR(o.x,s),LR(o.y,a),LR(o.z,A)).toVar(),u=zf(1e6,1e6).toVar();return zx({start:-1,end:Vf(1),name:"x",condition:"<="},({x:e})=>{zx({start:-1,end:Vf(1),name:"y",condition:"<="},({y:t})=>{zx({start:-1,end:Vf(1),name:"z",condition:"<="},({z:r})=>{const o=Uf(kP(l,e,t,r,s,a,A,i,n)).toVar();kf(o.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(o)}).ElseIf(o.lessThan(u.y),()=>{u.y.assign(o)})})})}),kf(n.equal(Vf(0)),()=>{u.assign(Ug(u))}),u}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),zP=EM([FP,jP]),HP=qf(([e,t,r])=>{const n=Vf(r).toVar(),i=Uf(t).toVar(),o=$f(e).toVar(),s=Vf().toVar(),a=Vf().toVar(),A=Vf().toVar(),l=$f(LR(o.x,s),LR(o.y,a),LR(o.z,A)).toVar(),u=$f(1e6,1e6,1e6).toVar();return zx({start:-1,end:Vf(1),name:"x",condition:"<="},({x:e})=>{zx({start:-1,end:Vf(1),name:"y",condition:"<="},({y:t})=>{zx({start:-1,end:Vf(1),name:"z",condition:"<="},({z:r})=>{const o=Uf(kP(l,e,t,r,s,a,A,i,n)).toVar();kf(o.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(o)}).ElseIf(o.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(o)}).ElseIf(o.lessThan(u.z),()=>{u.z.assign(o)})})})}),kf(n.equal(Vf(0)),()=>{u.assign(Ug(u))}),u}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),WP=EM([UP,HP]),QP=qf(([e])=>{const t=e.y,r=e.z,n=$f().toVar();return kf(t.lessThan(1e-4),()=>{n.assign($f(r,r,r))}).Else(()=>{let i=e.x;i=i.sub(Gg(i)).mul(6).toVar();const o=Vf(ay(i)),s=i.sub(Uf(o)),a=r.mul(t.oneMinus()),A=r.mul(t.mul(s).oneMinus()),l=r.mul(t.mul(s.oneMinus()).oneMinus());kf(o.equal(Vf(0)),()=>{n.assign($f(r,l,a))}).ElseIf(o.equal(Vf(1)),()=>{n.assign($f(A,r,a))}).ElseIf(o.equal(Vf(2)),()=>{n.assign($f(a,r,l))}).ElseIf(o.equal(Vf(3)),()=>{n.assign($f(a,A,r))}).ElseIf(o.equal(Vf(4)),()=>{n.assign($f(l,a,r))}).Else(()=>{n.assign($f(r,a,A))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),$P=qf(([e])=>{const t=$f(e).toVar(),r=Uf(t.x).toVar(),n=Uf(t.y).toVar(),i=Uf(t.z).toVar(),o=Uf(hy(r,hy(n,i))).toVar(),s=Uf(dy(r,dy(n,i))).toVar(),a=Uf(s.sub(o)).toVar(),A=Uf().toVar(),l=Uf().toVar(),u=Uf().toVar();return u.assign(s),kf(s.greaterThan(0),()=>{l.assign(a.div(s))}).Else(()=>{l.assign(0)}),kf(l.lessThanEqual(0),()=>{A.assign(0)}).Else(()=>{kf(r.greaterThanEqual(s),()=>{A.assign(n.sub(i).div(a))}).ElseIf(n.greaterThanEqual(s),()=>{A.assign(eg(2,i.sub(r).div(a)))}).Else(()=>{A.assign(eg(4,r.sub(n).div(a)))}),A.mulAssign(1/6),kf(A.lessThan(0),()=>{A.addAssign(1)})}),$f(A,l,u)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),YP=qf(([e])=>{const t=$f(e).toVar(),r=Kf(Ag(t,$f(.04045))).toVar(),n=$f(t.div(12.92)).toVar(),i=$f(vy(dy(t.add($f(.055)),$f(0)).div(1.055),$f(2.4))).toVar();return My(n,i,r)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),XP=(e,t)=>{e=Uf(e),t=Uf(t);const r=zf(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return Py(e.sub(r),e.add(r),t)},KP=(e,t,r,n)=>My(e,t,r[n].clamp()),ZP=(e,t,r,n,i)=>My(e,t,XP(r,n[i])),JP=qf(([e,t,r])=>{const n=zg(e).toVar(),i=tg(Uf(.5).mul(t.sub(r)),Pv).div(n).toVar(),o=tg(Uf(-.5).mul(t.sub(r)),Pv).div(n).toVar(),s=$f().toVar();s.x=n.x.greaterThan(Uf(0)).select(i.x,o.x),s.y=n.y.greaterThan(Uf(0)).select(i.y,o.y),s.z=n.z.greaterThan(Uf(0)).select(i.z,o.z);const a=hy(s.x,s.y,s.z).toVar();return Pv.add(n.mul(a)).toVar().sub(r)}),eD=qf(([e,t])=>{const r=e.x,n=e.y,i=e.z;let o=t.element(0).mul(.886227);return o=o.add(t.element(1).mul(1.023328).mul(n)),o=o.add(t.element(2).mul(1.023328).mul(i)),o=o.add(t.element(3).mul(1.023328).mul(r)),o=o.add(t.element(4).mul(.858086).mul(r).mul(n)),o=o.add(t.element(5).mul(.858086).mul(n).mul(i)),o=o.add(t.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),o=o.add(t.element(7).mul(.858086).mul(r).mul(i)),o=o.add(t.element(8).mul(.429043).mul(rg(r,r).sub(rg(n,n)))),o});var tD=Object.freeze({__proto__:null,BRDF_GGX:TT,BRDF_Lambert:lT,BasicPointShadowFilter:bR,BasicShadowFilter:tR,Break:Hx,Const:$y,Continue:()=>Nb("continue").toStack(),DFGApprox:ST,D_GGX:_T,Discard:Cb,EPSILON:Ng,F_Schlick:AT,Fn:qf,INFINITY:Cg,If:kf,Loop:zx,NodeAccess:Dp,NodeShaderStage:Rp,NodeType:{BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},NodeUpdateType:Pp,PCFShadowFilter:rR,PCFSoftShadowFilter:nR,PI:Rg,PI2:Pg,PointShadowFilter:vR,Return:()=>Nb("return").toStack(),Schlick_to_F0:MT,ScriptableNodeResources:fC,ShaderNode:Mf,Stack:If,Switch:(...e)=>Zp.Switch(...e),TBNViewMatrix:E_,VSMShadowFilter:iR,V_GGX_SmithCorrelated:bT,Var:Qy,abs:Zg,acesFilmicToneMapping:tC,acos:Xg,add:eg,addMethodChaining:ef,addNodeElement:function(e){console.warn("THREE.TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",e)},agxToneMapping:oC,all:Dg,alphaT:_m,and:cg,anisotropy:xm,anisotropyB:Tm,anisotropyT:wm,any:Bg,append:e=>(console.warn("THREE.TSL: append() has been renamed to Stack()."),If(e)),array:Qm,arrayBuffer:e=>Nf(new Xp(e,"ArrayBuffer")),asin:Yg,assign:Ym,atan:Kg,atan2:Ly,atomicAdd:(e,t)=>IC(LC.ATOMIC_ADD,e,t),atomicAnd:(e,t)=>IC(LC.ATOMIC_AND,e,t),atomicFunc:IC,atomicLoad:e=>IC(LC.ATOMIC_LOAD,e,null),atomicMax:(e,t)=>IC(LC.ATOMIC_MAX,e,t),atomicMin:(e,t)=>IC(LC.ATOMIC_MIN,e,t),atomicOr:(e,t)=>IC(LC.ATOMIC_OR,e,t),atomicStore:(e,t)=>IC(LC.ATOMIC_STORE,e,t),atomicSub:(e,t)=>IC(LC.ATOMIC_SUB,e,t),atomicXor:(e,t)=>IC(LC.ATOMIC_XOR,e,t),attenuationColor:Lm,attenuationDistance:Om,attribute:Ob,attributeArray:(e,t="float")=>{let r,n;!0===t.isStruct?(r=t.layout.getLength(),n=_p("float")):(r=xp(t),n=_p(t));const i=new cN(e,r,n);return Fx(i,t,e)},backgroundBlurriness:gN,backgroundIntensity:yN,backgroundRotation:bN,batch:Ox,billboarding:DM,bitAnd:fg,bitNot:mg,bitOr:gg,bitXor:yg,bitangentGeometry:v_,bitangentLocal:__,bitangentView:x_,bitangentWorld:w_,bitcast:uy,blendBurn:PN,blendColor:ON,blendDodge:DN,blendOverlay:qN,blendScreen:BN,blur:SS,bool:jf,buffer:Qb,bufferAttribute:db,bumpMap:O_,burn:(...e)=>(console.warn('THREE.TSL: "burn" has been renamed. Use "blendBurn" instead.'),PN(e)),bvec2:Qf,bvec3:Kf,bvec4:tm,bypass:wb,cache:vb,call:Km,cameraFar:ev,cameraIndex:Zb,cameraNear:Jb,cameraNormalMatrix:ov,cameraPosition:sv,cameraProjectionMatrix:tv,cameraProjectionMatrixInverse:rv,cameraViewMatrix:nv,cameraWorldMatrix:iv,cbrt:Sy,cdl:jN,ceil:jg,checker:PR,cineonToneMapping:JN,clamp:Ny,clearcoat:pm,clearcoatRoughness:fm,code:AC,color:Ff,colorSpaceToWorking:ib,colorToDirection:e=>Nf(e).mul(2).sub(1),compute:yb,computeSkinning:(e,t=null)=>{const r=new Vx(e);return r.positionNode=Fx(new y(e.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(Sx).toVar(),r.skinIndexNode=Fx(new y(new Uint32Array(e.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(Sx).toVar(),r.skinWeightNode=Fx(new y(e.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(Sx).toVar(),r.bindMatrixNode=Hm(e.bindMatrix,"mat4"),r.bindMatrixInverseNode=Hm(e.bindMatrixInverse,"mat4"),r.boneMatricesNode=Qb(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length),r.toPositionNode=t,Nf(r)},cond:Vy,context:jy,convert:sm,convertColorSpace:(e,t,r)=>Nf(new rb(Nf(e),t,r)),convertToTexture:(e,...t)=>e.isTextureNode?e:e.isPassNode?e.getTextureNode():sN(e,...t),cos:Qg,cross:by,cubeTexture:s_,cubeTextureBase:o_,cubeToUV:yR,dFdx:ny,dFdy:iy,dashSize:Cm,debug:Bb,decrement:Tg,decrementBefore:xg,defaultBuildStages:qp,defaultShaderStages:Bp,defined:Sf,degrees:Og,deltaTime:NM,densityFog:function(e,t){return console.warn('THREE.TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),_C(e,vC(t))},densityFogFactor:vC,depth:Nw,depthPass:(e,t,r)=>Nf(new YN(YN.DEPTH,e,t,r)),difference:gy,diffuseColor:um,directPointLight:CR,directionToColor:Hw,dispersion:km,distance:my,div:ng,dodge:(...e)=>(console.warn('THREE.TSL: "dodge" has been renamed. Use "blendDodge" instead.'),DN(e)),dot:yy,drawIndex:Cx,dynamicBufferAttribute:pb,element:om,emissive:cm,equal:og,equals:cy,equirectUV:Yw,exp:Lg,exp2:kg,expression:Nb,faceDirection:kv,faceForward:Dy,faceforward:ky,float:Uf,floor:Gg,fog:_C,fract:Hg,frameGroup:Vm,frameId:CM,frontFacing:Lv,fwidth:Ay,gain:(e,t)=>e.lessThan(.5)?vM(e.mul(2),t).div(2):tg(1,vM(rg(tg(1,e),2),t).div(2)),gapSize:Rm,getConstNodeType:Ef,getCurrentStack:Lf,getDirection:_S,getDistanceAttenuation:NR,getGeometryRoughness:gT,getNormalFromDepth:lN,getParallaxCorrectNormal:JP,getRoughness:yT,getScreenPosition:AN,getShIrradianceAt:eD,getShadowMaterial:sR,getShadowRenderObjectFunction:lR,getTextureIndex:mM,getViewPosition:aN,globalId:RC,glsl:(e,t)=>AC(e,t,"glsl"),glslFn:(e,t)=>uC(e,t,"glsl"),grayscale:IN,greaterThan:Ag,greaterThanEqual:ug,hash:bM,highpModelNormalViewMatrix:Mv,highpModelViewMatrix:Ev,hue:VN,increment:wg,incrementBefore:_g,instance:Px,instanceIndex:Sx,instancedArray:(e,t="float")=>{let r,n;!0===t.isStruct?(r=t.layout.getLength(),n=_p("float")):(r=xp(t),n=_p(t));const i=new uN(e,r,n);return Fx(i,t,e)},instancedBufferAttribute:fb,instancedDynamicBufferAttribute:mb,instancedMesh:Bx,int:Vf,inverseSqrt:Vg,inversesqrt:Iy,invocationLocalIndex:Nx,invocationSubgroupIndex:Mx,ior:Dm,iridescence:ym,iridescenceIOR:bm,iridescenceThickness:vm,ivec2:Hf,ivec3:Yf,ivec4:Jf,js:(e,t)=>AC(e,t,"js"),label:zy,length:ey,lengthSq:Ey,lessThan:ag,lessThanEqual:lg,lightPosition:jC,lightProjectionUV:GC,lightShadowMatrix:VC,lightTargetDirection:WC,lightTargetPosition:zC,lightViewPosition:HC,lightingContext:ew,lights:(e=[])=>Nf(new XC).setLights(e),linearDepth:Cw,linearToneMapping:KN,localId:PC,log:Ig,log2:Fg,logarithmicDepthToViewZ:(e,t,r)=>{const n=e.mul(Ig(r.div(t)));return Uf(Math.E).pow(n).mul(t).negate()},loop:(...e)=>(console.warn("THREE.TSL: loop() has been renamed to Loop()."),zx(...e)),luminance:GN,mat2:rm,mat3:nm,mat4:im,matcapUV:cE,materialAO:vx,materialAlphaTest:I_,materialAnisotropy:nx,materialAnisotropyVector:_x,materialAttenuationColor:cx,materialAttenuationDistance:ux,materialClearcoat:K_,materialClearcoatNormal:J_,materialClearcoatRoughness:Z_,materialColor:F_,materialDispersion:yx,materialEmissive:V_,materialEnvIntensity:Kv,materialEnvRotation:Zv,materialIOR:lx,materialIridescence:ix,materialIridescenceIOR:ox,materialIridescenceThickness:sx,materialLightMap:bx,materialLineDashOffset:mx,materialLineDashSize:dx,materialLineGapSize:px,materialLineScale:hx,materialLineWidth:fx,materialMetalness:Y_,materialNormal:X_,materialOpacity:G_,materialPointSize:gx,materialReference:h_,materialReflectivity:Q_,materialRefractionRatio:Xv,materialRotation:ex,materialRoughness:$_,materialSheen:tx,materialSheenRoughness:rx,materialShininess:U_,materialSpecular:j_,materialSpecularColor:H_,materialSpecularIntensity:z_,materialSpecularStrength:W_,materialThickness:Ax,materialTransmission:ax,max:dy,maxMipLevel:Ub,mediumpModelViewMatrix:Sv,metalness:dm,min:hy,mix:My,mixElement:qy,mod:ig,modInt:Eg,modelDirection:mv,modelNormalMatrix:xv,modelPosition:yv,modelRadius:_v,modelScale:bv,modelViewMatrix:Tv,modelViewPosition:vv,modelViewProjection:xx,modelWorldMatrix:gv,modelWorldMatrixInverse:wv,morphReference:Xx,mrt:yM,mul:rg,mx_aastep:XP,mx_cell_noise_float:(e=Lb())=>SP(e.convert("vec2|vec3")),mx_contrast:(e,t=1,r=.5)=>Uf(e).sub(r).mul(t).add(r),mx_fractal_noise_float:(e=Lb(),t=3,r=2,n=.5,i=1)=>PP(e,Vf(t),r,n).mul(i),mx_fractal_noise_vec2:(e=Lb(),t=3,r=2,n=.5,i=1)=>BP(e,Vf(t),r,n).mul(i),mx_fractal_noise_vec3:(e=Lb(),t=3,r=2,n=.5,i=1)=>DP(e,Vf(t),r,n).mul(i),mx_fractal_noise_vec4:(e=Lb(),t=3,r=2,n=.5,i=1)=>qP(e,Vf(t),r,n).mul(i),mx_hsvtorgb:QP,mx_noise_float:(e=Lb(),t=1,r=0)=>gP(e.convert("vec2|vec3")).mul(t).add(r),mx_noise_vec3:(e=Lb(),t=1,r=0)=>vP(e.convert("vec2|vec3")).mul(t).add(r),mx_noise_vec4:(e=Lb(),t=1,r=0)=>{e=e.convert("vec2|vec3");return Zf(vP(e),gP(e.add(zf(19,73)))).mul(t).add(r)},mx_ramplr:(e,t,r=Lb())=>KP(e,t,r,"x"),mx_ramptb:(e,t,r=Lb())=>KP(e,t,r,"y"),mx_rgbtohsv:$P,mx_safepower:(e,t=1)=>(e=Uf(e)).abs().pow(t).mul(e.sign()),mx_splitlr:(e,t,r,n=Lb())=>ZP(e,t,r,n,"x"),mx_splittb:(e,t,r,n=Lb())=>ZP(e,t,r,n,"y"),mx_srgb_texture_to_lin_rec709:YP,mx_transform_uv:(e=1,t=0,r=Lb())=>r.mul(e).add(t),mx_worley_noise_float:(e=Lb(),t=1)=>GP(e.convert("vec2|vec3"),t,Vf(1)),mx_worley_noise_vec2:(e=Lb(),t=1)=>zP(e.convert("vec2|vec3"),t,Vf(1)),mx_worley_noise_vec3:(e=Lb(),t=1)=>WP(e.convert("vec2|vec3"),t,Vf(1)),namespace:_b,negate:ty,neutralToneMapping:sC,nodeArray:Rf,nodeImmutable:Df,nodeObject:Nf,nodeObjects:Cf,nodeProxy:Pf,normalFlat:Uv,normalGeometry:Iv,normalLocal:Fv,normalMap:P_,normalView:Vv,normalWorld:Gv,normalize:zg,not:dg,notEqual:sg,numWorkgroups:NC,objectDirection:lv,objectGroup:jm,objectPosition:cv,objectRadius:pv,objectScale:hv,objectViewPosition:dv,objectWorldMatrix:uv,oneMinus:ry,or:hg,orthographicDepthToViewZ:(e,t,r)=>t.sub(r).mul(e).sub(t),oscSawtooth:(e=MM)=>e.fract(),oscSine:(e=MM)=>e.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5),oscSquare:(e=MM)=>e.fract().round(),oscTriangle:(e=MM)=>e.add(.5).fract().mul(2).sub(1).abs(),output:Nm,outputStruct:fM,overlay:(...e)=>(console.warn('THREE.TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),qN(e)),overloadingFn:EM,parabola:vM,parallaxDirection:M_,parallaxUV:(e,t)=>e.sub(M_.mul(t)),parameter:(e,t)=>Nf(new lM(e,t)),pass:(e,t,r)=>Nf(new YN(YN.COLOR,e,t,r)),passTexture:(e,t)=>Nf(new QN(e,t)),pcurve:(e,t,r)=>vy(ng(vy(e,t),eg(vy(e,t),vy(tg(1,e),r))),1/t),perspectiveDepthToViewZ:Sw,pmremTexture:KS,pointShadow:ER,pointUV:dN,pointWidth:Pm,positionGeometry:Nv,positionLocal:Cv,positionPrevious:Rv,positionView:Bv,positionViewDirection:qv,positionWorld:Pv,positionWorldDirection:Dv,posterize:HN,pow:vy,pow2:_y,pow3:xy,pow4:wy,premult:LN,property:Am,radians:qg,rand:By,range:SC,rangeFog:function(e,t,r){return console.warn('THREE.TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),_C(e,bC(t,r))},rangeFogFactor:bC,reciprocal:sy,reference:l_,referenceBuffer:u_,reflect:fy,reflectVector:t_,reflectView:Jv,reflector:e=>Nf(new ZM(e)),refract:Ry,refractVector:r_,refractView:e_,reinhardToneMapping:ZN,remainder:Sg,remap:Sb,remapClamp:Eb,renderGroup:Gm,renderOutput:Pb,rendererReference:Ab,rotate:fE,rotateUV:RM,roughness:hm,round:oy,rtt:sN,sRGBTransferEOTF:Jy,sRGBTransferOETF:eb,sampler:e=>(!0===e.isNode?e:zb(e)).convert("sampler"),samplerComparison:e=>(!0===e.isNode?e:zb(e)).convert("samplerComparison"),saturate:Cy,saturation:FN,screen:(...e)=>(console.warn('THREE.TSL: "screen" has been renamed. Use "blendScreen" instead.'),BN(e)),screenCoordinate:aw,screenSize:sw,screenUV:ow,scriptable:gC,scriptableValue:hC,select:Uy,setCurrentStack:Of,shaderStages:Op,shadow:mR,shadowPositionWorld:ZC,shapeCircle:DR,sharedUniformGroup:Um,sheen:mm,sheenRoughness:gm,shiftLeft:bg,shiftRight:vg,shininess:Mm,sign:Jg,sin:Wg,sinc:(e,t)=>Wg(Rg.mul(t.mul(e).sub(1))).div(Rg.mul(t.mul(e).sub(1))),skinning:Gx,smoothstep:Py,smoothstepElement:Oy,specularColor:Sm,specularF90:Em,spherizeUV:PM,split:(e,t)=>Nf(new Hp(Nf(e),t)),spritesheetUV:OM,sqrt:Ug,stack:cM,step:py,storage:Fx,storageBarrier:()=>BC("storage").toStack(),storageObject:(e,t,r)=>(console.warn('THREE.TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),Fx(e,t,r).setPBO(!0)),storageTexture:_N,string:(e="")=>Nf(new Xp(e,"string")),struct:(e,t=null)=>{const r=new hM(e,t),n=(...t)=>{let n=null;if(t.length>0)if(t[0].isNode){n={};const r=Object.keys(e);for(let e=0;e<t.length;e++)n[r[e]]=t[e]}else n=t[0];return Nf(new dM(r,n))};return n.layout=r,n.isStruct=!0,n},sub:tg,subgroupIndex:Ex,subgroupSize:DC,tan:$g,tangentGeometry:d_,tangentLocal:p_,tangentView:f_,tangentWorld:m_,temp:Yy,texture:zb,texture3D:TN,textureBarrier:()=>BC("texture").toStack(),textureBicubic:HT,textureCubeUV:xS,textureLoad:Hb,textureSize:Ib,textureStore:(e,t,r)=>{const n=_N(e,t,r);return null!==r&&n.toStack(),n},thickness:qm,time:MM,timerDelta:(e=1)=>(console.warn('TSL: timerDelta() is deprecated. Use "deltaTime" instead.'),NM.mul(e)),timerGlobal:(e=1)=>(console.warn('TSL: timerGlobal() is deprecated. Use "time" instead.'),MM.mul(e)),timerLocal:(e=1)=>(console.warn('TSL: timerLocal() is deprecated. Use "time" instead.'),MM.mul(e)),toneMapping:ub,toneMappingExposure:cb,toonOutlinePass:(e,t,r=new te(0,0,0),n=.003,i=1)=>Nf(new XN(e,t,Nf(r),Nf(n),Nf(i))),transformDirection:Ty,transformNormal:Wv,transformNormalToView:Qv,transformedBentNormalView:N_,transformedBitangentView:T_,transformedBitangentWorld:S_,transformedClearcoatNormalView:Hv,transformedNormalView:jv,transformedNormalWorld:zv,transformedTangentView:g_,transformedTangentWorld:y_,transmission:Bm,transpose:ly,triNoise3D:wM,triplanarTexture:(...e)=>kM(...e),triplanarTextures:kM,trunc:ay,tslFn:(...e)=>(console.warn("THREE.TSL: tslFn() has been renamed to Fn()."),qf(...e)),uint:Gf,uniform:Hm,uniformArray:Xb,uniformCubeTexture:(e=n_)=>o_(e),uniformGroup:Fm,uniformTexture:(e=Vb)=>zb(e),uniforms:(e,t)=>(console.warn("THREE.TSL: uniforms() has been renamed to uniformArray()."),Nf(new Yb(e,t))),unpremult:kN,userData:(e,t,r)=>Nf(new SN(e,t,r)),uv:Lb,uvec2:Wf,uvec3:Xf,uvec4:em,varying:Ky,varyingProperty:lm,vec2:zf,vec3:$f,vec4:Zf,vectorComponents:Lp,velocity:RN,vertexColor:Lw,vertexIndex:Tx,vertexStage:Zy,vibrance:UN,viewZToLogarithmicDepth:Ew,viewZToOrthographicDepth:ww,viewZToPerspectiveDepth:Tw,viewport:Aw,viewportBottomLeft:pw,viewportCoordinate:uw,viewportDepthTexture:_w,viewportLinearDepth:Rw,viewportMipTexture:yw,viewportResolution:hw,viewportSafeUV:BM,viewportSharedTexture:zw,viewportSize:lw,viewportTexture:gw,viewportTopLeft:dw,viewportUV:cw,wgsl:(e,t)=>AC(e,t,"wgsl"),wgslFn:(e,t)=>uC(e,t,"wgsl"),workgroupArray:(e,t)=>Nf(new OC("Workgroup",e,t)),workgroupBarrier:()=>BC("workgroup").toStack(),workgroupId:CC,workingToColorSpace:nb,xor:pg});const rD=new AM;class nD extends CE{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,r){const n=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background;let o=!1;if(null===i)n._clearColor.getRGB(rD),rD.a=n._clearColor.a;else if(!0===i.isColor)i.getRGB(rD),rD.a=1,o=!0;else if(!0===i.isNode){const a=this.get(e),u=i;rD.copy(n._clearColor);let c=a.backgroundMesh;if(void 0===c){const d=jy(Zf(u).mul(yN),{getUV:()=>bN.mul(Gv),getTextureLevel:()=>gN});let p=xx;p=p.setZ(p.w);const f=new kw;function m(){i.removeEventListener("dispose",m),c.material.dispose(),c.geometry.dispose()}f.name="Background.material",f.side=O,f.depthTest=!1,f.depthWrite=!1,f.allowOverride=!1,f.fog=!1,f.lights=!1,f.vertexNode=p,f.colorNode=d,a.backgroundMeshNode=d,a.backgroundMesh=c=new A(new l(1,32,32),f),c.frustumCulled=!1,c.name="Background.mesh",c.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},i.addEventListener("dispose",m)}const h=u.getCacheKey();a.backgroundCacheKey!==h&&(a.backgroundMeshNode.node=Zf(u).mul(yN),a.backgroundMeshNode.needsUpdate=!0,c.material.needsUpdate=!0,a.backgroundCacheKey=h),t.unshift(c,c.geometry,c.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",i);const s=n.xr.getEnvironmentBlendMode();if("additive"===s?rD.set(0,0,0,1):"alpha-blend"===s&&rD.set(0,0,0,0),!0===n.autoClear||!0===o){const g=r.clearColorValue;g.r=rD.r,g.g=rD.g,g.b=rD.b,g.a=rD.a,!0!==n.backend.isWebGLBackend&&!0!==n.alpha||(g.r*=g.a,g.g*=g.a,g.b*=g.a),r.depthClearValue=n._clearDepth,r.stencilClearValue=n._clearStencil,r.clearColor=!0===n.autoClearColor,r.clearDepth=!0===n.autoClearDepth,r.clearStencil=!0===n.autoClearStencil}else r.clearColor=!1,r.clearDepth=!1,r.clearStencil=!1}}let iD=0;class oD{constructor(e="",t=[],r=0,n=[]){this.name=e,this.bindings=t,this.index=r,this.bindingsReference=n,this.id=iD++}}class sD{constructor(e,t,r,n,i,o,s,a,A,l=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=r,this.transforms=l,this.nodeAttributes=n,this.bindings=i,this.updateNodes=o,this.updateBeforeNodes=s,this.updateAfterNodes=a,this.observer=A,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings){if(!0!==t.bindings[0].groupNode.shared){const r=new oD(t.name,[],t.index,t);e.push(r);for(const e of t.bindings)r.bindings.push(e.clone())}else e.push(t)}return e}}class aD{constructor(e,t,r=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=r}}class AD{constructor(e,t,r){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=r.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class lD{constructor(e,t,r=!1,n=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=r,this.count=n}}class uD extends lD{constructor(e,t,r=null,n=null){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=r,this.interpolationSampling=n}}class cD{constructor(e,t,r=""){this.name=e,this.type=t,this.code=r,Object.defineProperty(this,"isNodeCode",{value:!0})}}let hD=0;class dD{constructor(e=null){this.id=hD++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return void 0===t&&null!==this.parent&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class pD{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class fD{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class mD extends fD{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class gD extends fD{constructor(e,t=new n){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class yD extends fD{constructor(e,t=new o){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class bD extends fD{constructor(e,t=new M){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class vD extends fD{constructor(e,t=new te){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class _D extends fD{constructor(e,t=new en){super(e,t),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class xD extends fD{constructor(e,t=new Te){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class wD extends fD{constructor(e,t=new i){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class TD extends mD{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class SD extends gD{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ED extends yD{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class MD extends bD{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ND extends vD{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class CD extends _D{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class RD extends xD{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class PD extends wD{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const DD=new WeakMap,BD=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),qD=e=>/e/g.test(e)?String(e).replace(/\+/g,""):(e=Number(e))+(e%1?"":".0");class OD{constructor(e,t,r){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=r,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=cM(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new dD,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=DD.get(this.renderer);return void 0===e&&(e=new TE,DD.set(this.renderer,e)),e}createRenderTarget(e,t,r){return new R(e,t,r)}createCubeRenderTarget(e,t){return new Xw(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const r=this.getBindGroupsCache(),n=[];let i,o=!0;for(const s of t)n.push(s),o=o&&!0!==s.groupNode.shared;return o?(i=r.get(n),void 0===i&&(i=new oD(e,n,this.bindingsIndexes[e].group,n),r.set(n,i))):i=new oD(e,n,this.bindingsIndexes[e].group,n),i}getBindGroupArray(e,t){const r=this.bindings[t];let n=r[e];return void 0===n&&(void 0===this.bindingsIndexes[e]&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),r[e]=n=[]),n}getBindings(){let e=this.bindGroups;if(null===e){const t={},r=this.bindings;for(const e of Op)for(const n in r[e]){const i=r[e][n];(t[n]||(t[n]=[])).push(...i)}e=[];for(const n in t){const r=t[n],i=this._getBindGroup(n,r);e.push(i)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((e,t)=>e.bindings[0].groupNode.order-t.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const r=e[t];this.bindingsIndexes[r.name].group=t,r.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){!1===this.nodes.includes(e)&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){!1===this.sequentialNodes.includes(e)&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes){e.getUpdateType()!==Pp.NONE&&this.updateNodes.push(e.getSelf())}for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),r=e.getUpdateAfterType();t!==Pp.NONE&&this.updateBeforeNodes.push(e.getSelf()),r!==Pp.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===P||e.magFilter===Oe||e.magFilter===Le||e.magFilter===qe||e.minFilter===P||e.minFilter===Oe||e.minFilter===Le||e.minFilter===qe}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return this.context,this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const r=this.getDataFromNode(e);return void 0===r.cache&&(r.cache=new dD(t?this.getCache():null)),r.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=void 0===t.usageCount?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,r=null){let n=this.generateArrayDeclaration(e,t)+"( ";for(let i=0;i<t;i++){const o=r?r[i]:null;n+=null!==o?o.build(this,e):this.generateConst(e),i<t-1&&(n+=", ")}return n+=" )",n}generateStruct(e,t,r=null){const n=[];for(const i of t){const{name:e,type:t}=i;r&&r[e]&&r[e].isNode?n.push(r[e].build(this,t)):n.push(this.generateConst(t))}return e+"( "+n.join(", ")+" )"}generateConst(e,t=null){if(null===t&&("float"===e||"int"===e||"uint"===e?t=0:"bool"===e?t=!1:"color"===e?t=new te:"vec2"===e?t=new n:"vec3"===e?t=new o:"vec4"===e&&(t=new M)),"float"===e)return qD(t);if("int"===e)return`${Math.round(t)}`;if("uint"===e)return t>=0?`${Math.round(t)}u`:"0u";if("bool"===e)return t?"true":"false";if("color"===e)return`${this.getType("vec3")}( ${qD(t.r)}, ${qD(t.g)}, ${qD(t.b)} )`;const r=this.getTypeLength(e),i=this.getComponentType(e),s=e=>this.generateConst(i,e);if(2===r)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(3===r)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(4===r&&"mat2"!==e)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(r>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(r>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return"color"===e?"vec3":e}hasGeometryAttribute(e){return this.geometry&&void 0!==this.geometry.getAttribute(e)}getAttribute(e,t){const r=this.attributes;for(const i of r)if(i.name===e)return i;const n=new aD(e,t);return this.registerDeclaration(n),r.push(n),n}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"samplerComparison"===e||"texture"===e||"cubeTexture"===e||"storageTexture"===e||"depthTexture"===e||"texture3D"===e}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Re)return"int";if(t===le)return"uint"}return"float"}getElementType(e){return"mat2"===e?"vec2":"mat3"===e?"vec3":"mat4"===e?"vec4":this.getComponentType(e)}getComponentType(e){if("float"===(e=this.getVectorType(e))||"bool"===e||"int"===e||"uint"===e)return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return null===t?null:"b"===t[1]?"bool":"i"===t[1]?"int":"u"===t[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e?"vec4":e}getTypeFromLength(e,t="float"){if(1===e)return t;let r=vp(e);const n="float"===t?"":t[0];return!0===/mat2/.test(t)&&(r=r.replace("vec","mat")),n+r}getTypeFromArray(e){return BD.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const r=t.array,n=e.itemSize,i=e.normalized;let o;return e instanceof $r||!0===i||(o=this.getTypeFromArray(r)),this.getTypeFromLength(n,o)}getTypeLength(e){const t=this.getVectorType(e),r=/vec([2-4])/.exec(t);return null!==r?Number(r[1]):"float"===t||"bool"===t||"int"===t||"uint"===t?1:!0===/mat2/.test(e)?4:!0===/mat3/.test(e)?9:!0===/mat4/.test(e)?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return"int"===t||"uint"===t?e:this.changeComponentType(e,"int")}addStack(){return this.stack=cM(this.stack),this.stacks.push(Lf()||this.stack),Of(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,Of(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,r=null){let n=(r=null===r?e.isGlobal(this)?this.globalCache:this.cache:r).getData(e);return void 0===n&&(n={},r.setData(e,n)),void 0===n[t]&&(n[t]={}),n[t]}getNodeProperties(e,t="any"){const r=this.getDataFromNode(e,t);return r.properties||(r.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const r=this.getDataFromNode(e);let n=r.bufferAttribute;if(void 0===n){const i=this.uniforms.index++;n=new aD("nodeAttribute"+i,t,e),this.bufferAttributes.push(n),r.bufferAttribute=n}return n}getStructTypeFromNode(e,t,r=null,n=this.shaderStage){const i=this.getDataFromNode(e,n,this.globalCache);let o=i.structType;if(void 0===o){const e=this.structs.index++;null===r&&(r="StructType"+e),o=new pD(r,t),this.structs[n].push(o),i.structType=o}return o}getOutputStructTypeFromNode(e,t){const r=this.getStructTypeFromNode(e,t,"OutputType","fragment");return r.output=!0,r}getUniformFromNode(e,t,r=this.shaderStage,n=null){const i=this.getDataFromNode(e,r,this.globalCache);let o=i.uniform;if(void 0===o){const s=this.uniforms.index++;o=new AD(n||"nodeUniform"+s,t,e),this.uniforms[r].push(o),this.registerDeclaration(o),i.uniform=o}return o}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,r=e.getNodeType(this),n=this.shaderStage,i=!1){const o=this.getDataFromNode(e,n);let s=o.variable;if(void 0===s){const a=i?"_const":"_var",A=this.vars[n]||(this.vars[n]=[]),l=this.vars[a]||(this.vars[a]=0);null===t&&(t=(i?"nodeConst":"nodeVar")+l,this.vars[a]++);const u=this.getArrayCount(e);s=new lD(t,r,i,u),i||A.push(s),this.registerDeclaration(s),o.variable=s}return s}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode))&&(!e.cNode||this.isDeterministic(e.cNode));if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode));if(e.isArrayNode){if(null!==e.values)for(const t of e.values)if(!this.isDeterministic(t))return!1;return!0}return!!e.isConstNode}getVaryingFromNode(e,t=null,r=e.getNodeType(this),n=null,i=null){const o=this.getDataFromNode(e,"any");let s=o.varying;if(void 0===s){const e=this.varyings,a=e.length;null===t&&(t="nodeVarying"+a),s=new uD(t,r,n,i),e.push(s),this.registerDeclaration(s),o.varying=s}return s}get namespace(){return this.context.namespace}getOutputNamespace(){return this.getNamespace("outputNode")}getNamespace(e=""){const t=this.namespace;let r;return r=t?e?t+"_"+e:t:e,r}registerDeclaration(e){const t=this.shaderStage,r=this.declarations[t]||(this.declarations[t]={}),n=this.getPropertyName(e);let i=1,o=n;for(;void 0!==r[o];)o=n+"_"+i++;i>1&&(e.name=o,console.warn(`THREE.TSL: Declaration name '${n}' of '${e.type}' already in use. Renamed to '${o}'.`)),r[o]=e}getCodeFromNode(e,t,r=this.shaderStage){const n=this.getDataFromNode(e);let i=n.code;if(void 0===i){const e=this.codes[r]||(this.codes[r]=[]),o=e.length;i=new cD("nodeCode"+o,t),e.push(i),n.code=i}return i}addFlowCodeHierarchy(e,t){const{flowCodes:r,flowCodeBlock:n}=this.getDataFromNode(e);let i=!0,o=t;for(;o;){if(!0===n.get(o)){i=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(i)for(const s of r)this.addLineFlowCode(s)}addLineFlowCodeBlock(e,t,r){const n=this.getDataFromNode(e),i=n.flowCodes||(n.flowCodes=[]),o=n.flowCodeBlock||(n.flowCodeBlock=new WeakMap);i.push(t),o.set(r,!0)}addLineFlowCode(e,t=null){return""===e||(null!==t&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e+=";\n"),this.flow.code+=e),this}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),r=this.flowChildNode(e,t);return this.flowsData.set(e,r),r}addInclude(e){null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new lC,r=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=r,t}flowShaderNode(e){const t=e.layout,r={[Symbol.iterator](){let e=0;const t=Object.values(this);return{next:()=>({value:t[e],done:e++>=t.length})}}};for(const o of t.inputs)r[o.name]=new lM(o.type,o.name);e.layout=null;const n=e.call(r),i=this.flowStagesNode(n,t.type);return e.layout=t,i}flowStagesNode(e,t=null){const r=this.flow,n=this.vars,i=this.declarations,o=this.cache,s=this.buildStage,a=this.stack,A={code:""};this.flow=A,this.vars={},this.declarations={},this.cache=new dD,this.stack=cM();for(const l of qp)this.setBuildStage(l),A.result=e.build(this,t);return A.vars=this.getVars(this.shaderStage),this.flow=r,this.vars=n,this.declarations=i,this.cache=o,this.stack=a,this.setBuildStage(s),A}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const r=this.flow,n={code:""};return this.flow=n,n.result=e.build(this,t),this.flow=r,n}flowNodeFromShaderStage(e,t,r=null,n=null){const i=this.tab,o=this.cache,s=this.shaderStage,a=this.context;this.setShaderStage(e);const A={...this.context};delete A.nodeBlock,this.cache=this.globalCache,this.tab="\t",this.context=A;let l=null;if("generate"===this.buildStage){const i=this.flowChildNode(t,r);null!==n&&(i.code+=`${this.tab+n} = ${i.result};\n`),this.flowCode[e]=this.flowCode[e]+i.code,l=i}else l=t.build(this);return this.setShaderStage(s),this.cache=o,this.tab=i,this.context=a,l}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,r=null){return`${null!==r?this.generateArrayDeclaration(e,r):this.getType(e)} ${t}`}getVars(e){let t="";const r=this.vars[e];if(void 0!==r)for(const n of r)t+=`${this.getVar(n.type,n.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let r="";if(void 0!==t)for(const n of t)r+=n.code+"\n";return r}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:r}=this;if(null!==t){let e=r.library.fromMaterial(t);null===e&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),e=new kw),e.build(this)}else this.addFlow("compute",e);for(const n of qp){this.setBuildStage(n),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const e of Op){this.setShaderStage(e);const t=this.flowNodes[e];for(const e of t)"generate"===n?this.flowNode(e):e.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if("float"===t||"int"===t||"uint"===t)return new TD(e);if("vec2"===t||"ivec2"===t||"uvec2"===t)return new SD(e);if("vec3"===t||"ivec3"===t||"uvec3"===t)return new ED(e);if("vec4"===t||"ivec4"===t||"uvec4"===t)return new MD(e);if("color"===t)return new ND(e);if("mat2"===t)return new CD(e);if("mat3"===t)return new RD(e);if("mat4"===t)return new PD(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,r){if((t=this.getVectorType(t))===(r=this.getVectorType(r))||null===r||this.isReference(r))return e;const n=this.getTypeLength(t),i=this.getTypeLength(r);return 16===n&&9===i?`${this.getType(r)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:9===n&&4===i?`${this.getType(r)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:n>4||i>4||0===i?e:n===i?`${this.getType(r)}( ${e} )`:n>i?(e="bool"===r?`all( ${e} )`:`${e}.${"xyz".slice(0,i)}`,this.format(e,this.getTypeFromLength(i,this.getComponentType(t)),r)):4===i&&n>1?`${this.getType(r)}( ${this.format(e,t,"vec3")}, 1.0 )`:2===n?`${this.getType(r)}( ${this.format(e,t,"vec2")}, 0.0 )`:(1===n&&i>1&&t!==this.getComponentType(r)&&(e=`${this.getType(this.getComponentType(r))}( ${e} )`),`${this.getType(r)}( ${e} )`)}getSignature(){return`// Three.js r${Ce} - Node System\n`}*[Symbol.iterator](){}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class LD{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let r=e.get(t);return void 0===r&&(r={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,r)),r}updateBeforeNode(e){const t=e.getUpdateBeforeType(),r=e.updateReference(this);if(t===Pp.FRAME){const{frameMap:t}=this._getMaps(this.updateBeforeMap,r);t.get(r)!==this.frameId&&!1!==e.updateBefore(this)&&t.set(r,this.frameId)}else if(t===Pp.RENDER){const{renderMap:t}=this._getMaps(this.updateBeforeMap,r);t.get(r)!==this.renderId&&!1!==e.updateBefore(this)&&t.set(r,this.renderId)}else t===Pp.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),r=e.updateReference(this);if(t===Pp.FRAME){const{frameMap:t}=this._getMaps(this.updateAfterMap,r);t.get(r)!==this.frameId&&!1!==e.updateAfter(this)&&t.set(r,this.frameId)}else if(t===Pp.RENDER){const{renderMap:t}=this._getMaps(this.updateAfterMap,r);t.get(r)!==this.renderId&&!1!==e.updateAfter(this)&&t.set(r,this.renderId)}else t===Pp.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),r=e.updateReference(this);if(t===Pp.FRAME){const{frameMap:t}=this._getMaps(this.updateMap,r);t.get(r)!==this.frameId&&!1!==e.update(this)&&t.set(r,this.frameId)}else if(t===Pp.RENDER){const{renderMap:t}=this._getMaps(this.updateMap,r);t.get(r)!==this.renderId&&!1!==e.update(this)&&t.set(r,this.renderId)}else t===Pp.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class kD{constructor(e,t,r=null,n="",i=!1){this.type=e,this.name=t,this.count=r,this.qualifier=n,this.isConst=i}}kD.isNodeFunctionInput=!0;class ID extends MR{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:WC(this.light),lightColor:e}}}const FD=new i,UD=new i;let VD=null;class GD extends MR{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Hm(new o).setGroup(Gm),this.halfWidth=Hm(new o).setGroup(Gm),this.updateType=Pp.RENDER}update(e){super.update(e);const{light:t}=this,r=e.camera.matrixWorldInverse;UD.identity(),FD.copy(t.matrixWorld),FD.premultiply(r),UD.extractRotation(FD),this.halfWidth.value.set(.5*t.width,0,0),this.halfHeight.value.set(0,.5*t.height,0),this.halfWidth.value.applyMatrix4(UD),this.halfHeight.value.applyMatrix4(UD)}setupDirectRectArea(e){let t,r;e.isAvailable("float32Filterable")?(t=zb(VD.LTC_FLOAT_1),r=zb(VD.LTC_FLOAT_2)):(t=zb(VD.LTC_HALF_1),r=zb(VD.LTC_HALF_2));const{colorNode:n,light:i}=this;return{lightColor:n,lightPosition:HC(i),halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:r}}static setLTC(e){VD=e}}class jD extends MR{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Hm(0).setGroup(Gm),this.penumbraCosNode=Hm(0).setGroup(Gm),this.cutoffDistanceNode=Hm(0).setGroup(Gm),this.decayExponentNode=Hm(0).setGroup(Gm),this.colorNode=Hm(this.color).setGroup(Gm)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e,t){const{coneCosNode:r,penumbraCosNode:n}=this;return Py(r,n,t)}getLightCoord(e){const t=e.getNodeProperties(this);let r=t.projectionUV;return void 0===r&&(r=GC(this.light,e.context.positionWorld),t.projectionUV=r),r}setupDirect(e){const{colorNode:t,cutoffDistanceNode:r,decayExponentNode:n,light:i}=this,o=this.getLightVector(e),s=o.normalize(),a=s.dot(WC(i)),A=this.getSpotAttenuation(e,a),l=o.length(),u=NR({lightDistance:l,cutoffDistance:r,decayExponent:n});let c,h,d=t.mul(A).mul(u);if(i.colorNode?(h=this.getLightCoord(e),c=i.colorNode(h)):i.map&&(h=this.getLightCoord(e),c=zb(i.map,h.xy).onRenderUpdate(()=>i.map)),c){d=h.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(c),d)}return{lightColor:d,lightDirection:s}}}class zD extends jD{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e,t){const r=this.light.iesMap;let n=null;if(r&&!0===r.isTexture){const e=t.acos().mul(1/Math.PI);n=zb(r,zf(e,0),0).r}else n=super.getSpotAttenuation(t);return n}}const HD=qf(([e,t])=>{const r=e.abs().sub(t);return ey(dy(r,0)).add(hy(dy(r.x,r.y),0))});class WD extends jD{static get type(){return"ProjectorLightNode"}update(e){super.update(e);const t=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(t.angle*(1-t.penumbra)),.99999),null===t.aspect){let e=1;null!==t.map&&(e=t.map.width/t.map.height),t.shadow.aspect=e}else t.shadow.aspect=t.aspect}getSpotAttenuation(e){const t=this.penumbraCosNode,r=this.getLightCoord(e),n=r.xyz.div(r.w),i=HD(n.xy.sub(zf(.5)),zf(.5)),o=ng(-1,tg(1,Xg(t)).sub(1));return Cy(i.mul(-2).mul(o))}}class QD extends MR{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class $D extends MR{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=jC(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Hm(new te).setGroup(Gm)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:r,lightDirectionNode:n}=this,i=Gv.dot(n).mul(.5).add(.5),o=My(r,t,i);e.context.irradiance.addAssign(o)}}class YD extends MR{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let r=0;r<9;r++)t.push(new o);this.lightProbe=Xb(t)}update(e){const{light:t}=this;super.update(e);for(let r=0;r<9;r++)this.lightProbe.array[r].copy(t.sh.coefficients[r]).multiplyScalar(t.intensity)}setup(e){const t=eD(Gv,this.lightProbe);e.context.irradiance.addAssign(t)}}class XD{parseFunction(){console.warn("Abstract function.")}}class KD{constructor(e,t,r="",n=""){this.type=e,this.inputs=t,this.name=r,this.precision=n}getCode(){console.warn("Abstract function.")}}KD.isNodeFunction=!0;const ZD=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,JD=/[a-z_0-9]+/gi,eB="#pragma main";class tB extends KD{constructor(e){const{type:t,inputs:r,name:n,precision:i,inputsCode:o,blockCode:s,headerCode:a}=(e=>{const t=(e=e.trim()).indexOf(eB),r=-1!==t?e.slice(t+12):e,n=r.match(ZD);if(null!==n&&5===n.length){const i=n[4],o=[];let s=null;for(;null!==(s=JD.exec(i));)o.push(s);const a=[];let A=0;for(;A<o.length;){const e="const"===o[A][0];!0===e&&A++;let t=o[A][0];"in"===t||"out"===t||"inout"===t?A++:t="";const r=o[A++][0];let n=Number.parseInt(o[A][0]);!1===Number.isNaN(n)?A++:n=null;const i=o[A++][0];a.push(new kD(r,i,n,t,e))}const l=r.substring(n[0].length),u=void 0!==n[3]?n[3]:"";return{type:n[2],inputs:a,name:u,precision:void 0!==n[1]?n[1]:"",inputsCode:i,blockCode:l,headerCode:-1!==t?e.slice(0,t):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(e);super(t,r,n,i),this.inputsCode=o,this.blockCode=s,this.headerCode=a}getCode(e=this.name){let t;const r=this.blockCode;if(""!==r){const{type:n,inputsCode:i,headerCode:o,precision:s}=this;let a=`${n} ${e} ( ${i.trim()} )`;""!==s&&(a=`${s} ${a}`),t=o+a+r}else t="";return t}}class rB extends XD{parseFunction(e){return new tB(e)}}const nB=new WeakMap,iB=[],oB=[];class sB extends CE{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new LD,this.nodeBuilderCache=new Map,this.callHashCache=new TE,this.groupsData=new TE,this.cacheLib={}}updateGroup(e){const t=e.groupNode,r=t.name;if(r===jm.name)return!0;if(r===Gm.name){const t=this.get(e),r=this.nodeFrame.renderId;return t.renderId!==r&&(t.renderId=r,!0)}if(r===Vm.name){const t=this.get(e),r=this.nodeFrame.frameId;return t.frameId!==r&&(t.frameId=r,!0)}iB[0]=t,iB[1]=e;let n=this.groupsData.get(iB);return void 0===n&&this.groupsData.set(iB,n={}),iB.length=0,n.version!==t.version&&(n.version=t.version,!0)}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let r=t.nodeBuilderState;if(void 0===r){const{nodeBuilderCache:n}=this,i=this.getForRenderCacheKey(e);if(r=n.get(i),void 0===r){const t=this.backend.createNodeBuilder(e.object,this.renderer);t.scene=e.scene,t.material=e.material,t.camera=e.camera,t.context.material=e.material,t.lightsNode=e.lightsNode,t.environmentNode=this.getEnvironmentNode(e.scene),t.fogNode=this.getFogNode(e.scene),t.clippingContext=e.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&t.enableMultiview(),t.build(),r=this._createNodeBuilderState(t),n.set(i,r)}r.usedTimes++,t.nodeBuilderState=r}return r}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,0===t.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let r=t.nodeBuilderState;if(void 0===r){const n=this.backend.createNodeBuilder(e,this.renderer);n.build(),r=this._createNodeBuilderState(n),t.nodeBuilderState=r}return r}_createNodeBuilderState(e){return new sD(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const r=this.get(e);r.environmentNode&&(t=r.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const r=this.get(e);r.backgroundNode&&(t=r.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){iB[0]=e,iB[1]=t;const r=this.renderer.info.calls,n=this.callHashCache.get(iB)||{};if(n.callId!==r){const i=this.getEnvironmentNode(e),o=this.getFogNode(e);t&&oB.push(t.getCacheKey(!0)),i&&oB.push(i.getCacheKey()),o&&oB.push(o.getCacheKey()),oB.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),oB.push(this.renderer.shadowMap.enabled?1:0),n.callId=r,n.cacheKey=pp(oB),this.callHashCache.set(iB,n),oB.length=0}return iB.length=0,n.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),r=e.background;if(r){const n=0===e.backgroundBlurriness&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&0===t.backgroundBlurriness;if(t.background!==r||n){const i=this.getCacheNode("background",r,()=>{if(!0===r.isCubeTexture||r.mapping===ye||r.mapping===be||r.mapping===ve){if(e.backgroundBlurriness>0||r.mapping===ve)return KS(r);{let e;return e=!0===r.isCubeTexture?s_(r):zb(r),tT(e)}}if(!0===r.isTexture)return zb(r,ow.flipY()).setUpdateMatrix(!0);!0!==r.isColor&&console.error("WebGPUNodes: Unsupported background configuration.",r)},n);t.backgroundNode=i,t.background=r,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,r,n=!1){const i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let o=i.get(t);return(void 0===o||n)&&(o=r(),i.set(t,o)),o}updateFog(e){const t=this.get(e),r=e.fog;if(r){if(t.fog!==r){const e=this.getCacheNode("fog",r,()=>{if(r.isFogExp2){const e=l_("color","color",r).setGroup(Gm),t=l_("density","float",r).setGroup(Gm);return _C(e,vC(t))}if(r.isFog){const e=l_("color","color",r).setGroup(Gm),t=l_("near","float",r).setGroup(Gm),n=l_("far","float",r).setGroup(Gm);return _C(e,bC(t,n))}console.error("THREE.Renderer: Unsupported fog configuration.",r)});t.fogNode=e,t.fog=r}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),r=e.environment;if(r){if(t.environment!==r){const e=this.getCacheNode("environment",r,()=>!0===r.isCubeTexture?s_(r):!0===r.isTexture?zb(r):void console.error("Nodes: Unsupported environment configuration.",r));t.environmentNode=e,t.environment=r}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,r=null,n=null,i=null){const o=this.nodeFrame;return o.renderer=e,o.scene=t,o.object=r,o.camera=n,o.material=i,o}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace+","+e.xr.isPresenting}hasOutputChange(e){return nB.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,r=this.getOutputCacheKey(),n=e.isArrayTexture?TN(e,$f(ow,Kb("gl_ViewID_OVR"))).renderOutput(t.toneMapping,t.currentColorSpace):zb(e,ow).renderOutput(t.toneMapping,t.currentColorSpace);return nB.set(e,r),n}updateBefore(e){const t=e.getNodeBuilderState();for(const r of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(r)}updateAfter(e){const t=e.getNodeBuilderState();for(const r of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(r)}updateForCompute(e){const t=this.getNodeFrame(),r=this.getForCompute(e);for(const n of r.updateNodes)t.updateNode(n)}updateForRender(e){const t=this.getNodeFrameForRender(e),r=e.getNodeBuilderState();for(const n of r.updateNodes)t.updateNode(n)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new LD,this.nodeBuilderCache=new Map,this.cacheLib={}}}const aB=new Se;class AB{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Te,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==e&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,r){const n=e.length;for(let i=0;i<n;i++){aB.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const n=t[r+i],o=aB.normal;n.x=-o.x,n.y=-o.y,n.z=-o.z,n.w=aB.constant}}updateGlobal(e,t){this.shadowPass=null!==e.overrideMaterial&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let r=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const n=t.clippingPlanes,i=n.length;let o,s;if(this.clipIntersection?(o=this.intersectionPlanes,s=e.intersectionPlanes.length):(o=this.unionPlanes,s=e.unionPlanes.length),o.length!==s+i){o.length=s+i;for(let e=0;e<i;e++)o[s+e]=new M;r=!0}this.projectPlanes(n,o,s),r&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return void 0===t&&(t=new AB(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class lB{constructor(e,t){this.bundleGroup=e,this.camera=t}}const uB=[];class cB{constructor(){this.bundles=new TE}get(e,t){const r=this.bundles;uB[0]=e,uB[1]=t;let n=r.get(uB);return void 0===n&&(n=new lB(e,t),r.set(uB,n)),uB.length=0,n}dispose(){this.bundles=new TE}}class hB{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const r=this.getMaterialNodeClass(e.type);if(null!==r){t=new r;for(const r in e)t[r]=e[r]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,r){if(r.has(t))console.warn(`Redefinition of node ${t}`);else{if("function"!=typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"==typeof t||"object"==typeof t)throw new Error(`Base class ${t} is not a class.`);r.set(t,e)}}addClass(e,t,r){if(r.has(t))console.warn(`Redefinition of node ${t.name}`);else{if("function"!=typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"!=typeof t)throw new Error(`Base class ${t.name} is not a class.`);r.set(t,e)}}}const dB=new XC,pB=[];class fB extends TE{constructor(){super()}createNode(e=[]){return(new XC).setLights(e)}getNode(e,t){if(e.isQuadMesh)return dB;pB[0]=e,pB[1]=t;let r=this.get(pB);return void 0===r&&(r=this.createNode(),this.set(pB,r)),pB.length=0,r}}class mB extends R{constructor(e=1,t=1,r={}){super(e,t,r),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const gB=new o,yB=new o;class bB extends re{constructor(e,t=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new ne,this._cameraL.viewport=new M,this._cameraR=new ne,this._cameraR.viewport=new M,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new ie,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._frameBufferTargets=null,this._createXRLayer=TB.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new n,this._onSessionEvent=_B.bind(this),this._onSessionEnd=xB.bind(this),this._onInputSourcesChange=wB.bind(this),this._onAnimationFrame=SB.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers="undefined"!=typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=t,this._useMultiview=!1}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(null!==this._glProjLayer||null!==this._glBaseLayer)return this._foveation}setFoveation(e){this._foveation=e,null!==this._glProjLayer&&(this._glProjLayer.fixedFoveation=e),null!==this._glBaseLayer&&void 0!==this._glBaseLayer.fixedFoveation&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,!0===this.isPresenting&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(null!==this._session)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(e,t,r,n,i,o,s,a={}){const l=new oe(e,t),c=new mB(i,o,{format:B,type:ae,depthTexture:new se(i,o,a.stencil?Ae:le,void 0,void 0,void 0,void 0,void 0,void 0,a.stencil?ue:ce),stencilBuffer:a.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});c.autoAllocateDepthBuffer=!0;const h=new u({color:16777215,side:L});h.map=c.texture,h.map.offset.y=1,h.map.repeat.y=-1;const d=new A(l,h);d.position.copy(r),d.quaternion.copy(n);const p={type:"quad",width:e,height:t,translation:r,quaternion:n,pixelwidth:i,pixelheight:o,plane:d,material:h,rendercall:s,renderTarget:c};if(this._layers.push(p),null!==this._session){p.plane.material=new u({color:16777215,side:L}),p.plane.material.blending=he,p.plane.material.blendEquation=de,p.plane.material.blendSrc=pe,p.plane.material.blendDst=pe,p.xrlayer=this._createXRLayer(p);const e=this._session.renderState.layers;e.unshift(p.xrlayer),this._session.updateRenderState({layers:e})}else c.isXRRenderTarget=!1;return d}createCylinderLayer(e,t,r,n,i,o,s,a,l={}){const c=new fe(e,e,e*t/r,64,64,!0,Math.PI-t/2,t),h=new mB(o,s,{format:B,type:ae,depthTexture:new se(o,s,l.stencil?Ae:le,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?ue:ce),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});h.autoAllocateDepthBuffer=!0;const d=new u({color:16777215,side:O});d.map=h.texture,d.map.offset.y=1,d.map.repeat.y=-1;const p=new A(c,d);p.position.copy(n),p.quaternion.copy(i);const f={type:"cylinder",radius:e,centralAngle:t,aspectratio:r,translation:n,quaternion:i,pixelwidth:o,pixelheight:s,plane:p,material:d,rendercall:a,renderTarget:h};if(this._layers.push(f),null!==this._session){f.plane.material=new u({color:16777215,side:O}),f.plane.material.blending=he,f.plane.material.blendEquation=de,f.plane.material.blendSrc=pe,f.plane.material.blendDst=pe,f.xrlayer=this._createXRLayer(f);const e=this._session.renderState.layers;e.unshift(f.xrlayer),this._session.updateRenderState({layers:e})}else h.isXRRenderTarget=!1;return p}renderLayers(){const e=new o,t=new me,r=this._renderer,i=this.isPresenting,s=r.getOutputRenderTarget(),a=r._frameBufferTarget;this.isPresenting=!1;const A=new n;r.getSize(A);const l=r._quad;for(const n of this._layers)if(n.renderTarget.isXRRenderTarget=null!==this._session,n.renderTarget.hasExternalTextures=n.renderTarget.isXRRenderTarget,n.renderTarget.isXRRenderTarget&&this._supportsLayers){n.xrlayer.transform=new XRRigidTransform(n.plane.getWorldPosition(e),n.plane.getWorldQuaternion(t));const i=this._glBinding.getSubImage(n.xrlayer,this._xrFrame);r.backend.setXRRenderTargetTextures(n.renderTarget,i.colorTexture,void 0),r._setXRLayerSize(n.renderTarget.width,n.renderTarget.height),r.setOutputRenderTarget(n.renderTarget),r.setRenderTarget(null),r._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:o,quad:s}=this._frameBufferTargets.get(n.renderTarget)||{frameBufferTarget:null,quad:null};o?(r._frameBufferTarget=o,r._quad=s):(r._quad=new nN(new kw),this._frameBufferTargets.set(n.renderTarget,{frameBufferTarget:r._getFrameBufferTarget(),quad:r._quad})),n.rendercall(),r._frameBufferTarget=null}else r.setRenderTarget(n.renderTarget),n.rendercall();r.setRenderTarget(null),r.setOutputRenderTarget(s),r._frameBufferTarget=a,r._setXRLayerSize(A.x,A.y),r._quad=l,this.isPresenting=i}getSession(){return this._session}async setSession(e){const t=this._renderer,r=t.backend;this._gl=t.getContext();const n=this._gl,i=n.getContextAttributes();if(this._session=e,null!==e){if(!0===r.isWebGPUBackend)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await r.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),!0===this._useLayers){let r=null,o=null,s=null;t.depth&&(s=t.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,r=t.stencil?ue:ce,o=t.stencil?Ae:le);const a={colorFormat:n.RGBA8,depthFormat:s,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&t.hasFeature("OVR_multiview2")&&(a.textureType="texture-array",this._useMultiview=!0);const A=new XRWebGLBinding(e,n),l=A.createProjectionLayer(a),c=[l];this._glBinding=A,this._glProjLayer=l,t.setPixelRatio(1),t._setXRLayerSize(l.textureWidth,l.textureHeight);const h=this._useMultiview?2:1,d=new se(l.textureWidth,l.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,r,h);if(this._xrRenderTarget=new mB(l.textureWidth,l.textureHeight,{format:B,type:ae,colorSpace:t.outputColorSpace,depthTexture:d,stencilBuffer:t.stencil,samples:i.antialias?4:0,resolveDepthBuffer:!1===l.ignoreDepthValues,resolveStencilBuffer:!1===l.ignoreDepthValues,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget.hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._supportsLayers=e.enabledFeatures.includes("layers"),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers)for(const e of this._layers)e.plane.material=new u({color:16777215,side:"cylinder"===e.type?O:L}),e.plane.material.blending=he,e.plane.material.blendEquation=de,e.plane.material.blendSrc=pe,e.plane.material.blendDst=pe,e.xrlayer=this._createXRLayer(e),c.unshift(e.xrlayer);e.updateRenderState({layers:c})}else{const r={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},i=new XRWebGLLayer(e,n,r);this._glBaseLayer=i,e.updateRenderState({baseLayer:i}),t.setPixelRatio(1),t._setXRLayerSize(i.framebufferWidth,i.framebufferHeight),this._xrRenderTarget=new mB(i.framebufferWidth,i.framebufferHeight,{format:B,type:ae,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:!1===i.ignoreDepthValues,resolveStencilBuffer:!1===i.ignoreDepthValues}),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(null===t)return;const r=e.near,n=e.far,i=this._cameraXR,o=this._cameraL,s=this._cameraR;i.near=s.near=o.near=r,i.far=s.far=o.far=n,i.isMultiViewCamera=this._useMultiview,this._currentDepthNear===i.near&&this._currentDepthFar===i.far||(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),o.layers.mask=2|e.layers.mask,s.layers.mask=4|e.layers.mask,i.layers.mask=o.layers.mask|s.layers.mask;const a=e.parent,A=i.cameras;vB(i,a);for(let l=0;l<A.length;l++)vB(A[l],a);2===A.length?function(e,t,r){gB.setFromMatrixPosition(t.matrixWorld),yB.setFromMatrixPosition(r.matrixWorld);const n=gB.distanceTo(yB),i=t.projectionMatrix.elements,o=r.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),A=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],c=(o[8]+1)/o[0],h=s*u,d=s*c,p=n/(-u+c),f=p*-u;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=s+p,r=a+p,i=h-f,o=d+(n-f),u=A*a/r*t,c=l*a/r*t;e.projectionMatrix.makePerspective(i,o,u,c,t,r),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(i,o,s):i.projectionMatrix.copy(o.projectionMatrix),function(e,t,r){null===r?e.matrix.copy(t.matrixWorld):(e.matrix.copy(r.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Er*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,i,a)}_getController(e){let t=this._controllers[e];return void 0===t&&(t=new ge,this._controllers[e]=t),t}}function vB(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}function _B(e){const t=this._controllerInputSources.indexOf(e.inputSource);if(-1===t)return;const r=this._controllers[t];if(void 0!==r){const t=this.getReferenceSpace();r.update(e.inputSource,e.frame,t),r.dispatchEvent({type:e.type,data:e.inputSource})}}function xB(){const e=this._session,t=this._renderer;e.removeEventListener("select",this._onSessionEvent),e.removeEventListener("selectstart",this._onSessionEvent),e.removeEventListener("selectend",this._onSessionEvent),e.removeEventListener("squeeze",this._onSessionEvent),e.removeEventListener("squeezestart",this._onSessionEvent),e.removeEventListener("squeezeend",this._onSessionEvent),e.removeEventListener("end",this._onSessionEnd),e.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let r=0;r<this._controllers.length;r++){const e=this._controllerInputSources[r];null!==e&&(this._controllerInputSources[r]=null,this._controllers[r].disconnect(e))}if(this._currentDepthNear=null,this._currentDepthFar=null,t._resetXRState(),this._session=null,this._xrRenderTarget=null,!0===this._supportsLayers)for(const r of this._layers)r.renderTarget=new mB(r.pixelwidth,r.pixelheight,{format:B,type:ae,depthTexture:new se(r.pixelwidth,r.pixelheight,r.stencilBuffer?Ae:le,void 0,void 0,void 0,void 0,void 0,void 0,r.stencilBuffer?ue:ce),stencilBuffer:r.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),r.renderTarget.isXRRenderTarget=!1,r.plane.material=r.material,r.material.map=r.renderTarget.texture,r.material.map.offset.y=1,r.material.map.repeat.y=-1,delete r.xrlayer;this.isPresenting=!1,this._useMultiview=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function wB(e){const t=this._controllers,r=this._controllerInputSources;for(let n=0;n<e.removed.length;n++){const i=e.removed[n],o=r.indexOf(i);o>=0&&(r[o]=null,t[o].disconnect(i))}for(let n=0;n<e.added.length;n++){const i=e.added[n];let o=r.indexOf(i);if(-1===o){for(let e=0;e<t.length;e++){if(e>=r.length){r.push(i),o=e;break}if(null===r[e]){r[e]=i,o=e;break}}if(-1===o)break}const s=t[o];s&&s.connect(i)}}function TB(e){return"quad"===e.type?this._glBinding.createQuadLayer({transform:new XRRigidTransform(e.translation,e.quaternion),width:e.width/2,height:e.height/2,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(e.translation,e.quaternion),radius:e.radius,centralAngle:e.centralAngle,aspectRatio:e.aspectRatio,space:this._referenceSpace,viewPixelWidth:e.pixelwidth,viewPixelHeight:e.pixelheight,clearOnAccess:!1})}function SB(e,t){if(void 0===t)return;const r=this._cameraXR,n=this._renderer,i=n.backend,o=this._glBaseLayer,s=this.getReferenceSpace(),a=t.getViewerPose(s);if(this._xrFrame=t,null!==a){const e=a.views;null!==this._glBaseLayer&&i.setXRTarget(o.framebuffer);let t=!1;e.length!==r.cameras.length&&(r.cameras.length=0,t=!0);for(let n=0;n<e.length;n++){const s=e[n];let a;if(!0===this._useLayers){const e=this._glBinding.getViewSubImage(this._glProjLayer,s);a=e.viewport,0===n&&i.setXRRenderTargetTextures(this._xrRenderTarget,e.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:e.depthStencilTexture)}else a=o.getViewport(s);let A=this._cameras[n];void 0===A&&(A=new ne,A.layers.enable(n),A.viewport=new M,this._cameras[n]=A),A.matrix.fromArray(s.transform.matrix),A.matrix.decompose(A.position,A.quaternion,A.scale),A.projectionMatrix.fromArray(s.projectionMatrix),A.projectionMatrixInverse.copy(A.projectionMatrix).invert(),A.viewport.set(a.x,a.y,a.width,a.height),0===n&&(r.matrix.copy(A.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)),!0===t&&r.cameras.push(A)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let A=0;A<this._controllers.length;A++){const e=this._controllerInputSources[A],r=this._controllers[A];null!==e&&void 0!==r&&r.update(e,t,s)}this._currentAnimationLoop&&this._currentAnimationLoop(e,t),t.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:t}),this._xrFrame=null}const EB=new C,MB=new n,NB=new M,CB=new c,RB=new q,PB=new i,DB=new M;class BB{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:r=!1,alpha:n=!0,depth:i=!0,stencil:o=!1,antialias:s=!1,samples:a=0,getFallback:A=null,colorBufferType:l=S,multiview:u=!1}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=a||!0===s?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=n,this.logarithmicDepthBuffer=r,this.outputColorSpace=p,this.toneMapping=E,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=o,this.info=new FE,this.overrideNodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new hB,this.lighting=new fB,this._getFallback=A,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new M(0,0,this._width,this._height),this._scissor=new M(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new nN(new kw),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const c=!0===this.alpha?0:1;this._clearColor=new AM(0,0,0,c),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=l,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:N},this.xr=new bB(this,u),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(e,t,r)=>{await this.compileAsync(e,t);const n=this._renderLists.get(e,t),i=this._renderContexts.get(e,t,this._renderTarget),o=e.overrideMaterial||r.material,s=this._objects.get(r,o,e,t,n.lightsNode,i,i.clippingContext),{fragmentShader:a,vertexShader:A}=s.getNodeBuilderState();return{fragmentShader:a,vertexShader:A}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return null!==this._initPromise||(this._initPromise=new Promise(async(e,t)=>{let r=this.backend;try{await r.init(this)}catch(n){if(null===this._getFallback)return void t(n);try{this.backend=r=this._getFallback(n),await r.init(this)}catch(n){return void t(n)}}this._nodes=new sB(this,r),this._animation=new wE(this._nodes,this.info),this._attributes=new OE(r),this._background=new nD(this,this._nodes),this._geometries=new IE(this._attributes,this.info),this._textures=new aM(this,r,this.info),this._pipelines=new HE(r,this._nodes),this._bindings=new WE(r,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new NE(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new ZE(this.lighting),this._bundles=new cB,this._renderContexts=new oM,this._animation.start(),this._initialized=!0,e(this)})),this._initPromise}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,r=null){if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();const n=this._nodes.nodeFrame,i=n.renderId,o=this._currentRenderContext,s=this._currentRenderObjectFunction,a=this._compilationPromises,A=!0===e.isScene?e:EB;null===r&&(r=e);const l=this._renderTarget,u=this._renderContexts.get(r,t,l),c=this._activeMipmapLevel,h=[];this._currentRenderContext=u,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=h,n.renderId++,n.update(),u.depth=this.depth,u.stencil=this.stencil,u.clippingContext||(u.clippingContext=new AB),u.clippingContext.updateGlobal(A,t),A.onBeforeRender(this,e,t,l);const d=this._renderLists.get(e,t);if(d.begin(),this._projectObject(e,t,0,d,u.clippingContext),r!==e&&r.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&d.pushLight(e)}),d.finish(),null!==l){this._textures.updateRenderTarget(l,c);const e=this._textures.get(l);u.textures=e.textures,u.depthTexture=e.depthTexture}else u.textures=null,u.depthTexture=null;this._background.update(A,d,u);const p=d.opaque,f=d.transparent,m=d.transparentDoublePass,g=d.lightsNode;!0===this.opaque&&p.length>0&&this._renderObjects(p,t,A,g),!0===this.transparent&&f.length>0&&this._renderTransparents(f,m,t,A,g),n.renderId=i,this._currentRenderContext=o,this._currentRenderObjectFunction=s,this._compilationPromises=a,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(h)}async renderAsync(e,t){!1===this._initialized&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}set highPrecision(e){!0===e?(this.overrideNodes.modelViewMatrix=Ev,this.overrideNodes.modelNormalViewMatrix=Mv):this.highPrecision&&(this.overrideNodes.modelViewMatrix=null,this.overrideNodes.modelNormalViewMatrix=null)}get highPrecision(){return this.overrideNodes.modelViewMatrix===Ev&&this.overrideNodes.modelNormalViewMatrix===Mv}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:\n\nMessage: ${e.message}`;e.reason&&(t+=`\nReason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,r){const{bundleGroup:n,camera:i,renderList:o}=e,s=this._currentRenderContext,a=this._bundles.get(n,i),A=this.backend.get(a);void 0===A.renderContexts&&(A.renderContexts=new Set);const l=n.version!==A.version,u=!1===A.renderContexts.has(s)||l;if(A.renderContexts.add(s),u){this.backend.beginBundle(s),(void 0===A.renderObjects||l)&&(A.renderObjects=[]),this._currentRenderBundle=a;const{transparentDoublePass:e,transparent:u,opaque:c}=o;!0===this.opaque&&c.length>0&&this._renderObjects(c,i,t,r),!0===this.transparent&&u.length>0&&this._renderTransparents(u,e,i,t,r),this._currentRenderBundle=null,this.backend.finishBundle(s,a),A.version=n.version}else{const{renderObjects:e}=A;for(let t=0,r=e.length;t<r;t++){const r=e[t];this._nodes.needsRefresh(r)&&(this._nodes.updateBefore(r),this._nodes.updateForRender(r),this._bindings.updateForRender(r),this._nodes.updateAfter(r))}}this.backend.addBundle(s,a)}render(e,t){if(!1===this._initialized)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(!1===(e!==E)&&!1===(t!==D))return null;const{width:r,height:n}=this.getDrawingBufferSize(MB),{depth:i,stencil:o}=this;let s=this._frameBufferTarget;null===s&&(s=new R(r,n,{depthBuffer:i,stencilBuffer:o,type:this._colorBufferType,format:B,colorSpace:D,generateMipmaps:!1,minFilter:P,magFilter:P,samples:this.samples}),s.isPostProcessingRenderTarget=!0,this._frameBufferTarget=s);const a=this.getOutputRenderTarget();return s.depthBuffer=i,s.stencilBuffer=o,null!==a?s.setSize(a.width,a.height,a.depth):s.setSize(r,n,1),s.viewport.copy(this._viewport),s.scissor.copy(this._scissor),s.viewport.multiplyScalar(this._pixelRatio),s.scissor.multiplyScalar(this._pixelRatio),s.scissorTest=this._scissorTest,s.multiview=null!==a&&a.multiview,s.resolveDepthBuffer=null===a||a.resolveDepthBuffer,s.autoAllocateDepthBuffer=null!==a&&a.autoAllocateDepthBuffer,s}_renderScene(e,t,r=!0){if(!0===this._isDeviceLost)return;const n=r?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,o=i.renderId,s=this._currentRenderContext,a=this._currentRenderObjectFunction,A=!0===e.isScene?e:EB,l=this._renderTarget||this._outputRenderTarget,u=this._activeCubeFace,c=this._activeMipmapLevel;let h;null!==n?(h=n,this.setRenderTarget(h)):h=l;const d=this._renderContexts.get(e,t,h);this._currentRenderContext=d,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls;const p=this.coordinateSystem,f=this.xr;if(t.coordinateSystem!==p&&!1===f.isPresenting&&(t.coordinateSystem=p,t.updateProjectionMatrix(),t.isArrayCamera))for(const N of t.cameras)N.coordinateSystem=p,N.updateProjectionMatrix();!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===f.enabled&&!0===f.isPresenting&&(!0===f.cameraAutoUpdate&&f.updateCamera(t),t=f.getCamera());let m=this._viewport,g=this._scissor,y=this._pixelRatio;null!==h&&(m=h.viewport,g=h.scissor,y=1),this.getDrawingBufferSize(MB),NB.set(0,0,MB.width,MB.height);const b=void 0===m.minDepth?0:m.minDepth,v=void 0===m.maxDepth?1:m.maxDepth;d.viewportValue.copy(m).multiplyScalar(y).floor(),d.viewportValue.width>>=c,d.viewportValue.height>>=c,d.viewportValue.minDepth=b,d.viewportValue.maxDepth=v,d.viewport=!1===d.viewportValue.equals(NB),d.scissorValue.copy(g).multiplyScalar(y).floor(),d.scissor=this._scissorTest&&!1===d.scissorValue.equals(NB),d.scissorValue.width>>=c,d.scissorValue.height>>=c,d.clippingContext||(d.clippingContext=new AB),d.clippingContext.updateGlobal(A,t),A.onBeforeRender(this,e,t,h);const _=t.isArrayCamera?RB:CB;t.isArrayCamera||(PB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),_.setFromProjectionMatrix(PB,p));const x=this._renderLists.get(e,t);if(x.begin(),this._projectObject(e,t,0,x,d.clippingContext),x.finish(),!0===this.sortObjects&&x.sort(this._opaqueSort,this._transparentSort),null!==h){this._textures.updateRenderTarget(h,c);const e=this._textures.get(h);d.textures=e.textures,d.depthTexture=e.depthTexture,d.width=e.width,d.height=e.height,d.renderTarget=h,d.depth=h.depthBuffer,d.stencil=h.stencilBuffer}else d.textures=null,d.depthTexture=null,d.width=this.domElement.width,d.height=this.domElement.height,d.depth=this.depth,d.stencil=this.stencil;d.width>>=c,d.height>>=c,d.activeCubeFace=u,d.activeMipmapLevel=c,d.occlusionQueryCount=x.occlusionQueryCount,this._background.update(A,x,d),d.camera=t,this.backend.beginRender(d);const{bundles:w,lightsNode:T,transparentDoublePass:S,transparent:E,opaque:M}=x;return w.length>0&&this._renderBundles(w,A,T),!0===this.opaque&&M.length>0&&this._renderObjects(M,t,A,T),!0===this.transparent&&E.length>0&&this._renderTransparents(E,S,t,A,T),this.backend.finishRender(d),i.renderId=o,this._currentRenderContext=s,this._currentRenderObjectFunction=a,null!==n&&(this.setRenderTarget(l,u,c),this._renderOutput(h)),A.onAfterRender(this,e,t,h),d}_setXRLayerSize(e,t){this._width=e,this._height=t,this.setViewport(0,0,e,t)}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const r=this.autoClear,n=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=r,this.xr.enabled=n}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,r){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=r,this.domElement.width=Math.floor(e*r),this.domElement.height=Math.floor(t*r),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,r=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),!0===r&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,r,n){const i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,r,n)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,r,n,i=0,o=1){const s=this._viewport;e.isVector4?s.copy(e):s.set(e,t,r,n),s.minDepth=i,s.maxDepth=o}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,r=!0){if(!1===this._initialized)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,r);const n=this._renderTarget||this._getFrameBufferTarget();let i=null;if(null!==n){this._textures.updateRenderTarget(n);const e=this._textures.get(n);i=this._renderContexts.getForClear(n),i.textures=e.textures,i.depthTexture=e.depthTexture,i.width=e.width,i.height=e.height,i.renderTarget=n,i.depth=n.depthBuffer,i.stencil=n.stencilBuffer,i.clearColorValue=this.backend.getClearColor(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,r,i),null!==n&&null===this._renderTarget&&this._renderOutput(n)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,r=!0){!1===this._initialized&&await this.init(),this.clear(e,t,r)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:E}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:D}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||null===this._renderTarget}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),null!==this._frameBufferTarget&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{null!==e&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,r=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=r}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(!0===this._isDeviceLost)return;if(!1===this._initialized)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,r=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const n=this.backend,i=this._pipelines,o=this._bindings,s=this._nodes,a=Array.isArray(e)?e:[e];if(void 0===a[0]||!0!==a[0].isComputeNode)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");n.beginCompute(e);for(const A of a){if(!1===i.has(A)){const e=()=>{A.removeEventListener("dispose",e),i.delete(A),o.delete(A),s.delete(A)};A.addEventListener("dispose",e);const t=A.onInitFunction;null!==t&&t.call(A,{renderer:this})}s.updateForCompute(A),o.updateForCompute(A);const t=o.getForCompute(A),r=i.getForCompute(A,t);n.compute(e,A,t,r)}n.finishCompute(e),t.renderId=r}async computeAsync(e){!1===this._initialized&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return!1===this._initialized&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return!1===this._initialized&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return!1===this._initialized?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){!1===this._initialized&&await this.init(),this._textures.updateTexture(e)}initTexture(e){!1===this._initialized&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(null!==t)if(t.isVector2)t=DB.set(t.x,t.y,e.image.width,e.image.height).floor();else{if(!t.isVector4)return void console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");t=DB.copy(t).floor()}else t=DB.set(0,0,e.image.width,e.image.height);let r,n=this._currentRenderContext;null!==n?r=n.renderTarget:(r=this._renderTarget||this._getFrameBufferTarget(),null!==r&&(this._textures.updateRenderTarget(r),n=this._textures.get(r))),this._textures.updateTexture(e,{renderTarget:r}),this.backend.copyFramebufferToTexture(e,n,t)}copyTextureToTexture(e,t,r=null,n=null,i=0,o=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,r,n,i,o)}async readRenderTargetPixelsAsync(e,t,r,n,i,o=0,s=0){return this.backend.copyTextureToBuffer(e.textures[o],t,r,n,i,s)}_projectObject(e,t,r,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)n.pushLight(e);else if(e.isSprite){const o=t.isArrayCamera?RB:CB;if(!e.frustumCulled||o.intersectsSprite(e,t)){!0===this.sortObjects&&DB.setFromMatrixPosition(e.matrixWorld).applyMatrix4(PB);const{geometry:t,material:o}=e;o.visible&&n.push(e,t,o,r,DB.z,null,i)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(e.isMesh||e.isLine||e.isPoints){const o=t.isArrayCamera?RB:CB;if(!e.frustumCulled||o.intersectsObject(e,t)){const{geometry:t,material:o}=e;if(!0===this.sortObjects&&(null===t.boundingSphere&&t.computeBoundingSphere(),DB.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(PB)),Array.isArray(o)){const s=t.groups;for(let a=0,A=s.length;a<A;a++){const A=s[a],l=o[A.materialIndex];l&&l.visible&&n.push(e,t,l,r,DB.z,A,i)}}else o.visible&&n.push(e,t,o,r,DB.z,null,i)}}if(!0===e.isBundleGroup&&void 0!==this.backend.beginBundle){const r=n;(n=this._renderLists.get(e,t)).begin(),r.pushBundle({bundleGroup:e,camera:t,renderList:n}),n.finish()}const o=e.children;for(let s=0,a=o.length;s<a;s++)this._projectObject(o[s],t,r,n,i)}_renderBundles(e,t,r){for(const n of e)this._renderBundle(n,t,r)}_renderTransparents(e,t,r,n,i){if(t.length>0){for(const{material:e}of t)e.side=O;this._renderObjects(t,r,n,i,"backSide");for(const{material:e}of t)e.side=L;this._renderObjects(e,r,n,i);for(const{material:e}of t)e.side=k}else this._renderObjects(e,r,n,i)}_renderObjects(e,t,r,n,i=null){for(let o=0,s=e.length;o<s;o++){const{object:s,geometry:a,material:A,group:l,clippingContext:u}=e[o];this._currentRenderObjectFunction(s,r,t,a,A,l,n,u,i)}}renderObject(e,t,r,n,i,o,s,a=null,A=null){let l,u,c;if(e.onBeforeRender(this,t,r,n,i,o),!0===i.allowOverride&&null!==t.overrideMaterial){const e=t.overrideMaterial;i.positionNode&&i.positionNode.isNode&&(l=e.positionNode,e.positionNode=i.positionNode),e.alphaTest=i.alphaTest,e.alphaMap=i.alphaMap,e.transparent=i.transparent||i.transmission>0,e.isShadowPassMaterial&&(e.side=null===i.shadowSide?i.side:i.shadowSide,i.depthNode&&i.depthNode.isNode&&(c=e.depthNode,e.depthNode=i.depthNode),i.castShadowNode&&i.castShadowNode.isNode&&(u=e.colorNode,e.colorNode=i.castShadowNode),i.castShadowPositionNode&&i.castShadowPositionNode.isNode&&(l=e.positionNode,e.positionNode=i.castShadowPositionNode)),i=e}!0===i.transparent&&i.side===k&&!1===i.forceSinglePass?(i.side=O,this._handleObjectFunction(e,i,t,r,s,o,a,"backSide"),i.side=L,this._handleObjectFunction(e,i,t,r,s,o,a,A),i.side=k):this._handleObjectFunction(e,i,t,r,s,o,a,A),void 0!==l&&(t.overrideMaterial.positionNode=l),void 0!==c&&(t.overrideMaterial.depthNode=c),void 0!==u&&(t.overrideMaterial.colorNode=u),e.onAfterRender(this,t,r,n,i,o)}_renderObjectDirect(e,t,r,n,i,o,s,a){const A=this._objects.get(e,t,r,n,i,this._currentRenderContext,s,a);A.drawRange=e.geometry.drawRange,A.group=o;const l=this._nodes.needsRefresh(A);if(l&&(this._nodes.updateBefore(A),this._geometries.updateForRender(A),this._nodes.updateForRender(A),this._bindings.updateForRender(A)),this._pipelines.updateForRender(A),null!==this._currentRenderBundle){this.backend.get(this._currentRenderBundle).renderObjects.push(A),A.bundle=this._currentRenderBundle.bundleGroup}this.backend.draw(A,this.info),l&&this._nodes.updateAfter(A)}_createObjectPipeline(e,t,r,n,i,o,s,a){const A=this._objects.get(e,t,r,n,i,this._currentRenderContext,s,a);A.drawRange=e.geometry.drawRange,A.group=o,this._nodes.updateBefore(A),this._geometries.updateForRender(A),this._nodes.updateForRender(A),this._bindings.updateForRender(A),this._pipelines.getForRender(A,this._compilationPromises),this._nodes.updateAfter(A)}get compile(){return this.compileAsync}}class qB{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}class OB extends qB{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return(e=this._buffer.byteLength)+(qE-e%qE)%qE;var e}get buffer(){return this._buffer}update(){return!0}}class LB extends OB{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let kB=0;class IB extends LB{constructor(e,t){super("UniformBuffer_"+kB++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class FB extends LB{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(null===e){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){const e=this.bytesPerElement;let t=0;for(let r=0,n=this.uniforms.length;r<n;r++){const n=this.uniforms[r],i=n.boundary,o=n.itemSize*e,s=t%qE,a=s%i,A=s+a;t+=a,0!==A&&qE-A<o&&(t+=qE-A),n.offset=t/e,t+=o}return Math.ceil(t/qE)*qE}update(){let e=!1;for(const t of this.uniforms)!0===this.updateByType(t)&&(e=!0);return e}updateByType(e){return e.isNumberUniform?this.updateNumber(e):e.isVector2Uniform?this.updateVector2(e):e.isVector3Uniform?this.updateVector3(e):e.isVector4Uniform?this.updateVector4(e):e.isColorUniform?this.updateColor(e):e.isMatrix3Uniform?this.updateMatrix3(e):e.isMatrix4Uniform?this.updateMatrix4(e):void console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const r=this.values,n=e.getValue(),i=e.offset,o=e.getType();if(r[i]!==n){this._getBufferForType(o)[i]=r[i]=n,t=!0}return t}updateVector2(e){let t=!1;const r=this.values,n=e.getValue(),i=e.offset,o=e.getType();if(r[i+0]!==n.x||r[i+1]!==n.y){const e=this._getBufferForType(o);e[i+0]=r[i+0]=n.x,e[i+1]=r[i+1]=n.y,t=!0}return t}updateVector3(e){let t=!1;const r=this.values,n=e.getValue(),i=e.offset,o=e.getType();if(r[i+0]!==n.x||r[i+1]!==n.y||r[i+2]!==n.z){const e=this._getBufferForType(o);e[i+0]=r[i+0]=n.x,e[i+1]=r[i+1]=n.y,e[i+2]=r[i+2]=n.z,t=!0}return t}updateVector4(e){let t=!1;const r=this.values,n=e.getValue(),i=e.offset,o=e.getType();if(r[i+0]!==n.x||r[i+1]!==n.y||r[i+2]!==n.z||r[i+4]!==n.w){const e=this._getBufferForType(o);e[i+0]=r[i+0]=n.x,e[i+1]=r[i+1]=n.y,e[i+2]=r[i+2]=n.z,e[i+3]=r[i+3]=n.w,t=!0}return t}updateColor(e){let t=!1;const r=this.values,n=e.getValue(),i=e.offset;if(r[i+0]!==n.r||r[i+1]!==n.g||r[i+2]!==n.b){const e=this.buffer;e[i+0]=r[i+0]=n.r,e[i+1]=r[i+1]=n.g,e[i+2]=r[i+2]=n.b,t=!0}return t}updateMatrix3(e){let t=!1;const r=this.values,n=e.getValue().elements,i=e.offset;if(r[i+0]!==n[0]||r[i+1]!==n[1]||r[i+2]!==n[2]||r[i+4]!==n[3]||r[i+5]!==n[4]||r[i+6]!==n[5]||r[i+8]!==n[6]||r[i+9]!==n[7]||r[i+10]!==n[8]){const e=this.buffer;e[i+0]=r[i+0]=n[0],e[i+1]=r[i+1]=n[1],e[i+2]=r[i+2]=n[2],e[i+4]=r[i+4]=n[3],e[i+5]=r[i+5]=n[4],e[i+6]=r[i+6]=n[5],e[i+8]=r[i+8]=n[6],e[i+9]=r[i+9]=n[7],e[i+10]=r[i+10]=n[8],t=!0}return t}updateMatrix4(e){let t=!1;const r=this.values,n=e.getValue().elements,i=e.offset;if(!1===function(e,t,r){for(let n=0,i=t.length;n<i;n++)if(e[r+n]!==t[n])return!1;return!0}(r,n,i)){this.buffer.set(n,i),function(e,t,r){for(let n=0,i=t.length;n<i;n++)e[r+n]=t[n]}(r,n,i),t=!0}return t}_getBufferForType(e){return"int"===e||"ivec2"===e||"ivec3"===e||"ivec4"===e?new Int32Array(this.buffer.buffer):"uint"===e||"uvec2"===e||"uvec3"===e||"uvec4"===e?new Uint32Array(this.buffer.buffer):this.buffer}}let UB=0;class VB extends FB{constructor(e,t){super(e),this.id=UB++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let GB=0;class jB extends qB{constructor(e,t){super(e),this.id=GB++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version&&(this.version=e.version,!0)}}class zB extends jB{constructor(e,t,r,n=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r,this.access=n}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class HB extends zB{constructor(e,t,r,n=null){super(e,t,r,n),this.isSampledCubeTexture=!0}}class WB extends zB{constructor(e,t,r,n=null){super(e,t,r,n),this.isSampledTexture3D=!0}}const QB={textureDimensions:"textureSize",equals:"equal"},$B={low:"lowp",medium:"mediump",high:"highp"},YB={swizzleAssign:!0,storageBuffer:!1},XB={perspective:"smooth",linear:"noperspective"},KB={centroid:"centroid","flat first":"flat","flat either":"flat"},ZB="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\nprecision highp sampler2DArray;\n\nprecision highp usampler2D;\nprecision highp usampler3D;\nprecision highp usamplerCube;\nprecision highp usampler2DArray;\n\nprecision highp isampler2D;\nprecision highp isampler3D;\nprecision highp isamplerCube;\nprecision highp isampler2DArray;\n\nprecision lowp sampler2DShadow;\nprecision lowp sampler2DArrayShadow;\nprecision lowp samplerCubeShadow;\n";class JB extends OD{constructor(e,t){super(e,t,new rB),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==Xe}getMethod(e){return QB[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),n=[];for(const i of t.inputs)n.push(this.getType(i.type)+" "+i.name);return`${this.getType(t.type)} ${t.name}( ${n.join(", ")} ) {\n\n\t${r.vars}\n\n${r.code}\n\treturn ${r.result};\n\n}`}setupPBO(e){const t=e.value;if(void 0===t.pbo){const e=t.array,r=t.count*t.itemSize,{itemSize:n}=t,i=t.array.constructor.name.toLowerCase().includes("int");let o=i?qt:Bt;2===n?o=i?Lt:Ot:3===n?o=i?Yr:Dt:4===n&&(o=i?kt:B);const s={Float32Array:Ke,Uint8Array:ae,Uint16Array:Rt,Uint32Array:le,Int8Array:Nt,Int16Array:Ct,Int32Array:Re,Uint8ClampedArray:ae},a=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(r/n))));let A=Math.ceil(r/n/a);a*A*n<r&&A++;const l=a*A*n,u=new e.constructor(l);u.set(e,0),t.array=u;const c=new pr(t.array,a,A,o,s[t.array.constructor.name]||Ke);c.needsUpdate=!0,c.isPBOTexture=!0;const h=new Gb(c,null,null);h.setPrecision("high"),t.pboNode=h,t.pbo=h.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&!0!==e.node.isTextureNode&&!0!==e.node.isBufferNode?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:r}=e,n=t.value;if(this.renderer.backend.has(n)){this.renderer.backend.get(n).pbo=n.pbo}const i=this.getUniformFromNode(n.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(i);this.increaseUsage(r);const s=r.build(this,"uint"),a=this.getDataFromNode(e);let A=a.propertyName;if(void 0===A){const r=this.getVarFromNode(e);A=this.getPropertyName(r);const i=this.getDataFromNode(t);let l=i.propertySizeName;void 0===l&&(l=A+"Size",this.getVarFromNode(t,l,"uint"),this.addLineFlowCode(`${l} = uint( textureSize( ${o}, 0 ).x )`,e),i.propertySizeName=l);const{itemSize:u}=n,c="."+Lp.join("").slice(0,u),h=`ivec2(${s} % ${l}, ${s} / ${l})`,d=this.generateTextureLoad(null,o,h,null,"0");let p="vec4";n.pbo.type===le?p="uvec4":n.pbo.type===Re&&(p="ivec4"),this.addLineFlowCode(`${A} = ${p}(${d})${c}`,e),a.propertyName=A}return A}generateTextureLoad(e,t,r,n,i="0"){return n?`texelFetch( ${t}, ivec3( ${r}, ${n} ), ${i} )`:`texelFetch( ${t}, ${r}, ${i} )`}generateTexture(e,t,r,n){return e.isDepthTexture?(n&&(r=`vec4( ${r}, ${n} )`),`texture( ${t}, ${r} ).x`):(n&&(r=`vec3( ${r}, ${n} )`),`texture( ${t}, ${r} )`)}generateTextureLevel(e,t,r,n){return`textureLod( ${t}, ${r}, ${n} )`}generateTextureBias(e,t,r,n){return`texture( ${t}, ${r}, ${n} )`}generateTextureGrad(e,t,r,n){return`textureGrad( ${t}, ${r}, ${n[0]}, ${n[1]} )`}generateTextureCompare(e,t,r,n,i,o=this.shaderStage){if("fragment"===o)return i?`texture( ${t}, vec4( ${r}, ${i}, ${n} ) )`:`texture( ${t}, vec3( ${r}, ${n} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(e){const t=[],r=this.vars[e];if(void 0!==r)for(const n of r)t.push(`${this.getVar(n.type,n.name,n.count)};`);return t.join("\n\t")}getUniforms(e){const t=this.uniforms[e],r=[],n={};for(const o of t){let t=null,i=!1;if("texture"===o.type||"texture3D"===o.type){const e=o.node.value;let r="";!0!==e.isDataTexture&&!0!==e.isData3DTexture||(e.type===le?r="u":e.type===Re&&(r="i")),t="texture3D"===o.type&&!1===e.isArrayTexture?`${r}sampler3D ${o.name};`:e.compareFunction?!0===e.isArrayTexture?`sampler2DArrayShadow ${o.name};`:`sampler2DShadow ${o.name};`:!0===e.isArrayTexture||!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?`${r}sampler2DArray ${o.name};`:`${r}sampler2D ${o.name};`}else if("cubeTexture"===o.type)t=`samplerCube ${o.name};`;else if("buffer"===o.type){const e=o.node,r=this.getType(e.bufferType),n=e.bufferCount,i=n>0?n:"";t=`${e.name} {\n\t${r} ${o.name}[${i}];\n};\n`}else{t=`${this.getVectorType(o.type)} ${this.getPropertyName(o,e)};`,i=!0}const s=o.node.precision;if(null!==s&&(t=$B[s]+" "+t),i){t="\t"+t;const e=o.groupNode.name;(n[e]||(n[e]=[])).push(t)}else t="uniform "+t,r.push(t)}let i="";for(const o in n){const t=n[o];i+=this._getGLSLUniformStruct(e+"_"+o,t.join("\n"))+"\n"}return i+=r.join("\n"),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Re){let r=e;e.isInterleavedBufferAttribute&&(r=e.data);const n=r.array;!1==(n instanceof Uint32Array||n instanceof Int32Array)&&(t=t.slice(1))}return t}getAttributes(e){let t="";if("vertex"===e||"compute"===e){const e=this.getAttributesArray();let r=0;for(const n of e)t+=`layout( location = ${r++} ) in ${n.type} ${n.name};\n`}return t}getStructMembers(e){const t=[];for(const r of e.members)t.push(`\t${r.type} ${r.name};`);return t.join("\n")}getStructs(e){const t=[],r=this.structs[e],n=[];for(const i of r)if(i.output)for(const e of i.members)n.push(`layout( location = ${e.index} ) out ${e.type} ${e.name};`);else{let e="struct "+i.name+" {\n";e+=this.getStructMembers(i),e+="\n};\n",t.push(e)}return 0===n.length&&n.push("layout( location = 0 ) out vec4 fragColor;"),"\n"+n.join("\n")+"\n\n"+t.join("\n")}getVaryings(e){let t="";const r=this.varyings;if("vertex"===e||"compute"===e)for(const n of r){"compute"===e&&(n.needsInterpolation=!0);const r=this.getType(n.type);if(n.needsInterpolation)if(n.interpolationType){t+=`${XB[n.interpolationType]||n.interpolationType} ${KB[n.interpolationSampling]||""} out ${r} ${n.name};\n`}else{t+=`${r.includes("int")||r.includes("uv")||r.includes("iv")?"flat ":""}out ${r} ${n.name};\n`}else t+=`${r} ${n.name};\n`}else if("fragment"===e)for(const n of r)if(n.needsInterpolation){const e=this.getType(n.type);if(n.interpolationType){t+=`${XB[n.interpolationType]||n.interpolationType} ${KB[n.interpolationSampling]||""} in ${e} ${n.name};\n`}else{t+=`${e.includes("int")||e.includes("uv")||e.includes("iv")?"flat ":""}in ${e} ${n.name};\n`}}for(const n of this.builtins[e])t+=`${n};\n`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((e,t)=>e*t,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,r=this.shaderStage){const n=this.extensions[r]||(this.extensions[r]=new Map);!1===n.has(e)&&n.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if("vertex"===e){const t=this.renderer.backend.extensions;this.object.isBatchedMesh&&t.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const r=this.extensions[e];if(void 0!==r)for(const{name:n,behavior:i}of r.values())t.push(`#extension ${n} : ${i}`);return t.join("\n")}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=YB[e];if(void 0===t){let r;switch(t=!1,e){case"float32Filterable":r="OES_texture_float_linear";break;case"clipDistance":r="WEBGL_clip_cull_distance"}if(void 0!==r){const e=this.renderer.backend.extensions;e.has(r)&&(e.get(r),t=!0)}YB[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let r=0;r<e.length;r++){const n=e[r],i=this.getPropertyName(n.attributeNode);i&&(t+=`${n.varyingName} = ${i};\n\t`)}return t}_getGLSLUniformStruct(e,t){return`\nlayout( std140 ) uniform ${e} {\n${t}\n};`}_getGLSLVertexCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions\n${e.extensions}\n\n// precision\n${ZB}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// attributes\n${e.attributes}\n\n// codes\n${e.codes}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// transforms\n\t${e.transforms}\n\n\t// flow\n\t${e.flow}\n\n\tgl_PointSize = 1.0;\n\n}\n`}_getGLSLFragmentCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions\n${e.extensions}\n\n// precision\n${ZB}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// codes\n${e.codes}\n\n// structs\n${e.structs}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let r="// code\n\n";r+=this.flowCode[t];const n=this.flowNodes[t],i=n[n.length-1];for(const e of n){const n=this.getFlowData(e),o=e.name;o&&(r.length>0&&(r+="\n"),r+=`\t// flow -> ${o}\n\t`),r+=`${n.code}\n\t`,e===i&&"compute"!==t&&(r+="// result\n\t","vertex"===t?(r+="gl_Position = ",r+=`${n.result};`):"fragment"===t&&(e.outputNode.isOutputStructNode||(r+="fragColor = ",r+=`${n.result};`)))}const o=e[t];o.extensions=this.getExtensions(t),o.uniforms=this.getUniforms(t),o.attributes=this.getAttributes(t),o.varyings=this.getVaryings(t),o.vars=this.getVars(t),o.structs=this.getStructs(t),o.codes=this.getCodes(t),o.transforms=this.getTransforms(t),o.flow=r}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,r,n=null){const i=super.getUniformFromNode(e,t,r,n),o=this.getDataFromNode(e,r,this.globalCache);let s=o.uniformGPU;if(void 0===s){const n=e.groupNode,a=n.name,A=this.getBindGroupArray(a,r);if("texture"===t)s=new zB(i.name,i.node,n),A.push(s);else if("cubeTexture"===t)s=new HB(i.name,i.node,n),A.push(s);else if("texture3D"===t)s=new WB(i.name,i.node,n),A.push(s);else if("buffer"===t){e.name=`NodeBuffer_${e.id}`,i.name=`buffer${e.id}`;const t=new IB(e,n);t.name=e.name,A.push(t),s=t}else{const e=this.uniformGroups[r]||(this.uniformGroups[r]={});let o=e[a];void 0===o&&(o=new VB(r+"_"+a,n),e[a]=o,A.push(o)),s=this.getNodeUniform(i,t),o.addUniform(s)}o.uniformGPU=s}return i}}let eq=null,tq=null;class rq{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=!0===e.trackTimestamp}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp)return void Me("WebGPURenderer: Timestamp tracking is disabled.");const t=this.timestampQueryPool[e];if(!t)return void Me(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);const r=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=r,r}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return eq=eq||new n,this.renderer.getDrawingBufferSize(eq)}setScissorTest(){}getClearColor(){const e=this.renderer;return tq=tq||new AM,e.getClearColor(tq),tq.getRGB(tq),tq}getDomElement(){let e=this.domElement;return null===e&&(e=void 0!==this.parameters.canvas?this.parameters.canvas:Ne(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Ce} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let nq,iq,oq=0;class sq{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class aq{constructor(e){this.backend=e}createAttribute(e,t){const r=this.backend,{gl:n}=r,i=e.array,o=e.usage||n.STATIC_DRAW,s=e.isInterleavedBufferAttribute?e.data:e,a=r.get(s);let A,l=a.bufferGPU;if(void 0===l&&(l=this._createBuffer(n,t,i,o),a.bufferGPU=l,a.bufferType=t,a.version=s.version),i instanceof Float32Array)A=n.FLOAT;else if(i instanceof Uint16Array)A=e.isFloat16BufferAttribute?n.HALF_FLOAT:n.UNSIGNED_SHORT;else if(i instanceof Int16Array)A=n.SHORT;else if(i instanceof Uint32Array)A=n.UNSIGNED_INT;else if(i instanceof Int32Array)A=n.INT;else if(i instanceof Int8Array)A=n.BYTE;else if(i instanceof Uint8Array)A=n.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);A=n.UNSIGNED_BYTE}let u={bufferGPU:l,bufferType:t,type:A,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:A===n.INT||A===n.UNSIGNED_INT||e.gpuType===Re,id:oq++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const e=this._createBuffer(n,t,i,o);u=new sq(u,e)}r.set(e,u)}updateAttribute(e){const t=this.backend,{gl:r}=t,n=e.array,i=e.isInterleavedBufferAttribute?e.data:e,o=t.get(i),s=o.bufferType,a=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(r.bindBuffer(s,o.bufferGPU),0===a.length)r.bufferSubData(s,0,n);else{for(let e=0,t=a.length;e<t;e++){const t=a[e];r.bufferSubData(s,t.start*n.BYTES_PER_ELEMENT,n,t.start,t.count)}i.clearUpdateRanges()}r.bindBuffer(s,null),o.version=i.version}destroyAttribute(e){const t=this.backend,{gl:r}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const n=t.get(e);r.deleteBuffer(n.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:r}=t,n=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(n),o=e.array,s=o.byteLength;r.bindBuffer(r.COPY_READ_BUFFER,i);const a=r.createBuffer();r.bindBuffer(r.COPY_WRITE_BUFFER,a),r.bufferData(r.COPY_WRITE_BUFFER,s,r.STREAM_READ),r.copyBufferSubData(r.COPY_READ_BUFFER,r.COPY_WRITE_BUFFER,0,0,s),await t.utils._clientWaitAsync();const A=new e.array.constructor(o.length);return r.bindBuffer(r.COPY_WRITE_BUFFER,a),r.getBufferSubData(r.COPY_WRITE_BUFFER,0,A),r.deleteBuffer(a),r.bindBuffer(r.COPY_READ_BUFFER,null),r.bindBuffer(r.COPY_WRITE_BUFFER,null),A.buffer}_createBuffer(e,t,r,n){const i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,r,n),e.bindBuffer(t,null),i}}class Aq{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;nq={[de]:e.FUNC_ADD,[Je]:e.FUNC_SUBTRACT,[Ze]:e.FUNC_REVERSE_SUBTRACT},iq={[pe]:e.ZERO,[lt]:e.ONE,[At]:e.SRC_COLOR,[at]:e.SRC_ALPHA,[st]:e.SRC_ALPHA_SATURATE,[ot]:e.DST_COLOR,[it]:e.DST_ALPHA,[nt]:e.ONE_MINUS_SRC_COLOR,[rt]:e.ONE_MINUS_SRC_ALPHA,[tt]:e.ONE_MINUS_DST_COLOR,[et]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),r=e.getParameter(e.VIEWPORT);this.currentScissor=(new M).fromArray(t),this.currentViewport=(new M).fromArray(r),this._tempVec4=new M}enable(e){const{enabled:t}=this;!0!==t[e]&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;!1!==t[e]&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==ut?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===ct?t.cullFace(t.BACK):e===ht?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:r}=this;e!==t&&(r.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,r,n,i,o,s,a){const{gl:A}=this;if(e!==dt){if(!1===this.currentBlendingEnabled&&(this.enable(A.BLEND),this.currentBlendingEnabled=!0),e===he)i=i||t,o=o||r,s=s||n,t===this.currentBlendEquation&&i===this.currentBlendEquationAlpha||(A.blendEquationSeparate(nq[t],nq[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),r===this.currentBlendSrc&&n===this.currentBlendDst&&o===this.currentBlendSrcAlpha&&s===this.currentBlendDstAlpha||(A.blendFuncSeparate(iq[r],iq[n],iq[o],iq[s]),this.currentBlendSrc=r,this.currentBlendDst=n,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=s),this.currentBlending=e,this.currentPremultipledAlpha=!1;else if(e!==this.currentBlending||a!==this.currentPremultipledAlpha){if(this.currentBlendEquation===de&&this.currentBlendEquationAlpha===de||(A.blendEquation(A.FUNC_ADD),this.currentBlendEquation=de,this.currentBlendEquationAlpha=de),a)switch(e){case ee:A.blendFuncSeparate(A.ONE,A.ONE_MINUS_SRC_ALPHA,A.ONE,A.ONE_MINUS_SRC_ALPHA);break;case mt:A.blendFunc(A.ONE,A.ONE);break;case ft:A.blendFuncSeparate(A.ZERO,A.ONE_MINUS_SRC_COLOR,A.ZERO,A.ONE);break;case pt:A.blendFuncSeparate(A.ZERO,A.SRC_COLOR,A.ZERO,A.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case ee:A.blendFuncSeparate(A.SRC_ALPHA,A.ONE_MINUS_SRC_ALPHA,A.ONE,A.ONE_MINUS_SRC_ALPHA);break;case mt:A.blendFunc(A.SRC_ALPHA,A.ONE);break;case ft:A.blendFuncSeparate(A.ZERO,A.ONE_MINUS_SRC_COLOR,A.ZERO,A.ONE);break;case pt:A.blendFunc(A.ZERO,A.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=a}}else!0===this.currentBlendingEnabled&&(this.disable(A.BLEND),this.currentBlendingEnabled=!1)}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case Tt:t.depthFunc(t.NEVER);break;case wt:t.depthFunc(t.ALWAYS);break;case xt:t.depthFunc(t.LESS);break;case _t:t.depthFunc(t.LEQUAL);break;case vt:t.depthFunc(t.EQUAL);break;case bt:t.depthFunc(t.GEQUAL);break;case yt:t.depthFunc(t.GREATER);break;case gt:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,r,n){const i=this._tempVec4.set(e,t,r,n);if(!1===this.currentScissor.equals(i)){const{gl:e}=this;e.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,r,n){const i=this._tempVec4.set(e,t,r,n);if(!1===this.currentViewport.equals(i)){const{gl:e}=this;e.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,r){this.currentStencilFunc===e&&this.currentStencilRef===t&&this.currentStencilFuncMask===r||(this.gl.stencilFunc(e,t,r),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=r)}setStencilOp(e,t,r){this.currentStencilFail===e&&this.currentStencilZFail===t&&this.currentStencilZPass===r||(this.gl.stencilOp(e,t,r),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=r)}setMaterial(e,t,r){const{gl:n}=this;e.side===k?this.disable(n.CULL_FACE):this.enable(n.CULL_FACE);let i=e.side===O;t&&(i=!i),this.setFlipSided(i),e.blending===ee&&!1===e.transparent?this.setBlending(dt):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const o=e.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage&&this.backend.renderer.samples>1?this.enable(n.SAMPLE_ALPHA_TO_COVERAGE):this.disable(n.SAMPLE_ALPHA_TO_COVERAGE),r>0&&this.currentClippingPlanes!==r){const e=12288;for(let t=0;t<8;t++)t<r?this.enable(e+t):this.disable(e+t)}}setPolygonOffset(e,t,r){const{gl:n}=this;e?(this.enable(n.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===t&&this.currentPolygonOffsetUnits===r||(n.polygonOffset(t,r),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=r)):this.disable(n.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e&&(this.gl.useProgram(e),this.currentProgram=e,!0)}setVertexState(e,t=null){const r=this.gl;return(this.currentVAO!==e||this.currentIndex!==t)&&(r.bindVertexArray(e),null!==t&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0)}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:r,currentBoundFramebuffers:n}=this;return n[e]!==t&&(r.bindFramebuffer(e,t),n[e]=t,e===r.DRAW_FRAMEBUFFER&&(n[r.FRAMEBUFFER]=t),e===r.FRAMEBUFFER&&(n[r.DRAW_FRAMEBUFFER]=t),!0)}drawBuffers(e,t){const{gl:r}=this;let n=[],i=!1;if(null!==e.textures){n=this.currentDrawbuffers.get(t),void 0===n&&(n=[],this.currentDrawbuffers.set(t,n));const o=e.textures;if(n.length!==o.length||n[0]!==r.COLOR_ATTACHMENT0){for(let e=0,t=o.length;e<t;e++)n[e]=r.COLOR_ATTACHMENT0+e;n.length=o.length,i=!0}}else n[0]!==r.BACK&&(n[0]=r.BACK,i=!0);i&&r.drawBuffers(n)}activeTexture(e){const{gl:t,currentTextureSlot:r,maxTextures:n}=this;void 0===e&&(e=t.TEXTURE0+n-1),r!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,r){const{gl:n,currentTextureSlot:i,currentBoundTextures:o,maxTextures:s}=this;void 0===r&&(r=null===i?n.TEXTURE0+s-1:i);let a=o[r];void 0===a&&(a={type:void 0,texture:void 0},o[r]=a),a.type===e&&a.texture===t||(i!==r&&(n.activeTexture(r),this.currentTextureSlot=r),n.bindTexture(e,t),a.type=e,a.texture=t)}bindBufferBase(e,t,r){const{gl:n}=this,i=`${e}-${t}`;return this.currentBoundBufferBases[i]!==r&&(n.bindBufferBase(e,t,r),this.currentBoundBufferBases[i]=r,!0)}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:r}=this,n=r[t];void 0!==n&&void 0!==n.type&&(e.bindTexture(n.type,null),n.type=void 0,n.texture=void 0)}}class lq{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Xe){const{gl:r,extensions:n}=this;let i;const o=$e.getTransfer(t);if(e===ae)return r.UNSIGNED_BYTE;if(e===St)return r.UNSIGNED_SHORT_4_4_4_4;if(e===Et)return r.UNSIGNED_SHORT_5_5_5_1;if(e===Mt)return r.UNSIGNED_INT_5_9_9_9_REV;if(e===Nt)return r.BYTE;if(e===Ct)return r.SHORT;if(e===Rt)return r.UNSIGNED_SHORT;if(e===Re)return r.INT;if(e===le)return r.UNSIGNED_INT;if(e===Ke)return r.FLOAT;if(e===S)return r.HALF_FLOAT;if(e===Pt)return r.ALPHA;if(e===Dt)return r.RGB;if(e===B)return r.RGBA;if(e===ce)return r.DEPTH_COMPONENT;if(e===ue)return r.DEPTH_STENCIL;if(e===Bt)return r.RED;if(e===qt)return r.RED_INTEGER;if(e===Ot)return r.RG;if(e===Lt)return r.RG_INTEGER;if(e===kt)return r.RGBA_INTEGER;if(e===It||e===Ft||e===Ut||e===Vt)if(o===Ye){if(i=n.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(e===It)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Ft)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Ut)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Vt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=n.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===It)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ft)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ut)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Vt)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Gt||e===jt||e===zt||e===Ht){if(i=n.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===Gt)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===jt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===zt)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Ht)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Wt||e===Qt||e===$t){if(i=n.get("WEBGL_compressed_texture_etc"),null===i)return null;if(e===Wt||e===Qt)return o===Ye?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===$t)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(e===Yt||e===Xt||e===Kt||e===Zt||e===Jt||e===er||e===tr||e===rr||e===nr||e===ir||e===or||e===sr||e===ar||e===Ar){if(i=n.get("WEBGL_compressed_texture_astc"),null===i)return null;if(e===Yt)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Xt)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Kt)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Zt)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Jt)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===er)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===tr)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===rr)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===nr)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===ir)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===or)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===sr)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===ar)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Ar)return o===Ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===lr){if(i=n.get("EXT_texture_compression_bptc"),null===i)return null;if(e===lr)return o===Ye?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(e===ur||e===cr||e===hr||e===dr){if(i=n.get("EXT_texture_compression_rgtc"),null===i)return null;if(e===lr)return i.COMPRESSED_RED_RGTC1_EXT;if(e===cr)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===hr)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===dr)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===Ae?r.UNSIGNED_INT_24_8:void 0!==r[e]?r[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((r,n)=>{!function i(){const o=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(o===e.WAIT_FAILED)return e.deleteSync(t),void n();o!==e.TIMEOUT_EXPIRED?(e.deleteSync(t),r()):requestAnimationFrame(i)}()})}}let uq,cq,hq,dq=!1;class pq{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},!1===dq&&(this._init(),dq=!0)}_init(){const e=this.gl;uq={[Be]:e.REPEAT,[De]:e.CLAMP_TO_EDGE,[Pe]:e.MIRRORED_REPEAT},cq={[Ie]:e.NEAREST,[ke]:e.NEAREST_MIPMAP_NEAREST,[Le]:e.NEAREST_MIPMAP_LINEAR,[P]:e.LINEAR,[Oe]:e.LINEAR_MIPMAP_NEAREST,[qe]:e.LINEAR_MIPMAP_LINEAR},hq={[We]:e.NEVER,[He]:e.ALWAYS,[ze]:e.LESS,[je]:e.LEQUAL,[Ge]:e.EQUAL,[Ve]:e.GEQUAL,[Ue]:e.GREATER,[Fe]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let r;return r=!0===e.isCubeTexture?t.TEXTURE_CUBE_MAP:!0===e.isArrayTexture||!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:!0===e.isData3DTexture?t.TEXTURE_3D:t.TEXTURE_2D,r}getInternalFormat(e,t,r,n,i=!1){const{gl:o,extensions:s}=this;if(null!==e){if(void 0!==o[e])return o[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let a=t;if(t===o.RED&&(r===o.FLOAT&&(a=o.R32F),r===o.HALF_FLOAT&&(a=o.R16F),r===o.UNSIGNED_BYTE&&(a=o.R8),r===o.UNSIGNED_SHORT&&(a=o.R16),r===o.UNSIGNED_INT&&(a=o.R32UI),r===o.BYTE&&(a=o.R8I),r===o.SHORT&&(a=o.R16I),r===o.INT&&(a=o.R32I)),t===o.RED_INTEGER&&(r===o.UNSIGNED_BYTE&&(a=o.R8UI),r===o.UNSIGNED_SHORT&&(a=o.R16UI),r===o.UNSIGNED_INT&&(a=o.R32UI),r===o.BYTE&&(a=o.R8I),r===o.SHORT&&(a=o.R16I),r===o.INT&&(a=o.R32I)),t===o.RG&&(r===o.FLOAT&&(a=o.RG32F),r===o.HALF_FLOAT&&(a=o.RG16F),r===o.UNSIGNED_BYTE&&(a=o.RG8),r===o.UNSIGNED_SHORT&&(a=o.RG16),r===o.UNSIGNED_INT&&(a=o.RG32UI),r===o.BYTE&&(a=o.RG8I),r===o.SHORT&&(a=o.RG16I),r===o.INT&&(a=o.RG32I)),t===o.RG_INTEGER&&(r===o.UNSIGNED_BYTE&&(a=o.RG8UI),r===o.UNSIGNED_SHORT&&(a=o.RG16UI),r===o.UNSIGNED_INT&&(a=o.RG32UI),r===o.BYTE&&(a=o.RG8I),r===o.SHORT&&(a=o.RG16I),r===o.INT&&(a=o.RG32I)),t===o.RGB){const e=i?Qe:$e.getTransfer(n);r===o.FLOAT&&(a=o.RGB32F),r===o.HALF_FLOAT&&(a=o.RGB16F),r===o.UNSIGNED_BYTE&&(a=o.RGB8),r===o.UNSIGNED_SHORT&&(a=o.RGB16),r===o.UNSIGNED_INT&&(a=o.RGB32UI),r===o.BYTE&&(a=o.RGB8I),r===o.SHORT&&(a=o.RGB16I),r===o.INT&&(a=o.RGB32I),r===o.UNSIGNED_BYTE&&(a=e===Ye?o.SRGB8:o.RGB8),r===o.UNSIGNED_SHORT_5_6_5&&(a=o.RGB565),r===o.UNSIGNED_SHORT_5_5_5_1&&(a=o.RGB5_A1),r===o.UNSIGNED_SHORT_4_4_4_4&&(a=o.RGB4),r===o.UNSIGNED_INT_5_9_9_9_REV&&(a=o.RGB9_E5)}if(t===o.RGB_INTEGER&&(r===o.UNSIGNED_BYTE&&(a=o.RGB8UI),r===o.UNSIGNED_SHORT&&(a=o.RGB16UI),r===o.UNSIGNED_INT&&(a=o.RGB32UI),r===o.BYTE&&(a=o.RGB8I),r===o.SHORT&&(a=o.RGB16I),r===o.INT&&(a=o.RGB32I)),t===o.RGBA){const e=i?Qe:$e.getTransfer(n);r===o.FLOAT&&(a=o.RGBA32F),r===o.HALF_FLOAT&&(a=o.RGBA16F),r===o.UNSIGNED_BYTE&&(a=o.RGBA8),r===o.UNSIGNED_SHORT&&(a=o.RGBA16),r===o.UNSIGNED_INT&&(a=o.RGBA32UI),r===o.BYTE&&(a=o.RGBA8I),r===o.SHORT&&(a=o.RGBA16I),r===o.INT&&(a=o.RGBA32I),r===o.UNSIGNED_BYTE&&(a=e===Ye?o.SRGB8_ALPHA8:o.RGBA8),r===o.UNSIGNED_SHORT_4_4_4_4&&(a=o.RGBA4),r===o.UNSIGNED_SHORT_5_5_5_1&&(a=o.RGB5_A1)}return t===o.RGBA_INTEGER&&(r===o.UNSIGNED_BYTE&&(a=o.RGBA8UI),r===o.UNSIGNED_SHORT&&(a=o.RGBA16UI),r===o.UNSIGNED_INT&&(a=o.RGBA32UI),r===o.BYTE&&(a=o.RGBA8I),r===o.SHORT&&(a=o.RGBA16I),r===o.INT&&(a=o.RGBA32I)),t===o.DEPTH_COMPONENT&&(r===o.UNSIGNED_SHORT&&(a=o.DEPTH_COMPONENT16),r===o.UNSIGNED_INT&&(a=o.DEPTH_COMPONENT24),r===o.FLOAT&&(a=o.DEPTH_COMPONENT32F)),t===o.DEPTH_STENCIL&&r===o.UNSIGNED_INT_24_8&&(a=o.DEPTH24_STENCIL8),a!==o.R16F&&a!==o.R32F&&a!==o.RG16F&&a!==o.RG32F&&a!==o.RGBA16F&&a!==o.RGBA32F||s.get("EXT_color_buffer_float"),a}setTextureParameters(e,t){const{gl:r,extensions:n,backend:i}=this,o=$e.getPrimaries($e.workingColorSpace),s=t.colorSpace===Xe?null:$e.getPrimaries(t.colorSpace),a=t.colorSpace===Xe||o===s?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,t.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,a),r.texParameteri(e,r.TEXTURE_WRAP_S,uq[t.wrapS]),r.texParameteri(e,r.TEXTURE_WRAP_T,uq[t.wrapT]),e!==r.TEXTURE_3D&&e!==r.TEXTURE_2D_ARRAY||t.isArrayTexture||r.texParameteri(e,r.TEXTURE_WRAP_R,uq[t.wrapR]),r.texParameteri(e,r.TEXTURE_MAG_FILTER,cq[t.magFilter]);const A=void 0!==t.mipmaps&&t.mipmaps.length>0,l=t.minFilter===P&&A?qe:t.minFilter;if(r.texParameteri(e,r.TEXTURE_MIN_FILTER,cq[l]),t.compareFunction&&(r.texParameteri(e,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(e,r.TEXTURE_COMPARE_FUNC,hq[t.compareFunction])),!0===n.has("EXT_texture_filter_anisotropic")){if(t.magFilter===Ie)return;if(t.minFilter!==Le&&t.minFilter!==qe)return;if(t.type===Ke&&!1===n.has("OES_texture_float_linear"))return;if(t.anisotropy>1){const o=n.get("EXT_texture_filter_anisotropic");r.texParameterf(e,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:r,defaultTextures:n}=this,i=this.getGLTextureType(e);let o=n[i];void 0===o&&(o=t.createTexture(),r.state.bindTexture(i,o),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),n[i]=o),r.set(e,{textureGPU:o,glTextureType:i,isDefault:!0})}createTexture(e,t){const{gl:r,backend:n}=this,{levels:i,width:o,height:s,depth:a}=t,A=n.utils.convert(e.format,e.colorSpace),l=n.utils.convert(e.type),u=this.getInternalFormat(e.internalFormat,A,l,e.colorSpace,e.isVideoTexture),c=r.createTexture(),h=this.getGLTextureType(e);n.state.bindTexture(h,c),this.setTextureParameters(h,e),e.isArrayTexture||e.isDataArrayTexture||e.isCompressedArrayTexture?r.texStorage3D(r.TEXTURE_2D_ARRAY,i,u,o,s,a):e.isData3DTexture?r.texStorage3D(r.TEXTURE_3D,i,u,o,s,a):e.isVideoTexture||r.texStorage2D(h,i,u,o,s),n.set(e,{textureGPU:c,glTextureType:h,glFormat:A,glType:l,glInternalFormat:u})}copyBufferToTexture(e,t){const{gl:r,backend:n}=this,{textureGPU:i,glTextureType:o,glFormat:s,glType:a}=n.get(t),{width:A,height:l}=t.source.data;r.bindBuffer(r.PIXEL_UNPACK_BUFFER,e),n.state.bindTexture(o,i),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.texSubImage2D(o,0,0,0,A,l,s,a,0),r.bindBuffer(r.PIXEL_UNPACK_BUFFER,null),n.state.unbindTexture()}updateTexture(e,t){const{gl:r}=this,{width:n,height:i}=t,{textureGPU:o,glTextureType:s,glFormat:a,glType:A,glInternalFormat:l}=this.backend.get(e);if(!e.isRenderTargetTexture&&void 0!==o)if(this.backend.state.bindTexture(s,o),this.setTextureParameters(s,e),e.isCompressedTexture){const n=e.mipmaps,i=t.image;for(let t=0;t<n.length;t++){const o=n[t];e.isCompressedArrayTexture?e.format!==r.RGBA?null!==a?r.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,t,0,0,0,o.width,o.height,i.depth,a,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texSubImage3D(r.TEXTURE_2D_ARRAY,t,0,0,0,o.width,o.height,i.depth,a,A,o.data):null!==a?r.compressedTexSubImage2D(r.TEXTURE_2D,t,0,0,o.width,o.height,a,o.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const e=t.images;for(let t=0;t<6;t++){const o=fq(e[t]);r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,n,i,a,A,o)}}else if(e.isDataArrayTexture||e.isArrayTexture){const e=t.image;r.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,e.width,e.height,e.depth,a,A,e.data)}else if(e.isData3DTexture){const e=t.image;r.texSubImage3D(r.TEXTURE_3D,0,0,0,0,e.width,e.height,e.depth,a,A,e.data)}else if(e.isVideoTexture)e.update(),r.texImage2D(s,0,l,a,A,t.image);else{const e=fq(t.image);r.texSubImage2D(s,0,0,0,n,i,a,A,e)}}generateMipmaps(e){const{gl:t,backend:r}=this,{textureGPU:n,glTextureType:i}=r.get(e);r.state.bindTexture(i,n),t.generateMipmap(i)}deallocateRenderBuffers(e){const{gl:t,backend:r}=this;if(e){const n=r.get(e);if(n.renderBufferStorageSetup=void 0,n.framebuffers){for(const e in n.framebuffers)t.deleteFramebuffer(n.framebuffers[e]);delete n.framebuffers}if(n.depthRenderbuffer&&(t.deleteRenderbuffer(n.depthRenderbuffer),delete n.depthRenderbuffer),n.stencilRenderbuffer&&(t.deleteRenderbuffer(n.stencilRenderbuffer),delete n.stencilRenderbuffer),n.msaaFrameBuffer&&(t.deleteFramebuffer(n.msaaFrameBuffer),delete n.msaaFrameBuffer),n.msaaRenderbuffers){for(let e=0;e<n.msaaRenderbuffers.length;e++)t.deleteRenderbuffer(n.msaaRenderbuffers[e]);delete n.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:r}=this,{textureGPU:n,renderTarget:i}=r.get(e);this.deallocateRenderBuffers(i),t.deleteTexture(n),r.delete(e)}copyTextureToTexture(e,t,r=null,n=null,i=0,o=0){const{gl:s,backend:a}=this,{state:A}=this.backend,{textureGPU:l,glTextureType:u,glType:c,glFormat:h}=a.get(t);let d,p,f,m,g,y,b,v,_;A.bindTexture(u,l);const x=e.isCompressedTexture?e.mipmaps[o]:e.image;if(null!==r)d=r.max.x-r.min.x,p=r.max.y-r.min.y,f=r.isBox3?r.max.z-r.min.z:1,m=r.min.x,g=r.min.y,y=r.isBox3?r.min.z:0;else{const t=Math.pow(2,-i);d=Math.floor(x.width*t),p=Math.floor(x.height*t),f=e.isDataArrayTexture||e.isArrayTexture?x.depth:e.isData3DTexture?Math.floor(x.depth*t):1,m=0,g=0,y=0}null!==n?(b=n.x,v=n.y,_=n.z):(b=0,v=0,_=0),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment);const w=s.getParameter(s.UNPACK_ROW_LENGTH),T=s.getParameter(s.UNPACK_IMAGE_HEIGHT),S=s.getParameter(s.UNPACK_SKIP_PIXELS),E=s.getParameter(s.UNPACK_SKIP_ROWS),M=s.getParameter(s.UNPACK_SKIP_IMAGES);s.pixelStorei(s.UNPACK_ROW_LENGTH,x.width),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,x.height),s.pixelStorei(s.UNPACK_SKIP_PIXELS,m),s.pixelStorei(s.UNPACK_SKIP_ROWS,g),s.pixelStorei(s.UNPACK_SKIP_IMAGES,y);const N=t.isDataArrayTexture||t.isData3DTexture||t.isArrayTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const r=a.get(e),n=a.get(t),i=a.get(r.renderTarget),o=a.get(n.renderTarget),l=i.framebuffers[r.cacheKey],u=o.framebuffers[n.cacheKey];A.bindFramebuffer(s.READ_FRAMEBUFFER,l),A.bindFramebuffer(s.DRAW_FRAMEBUFFER,u);let c=s.COLOR_BUFFER_BIT;e.isDepthTexture&&(c=s.DEPTH_BUFFER_BIT),s.blitFramebuffer(m,g,d,p,b,v,d,p,c,s.NEAREST),A.bindFramebuffer(s.READ_FRAMEBUFFER,null),A.bindFramebuffer(s.DRAW_FRAMEBUFFER,null)}else N?e.isDataTexture||e.isData3DTexture?s.texSubImage3D(u,o,b,v,_,d,p,f,h,c,x.data):t.isCompressedArrayTexture?s.compressedTexSubImage3D(u,o,b,v,_,d,p,f,h,x.data):s.texSubImage3D(u,o,b,v,_,d,p,f,h,c,x):e.isDataTexture?s.texSubImage2D(u,o,b,v,d,p,h,c,x.data):e.isCompressedTexture?s.compressedTexSubImage2D(u,o,b,v,x.width,x.height,h,x.data):s.texSubImage2D(u,o,b,v,d,p,h,c,x);s.pixelStorei(s.UNPACK_ROW_LENGTH,w),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,T),s.pixelStorei(s.UNPACK_SKIP_PIXELS,S),s.pixelStorei(s.UNPACK_SKIP_ROWS,E),s.pixelStorei(s.UNPACK_SKIP_IMAGES,M),0===o&&t.generateMipmaps&&s.generateMipmap(u),A.unbindTexture()}copyFramebufferToTexture(e,t,r){const{gl:n}=this,{state:i}=this.backend,{textureGPU:o}=this.backend.get(e),{x:s,y:a,z:A,w:l}=r,u=!0===e.isDepthTexture||t.renderTarget&&t.renderTarget.samples>0,c=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(u){const r=0!==s||0!==a;let u,h;if(!0===e.isDepthTexture?(u=n.DEPTH_BUFFER_BIT,h=n.DEPTH_ATTACHMENT,t.stencil&&(u|=n.STENCIL_BUFFER_BIT)):(u=n.COLOR_BUFFER_BIT,h=n.COLOR_ATTACHMENT0),r){const e=this.backend.get(t.renderTarget),r=e.framebuffers[t.getCacheKey()],h=e.msaaFrameBuffer;i.bindFramebuffer(n.DRAW_FRAMEBUFFER,r),i.bindFramebuffer(n.READ_FRAMEBUFFER,h);const d=c-a-l;n.blitFramebuffer(s,d,s+A,d+l,s,d,s+A,d+l,u,n.NEAREST),i.bindFramebuffer(n.READ_FRAMEBUFFER,r),i.bindTexture(n.TEXTURE_2D,o),n.copyTexSubImage2D(n.TEXTURE_2D,0,0,0,s,d,A,l),i.unbindTexture()}else{const e=n.createFramebuffer();i.bindFramebuffer(n.DRAW_FRAMEBUFFER,e),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,h,n.TEXTURE_2D,o,0),n.blitFramebuffer(0,0,A,l,0,0,A,l,u,n.NEAREST),n.deleteFramebuffer(e)}}else i.bindTexture(n.TEXTURE_2D,o),n.copyTexSubImage2D(n.TEXTURE_2D,0,0,0,s,c-l-a,A,l),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,r,n=!1){const{gl:i}=this,o=t.renderTarget,{depthTexture:s,depthBuffer:a,stencilBuffer:A,width:l,height:u}=o;if(i.bindRenderbuffer(i.RENDERBUFFER,e),a&&!A){let t=i.DEPTH_COMPONENT24;if(!0===n){this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,o.samples,t,l,u)}else r>0?(s&&s.isDepthTexture&&s.type===i.FLOAT&&(t=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,r,t,l,u)):i.renderbufferStorage(i.RENDERBUFFER,t,l,u);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else a&&A&&(r>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,r,i.DEPTH24_STENCIL8,l,u):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,l,u),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,r,n,i,o){const{backend:s,gl:a}=this,{textureGPU:A,glFormat:l,glType:u}=this.backend.get(e),c=a.createFramebuffer();a.bindFramebuffer(a.READ_FRAMEBUFFER,c);const h=e.isCubeTexture?a.TEXTURE_CUBE_MAP_POSITIVE_X+o:a.TEXTURE_2D;a.framebufferTexture2D(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,h,A,0);const d=this._getTypedArrayType(u),p=n*i*this._getBytesPerTexel(u,l),f=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,f),a.bufferData(a.PIXEL_PACK_BUFFER,p,a.STREAM_READ),a.readPixels(t,r,n,i,l,u,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),await s.utils._clientWaitAsync();const m=new d(p/d.BYTES_PER_ELEMENT);return a.bindBuffer(a.PIXEL_PACK_BUFFER,f),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,m),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteFramebuffer(c),m}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:r}=this;let n=0;return e===r.UNSIGNED_BYTE&&(n=1),e!==r.UNSIGNED_SHORT_4_4_4_4&&e!==r.UNSIGNED_SHORT_5_5_5_1&&e!==r.UNSIGNED_SHORT_5_6_5&&e!==r.UNSIGNED_SHORT&&e!==r.HALF_FLOAT||(n=2),e!==r.UNSIGNED_INT&&e!==r.FLOAT||(n=4),t===r.RGBA?4*n:t===r.RGB?3*n:t===r.ALPHA?n:void 0}}function fq(e){return e.isDataTexture?e.image.data:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e:e.data}class mq{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return void 0===t&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class gq{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(!0===t.has("EXT_texture_filter_anisotropic")){const r=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const yq={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class bq{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:r,mode:n,object:i,type:o,info:s,index:a}=this;0!==a?r.drawElements(n,t,o,e):r.drawArrays(n,e,t),s.update(i,t,1)}renderInstances(e,t,r){const{gl:n,mode:i,type:o,index:s,object:a,info:A}=this;0!==r&&(0!==s?n.drawElementsInstanced(i,t,o,e,r):n.drawArraysInstanced(i,e,t,r),A.update(a,t,r))}renderMultiDraw(e,t,r){const{extensions:n,mode:i,object:o,info:s}=this;if(0===r)return;const a=n.get("WEBGL_multi_draw");if(null===a)for(let A=0;A<r;A++)this.render(e[A],t[A]);else{0!==this.index?a.multiDrawElementsWEBGL(i,t,0,this.type,e,0,r):a.multiDrawArraysWEBGL(i,e,0,t,0,r);let n=0;for(let e=0;e<r;e++)n+=t[e];s.update(o,n,1)}}renderMultiDrawInstances(e,t,r,n){const{extensions:i,mode:o,object:s,info:a}=this;if(0===r)return;const A=i.get("WEBGL_multi_draw");if(null===A)for(let l=0;l<r;l++)this.renderInstances(e[l],t[l],n[l]);else{0!==this.index?A.multiDrawElementsInstancedWEBGL(o,t,0,this.type,e,0,n,0,r):A.multiDrawArraysInstancedWEBGL(o,e,0,t,0,n,0,r);let i=0;for(let e=0;e<r;e++)i+=t[e]*n[e];a.update(s,i,1)}}}class vq{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class _q extends vq{constructor(e,t,r=2048){if(super(r),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext)return console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),void(this.trackTimestamp=!1);this.queries=[];for(let n=0;n<this.maxQueries;n++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return Me(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null==t)return;if(null!==this.activeQuery)return;const r=this.queries[t];if(r)try{"inactive"===this.queryStates.get(t)&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,r),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(n){console.error("Error in beginQuery:",n),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null!=t&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(r){console.error("Error in endQuery:",r),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[r,n]of this.queryStates)if("ended"===n){const t=this.queries[r];e.push(this.resolveQuery(t))}if(0===e.length)return this.lastValue;const t=(await Promise.all(e)).reduce((e,t)=>e+t,0);return this.lastValue=t,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,t}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed)return void t(this.lastValue);let r,n=!1;const i=e=>{n||(n=!0,r&&(clearTimeout(r),r=null),t(e))},o=()=>{if(this.isDisposed)i(this.lastValue);else try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))return void i(this.lastValue);if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE))return void(r=setTimeout(o,1));const n=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(n)/1e6)}catch(n){console.error("Error checking query:",n),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}const xq=new n;class wq extends rq{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,r={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},n=void 0!==t.context?t.context:e.domElement.getContext("webgl2",r);function i(t){t.preventDefault();const r={api:"WebGL",message:t.statusMessage||"Unknown reason",reason:null,originalEvent:t};e.onDeviceLost(r)}this._onContextLost=i,e.domElement.addEventListener("webglcontextlost",i,!1),this.gl=n,this.extensions=new mq(this),this.capabilities=new gq(this),this.attributeUtils=new aq(this),this.textureUtils=new pq(this),this.bufferRenderer=new bq(this),this.state=new Aq(this),this.utils=new lq(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return I}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){!0!==this.gl.getContextAttributes().xrCompatible&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,r=null){const n=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:n.RGBA8}),null!==r){const t=e.stencilBuffer?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:r,glInternalFormat:t}),!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!0===e.autoAllocateDepthBuffer&&!1===e.multiview&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new _q(this.gl,t,2048));const r=this.timestampQueryPool[t];null!==r.allocateQueriesForContext(e)&&r.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t}=this,r=this.get(e);if(e.viewport)this.updateViewport(e);else{const{width:e,height:r}=this.getDrawingBufferSize(xq);t.viewport(0,0,e,r)}if(e.scissor){const{x:r,y:n,width:i,height:o}=e.scissorValue;t.scissor(r,e.height-o-n,i,o)}this.initTimestampQuery(e),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const n=e.occlusionQueryCount;n>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(n),r.occlusionQueryObjects=new Array(n),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:r}=this,n=this.get(e),i=n.previousContext;r.resetVertexState();const o=e.occlusionQueryCount;o>0&&(o>n.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const s=e.textures;if(null!==s)for(let a=0;a<s.length;a++){const e=s[a];e.generateMipmaps&&this.generateMipmaps(e)}if(this._currentContext=i,null!==e.textures&&e.renderTarget){const n=this.get(e.renderTarget),{resolveDepthBuffer:i,samples:o}=e.renderTarget;if(o>0&&!1===this._useMultisampledExtension(e.renderTarget)){const i=n.framebuffers[e.getCacheKey()],o=t.COLOR_BUFFER_BIT,s=n.msaaFrameBuffer,a=e.textures;r.bindFramebuffer(t.READ_FRAMEBUFFER,s),r.bindFramebuffer(t.DRAW_FRAMEBUFFER,i);for(let r=0;r<a.length;r++)if(e.scissor){const{x:r,y:i,width:s,height:a}=e.scissorValue,A=e.height-a-i;t.blitFramebuffer(r,A,r+s,A+a,r,A,r+s,A+a,o,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,n.invalidationArray,r,A,s,a)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,o,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,n.invalidationArray)}else if(!1===i&&n.framebuffers){const i=n.framebuffers[e.getCacheKey()];r.bindFramebuffer(t.DRAW_FRAMEBUFFER,i),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,n.depthInvalidationArray)}}if(null!==i)if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:e,height:t}=this.getDrawingBufferSize(xq);r.viewport(0,0,e,t)}this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:r,currentOcclusionQueryObjects:n}=t;if(r&&n){const e=new WeakSet,{gl:i}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let s=0;for(let t=0;t<r.length;t++){const o=r[t];null!==o&&(i.getQueryParameter(o,i.QUERY_RESULT_AVAILABLE)&&(0===i.getQueryParameter(o,i.QUERY_RESULT)&&e.add(n[t]),r[t]=null,i.deleteQuery(o),s++))}s<r.length?requestAnimationFrame(o):t.occluded=e};o()}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:r,y:n,width:i,height:o}=e.viewportValue;t.viewport(r,e.height-o-n,i,o)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,r,n=null,i=!0){const{gl:o,renderer:s}=this;if(null===n){n={textures:null,clearColorValue:this.getClearColor()}}let a=0;if(e&&(a|=o.COLOR_BUFFER_BIT),t&&(a|=o.DEPTH_BUFFER_BIT),r&&(a|=o.STENCIL_BUFFER_BIT),0!==a){let A;A=n.clearColorValue?n.clearColorValue:this.getClearColor();const l=s.getClearDepth(),u=s.getClearStencil();if(t&&this.state.setDepthMask(!0),null===n.textures)o.clearColor(A.r,A.g,A.b,A.a),o.clear(a);else{if(i&&this._setFramebuffer(n),e)for(let e=0;e<n.textures.length;e++)0===e?o.clearBufferfv(o.COLOR,e,[A.r,A.g,A.b,A.a]):o.clearBufferfv(o.COLOR,e,[0,0,0,1]);t&&r?o.clearBufferfi(o.DEPTH_STENCIL,0,l,u):t?o.clearBufferfv(o.DEPTH,0,[l]):r&&o.clearBufferiv(o.STENCIL,0,[u])}}}beginCompute(e){const{state:t,gl:r}=this;t.bindFramebuffer(r.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,r,n){const{state:i,gl:o}=this;!1===this.discard&&(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:s,transformBuffers:a,attributes:A}=this.get(n),l=this._getVaoKey(A),u=this.vaoCache[l];void 0===u?this._createVao(A):i.setVertexState(u),i.useProgram(s),this._bindUniforms(r);const c=this._getTransformFeedback(a);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,c),o.beginTransformFeedback(o.POINTS),A[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,t.count):o.drawArrays(o.POINTS,0,t.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let h=0;h<a.length;h++){const e=a[h];e.pbo&&this.textureUtils.copyBufferToTexture(e.transformBuffer,e.pbo),e.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.isArrayTexture&&e.camera.isArrayCamera}draw(e){const{object:t,pipeline:r,material:n,context:i,hardwareClippingPlanes:o}=e,{programGPU:s}=this.get(r),{gl:a,state:A}=this,l=this.get(i),u=e.getDrawParameters();if(null===u)return;this._bindUniforms(e.getBindings());const c=t.isMesh&&t.matrixWorld.determinant()<0;A.setMaterial(n,c,o),A.useProgram(s);const h=this.get(e);let d=h.staticVao;if(void 0===d||h.geometryId!==e.geometry.id){const t=this._getVaoKey(e.getAttributes());if(d=this.vaoCache[t],void 0===d){let t;({vaoGPU:d,staticVao:t}=this._createVao(e.getAttributes())),t&&(h.staticVao=d,h.geometryId=e.geometry.id)}}const p=e.getIndex(),f=null!==p?this.get(p).bufferGPU:null;A.setVertexState(d,f);const m=l.lastOcclusionObject;if(m!==t&&void 0!==m){if(null!==m&&!0===m.occlusionTest&&(a.endQuery(a.ANY_SAMPLES_PASSED),l.occlusionQueryIndex++),!0===t.occlusionTest){const e=a.createQuery();a.beginQuery(a.ANY_SAMPLES_PASSED,e),l.occlusionQueries[l.occlusionQueryIndex]=e,l.occlusionQueryObjects[l.occlusionQueryIndex]=t}l.lastOcclusionObject=t}const g=this.bufferRenderer;t.isPoints?g.mode=a.POINTS:t.isLineSegments?g.mode=a.LINES:t.isLine?g.mode=a.LINE_STRIP:t.isLineLoop?g.mode=a.LINE_LOOP:!0===n.wireframe?(A.setLineWidth(n.wireframeLinewidth*this.renderer.getPixelRatio()),g.mode=a.LINES):g.mode=a.TRIANGLES;const{vertexCount:y,instanceCount:b}=u;let{firstVertex:v}=u;if(g.object=t,null!==p){v*=p.array.BYTES_PER_ELEMENT;const e=this.get(p);g.index=p.count,g.type=e.type}else g.index=0;const _=()=>{t.isBatchedMesh?null!==t._multiDrawInstances?(Me("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),g.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?g.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Me("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):b>1?g.renderInstances(v,y,b):g.render(v,y)};if(!0===e.camera.isArrayCamera&&e.camera.cameras.length>0&&!1===e.camera.isMultiViewCamera){const r=this.get(e.camera),n=e.camera.cameras,i=e.getBindingGroup("cameraIndex").bindings[0];if(void 0===r.indexesGPU||r.indexesGPU.length!==n.length){const e=new Uint32Array([0,0,0,0]),t=[];for(let r=0,i=n.length;r<i;r++){const n=a.createBuffer();e[0]=r,a.bindBuffer(a.UNIFORM_BUFFER,n),a.bufferData(a.UNIFORM_BUFFER,e,a.STATIC_DRAW),t.push(n)}r.indexesGPU=t}const o=this.get(i),s=this.renderer.getPixelRatio(),l=this._currentContext.renderTarget,u=this._isRenderCameraDepthArray(this._currentContext),c=this._currentContext.activeCubeFace;if(u){const e=this.get(l.depthTexture);if(e.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){e.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:t}=l;for(let e=0,r=n.length;e<r;e++)this.renderer._activeCubeFace=e,this._currentContext.activeCubeFace=e,this._setFramebuffer(this._currentContext),this.clear(!1,!0,t,this._currentContext,!1);this.renderer._activeCubeFace=c,this._currentContext.activeCubeFace=c}}for(let h=0,d=n.length;h<d;h++){const i=n[h];if(t.layers.test(i.layers)){u&&(this.renderer._activeCubeFace=h,this._currentContext.activeCubeFace=h,this._setFramebuffer(this._currentContext));const t=i.viewport;if(void 0!==t){const r=t.x*s,n=t.y*s,i=t.width*s,o=t.height*s;A.viewport(Math.floor(r),Math.floor(e.context.height-o-n),Math.floor(i),Math.floor(o))}A.bindBufferBase(a.UNIFORM_BUFFER,o.index,r.indexesGPU[h]),_()}this._currentContext.activeCubeFace=c,this.renderer._activeCubeFace=c}}else _()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,r,n,i,o){return this.textureUtils.copyTextureToBuffer(e,t,r,n,i,o)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new JB(e,t)}createProgram(e){const t=this.gl,{stage:r,code:n}=e,i="fragment"===r?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,n),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const r=this.gl,n=e.pipeline,{fragmentProgram:i,vertexProgram:o}=n,s=r.createProgram(),a=this.get(i).shaderGPU,A=this.get(o).shaderGPU;if(r.attachShader(s,a),r.attachShader(s,A),r.linkProgram(s),this.set(n,{programGPU:s,fragmentShader:a,vertexShader:A}),null!==t&&this.parallel){const i=new Promise(t=>{const i=this.parallel,o=()=>{r.getProgramParameter(s,i.COMPLETION_STATUS_KHR)?(this._completeCompile(e,n),t()):requestAnimationFrame(o)};o()});return void t.push(i)}this._completeCompile(e,n)}_handleSource(e,t){const r=e.split("\n"),n=[],i=Math.max(t-6,0),o=Math.min(t+6,r.length);for(let s=i;s<o;s++){const e=s+1;n.push(`${e===t?">":" "} ${e}: ${r[s]}`)}return n.join("\n")}_getShaderErrors(e,t,r){const n=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(n&&""===i)return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const n=parseInt(o[1]);return r.toUpperCase()+"\n\n"+i+"\n\n"+this._handleSource(e.getShaderSource(t),n)}return i}_logProgramError(e,t,r){if(this.renderer.debug.checkShaderErrors){const n=this.gl,i=n.getProgramInfoLog(e).trim();if(!1===n.getProgramParameter(e,n.LINK_STATUS))if("function"==typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(n,e,r,t);else{const o=this._getShaderErrors(n,r,"vertex"),s=this._getShaderErrors(n,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(e,n.VALIDATE_STATUS)+"\n\nProgram Info Log: "+i+"\n"+o+"\n"+s)}else""!==i&&console.warn("THREE.WebGLProgram: Program Info Log:",i)}}_completeCompile(e,t){const{state:r,gl:n}=this,i=this.get(t),{programGPU:o,fragmentShader:s,vertexShader:a}=i;!1===n.getProgramParameter(o,n.LINK_STATUS)&&this._logProgramError(o,s,a),r.useProgram(o);const A=e.getBindings();this._setupBindings(A,o),this.set(t,{programGPU:o})}createComputePipeline(e,t){const{state:r,gl:n}=this,i={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(i);const{computeProgram:o}=e,s=n.createProgram(),a=this.get(i).shaderGPU,A=this.get(o).shaderGPU,l=o.transforms,u=[],c=[];for(let f=0;f<l.length;f++){const e=l[f];u.push(e.varyingName),c.push(e.attributeNode)}n.attachShader(s,a),n.attachShader(s,A),n.transformFeedbackVaryings(s,u,n.SEPARATE_ATTRIBS),n.linkProgram(s),!1===n.getProgramParameter(s,n.LINK_STATUS)&&this._logProgramError(s,a,A),r.useProgram(s),this._setupBindings(t,s);const h=o.attributes,d=[],p=[];for(let f=0;f<h.length;f++){const e=h[f].node.attribute;d.push(e),this.has(e)||this.attributeUtils.createAttribute(e,n.ARRAY_BUFFER)}for(let f=0;f<c.length;f++){const e=c[f].attribute;this.has(e)||this.attributeUtils.createAttribute(e,n.ARRAY_BUFFER);const t=this.get(e);p.push(t)}this.set(e,{programGPU:s,transformBuffers:p,attributes:d})}createBindings(e,t){if(!1===this._knownBindings.has(t)){this._knownBindings.add(t);let e=0,r=0;for(const n of t){this.set(n,{textures:r,uniformBuffers:e});for(const t of n.bindings)t.isUniformBuffer&&e++,t.isSampledTexture&&r++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,r=this.get(e);let n=r.uniformBuffers,i=r.textures;for(const o of e.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const e=o.buffer,r=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,e,t.DYNAMIC_DRAW),this.set(o,{index:n++,bufferGPU:r})}else if(o.isSampledTexture){const{textureGPU:e,glTextureType:t}=this.get(o.texture);this.set(o,{index:i++,textureGPU:e,glTextureType:t})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const r=this.get(e).bufferGPU,n=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,n,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(yq).filter(t=>yq[t]===e),r=this.extensions;for(let n=0;n<t.length;n++)if(r.has(t[n]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,r=null,n=null,i=0,o=0){this.textureUtils.copyTextureToTexture(e,t,r,n,i,o)}copyFramebufferToTexture(e,t,r){this.textureUtils.copyFramebufferToTexture(e,t,r)}_setFramebuffer(e){const{gl:t,state:r}=this;let n=null;if(null!==e.textures){const i=e.renderTarget,o=this.get(i),{samples:s,depthBuffer:a,stencilBuffer:A}=i,l=!0===i.isWebGLCubeRenderTarget,u=!0===i.isRenderTarget3D,c=i.depth>1,h=!0===i.isXRRenderTarget,d=!0===h&&!0===i.hasExternalTextures;let p=o.msaaFrameBuffer,f=o.depthRenderbuffer;const m=this.extensions.get("WEBGL_multisampled_render_to_texture"),g=this.extensions.get("OVR_multiview2"),y=this._useMultisampledExtension(i),b=tM(e);let v;if(l?(o.cubeFramebuffers||(o.cubeFramebuffers={}),v=o.cubeFramebuffers[b]):h&&!1===d?v=this._xrFramebuffer:(o.framebuffers||(o.framebuffers={}),v=o.framebuffers[b]),void 0===v){v=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,v);const n=e.textures,a=[];if(l){o.cubeFramebuffers[b]=v;const{textureGPU:e}=this.get(n[0]),r=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,e,0)}else{o.framebuffers[b]=v;for(let r=0;r<n.length;r++){const o=n[r],a=this.get(o);a.renderTarget=e.renderTarget,a.cacheKey=b;const A=t.COLOR_ATTACHMENT0+r;if(i.multiview)g.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,A,a.textureGPU,0,s,0,2);else if(u||c){const e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,A,a.textureGPU,0,e)}else y?m.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,A,t.TEXTURE_2D,a.textureGPU,0,s):t.framebufferTexture2D(t.FRAMEBUFFER,A,t.TEXTURE_2D,a.textureGPU,0)}r.drawBuffers(e,v)}const h=A?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===i.autoAllocateDepthBuffer){const r=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(r,e,0,y),o.xrDepthRenderbuffer=r,a.push(A?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT),t.bindRenderbuffer(t.RENDERBUFFER,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,h,t.RENDERBUFFER,r)}else if(null!==e.depthTexture){a.push(A?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT);const r=this.get(e.depthTexture);if(r.renderTarget=e.renderTarget,r.cacheKey=b,i.multiview)g.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,h,r.textureGPU,0,s,0,2);else if(d&&y)m.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,h,t.TEXTURE_2D,r.textureGPU,0,s);else if(e.depthTexture.isArrayTexture){const e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,h,r.textureGPU,0,e)}else t.framebufferTexture2D(t.FRAMEBUFFER,h,t.TEXTURE_2D,r.textureGPU,0)}o.depthInvalidationArray=a}else{if(this._isRenderCameraDepthArray(e)){r.bindFramebuffer(t.FRAMEBUFFER,v);const n=this.renderer._activeCubeFace,i=this.get(e.depthTexture),o=A?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.framebufferTextureLayer(t.FRAMEBUFFER,o,i.textureGPU,0,n)}if(h||y||i.multiview){r.bindFramebuffer(t.FRAMEBUFFER,v);const n=this.get(e.textures[0]);i.multiview?g.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,n.textureGPU,0,s,0,2):y?m.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n.textureGPU,0,s):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n.textureGPU,0);const a=A?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===i.autoAllocateDepthBuffer){const e=o.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,a,t.RENDERBUFFER,e)}else{const r=this.get(e.depthTexture);i.multiview?g.framebufferTextureMultisampleMultiviewOVR(t.FRAMEBUFFER,a,r.textureGPU,0,s,0,2):y?m.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,t.TEXTURE_2D,r.textureGPU,0,s):t.framebufferTexture2D(t.FRAMEBUFFER,a,t.TEXTURE_2D,r.textureGPU,0)}}}if(s>0&&!1===y&&!i.multiview){if(void 0===p){const n=[];p=t.createFramebuffer(),r.bindFramebuffer(t.FRAMEBUFFER,p);const i=[],l=e.textures;for(let r=0;r<l.length;r++){if(i[r]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i[r]),n.push(t.COLOR_ATTACHMENT0+r),a){const e=A?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;n.push(e)}const o=e.textures[r],l=this.get(o);t.renderbufferStorageMultisample(t.RENDERBUFFER,s,l.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+r,t.RENDERBUFFER,i[r])}if(o.msaaFrameBuffer=p,o.msaaRenderbuffers=i,void 0===f){f=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(f,e,s),o.depthRenderbuffer=f;const r=A?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;n.push(r)}o.invalidationArray=n}n=o.msaaFrameBuffer}else n=v}r.bindFramebuffer(t.FRAMEBUFFER,n)}_getVaoKey(e){let t="";for(let r=0;r<e.length;r++){t+=":"+this.get(e[r]).id}return t}_createVao(e){const{gl:t}=this,r=t.createVertexArray();let n="",i=!0;t.bindVertexArray(r);for(let o=0;o<e.length;o++){const r=e[o],s=this.get(r);let a,A;n+=":"+s.id,t.bindBuffer(t.ARRAY_BUFFER,s.bufferGPU),t.enableVertexAttribArray(o),(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&(i=!1),!0===r.isInterleavedBufferAttribute?(a=r.data.stride*s.bytesPerElement,A=r.offset*s.bytesPerElement):(a=0,A=0),s.isInteger?t.vertexAttribIPointer(o,r.itemSize,s.type,a,A):t.vertexAttribPointer(o,r.itemSize,s.type,r.normalized,a,A),r.isInstancedBufferAttribute&&!r.isInterleavedBufferAttribute?t.vertexAttribDivisor(o,r.meshPerAttribute):r.isInterleavedBufferAttribute&&r.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(o,r.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[n]=r,{vaoGPU:r,staticVao:i}}_getTransformFeedback(e){let t="";for(let i=0;i<e.length;i++)t+=":"+e[i].id;let r=this.transformFeedbackCache[t];if(void 0!==r)return r;const{gl:n}=this;r=n.createTransformFeedback(),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,r);for(let i=0;i<e.length;i++){const t=e[i];n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,i,t.transformBuffer)}return n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=r,r}_setupBindings(e,t){const r=this.gl;for(const n of e)for(const e of n.bindings){const n=this.get(e).index;if(e.isUniformsGroup||e.isUniformBuffer){const i=r.getUniformBlockIndex(t,e.name);r.uniformBlockBinding(t,i,n)}else if(e.isSampledTexture){const i=r.getUniformLocation(t,e.name);r.uniform1i(i,n)}}}_bindUniforms(e){const{gl:t,state:r}=this;for(const n of e)for(const e of n.bindings){const n=this.get(e),i=n.index;e.isUniformsGroup||e.isUniformBuffer?r.bindBufferBase(t.UNIFORM_BUFFER,i,n.bufferGPU):e.isSampledTexture&&r.bindTexture(n.glTextureType,n.textureGPU,t.TEXTURE0+i)}}_useMultisampledExtension(e){return!0===e.multiview||e.samples>0&&!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!1!==e.autoAllocateDepthBuffer}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const Tq="point-list",Sq="line-list",Eq="line-strip",Mq="triangle-list",Nq="triangle-strip",Cq="never",Rq="less",Pq="equal",Dq="less-equal",Bq="greater",qq="not-equal",Oq="greater-equal",Lq="always",kq="store",Iq="load",Fq="clear",Uq="ccw",Vq="none",Gq="front",jq="back",zq="uint16",Hq="uint32",Wq="r8unorm",Qq="r8snorm",$q="r8uint",Yq="r8sint",Xq="r16uint",Kq="r16sint",Zq="r16float",Jq="rg8unorm",eO="rg8snorm",tO="rg8uint",rO="rg8sint",nO="r32uint",iO="r32sint",oO="r32float",sO="rg16uint",aO="rg16sint",AO="rg16float",lO="rgba8unorm",uO="rgba8unorm-srgb",cO="rgba8snorm",hO="rgba8uint",dO="rgba8sint",pO="bgra8unorm",fO="bgra8unorm-srgb",mO="rgb9e5ufloat",gO="rgb10a2unorm",yO="rgb10a2unorm",bO="rg32uint",vO="rg32sint",_O="rg32float",xO="rgba16uint",wO="rgba16sint",TO="rgba16float",SO="rgba32uint",EO="rgba32sint",MO="rgba32float",NO="depth16unorm",CO="depth24plus",RO="depth24plus-stencil8",PO="depth32float",DO="depth32float-stencil8",BO="bc1-rgba-unorm",qO="bc1-rgba-unorm-srgb",OO="bc2-rgba-unorm",LO="bc2-rgba-unorm-srgb",kO="bc3-rgba-unorm",IO="bc3-rgba-unorm-srgb",FO="bc4-r-unorm",UO="bc4-r-snorm",VO="bc5-rg-unorm",GO="bc5-rg-snorm",jO="bc6h-rgb-ufloat",zO="bc6h-rgb-float",HO="bc7-rgba-unorm",WO="bc7-rgba-srgb",QO="etc2-rgb8unorm",$O="etc2-rgb8unorm-srgb",YO="etc2-rgb8a1unorm",XO="etc2-rgb8a1unorm-srgb",KO="etc2-rgba8unorm",ZO="etc2-rgba8unorm-srgb",JO="eac-r11unorm",eL="eac-r11snorm",tL="eac-rg11unorm",rL="eac-rg11snorm",nL="astc-4x4-unorm",iL="astc-4x4-unorm-srgb",oL="astc-5x4-unorm",sL="astc-5x4-unorm-srgb",aL="astc-5x5-unorm",AL="astc-5x5-unorm-srgb",lL="astc-6x5-unorm",uL="astc-6x5-unorm-srgb",cL="astc-6x6-unorm",hL="astc-6x6-unorm-srgb",dL="astc-8x5-unorm",pL="astc-8x5-unorm-srgb",fL="astc-8x6-unorm",mL="astc-8x6-unorm-srgb",gL="astc-8x8-unorm",yL="astc-8x8-unorm-srgb",bL="astc-10x5-unorm",vL="astc-10x5-unorm-srgb",_L="astc-10x6-unorm",xL="astc-10x6-unorm-srgb",wL="astc-10x8-unorm",TL="astc-10x8-unorm-srgb",SL="astc-10x10-unorm",EL="astc-10x10-unorm-srgb",ML="astc-12x10-unorm",NL="astc-12x10-unorm-srgb",CL="astc-12x12-unorm",RL="astc-12x12-unorm-srgb",PL="clamp-to-edge",DL="repeat",BL="mirror-repeat",qL="linear",OL="nearest",LL="zero",kL="one",IL="src",FL="one-minus-src",UL="src-alpha",VL="one-minus-src-alpha",GL="dst",jL="one-minus-dst",zL="dst-alpha",HL="one-minus-dst-alpha",WL="src-alpha-saturated",QL="constant",$L="one-minus-constant",YL="add",XL="subtract",KL="reverse-subtract",ZL="min",JL="max",ek=0,tk=15,rk="keep",nk="zero",ik="replace",ok="invert",sk="increment-clamp",ak="decrement-clamp",Ak="increment-wrap",lk="decrement-wrap",uk="storage",ck="read-only-storage",hk="write-only",dk="read-only",pk="read-write",fk="non-filtering",mk="comparison",gk="float",yk="unfilterable-float",bk="depth",vk="sint",_k="uint",xk="2d",wk="3d",Tk="2d",Sk="2d-array",Ek="cube",Mk="3d",Nk="all",Ck="vertex",Rk="instance",Pk={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class Dk extends qB{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class Bk extends Dk{constructor(e,t,r){super(e,t?t.value:null),this.textureNode=t,this.groupNode=r}update(){this.texture=this.textureNode.value}}class qk extends OB{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let Ok=0;class Lk extends qk{constructor(e,t){super("StorageBuffer_"+Ok++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Dp.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class kk extends CE{constructor(e){super(),this.device=e;this.mipmapSampler=e.createSampler({minFilter:qL}),this.flipYSampler=e.createSampler({minFilter:OL}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})}getTransferPipeline(e){let t=this.transferPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Nq,stripIndexFormat:Hq},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:Nq,stripIndexFormat:Hq},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,r=0){const n=t.format,{width:i,height:o}=t.size,s=this.getTransferPipeline(n),a=this.getFlipYPipeline(n),A=this.device.createTexture({size:{width:i,height:o,depthOrArrayLayers:1},format:n,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),l=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Tk,baseArrayLayer:r}),u=A.createView({baseMipLevel:0,mipLevelCount:1,dimension:Tk,baseArrayLayer:0}),c=this.device.createCommandEncoder({}),h=(e,t,r)=>{const n=e.getBindGroupLayout(0),i=this.device.createBindGroup({layout:n,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:t}]}),o=c.beginRenderPass({colorAttachments:[{view:r,loadOp:Fq,storeOp:kq,clearValue:[0,0,0,0]}]});o.setPipeline(e),o.setBindGroup(0,i),o.draw(4,1,0,0),o.end()};h(s,l,u),h(a,u,l),this.device.queue.submit([c.finish()]),A.destroy()}generateMipmaps(e,t,r=0){const n=this.get(e);void 0===n.useCount&&(n.useCount=0,n.layers=[]);const i=n.layers[r]||this._mipmapCreateBundles(e,t,r),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,i),this.device.queue.submit([o.finish()]),0!==n.useCount&&(n.layers[r]=i),n.useCount++}_mipmapCreateBundles(e,t,r){const n=this.getTransferPipeline(t.format),i=n.getBindGroupLayout(0);let o=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Tk,baseArrayLayer:r});const s=[];for(let a=1;a<t.mipLevelCount;a++){const A=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),l=e.createView({baseMipLevel:a,mipLevelCount:1,dimension:Tk,baseArrayLayer:r}),u={colorAttachments:[{view:l,loadOp:Fq,storeOp:kq,clearValue:[0,0,0,0]}]},c=this.device.createRenderBundleEncoder({colorFormats:[t.format]});c.setPipeline(n),c.setBindGroup(0,A),c.draw(4,1,0,0),s.push({renderBundles:[c.finish()],passDescriptor:u}),o=l}return s}_mipmapRunBundles(e,t){const r=t.length;for(let n=0;n<r;n++){const r=t[n],i=e.beginRenderPass(r.passDescriptor);i.executeBundles(r.renderBundles),i.end()}}}const Ik={[We]:"never",[ze]:"less",[Ge]:"equal",[je]:"less-equal",[Ue]:"greater",[Ve]:"greater-equal",[He]:"always",[Fe]:"not-equal"},Fk=[0,1,3,2,4,5];class Uk{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new se,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,r=t.device,n=t.get(e),i={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};i.magFilter===qL&&i.minFilter===qL&&i.mipmapFilter===qL&&(i.maxAnisotropy=e.anisotropy),e.isDepthTexture&&null!==e.compareFunction&&(i.compare=Ik[e.compareFunction]),n.sampler=r.createSampler(i)}createDefaultTexture(e){let t;const r=Vk(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(r):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(r),this.backend.get(e).texture=t}createTexture(e,t={}){const r=this.backend,n=r.get(e);if(n.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===t.needsMipmaps&&(t.needsMipmaps=!1),void 0===t.levels&&(t.levels=1),void 0===t.depth&&(t.depth=1);const{width:i,height:o,depth:s,levels:a}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const A=this._getDimension(e),l=e.internalFormat||t.format||Vk(e,r.device);n.format=l;const{samples:u,primarySamples:c,isMSAA:h}=r.utils.getTextureSampleData(e);let d=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===e.isStorageTexture&&(d|=GPUTextureUsage.STORAGE_BINDING),!0!==e.isCompressedTexture&&!0!==e.isCompressedArrayTexture&&(d|=GPUTextureUsage.RENDER_ATTACHMENT);const p={label:e.name,size:{width:i,height:o,depthOrArrayLayers:s},mipLevelCount:a,sampleCount:c,dimension:A,format:l,usage:d};if(e.isVideoTexture){const t=e.source.data,r=new VideoFrame(t);p.size.width=r.displayWidth,p.size.height=r.displayHeight,r.close(),n.externalTexture=t}else{if(void 0===l)return console.warn("WebGPURenderer: Texture format not supported."),void this.createDefaultTexture(e);e.isCubeTexture&&(p.textureBindingViewDimension=Ek),n.texture=r.device.createTexture(p)}if(h){const e=Object.assign({},p);e.label=e.label+"-msaa",e.sampleCount=u,n.msaaTexture=r.device.createTexture(e)}n.initialized=!0,n.textureDescriptorGPU=p}destroyTexture(e){const t=this.backend,r=t.get(e);void 0!==r.texture&&r.texture.destroy(),void 0!==r.msaaTexture&&r.msaaTexture.destroy(),t.delete(e)}destroySampler(e){delete this.backend.get(e).sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let r=0;r<6;r++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,r);else{const r=e.image.depth||1;for(let e=0;e<r;e++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,e)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:r}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:r,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const r=this.backend,{width:n,height:i}=r.getDrawingBufferSize(),o=this.depthTexture,s=r.get(o).texture;let a,A;if(t?(a=ue,A=Ae):e&&(a=ce,A=le),void 0!==s){if(o.image.width===n&&o.image.height===i&&o.format===a&&o.type===A)return s;this.destroyTexture(o)}return o.name="depthBuffer",o.format=a,o.type=A,o.image.width=n,o.image.height=i,this.createTexture(o,{width:n,height:i}),r.get(o).texture}updateTexture(e,t){const r=this.backend.get(e),{textureDescriptorGPU:n}=r;if(!e.isRenderTargetTexture&&void 0!==n){if(e.isDataTexture)this._copyBufferToTexture(t.image,r.texture,n,0,e.flipY);else if(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)for(let i=0;i<t.image.depth;i++)this._copyBufferToTexture(t.image,r.texture,n,i,e.flipY,i);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,r.texture,n);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,r.texture,n,e.flipY,e.premultiplyAlpha);else if(e.isVideoTexture){const t=e.source.data;r.externalTexture=t}else this._copyImageToTexture(t.image,r.texture,n,0,e.flipY,e.premultiplyAlpha);r.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,r,n,i,o){const s=this.backend.device,a=this.backend.get(e),A=a.texture,l=a.textureDescriptorGPU.format,u=this._getBytesPerTexel(l);let c=n*u;c=256*Math.ceil(c/256);const h=s.createBuffer({size:n*i*u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),d=s.createCommandEncoder();d.copyTextureToBuffer({texture:A,origin:{x:t,y:r,z:o}},{buffer:h,bytesPerRow:c},{width:n,height:i});const p=this._getTypedArrayType(l);s.queue.submit([d.finish()]),await h.mapAsync(GPUMapMode.READ);return new p(h.getMappedRange())}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const r=new xe;r.minFilter=Ie,r.magFilter=Ie,this.createTexture(r,{width:1,height:1,format:e}),this.defaultTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const r=new _e;r.minFilter=Ie,r.magFilter=Ie,this.createTexture(r,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=r}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(null===e){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,r,n,i){for(let o=0;o<6;o++){const s=e[o],a=!0===n?Fk[o]:o;s.isDataTexture?this._copyBufferToTexture(s.image,t,r,a,n):this._copyImageToTexture(s,t,r,a,n,i)}}_copyImageToTexture(e,t,r,n,i,o){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:0,origin:{x:0,y:0,z:n},premultipliedAlpha:o},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return null===e&&(this._passUtils=e=new kk(this.backend.device)),e}_generateMipmaps(e,t,r=0){this._getPassUtils().generateMipmaps(e,t,r)}_flipY(e,t,r=0){this._getPassUtils().flipY(e,t,r)}_copyBufferToTexture(e,t,r,n,i,o=0){const s=this.backend.device,a=e.data,A=this._getBytesPerTexel(r.format),l=e.width*A;s.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:n}},a,{offset:e.width*e.height*A*o,bytesPerRow:l},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===i&&this._flipY(t,r,n)}_copyCompressedBufferToTexture(e,t,r){const n=this.backend.device,i=this._getBlockData(r.format),o=r.size.depthOrArrayLayers>1;for(let s=0;s<e.length;s++){const a=e[s],A=a.width,l=a.height,u=o?r.size.depthOrArrayLayers:1,c=Math.ceil(A/i.width)*i.byteLength,h=c*Math.ceil(l/i.height);for(let e=0;e<u;e++)n.queue.writeTexture({texture:t,mipLevel:s,origin:{x:0,y:0,z:e}},a.data,{offset:e*h,bytesPerRow:c,rowsPerImage:Math.ceil(l/i.height)},{width:Math.ceil(A/i.width)*i.width,height:Math.ceil(l/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){return e===BO||e===qO?{byteLength:8,width:4,height:4}:e===OO||e===LO||e===kO||e===IO?{byteLength:16,width:4,height:4}:e===FO||e===UO?{byteLength:8,width:4,height:4}:e===VO||e===GO||e===jO||e===zO||e===HO||e===WO?{byteLength:16,width:4,height:4}:e===QO||e===$O||e===YO||e===XO?{byteLength:8,width:4,height:4}:e===KO||e===ZO?{byteLength:16,width:4,height:4}:e===JO||e===eL?{byteLength:8,width:4,height:4}:e===tL||e===rL||e===nL||e===iL?{byteLength:16,width:4,height:4}:e===oL||e===sL?{byteLength:16,width:5,height:4}:e===aL||e===AL?{byteLength:16,width:5,height:5}:e===lL||e===uL?{byteLength:16,width:6,height:5}:e===cL||e===hL?{byteLength:16,width:6,height:6}:e===dL||e===pL?{byteLength:16,width:8,height:5}:e===fL||e===mL?{byteLength:16,width:8,height:6}:e===gL||e===yL?{byteLength:16,width:8,height:8}:e===bL||e===vL?{byteLength:16,width:10,height:5}:e===_L||e===xL?{byteLength:16,width:10,height:6}:e===wL||e===TL?{byteLength:16,width:10,height:8}:e===SL||e===EL?{byteLength:16,width:10,height:10}:e===ML||e===NL?{byteLength:16,width:12,height:10}:e===CL||e===RL?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(e){let t=PL;return e===Be?t=DL:e===Pe&&(t=BL),t}_convertFilterMode(e){let t=qL;return e!==Ie&&e!==ke&&e!==Le||(t=OL),t}_getBytesPerTexel(e){return e===Wq||e===Qq||e===$q||e===Yq?1:e===Xq||e===Kq||e===Zq||e===Jq||e===eO||e===tO||e===rO?2:e===nO||e===iO||e===oO||e===sO||e===aO||e===AO||e===lO||e===uO||e===cO||e===hO||e===dO||e===pO||e===fO||e===mO||e===gO||e===yO||e===PO||e===CO||e===RO||e===DO?4:e===bO||e===vO||e===_O||e===xO||e===wO||e===TO?8:e===SO||e===EO||e===MO?16:void 0}_getTypedArrayType(e){return e===$q?Uint8Array:e===Yq?Int8Array:e===Wq?Uint8Array:e===Qq?Int8Array:e===tO?Uint8Array:e===rO?Int8Array:e===Jq?Uint8Array:e===eO?Int8Array:e===hO?Uint8Array:e===dO?Int8Array:e===lO?Uint8Array:e===cO?Int8Array:e===Xq?Uint16Array:e===Kq?Int16Array:e===sO?Uint16Array:e===aO?Int16Array:e===xO?Uint16Array:e===wO?Int16Array:e===Zq||e===AO||e===TO?Uint16Array:e===nO?Uint32Array:e===iO?Int32Array:e===oO?Float32Array:e===bO?Uint32Array:e===vO?Int32Array:e===_O?Float32Array:e===SO?Uint32Array:e===EO?Int32Array:e===MO?Float32Array:e===pO||e===fO?Uint8Array:e===gO||e===mO||e===yO?Uint32Array:e===PO?Float32Array:e===CO||e===RO?Uint32Array:e===DO?Float32Array:void 0}_getDimension(e){let t;return t=e.isData3DTexture?wk:xk,t}}function Vk(e,t=null){const r=e.format,n=e.type,i=e.colorSpace,o=$e.getTransfer(i);let s;if(!0===e.isCompressedTexture||!0===e.isCompressedArrayTexture)switch(r){case Ft:s=o===Ye?qO:BO;break;case Ut:s=o===Ye?LO:OO;break;case Vt:s=o===Ye?IO:kO;break;case Qt:s=o===Ye?$O:QO;break;case $t:s=o===Ye?ZO:KO;break;case Yt:s=o===Ye?iL:nL;break;case Xt:s=o===Ye?sL:oL;break;case Kt:s=o===Ye?AL:aL;break;case Zt:s=o===Ye?uL:lL;break;case Jt:s=o===Ye?hL:cL;break;case er:s=o===Ye?pL:dL;break;case tr:s=o===Ye?mL:fL;break;case rr:s=o===Ye?yL:gL;break;case nr:s=o===Ye?vL:bL;break;case ir:s=o===Ye?xL:_L;break;case or:s=o===Ye?TL:wL;break;case sr:s=o===Ye?EL:SL;break;case ar:s=o===Ye?NL:ML;break;case Ar:s=o===Ye?RL:CL;break;case B:s=o===Ye?uO:lO;break;default:console.error("WebGPURenderer: Unsupported texture format.",r)}else switch(r){case B:switch(n){case Nt:s=cO;break;case Ct:s=wO;break;case Rt:s=xO;break;case le:s=SO;break;case Re:s=EO;break;case ae:s=o===Ye?uO:lO;break;case S:s=TO;break;case Ke:s=MO;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Dt:if(n===Mt)s=mO;else console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n);break;case Bt:switch(n){case Nt:s=Qq;break;case Ct:s=Kq;break;case Rt:s=Xq;break;case le:s=nO;break;case Re:s=iO;break;case ae:s=Wq;break;case S:s=Zq;break;case Ke:s=oO;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Ot:switch(n){case Nt:s=eO;break;case Ct:s=aO;break;case Rt:s=sO;break;case le:s=bO;break;case Re:s=vO;break;case ae:s=Jq;break;case S:s=AO;break;case Ke:s=_O;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case ce:switch(n){case Rt:s=NO;break;case le:s=CO;break;case Ke:s=PO;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case ue:switch(n){case Ae:s=RO;break;case Ke:t&&!1===t.features.has(Pk.Depth32FloatStencil8)&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),s=DO;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case qt:switch(n){case Re:s=iO;break;case le:s=nO;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case Lt:switch(n){case Re:s=vO;break;case le:s=bO;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case kt:switch(n){case Re:s=EO;break;case le:s=SO;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",r)}return s}const Gk=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,jk=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,zk={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"};class Hk extends KD{constructor(e){const{type:t,inputs:r,name:n,inputsCode:i,blockCode:o,outputType:s}=(e=>{const t=(e=e.trim()).match(Gk);if(null!==t&&4===t.length){const r=t[2],n=[];let i=null;for(;null!==(i=jk.exec(r));)n.push({name:i[1],type:i[2]});const o=[];for(let e=0;e<n.length;e++){const{name:t,type:r}=n[e];let i=r;i.startsWith("ptr")?i="pointer":(i.startsWith("texture")&&(i=r.split("<")[0]),i=zk[i]),o.push(new kD(i,t))}const s=e.substring(t[0].length),a=t[3]||"void",A=void 0!==t[1]?t[1]:"";return{type:zk[a]||a,inputs:o,name:A,inputsCode:r,blockCode:s,outputType:a}}throw new Error("FunctionNode: Function is not a WGSL code.")})(e);super(t,r,n),this.inputsCode=i,this.blockCode=o,this.outputType=s}getCode(e=this.name){const t="void"!==this.outputType?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Wk extends XD{parseFunction(e){return new Hk(e)}}const Qk="undefined"!=typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},$k={[Dp.READ_ONLY]:"read",[Dp.WRITE_ONLY]:"write",[Dp.READ_WRITE]:"read_write"},Yk={[Be]:"repeat",[De]:"clamp",[Pe]:"mirror"},Xk={vertex:Qk?Qk.VERTEX:1,fragment:Qk?Qk.FRAGMENT:2,compute:Qk?Qk.COMPUTE:4},Kk={instance:!0,swizzleAssign:!1,storageBuffer:!0},Zk={"^^":"tsl_xor"},Jk={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},eI={},tI={tsl_xor:new aC("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new aC("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new aC("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new aC("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new aC("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new aC("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new aC("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new aC("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new aC("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new aC("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new aC("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new aC("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new aC("\nfn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {\n\n\tlet res = vec2f( iRes );\n\n\tlet uvScaled = coord * res;\n\tlet uvWrapping = ( ( uvScaled % res ) + res ) % res;\n\n\t// https://www.shadertoy.com/view/WtyXRy\n\n\tlet uv = uvWrapping - 0.5;\n\tlet iuv = floor( uv );\n\tlet f = fract( uv );\n\n\tlet rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );\n\tlet rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );\n\tlet rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );\n\tlet rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );\n\n\treturn mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );\n\n}\n")},rI={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};"undefined"!=typeof navigator&&/Windows/g.test(navigator.userAgent)&&(tI.pow_float=new aC("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),tI.pow_vec2=new aC("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[tI.pow_float]),tI.pow_vec3=new aC("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[tI.pow_float]),tI.pow_vec4=new aC("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[tI.pow_float]),rI.pow_float="tsl_pow_float",rI.pow_vec2="tsl_pow_vec2",rI.pow_vec3="tsl_pow_vec3",rI.pow_vec4="tsl_pow_vec4");let nI="";!0!==("undefined"!=typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))&&(nI+="diagnostic( off, derivative_uniformity );\n");class iI extends OD{constructor(e,t){super(e,t,new Wk),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==Xe}_generateTextureSample(e,t,r,n,i=this.shaderStage){return"fragment"===i?n?`textureSample( ${t}, ${t}_sampler, ${r}, ${n} )`:`textureSample( ${t}, ${t}_sampler, ${r} )`:this._generateTextureSampleLevel(e,t,r,"0",n)}_generateVideoSample(e,t,r=this.shaderStage){if("fragment"===r)return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${r} shader.`)}_generateTextureSampleLevel(e,t,r,n,i){return!1===this.isUnfilterable(e)?`textureSampleLevel( ${t}, ${t}_sampler, ${r}, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,r,n):this.generateTextureLod(e,t,r,i,n)}generateWrapFunction(e){const t=`tsl_coord_${Yk[e.wrapS]}S_${Yk[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let r=eI[t];if(void 0===r){const n=[],i=e.isData3DTexture?"vec3f":"vec2f";let o=`fn ${t}( coord : ${i} ) -> ${i} {\n\n\treturn ${i}(\n`;const s=(e,t)=>{e===Be?(n.push(tI.repeatWrapping_float),o+=`\t\ttsl_repeatWrapping_float( coord.${t} )`):e===De?(n.push(tI.clampWrapping_float),o+=`\t\ttsl_clampWrapping_float( coord.${t} )`):e===Pe?(n.push(tI.mirrorWrapping_float),o+=`\t\ttsl_mirrorWrapping_float( coord.${t} )`):(o+=`\t\tcoord.${t}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${e}" for vertex shader.`))};s(e.wrapS,"x"),o+=",\n",s(e.wrapT,"y"),e.isData3DTexture&&(o+=",\n",s(e.wrapR,"z")),o+="\n\t);\n\n}\n",eI[t]=r=new aC(o,n)}return r.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,r){const n=this.getDataFromNode(e,this.shaderStage,this.globalCache);void 0===n.dimensionsSnippet&&(n.dimensionsSnippet={});let i=n.dimensionsSnippet[r];if(void 0===n.dimensionsSnippet[r]){let o,s;const{primarySamples:a}=this.renderer.backend.utils.getTextureSampleData(e),A=a>1;s=e.isData3DTexture?"vec3<u32>":"vec2<u32>",o=A||e.isVideoTexture||e.isStorageTexture?t:`${t}${r?`, u32( ${r} )`:""}`,i=new Hy(new Mb(`textureDimensions( ${o} )`,s)),n.dimensionsSnippet[r]=i,(e.isArrayTexture||e.isDataArrayTexture||e.isData3DTexture)&&(n.arrayLayerCount=new Hy(new Mb(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(n.cubeFaceCount=new Hy(new Mb("6u","u32")))}return i.build(this)}generateFilteredTexture(e,t,r,n="0u"){this._include("biquadraticTexture");return`tsl_biquadraticTexture( ${t}, ${this.generateWrapFunction(e)}( ${r} ), ${this.generateTextureDimension(e,t,n)}, u32( ${n} ) )`}generateTextureLod(e,t,r,n,i="0u"){const o=this.generateWrapFunction(e),s=this.generateTextureDimension(e,t,i),a=e.isData3DTexture?"vec3":"vec2",A=`${a}<u32>( ${o}( ${r} ) * ${a}<f32>( ${s} ) )`;return this.generateTextureLoad(e,t,A,n,i)}generateTextureLoad(e,t,r,n,i="0u"){let o;return!0===e.isVideoTexture?o=`textureLoad( ${t}, ${r} )`:n?o=`textureLoad( ${t}, ${r}, ${n}, u32( ${i} ) )`:(o=`textureLoad( ${t}, ${r}, u32( ${i} ) )`,this.renderer.backend.compatibilityMode&&e.isDepthTexture&&(o+=".x")),o}generateTextureStore(e,t,r,n,i){let o;return o=n?`textureStore( ${t}, ${r}, ${n}, ${i} )`:`textureStore( ${t}, ${r}, ${i} )`,o}isSampleCompare(e){return!0===e.isDepthTexture&&null!==e.compareFunction}isUnfilterable(e){return"float"!==this.getComponentTypeFromTexture(e)||!this.isAvailable("float32Filterable")&&!0===e.isDataTexture&&e.type===Ke||!1===this.isSampleCompare(e)&&e.minFilter===Ie&&e.magFilter===Ie||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,r,n,i=this.shaderStage){let o=null;return o=!0===e.isVideoTexture?this._generateVideoSample(t,r,i):this.isUnfilterable(e)?this.generateTextureLod(e,t,r,n,"0",i):this._generateTextureSample(e,t,r,n,i),o}generateTextureGrad(e,t,r,n,i,o=this.shaderStage){if("fragment"===o)return`textureSampleGrad( ${t}, ${t}_sampler, ${r},  ${n[0]}, ${n[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(e,t,r,n,i,o=this.shaderStage){if("fragment"===o)return!0===e.isDepthTexture&&!0===e.isArrayTexture?`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${i}, ${n} )`:`textureSampleCompare( ${t}, ${t}_sampler, ${r}, ${n} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(e,t,r,n,i,o=this.shaderStage){let s=null;return s=!0===e.isVideoTexture?this._generateVideoSample(t,r,o):this._generateTextureSampleLevel(e,t,r,n,i),s}generateTextureBias(e,t,r,n,i,o=this.shaderStage){if("fragment"===o)return`textureSampleBias( ${t}, ${t}_sampler, ${r}, ${n} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(e,t=this.shaderStage){if(!0===e.isNodeVarying&&!0===e.needsInterpolation){if("vertex"===t)return`varyings.${e.name}`}else if(!0===e.isNodeUniform){const t=e.name,r=e.type;return"texture"===r||"cubeTexture"===r||"storageTexture"===r||"texture3D"===r?t:"buffer"===r||"storageBuffer"===r||"indirectStorageBuffer"===r?this.isCustomStruct(e)?t:t+".value":e.groupNode.name+"."+t}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=Zk[e];return void 0!==t?(this._include(t),t):null}getNodeAccess(e,t){return"compute"!==t?Dp.READ_ONLY:e.access}getStorageAccess(e,t){return $k[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,r,n=null){const i=super.getUniformFromNode(e,t,r,n),o=this.getDataFromNode(e,r,this.globalCache);if(void 0===o.uniformGPU){let s;const a=e.groupNode,A=a.name,l=this.getBindGroupArray(A,r);if("texture"===t||"cubeTexture"===t||"storageTexture"===t||"texture3D"===t){let n=null;const o=this.getNodeAccess(e,r);if("texture"===t||"storageTexture"===t?n=new zB(i.name,i.node,a,o):"cubeTexture"===t?n=new HB(i.name,i.node,a,o):"texture3D"===t&&(n=new WB(i.name,i.node,a,o)),n.store=!0===e.isStorageTextureNode,n.setVisibility(Xk[r]),!1===this.isUnfilterable(e.value)&&!1===n.store){const e=new Bk(`${i.name}_sampler`,i.node,a);e.setVisibility(Xk[r]),l.push(e,n),s=[e,n]}else l.push(n),s=[n]}else if("buffer"===t||"storageBuffer"===t||"indirectStorageBuffer"===t){const o=new("buffer"===t?IB:Lk)(e,a);o.setVisibility(Xk[r]),l.push(o),s=o,i.name=n||"NodeBuffer_"+i.id}else{const e=this.uniformGroups[r]||(this.uniformGroups[r]={});let n=e[A];void 0===n&&(n=new VB(A,a),n.setVisibility(Xk[r]),e[A]=n,l.push(n)),s=this.getNodeUniform(i,t),n.addUniform(s)}o.uniformGPU=s}return i}getBuiltin(e,t,r,n=this.shaderStage){const i=this.builtins[n]||(this.builtins[n]=new Map);return!1===i.has(e)&&i.set(e,{name:e,property:t,type:r}),t}hasBuiltin(e,t=this.shaderStage){return void 0!==this.builtins[t]&&this.builtins[t].has(e)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,r=this.flowShaderNode(e),n=[];for(const o of t.inputs)n.push(o.name+" : "+this.getType(o.type));let i=`fn ${t.name}( ${n.join(", ")} ) -> ${this.getType(t.type)} {\n${r.vars}\n${r.code}\n`;return r.result&&(i+=`\treturn ${r.result};\n`),i+="\n}\n",i}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],r=this.directives[e];if(void 0!==r)for(const n of r)t.push(`enable ${n};`);return t.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],r=this.builtins[e];if(void 0!==r)for(const{name:n,property:i,type:o}of r.values())t.push(`@builtin( ${n} ) ${i} : ${o}`);return t.join(",\n\t")}getScopedArray(e,t,r,n){return!1===this.scopedArrays.has(e)&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:r,bufferCount:n}),e}getScopedArrays(e){if("compute"!==e)return;const t=[];for(const{name:r,scope:n,bufferType:i,bufferCount:o}of this.scopedArrays.values()){const e=this.getType(i);t.push(`var<${n}> ${r}: array< ${e}, ${o} >;`)}return t.join("\n")}getAttributes(e){const t=[];if("compute"===e&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===e||"compute"===e){const e=this.getBuiltins("attribute");e&&t.push(e);const r=this.getAttributesArray();for(let n=0,i=r.length;n<i;n++){const e=r[n],i=e.name,o=this.getType(e.type);t.push(`@location( ${n} ) ${i} : ${o}`)}}return t.join(",\n\t")}getStructMembers(e){const t=[];for(const r of e.members){const n=e.output?"@location( "+r.index+" ) ":"";let i=this.getType(r.type);r.atomic&&(i="atomic< "+i+" >"),t.push(`\t${n+r.name} : ${i}`)}return e.output&&t.push(`\t${this.getBuiltins("output")}`),t.join(",\n")}getStructs(e){let t="";const r=this.structs[e];if(r.length>0){const e=[];for(const t of r){let r=`struct ${t.name} {\n`;r+=this.getStructMembers(t),r+="\n};",e.push(r)}t="\n"+e.join("\n\n")+"\n"}return t}getVar(e,t,r=null){let n=`var ${t} : `;return n+=null!==r?this.generateArrayDeclaration(e,r):this.getType(e),n}getVars(e){const t=[],r=this.vars[e];if(void 0!==r)for(const n of r)t.push(`\t${this.getVar(n.type,n.name,n.count)};`);return`\n${t.join("\n")}\n`}getVaryings(e){const t=[];if("vertex"===e&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===e||"fragment"===e){const r=this.varyings,n=this.vars[e];for(let i=0;i<r.length;i++){const o=r[i];if(o.needsInterpolation){let e=`@location( ${i} )`;if(o.interpolationType){const t=null!==o.interpolationSampling?`, ${o.interpolationSampling} )`:" )";e+=` @interpolate( ${o.interpolationType}${t}`}else/^(int|uint|ivec|uvec)/.test(o.type)&&(e+=` @interpolate( ${this.renderer.backend.compatibilityMode?"flat, either":"flat"} )`);t.push(`${e} ${o.name} : ${this.getType(o.type)}`)}else"vertex"===e&&!1===n.includes(o)&&n.push(o)}}const r=this.getBuiltins(e);r&&t.push(r);const n=t.join(",\n\t");return"vertex"===e?this._getWGSLStruct("VaryingsStruct","\t"+n):n}isCustomStruct(e){const t=e.value,r=e.node,n=(t.isBufferAttribute||t.isInstancedBufferAttribute)&&null!==r.structTypeNode,i=r.value&&r.value.array&&"number"==typeof r.value.itemSize&&r.value.array.length>r.value.itemSize;return n&&!i}getUniforms(e){const t=this.uniforms[e],r=[],n=[],i=[],o={};for(const a of t){const t=a.groupNode.name,i=this.bindingsIndexes[t];if("texture"===a.type||"cubeTexture"===a.type||"storageTexture"===a.type||"texture3D"===a.type){const t=a.node.value;let n;!1===this.isUnfilterable(t)&&!0!==a.node.isStorageTextureNode&&(this.isSampleCompare(t)?r.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var ${a.name}_sampler : sampler_comparison;`):r.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var ${a.name}_sampler : sampler;`));let o="";const{primarySamples:s}=this.renderer.backend.utils.getTextureSampleData(t);if(s>1&&(o="_multisampled"),!0===t.isCubeTexture)n="texture_cube<f32>";else if(!0===t.isDepthTexture)n=this.renderer.backend.compatibilityMode&&null===t.compareFunction?`texture${o}_2d<f32>`:`texture_depth${o}_2d${!0===t.isArrayTexture?"_array":""}`;else if(!0===t.isArrayTexture||!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture)n="texture_2d_array<f32>";else if(!0===t.isVideoTexture)n="texture_external";else if(!0===t.isData3DTexture)n="texture_3d<f32>";else if(!0===a.node.isStorageTextureNode){n=`texture_storage_2d<${Vk(t)}, ${this.getStorageAccess(a.node,e)}>`}else{n=`texture${o}_2d<${this.getComponentTypeFromTexture(t).charAt(0)}32>`}r.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var ${a.name} : ${n};`)}else if("buffer"===a.type||"storageBuffer"===a.type||"indirectStorageBuffer"===a.type){const t=a.node,r=this.getType(t.getNodeType(this)),o=t.bufferCount,s=o>0&&"buffer"===a.type?", "+o:"",A=t.isStorageBufferNode?`storage, ${this.getStorageAccess(t,e)}`:"uniform";if(this.isCustomStruct(a))n.push(`@binding( ${i.binding++} ) @group( ${i.group} ) var<${A}> ${a.name} : ${r};`);else{const e=`\tvalue : array< ${t.isAtomic?`atomic<${r}>`:`${r}`}${s} >`;n.push(this._getWGSLStructBinding(a.name,e,A,i.binding++,i.group))}}else{const e=this.getType(this.getVectorType(a.type)),t=a.groupNode.name;(o[t]||(o[t]={index:i.binding++,id:i.group,snippets:[]})).snippets.push(`\t${a.name} : ${e}`)}}for(const a in o){const e=o[a];i.push(this._getWGSLStructBinding(a,e.snippets.join(",\n"),"uniform",e.index,e.id))}let s=r.join("\n");return s+=n.join("\n"),s+=i.join("\n"),s}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const r=e[t];r.uniforms=this.getUniforms(t),r.attributes=this.getAttributes(t),r.varyings=this.getVaryings(t),r.structs=this.getStructs(t),r.vars=this.getVars(t),r.codes=this.getCodes(t),r.directives=this.getDirectives(t),r.scopedArrays=this.getScopedArrays(t);let n="// code\n\n";n+=this.flowCode[t];const i=this.flowNodes[t],o=i[i.length-1],s=o.outputNode,a=void 0!==s&&!0===s.isOutputStructNode;for(const e of i){const i=this.getFlowData(e),A=e.name;if(A&&(n.length>0&&(n+="\n"),n+=`\t// flow -> ${A}\n`),n+=`${i.code}\n\t`,e===o&&"compute"!==t)if(n+="// result\n\n\t","vertex"===t)n+=`varyings.Vertex = ${i.result};`;else if("fragment"===t)if(a)r.returnType=s.getNodeType(this),r.structs+="var<private> output : "+r.returnType+";",n+=`return ${i.result};`;else{let e="\t@location(0) color: vec4<f32>";const t=this.getBuiltins("output");t&&(e+=",\n\t"+t),r.returnType="OutputStruct",r.structs+=this._getWGSLStruct("OutputStruct",e),r.structs+="\nvar<private> output : OutputStruct;",n+=`output.color = ${i.result};\n\n\treturn output;`}}r.flow=n}this.shaderStage=null,null!==this.material?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let r;return null!==t&&(r=this._getWGSLMethod(e+"_"+t)),void 0===r&&(r=this._getWGSLMethod(e)),r||e}getType(e){return Jk[e]||e}isAvailable(e){let t=Kk[e];return void 0===t&&("float32Filterable"===e?t=this.renderer.hasFeature("float32-filterable"):"clipDistance"===e&&(t=this.renderer.hasFeature("clip-distances")),Kk[e]=t),t}_getWGSLMethod(e){return void 0!==tI[e]&&this._include(e),rI[e]}_include(e){const t=tI[e];return t.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}\n// directives\n${e.directives}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\nvar<private> varyings : VaryingsStruct;\n\n// codes\n${e.codes}\n\n@vertex\nfn main( ${e.attributes} ) -> VaryingsStruct {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n\treturn varyings;\n\n}\n`}_getWGSLFragmentCode(e){return`${this.getSignature()}\n// global\n${nI}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@fragment\nfn main( ${e.varyings} ) -> ${e.returnType} {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLComputeCode(e,t){return`${this.getSignature()}\n// directives\n${e.directives}\n\n// system\nvar<private> instanceIndex : u32;\n\n// locals\n${e.scopedArrays}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@compute @workgroup_size( ${t} )\nfn main( ${e.attributes} ) {\n\n\t// system\n\tinstanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLStruct(e,t){return`\nstruct ${e} {\n${t}\n};`}_getWGSLStructBinding(e,t,r,n=0,i=0){const o=e+"Struct";return`${this._getWGSLStruct(o,t)}\n@binding( ${n} ) @group( ${i} )\nvar<${r}> ${e} : ${o};`}}class oI{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return null!==e.depthTexture?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=RO:e.depth&&(t=CO),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const e=this.backend.renderer,r=e.getRenderTarget();t=r?r.samples:e.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const r=t>1&&null!==e.renderTarget&&!0!==e.isDepthTexture&&!0!==e.isFramebufferTexture;return{samples:t,primarySamples:r?1:t,isMSAA:r}}getCurrentColorFormat(e){let t;return t=null!==e.textures?this.getTextureFormatGPU(e.textures[0]):this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return null!==e.textures?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){return e.isPoints?Tq:e.isLineSegments||e.isMesh&&!0===t.wireframe?Sq:e.isLine?Eq:e.isMesh?Mq:void 0}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),2===t&&(t=4)),t}getSampleCountRenderContext(e){return null!==e.textures?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(void 0===e)return navigator.gpu.getPreferredCanvasFormat();if(e===ae)return pO;if(e===S)return TO;throw new Error("Unsupported outputType")}}const sI=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),aI=new Map([[$r,["float16"]]]),AI=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class lI{constructor(e){this.backend=e}createAttribute(e,t){const r=this._getBufferAttribute(e),n=this.backend,i=n.get(r);let o=i.buffer;if(void 0===o){const s=n.device;let a=r.array;if(!1===e.normalized)if(a.constructor===Int16Array||a.constructor===Int8Array)a=new Int32Array(a);else if((a.constructor===Uint16Array||a.constructor===Uint8Array)&&(a=new Uint32Array(a),t&GPUBufferUsage.INDEX))for(let e=0;e<a.length;e++)65535===a[e]&&(a[e]=4294967295);if(r.array=a,(r.isStorageBufferAttribute||r.isStorageInstancedBufferAttribute)&&3===r.itemSize){a=new a.constructor(4*r.count);for(let e=0;e<r.count;e++)a.set(r.array.subarray(3*e,3*e+3),4*e);r.itemSize=4,r.array=a,i._force3to4BytesAlignment=!0}const A=a.byteLength,l=A+(4-A%4)%4;o=s.createBuffer({label:r.name,size:l,usage:t,mappedAtCreation:!0}),new a.constructor(o.getMappedRange()).set(a),o.unmap(),i.buffer=o}}updateAttribute(e){const t=this._getBufferAttribute(e),r=this.backend,n=r.device,i=r.get(t),o=r.get(t).buffer;let s=t.array;if(!0===i._force3to4BytesAlignment){s=new s.constructor(4*t.count);for(let e=0;e<t.count;e++)s.set(t.array.subarray(3*e,3*e+3),4*e);t.array=s}const a=this._isTypedArray(s),A=t.updateRanges;if(0===A.length)n.queue.writeBuffer(o,0,s,0);else{const e=a?1:s.BYTES_PER_ELEMENT;for(let t=0,r=A.length;t<r;t++){const r=A[t];let l,u;if(!0===i._force3to4BytesAlignment){l=4*Math.floor(r.start/3)*e,u=4*Math.ceil(r.count/3)*e}else l=r.start*e,u=r.count*e;const c=l*(a?s.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(o,c,s,l,u)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),r=new Map;for(let n=0;n<t.length;n++){const e=t[n],i=e.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(e);let s=r.get(o);if(void 0===s){let t,n;!0===e.isInterleavedBufferAttribute?(t=e.data.stride*i,n=e.data.isInstancedInterleavedBuffer?Rk:Ck):(t=e.itemSize*i,n=e.isInstancedBufferAttribute?Rk:Ck),!1!==e.normalized||e.array.constructor!==Int16Array&&e.array.constructor!==Uint16Array||(t=4),s={arrayStride:t,attributes:[],stepMode:n},r.set(o,s)}const a=this._getVertexFormat(e),A=!0===e.isInterleavedBufferAttribute?e.offset*i:0;s.attributes.push({shaderLocation:n,offset:A,format:a})}return Array.from(r.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,r=t.device,n=t.get(this._getBufferAttribute(e)).buffer,i=n.size,o=r.createBuffer({label:`${e.name}_readback`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s=r.createCommandEncoder({label:`readback_encoder_${e.name}`});s.copyBufferToBuffer(n,0,o,0,i);const a=s.finish();r.queue.submit([a]),await o.mapAsync(GPUMapMode.READ);const A=o.getMappedRange(),l=new e.array.constructor(A.slice(0));return o.unmap(),l.buffer}_getVertexFormat(e){const{itemSize:t,normalized:r}=e,n=e.array.constructor,i=e.constructor;let o;if(1===t)o=AI.get(n);else{const e=(aI.get(i)||sI.get(n))[r?1:0];if(e){const r=n.BYTES_PER_ELEMENT*t,i=4*Math.floor((r+3)/4)/n.BYTES_PER_ELEMENT;if(i%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${e}x${i}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class uI{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,r=t.device,n=[];let i=0;for(const o of e.bindings){const e={binding:i++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const t={};o.isStorageBuffer&&(4&o.visibility&&(o.access===Dp.READ_WRITE||o.access===Dp.WRITE_ONLY)?t.type=uk:t.type=ck),e.buffer=t}else if(o.isSampler){const r={};o.texture.isDepthTexture&&(null!==o.texture.compareFunction?r.type=mk:t.compatibilityMode&&(r.type=fk)),e.sampler=r}else if(o.isSampledTexture&&o.texture.isVideoTexture)e.externalTexture={};else if(o.isSampledTexture&&o.store){const t={};t.format=this.backend.get(o.texture).texture.format;const r=o.access;t.access=r===Dp.READ_WRITE?pk:r===Dp.WRITE_ONLY?hk:dk,e.storageTexture=t}else if(o.isSampledTexture){const r={},{primarySamples:n}=t.utils.getTextureSampleData(o.texture);if(n>1&&(r.multisampled=!0,o.texture.isDepthTexture||(r.sampleType=yk)),o.texture.isDepthTexture)t.compatibilityMode&&null===o.texture.compareFunction?r.sampleType=yk:r.sampleType=bk;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const e=o.texture.type;e===Re?r.sampleType=vk:e===le?r.sampleType=_k:e===Ke&&(this.backend.hasFeature("float32-filterable")?r.sampleType=gk:r.sampleType=yk)}o.isSampledCubeTexture?r.viewDimension=Ek:o.texture.isArrayTexture||o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?r.viewDimension=Sk:o.isSampledTexture3D&&(r.viewDimension=Mk),e.texture=r}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);n.push(e)}return r.createBindGroupLayout({entries:n})}createBindings(e,t,r,n=0){const{backend:i,bindGroupLayoutCache:o}=this,s=i.get(e);let a,A=o.get(e.bindingsReference);void 0===A&&(A=this.createBindingsLayout(e),o.set(e.bindingsReference,A)),r>0&&(void 0===s.groups&&(s.groups=[],s.versions=[]),s.versions[r]===n&&(a=s.groups[r])),void 0===a&&(a=this.createBindGroup(e,A),r>0&&(s.groups[r]=a,s.versions[r]=n)),s.group=a,s.layout=A}updateBinding(e){const t=this.backend,r=t.device,n=e.buffer,i=t.get(e).buffer;r.queue.writeBuffer(i,0,n,0)}createBindGroupIndex(e,t){const r=this.backend.device,n=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=e[0],o=r.createBuffer({label:"bindingCameraIndex_"+i,size:16,usage:n});r.queue.writeBuffer(o,0,e,0);const s=[{binding:0,resource:{buffer:o}}];return r.createBindGroup({label:"bindGroupCameraIndex_"+i,layout:t,entries:s})}createBindGroup(e,t){const r=this.backend,n=r.device;let i=0;const o=[];for(const s of e.bindings){if(s.isUniformBuffer){const e=r.get(s);if(void 0===e.buffer){const t=s.byteLength,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=n.createBuffer({label:"bindingBuffer_"+s.name,size:t,usage:r});e.buffer=i}o.push({binding:i,resource:{buffer:e.buffer}})}else if(s.isStorageBuffer){const e=r.get(s);if(void 0===e.buffer){const t=s.attribute;e.buffer=r.get(t).buffer}o.push({binding:i,resource:{buffer:e.buffer}})}else if(s.isSampler){const e=r.get(s.texture);o.push({binding:i,resource:e.sampler})}else if(s.isSampledTexture){const e=r.get(s.texture);let t;if(void 0!==e.externalTexture)t=n.importExternalTexture({source:e.externalTexture});else{const r=s.store?1:e.texture.mipLevelCount,n=`view-${e.texture.width}-${e.texture.height}-${r}`;if(t=e[n],void 0===t){const i=Nk;let o;o=s.isSampledCubeTexture?Ek:s.isSampledTexture3D?Mk:s.texture.isArrayTexture||s.texture.isDataArrayTexture||s.texture.isCompressedArrayTexture?Sk:Tk,t=e[n]=e.texture.createView({aspect:i,dimension:o,mipLevelCount:r})}}o.push({binding:i,resource:t})}i++}return n.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:o})}}class cI{constructor(e){this.backend=e,this._activePipelines=new WeakMap}setPipeline(e,t){this._activePipelines.get(e)!==t&&(e.setPipeline(t),this._activePipelines.set(e,t))}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:r,material:n,geometry:i,pipeline:o}=e,{vertexProgram:s,fragmentProgram:a}=o,A=this.backend,l=A.device,u=A.utils,c=A.get(o),h=[];for(const N of e.getBindings()){const e=A.get(N);h.push(e.layout)}const d=A.attributeUtils.createShaderVertexBuffers(e);let p;n.blending===dt||n.blending===ee&&!1===n.transparent||(p=this._getBlending(n));let f={};!0===n.stencilWrite&&(f={compare:this._getStencilCompare(n),failOp:this._getStencilOperation(n.stencilFail),depthFailOp:this._getStencilOperation(n.stencilZFail),passOp:this._getStencilOperation(n.stencilZPass)});const m=this._getColorWriteMask(n),g=[];if(null!==e.context.textures){const t=e.context.textures;for(let e=0;e<t.length;e++){const r=u.getTextureFormatGPU(t[e]);g.push({format:r,blend:p,writeMask:m})}}else{const t=u.getCurrentColorFormat(e.context);g.push({format:t,blend:p,writeMask:m})}const y=A.get(s).module,b=A.get(a).module,v=this._getPrimitiveState(r,i,n),_=this._getDepthCompare(n),x=u.getCurrentDepthStencilFormat(e.context),w=this._getSampleCount(e.context),T={label:`renderPipeline_${n.name||n.type}_${n.id}`,vertex:Object.assign({},y,{buffers:d}),fragment:Object.assign({},b,{targets:g}),primitive:v,multisample:{count:w,alphaToCoverageEnabled:n.alphaToCoverage&&w>1},layout:l.createPipelineLayout({bindGroupLayouts:h})},S={},E=e.context.depth,M=e.context.stencil;if(!0!==E&&!0!==M||(!0===E&&(S.format=x,S.depthWriteEnabled=n.depthWrite,S.depthCompare=_),!0===M&&(S.stencilFront=f,S.stencilBack={},S.stencilReadMask=n.stencilFuncMask,S.stencilWriteMask=n.stencilWriteMask),!0===n.polygonOffset&&(S.depthBias=n.polygonOffsetUnits,S.depthBiasSlopeScale=n.polygonOffsetFactor,S.depthBiasClamp=0),T.depthStencil=S),null===t)c.pipeline=l.createRenderPipeline(T);else{const e=new Promise(e=>{l.createRenderPipelineAsync(T).then(t=>{c.pipeline=t,e()})});t.push(e)}}createBundleEncoder(e,t="renderBundleEncoder"){const r=this.backend,{utils:n,device:i}=r,o=n.getCurrentDepthStencilFormat(e),s={label:t,colorFormats:[n.getCurrentColorFormat(e)],depthStencilFormat:o,sampleCount:this._getSampleCount(e)};return i.createRenderBundleEncoder(s)}createComputePipeline(e,t){const r=this.backend,n=r.device,i=r.get(e.computeProgram).module,o=r.get(e),s=[];for(const a of t){const e=r.get(a);s.push(e.layout)}o.pipeline=n.createComputePipeline({compute:i,layout:n.createPipelineLayout({bindGroupLayouts:s})})}_getBlending(e){let t,r;const n=e.blending,i=e.blendSrc,o=e.blendDst,s=e.blendEquation;if(n===he){const n=null!==e.blendSrcAlpha?e.blendSrcAlpha:i,a=null!==e.blendDstAlpha?e.blendDstAlpha:o,A=null!==e.blendEquationAlpha?e.blendEquationAlpha:s;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(s)},r={srcFactor:this._getBlendFactor(n),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(A)}}else{const i=(e,n,i,o)=>{t={srcFactor:e,dstFactor:n,operation:YL},r={srcFactor:i,dstFactor:o,operation:YL}};if(e.premultipliedAlpha)switch(n){case ee:i(kL,VL,kL,VL);break;case mt:i(kL,kL,kL,kL);break;case ft:i(LL,FL,LL,kL);break;case pt:i(LL,IL,LL,UL)}else switch(n){case ee:i(UL,VL,kL,VL);break;case mt:i(UL,kL,UL,kL);break;case ft:i(LL,FL,LL,kL);break;case pt:i(LL,IL,LL,IL)}}if(void 0!==t&&void 0!==r)return{color:t,alpha:r};console.error("THREE.WebGPURenderer: Invalid blending: ",n)}_getBlendFactor(e){let t;switch(e){case pe:t=LL;break;case lt:t=kL;break;case At:t=IL;break;case nt:t=FL;break;case at:t=UL;break;case rt:t=VL;break;case ot:t=GL;break;case tt:t=jL;break;case it:t=zL;break;case et:t=HL;break;case st:t=WL;break;case 211:t=QL;break;case 212:t=$L;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const r=e.stencilFunc;switch(r){case kr:t=Cq;break;case Lr:t=Lq;break;case Or:t=Rq;break;case qr:t=Dq;break;case Br:t=Pq;break;case Dr:t=Oq;break;case Pr:t=Bq;break;case Rr:t=qq;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",r)}return t}_getStencilOperation(e){let t;switch(e){case Hr:t=rk;break;case zr:t=nk;break;case jr:t=ik;break;case Gr:t=ok;break;case Vr:t=sk;break;case Ur:t=ak;break;case Fr:t=Ak;break;case Ir:t=lk;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case de:t=YL;break;case Je:t=XL;break;case Ze:t=KL;break;case Qr:t=ZL;break;case Wr:t=JL;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,r){const n={},i=this.backend.utils;switch(n.topology=i.getPrimitiveTopology(e,r),null!==t.index&&!0===e.isLine&&!0!==e.isLineSegments&&(n.stripIndexFormat=t.index.array instanceof Uint16Array?zq:Hq),r.side){case L:n.frontFace=Uq,n.cullMode=jq;break;case O:n.frontFace=Uq,n.cullMode=Gq;break;case k:n.frontFace=Uq,n.cullMode=Vq;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",r.side)}return n}_getColorWriteMask(e){return!0===e.colorWrite?tk:ek}_getDepthCompare(e){let t;if(!1===e.depthTest)t=Lq;else{const r=e.depthFunc;switch(r){case Tt:t=Cq;break;case wt:t=Lq;break;case xt:t=Rq;break;case _t:t=Dq;break;case vt:t=Pq;break;case bt:t=Oq;break;case yt:t=Bq;break;case gt:t=qq;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",r)}}return t}}class hI extends vq{constructor(e,t,r=2048){super(r),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const n=8*this.maxQueries;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:n,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:n,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return Me(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||0===this.currentQueryIndex||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if("unmapped"!==this.resultBuffer.mapState)return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,r=8*t;this.currentQueryIndex=0,this.queryOffsets.clear();const n=this.device.createCommandEncoder();n.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),n.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,r);const i=n.finish();if(this.device.queue.submit([i]),"unmapped"!==this.resultBuffer.mapState)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,r),this.isDisposed)return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue;const o=new BigUint64Array(this.resultBuffer.getMappedRange(0,r));let s=0;for(const[,a]of e){const e=o[a],t=o[a+1];s+=Number(t-e)/1e6}return this.resultBuffer.unmap(),this.lastValue=s,s}catch(e){return console.error("Error resolving queries:",e),"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&"mapped"===this.resultBuffer.mapState)try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class dI extends rq{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===e.alpha||e.alpha,this.parameters.compatibilityMode=void 0!==e.compatibilityMode&&e.compatibilityMode,this.parameters.requiredLimits=void 0===e.requiredLimits?{}:e.requiredLimits,this.compatibilityMode=this.parameters.compatibilityMode,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new oI(this),this.attributeUtils=new lI(this),this.bindingUtils=new uI(this),this.pipelineUtils=new cI(this),this.textureUtils=new Uk(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let r;if(void 0===t.device){const e={powerPreference:t.powerPreference,featureLevel:t.compatibilityMode?"compatibility":void 0},n="undefined"!=typeof navigator?await navigator.gpu.requestAdapter(e):null;if(null===n)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const i=Object.values(Pk),o=[];for(const t of i)n.features.has(t)&&o.push(t);const s={requiredFeatures:o,requiredLimits:t.requiredLimits};r=await n.requestDevice(s)}else r=t.device;r.lost.then(t=>{const r={api:"WebGPU",message:t.message||"Unknown reason",reason:t.reason||null,originalEvent:t};e.onDeviceLost(r)});const n=void 0!==t.context?t.context:e.domElement.getContext("webgpu");this.device=r,this.context=n;const i=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(Pk.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i}),this.updateSize()}get coordinateSystem(){return Ee}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(null===e){const t=this.renderer;e={colorAttachments:[{view:null}]},!0!==this.renderer.depth&&!0!==this.renderer.stencil||(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(t.depth,t.stencil).createView()});const r=e.colorAttachments[0];this.renderer.samples>0?r.view=this.colorBuffer.createView():r.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_isRenderCameraDepthArray(e){return e.depthTexture&&e.depthTexture.image.depth>1&&e.camera.isArrayCamera}_getRenderPassDescriptor(e,t={}){const r=e.renderTarget,n=this.get(r);let i=n.descriptors;if(void 0===i||n.width!==r.width||n.height!==r.height||n.dimensions!==r.dimensions||n.activeMipmapLevel!==e.activeMipmapLevel||n.activeCubeFace!==e.activeCubeFace||n.samples!==r.samples){i={},n.descriptors=i;const e=()=>{r.removeEventListener("dispose",e),this.delete(r)};!1===r.hasEventListener("dispose",e)&&r.addEventListener("dispose",e)}const o=e.getCacheKey();let s=i[o];if(void 0===s){const t=e.textures,a=[];let A;const l=this._isRenderCameraDepthArray(e);for(let n=0;n<t.length;n++){const i=this.get(t[n]),o={label:`colorAttachment_${n}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Tk};if(r.isRenderTarget3D)A=e.activeCubeFace,o.baseArrayLayer=0,o.dimension=Mk,o.depthOrArrayLayers=t[n].image.depth;else if(r.isRenderTarget&&t[n].image.depth>1)if(!0===l){const t=e.camera.cameras;for(let e=0;e<t.length;e++){const t={...o,baseArrayLayer:e,arrayLayerCount:1,dimension:Tk},r=i.texture.createView(t);a.push({view:r,resolveTarget:void 0,depthSlice:void 0})}}else o.dimension=Sk,o.depthOrArrayLayers=t[n].image.depth;if(!0!==l){const e=i.texture.createView(o);let t,r;void 0!==i.msaaTexture?(t=i.msaaTexture.createView(),r=e):(t=e,r=void 0),a.push({view:t,resolveTarget:r,depthSlice:A})}}if(s={textureViews:a},e.depth){const t=this.get(e.depthTexture),r={};e.depthTexture.isArrayTexture&&(r.dimension=Tk,r.arrayLayerCount=1,r.baseArrayLayer=e.activeCubeFace),s.depthStencilView=t.texture.createView(r)}i[o]=s,n.width=r.width,n.height=r.height,n.samples=r.samples,n.activeMipmapLevel=e.activeMipmapLevel,n.activeCubeFace=e.activeCubeFace,n.dimensions=r.dimensions}const a={colorAttachments:[]};for(let A=0;A<s.textureViews.length;A++){const e=s.textureViews[A];let r={r:0,g:0,b:0,a:1};0===A&&t.clearValue&&(r=t.clearValue),a.colorAttachments.push({view:e.view,depthSlice:e.depthSlice,resolveTarget:e.resolveTarget,loadOp:t.loadOp||Iq,storeOp:t.storeOp||kq,clearValue:r})}return s.depthStencilView&&(a.depthStencilAttachment={view:s.depthStencilView}),a}beginRender(e){const t=this.get(e),r=this.device,n=e.occlusionQueryCount;let i,o;n>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=r.createQuerySet({type:"occlusion",count:n,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(n),t.lastOcclusionObject=null),o=null===e.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(e,{loadOp:Iq}),this.initTimestampQuery(e,o),o.occlusionQuerySet=i;const s=o.depthStencilAttachment;if(null!==e.textures){const t=o.colorAttachments;for(let r=0;r<t.length;r++){const n=t[r];e.clearColor?(n.clearValue=0===r?e.clearColorValue:{r:0,g:0,b:0,a:1},n.loadOp=Fq):n.loadOp=Iq,n.storeOp=kq}}else{const t=o.colorAttachments[0];e.clearColor?(t.clearValue=e.clearColorValue,t.loadOp=Fq):t.loadOp=Iq,t.storeOp=kq}e.depth&&(e.clearDepth?(s.depthClearValue=e.clearDepthValue,s.depthLoadOp=Fq):s.depthLoadOp=Iq,s.depthStoreOp=kq),e.stencil&&(e.clearStencil?(s.stencilClearValue=e.clearStencilValue,s.stencilLoadOp=Fq):s.stencilLoadOp=Iq,s.stencilStoreOp=kq);const a=r.createCommandEncoder({label:"renderContext_"+e.id});if(!0===this._isRenderCameraDepthArray(e)){const r=e.camera.cameras;t.layerDescriptors&&t.layerDescriptors.length===r.length?this._updateDepthLayerDescriptors(e,t,r):this._createDepthLayerDescriptors(e,t,o,r),t.bundleEncoders=[],t.bundleSets=[];for(let n=0;n<r.length;n++){const r=this.pipelineUtils.createBundleEncoder(e,"renderBundleArrayCamera_"+n),i={attributes:{},bindingGroups:[],pipeline:null,index:null};t.bundleEncoders.push(r),t.bundleSets.push(i)}t.currentPass=null}else{const r=a.beginRenderPass(o);if(t.currentPass=r,e.viewport&&this.updateViewport(e),e.scissor){const{x:t,y:n,width:i,height:o}=e.scissorValue;r.setScissorRect(t,n,i,o)}}t.descriptor=o,t.encoder=a,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[]}_createDepthLayerDescriptors(e,t,r,n){const i=r.depthStencilAttachment;t.layerDescriptors=[];const o=this.get(e.depthTexture);o.viewCache||(o.viewCache=[]);for(let s=0;s<n.length;s++){const n={...r,colorAttachments:[{...r.colorAttachments[0],view:r.colorAttachments[s].view}]};if(r.depthStencilAttachment){const t=s;o.viewCache[t]||(o.viewCache[t]=o.texture.createView({dimension:Tk,baseArrayLayer:s,arrayLayerCount:1})),n.depthStencilAttachment={view:o.viewCache[t],depthLoadOp:i.depthLoadOp||Fq,depthStoreOp:i.depthStoreOp||kq,depthClearValue:i.depthClearValue||1},e.stencil&&(n.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,n.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,n.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else n.depthStencilAttachment={...i};t.layerDescriptors.push(n)}}_updateDepthLayerDescriptors(e,t,r){for(let n=0;n<r.length;n++){const r=t.layerDescriptors[n];if(r.depthStencilAttachment){const t=r.depthStencilAttachment;e.depth&&(e.clearDepth?(t.depthClearValue=e.clearDepthValue,t.depthLoadOp=Fq):t.depthLoadOp=Iq),e.stencil&&(e.clearStencil?(t.stencilClearValue=e.clearStencilValue,t.stencilLoadOp=Fq):t.stencilLoadOp=Iq)}}}finishRender(e){const t=this.get(e),r=e.occlusionQueryCount;t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),r>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery();const n=t.encoder;if(!0===this._isRenderCameraDepthArray(e)){const r=[];for(let e=0;e<t.bundleEncoders.length;e++){const n=t.bundleEncoders[e];r.push(n.finish())}for(let i=0;i<t.layerDescriptors.length;i++)if(i<r.length){const o=t.layerDescriptors[i],s=n.beginRenderPass(o);if(e.viewport){const{x:t,y:r,width:n,height:i,minDepth:o,maxDepth:a}=e.viewportValue;s.setViewport(t,r,n,i,o,a)}if(e.scissor){const{x:t,y:r,width:n,height:i}=e.scissorValue;s.setScissorRect(t,r,n,i)}s.executeBundles([r[i]]),s.end()}}else t.currentPass&&t.currentPass.end();if(r>0){const n=8*r;let i=this.occludedResolveCache.get(n);void 0===i&&(i=this.device.createBuffer({size:n,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(n,i));const o=this.device.createBuffer({size:n,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,r,i,0),t.encoder.copyBufferToBuffer(i,0,o,0,n),t.occlusionQueryBuffer=o,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),null!==e.textures){const t=e.textures;for(let e=0;e<t.length;e++){const r=t[e];!0===r.generateMipmaps&&this.textureUtils.generateMipmaps(r)}}}isOccluded(e,t){const r=this.get(e);return r.occluded&&r.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:r,currentOcclusionQueryObjects:n}=t;if(r&&n){const e=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await r.mapAsync(GPUMapMode.READ);const i=r.getMappedRange(),o=new BigUint64Array(i);for(let t=0;t<n.length;t++)o[t]===BigInt(0)&&e.add(n[t]);r.destroy(),t.occluded=e}}updateViewport(e){const{currentPass:t}=this.get(e),{x:r,y:n,width:i,height:o,minDepth:s,maxDepth:a}=e.viewportValue;t.setViewport(r,n,i,o,s,a)}getClearColor(){const e=super.getClearColor();return!0===this.renderer.alpha&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,r,n=null){const i=this.device,o=this.renderer;let s,a,A,l,u=[];if(e){const e=this.getClearColor();a={r:e.r,g:e.g,b:e.b,a:e.a}}if(null===n){A=o.depth,l=o.stencil;const t=this._getDefaultRenderPassDescriptor();if(e){u=t.colorAttachments;const e=u[0];e.clearValue=a,e.loadOp=Fq,e.storeOp=kq}(A||l)&&(s=t.depthStencilAttachment)}else{A=n.depth,l=n.stencil;const i={loadOp:e?Fq:Iq,clearValue:e?a:void 0};A&&(i.depthLoadOp=t?Fq:Iq,i.depthClearValue=t?o.getClearDepth():void 0,i.depthStoreOp=kq),l&&(i.stencilLoadOp=r?Fq:Iq,i.stencilClearValue=r?o.getClearStencil():void 0,i.stencilStoreOp=kq);const c=this._getRenderPassDescriptor(n,i);u=c.colorAttachments,s=c.depthStencilAttachment}A&&s&&void 0===s.depthLoadOp&&(t?(s.depthLoadOp=Fq,s.depthClearValue=o.getClearDepth(),s.depthStoreOp=kq):(s.depthLoadOp=Iq,s.depthStoreOp=kq)),l&&s&&void 0===s.stencilLoadOp&&(r?(s.stencilLoadOp=Fq,s.stencilClearValue=o.getClearStencil(),s.stencilStoreOp=kq):(s.stencilLoadOp=Iq,s.stencilStoreOp=kq));const c=i.createCommandEncoder({label:"clear"});c.beginRenderPass({colorAttachments:u,depthStencilAttachment:s}).end(),i.queue.submit([c.finish()])}beginCompute(e){const t=this.get(e),r={label:"computeGroup_"+e.id};this.initTimestampQuery(e,r),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(r)}compute(e,t,r,n){const{passEncoderGPU:i}=this.get(e),o=this.get(n).pipeline;this.pipelineUtils.setPipeline(i,o);for(let l=0,u=r.length;l<u;l++){const e=r[l],t=this.get(e);i.setBindGroup(l,t.group)}const s=this.device.limits.maxComputeWorkgroupsPerDimension,a=this.get(t);void 0===a.dispatchSize&&(a.dispatchSize={x:0,y:1,z:1});const{dispatchSize:A}=a;t.dispatchCount>s?(A.x=Math.min(t.dispatchCount,s),A.y=Math.ceil(t.dispatchCount/s)):A.x=t.dispatchCount,i.dispatchWorkgroups(A.x,A.y,A.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:r,material:n,context:i,pipeline:o}=e,s=e.getBindings(),a=this.get(i),A=this.get(o).pipeline,l=e.getIndex(),u=null!==l,c=e.getDrawParameters();if(null===c)return;const h=(t,r)=>{this.pipelineUtils.setPipeline(t,A),r.pipeline=A;const o=r.bindingGroups;for(let e=0,n=s.length;e<n;e++){const r=s[e],n=this.get(r);o[r.index]!==r.id&&(t.setBindGroup(r.index,n.group),o[r.index]=r.id)}if(!0===u&&r.index!==l){const e=this.get(l).buffer,n=l.array instanceof Uint16Array?zq:Hq;t.setIndexBuffer(e,n),r.index=l}const c=e.getVertexBuffers();for(let e=0,n=c.length;e<n;e++){const n=c[e];if(r.attributes[e]!==n){const i=this.get(n).buffer;t.setVertexBuffer(e,i),r.attributes[e]=n}}!0===i.stencil&&!0===n.stencilWrite&&a.currentStencilRef!==n.stencilRef&&(t.setStencilReference(n.stencilRef),a.currentStencilRef=n.stencilRef)},d=(n,i)=>{if(h(n,i),!0===r.isBatchedMesh){const e=r._multiDrawStarts,i=r._multiDrawCounts,o=r._multiDrawCount,s=r._multiDrawInstances;null!==s&&Me("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let a=0;a<o;a++){const o=s?s[a]:1,A=o>1?0:a;!0===u?n.drawIndexed(i[a],o,e[a]/l.array.BYTES_PER_ELEMENT,0,A):n.draw(i[a],o,e[a],A),t.update(r,i[a],o)}}else if(!0===u){const{vertexCount:i,instanceCount:o,firstVertex:s}=c,a=e.getIndirect();if(null!==a){const e=this.get(a).buffer;n.drawIndexedIndirect(e,0)}else n.drawIndexed(i,o,s,0,0);t.update(r,i,o)}else{const{vertexCount:i,instanceCount:o,firstVertex:s}=c,a=e.getIndirect();if(null!==a){const e=this.get(a).buffer;n.drawIndirect(e,0)}else n.draw(i,o,s,0);t.update(r,i,o)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const t=this.get(e.camera),n=e.camera.cameras,o=e.getBindingGroup("cameraIndex");if(void 0===t.indexesGPU||t.indexesGPU.length!==n.length){const e=this.get(o),r=[],i=new Uint32Array([0,0,0,0]);for(let t=0,o=n.length;t<o;t++){i[0]=t;const n=this.bindingUtils.createBindGroupIndex(i,e.layout);r.push(n)}t.indexesGPU=r}const s=this.renderer.getPixelRatio();for(let e=0,A=n.length;e<A;e++){const A=n[e];if(r.layers.test(A.layers)){const r=A.viewport;let n=a.currentPass,l=a.currentSets;if(a.bundleEncoders){n=a.bundleEncoders[e],l=a.bundleSets[e]}r&&n.setViewport(Math.floor(r.x*s),Math.floor(r.y*s),Math.floor(r.width*s),Math.floor(r.height*s),i.viewportValue.minDepth,i.viewportValue.maxDepth),o&&t.indexesGPU&&(n.setBindGroup(o.index,t.indexesGPU[e]),l.bindingGroups[o.index]=o.id),d(n,l)}}}else if(a.currentPass){if(void 0!==a.occlusionQuerySet){const e=a.lastOcclusionObject;e!==r&&(null!==e&&!0===e.occlusionTest&&(a.currentPass.endOcclusionQuery(),a.occlusionQueryIndex++),!0===r.occlusionTest&&(a.currentPass.beginOcclusionQuery(a.occlusionQueryIndex),a.occlusionQueryObjects[a.occlusionQueryIndex]=r),a.lastOcclusionObject=r)}d(a.currentPass,a.currentSets)}}needsRenderUpdate(e){const t=this.get(e),{object:r,material:n}=e,i=this.utils,o=i.getSampleCountRenderContext(e.context),s=i.getCurrentColorSpace(e.context),a=i.getCurrentColorFormat(e.context),A=i.getCurrentDepthStencilFormat(e.context),l=i.getPrimitiveTopology(r,n);let u=!1;return t.material===n&&t.materialVersion===n.version&&t.transparent===n.transparent&&t.blending===n.blending&&t.premultipliedAlpha===n.premultipliedAlpha&&t.blendSrc===n.blendSrc&&t.blendDst===n.blendDst&&t.blendEquation===n.blendEquation&&t.blendSrcAlpha===n.blendSrcAlpha&&t.blendDstAlpha===n.blendDstAlpha&&t.blendEquationAlpha===n.blendEquationAlpha&&t.colorWrite===n.colorWrite&&t.depthWrite===n.depthWrite&&t.depthTest===n.depthTest&&t.depthFunc===n.depthFunc&&t.stencilWrite===n.stencilWrite&&t.stencilFunc===n.stencilFunc&&t.stencilFail===n.stencilFail&&t.stencilZFail===n.stencilZFail&&t.stencilZPass===n.stencilZPass&&t.stencilFuncMask===n.stencilFuncMask&&t.stencilWriteMask===n.stencilWriteMask&&t.side===n.side&&t.alphaToCoverage===n.alphaToCoverage&&t.sampleCount===o&&t.colorSpace===s&&t.colorFormat===a&&t.depthStencilFormat===A&&t.primitiveTopology===l&&t.clippingContextCacheKey===e.clippingContextCacheKey||(t.material=n,t.materialVersion=n.version,t.transparent=n.transparent,t.blending=n.blending,t.premultipliedAlpha=n.premultipliedAlpha,t.blendSrc=n.blendSrc,t.blendDst=n.blendDst,t.blendEquation=n.blendEquation,t.blendSrcAlpha=n.blendSrcAlpha,t.blendDstAlpha=n.blendDstAlpha,t.blendEquationAlpha=n.blendEquationAlpha,t.colorWrite=n.colorWrite,t.depthWrite=n.depthWrite,t.depthTest=n.depthTest,t.depthFunc=n.depthFunc,t.stencilWrite=n.stencilWrite,t.stencilFunc=n.stencilFunc,t.stencilFail=n.stencilFail,t.stencilZFail=n.stencilZFail,t.stencilZPass=n.stencilZPass,t.stencilFuncMask=n.stencilFuncMask,t.stencilWriteMask=n.stencilWriteMask,t.side=n.side,t.alphaToCoverage=n.alphaToCoverage,t.sampleCount=o,t.colorSpace=s,t.colorFormat=a,t.depthStencilFormat=A,t.primitiveTopology=l,t.clippingContextCacheKey=e.clippingContextCacheKey,u=!0),u}getRenderCacheKey(e){const{object:t,material:r}=e,n=this.utils,i=e.context;return[r.transparent,r.blending,r.premultipliedAlpha,r.blendSrc,r.blendDst,r.blendEquation,r.blendSrcAlpha,r.blendDstAlpha,r.blendEquationAlpha,r.colorWrite,r.depthWrite,r.depthTest,r.depthFunc,r.stencilWrite,r.stencilFunc,r.stencilFail,r.stencilZFail,r.stencilZPass,r.stencilFuncMask,r.stencilWriteMask,r.side,n.getSampleCountRenderContext(i),n.getCurrentColorSpace(i),n.getCurrentColorFormat(i),n.getCurrentDepthStencilFormat(i),n.getPrimitiveTopology(t,r),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,r,n,i,o){return this.textureUtils.copyTextureToBuffer(e,t,r,n,i,o)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const r=e.isComputeNode?"compute":"render";this.timestampQueryPool[r]||(this.timestampQueryPool[r]=new hI(this.device,r,2048));const n=this.timestampQueryPool[r],i=n.allocateQueriesForContext(e);t.timestampWrites={querySet:n.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new iI(e,t)}createProgram(e){this.get(e).module={module:this.device.createShaderModule({code:e.code,label:e.stage+(""!==e.name?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const r=this.get(e),n=r.currentPass.finish();this.get(t).bundleGPU=n,r.currentSets=r._currentSets,r.currentPass=r._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,r,n){this.bindingUtils.createBindings(e,t,r,n)}updateBindings(e,t,r,n){this.bindingUtils.createBindings(e,t,r,n)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,r=null,n=null,i=0,o=0){let s=0,a=0,A=0,l=0,u=0,c=0,h=e.image.width,d=e.image.height,p=1;null!==r&&(!0===r.isBox3?(l=r.min.x,u=r.min.y,c=r.min.z,h=r.max.x-r.min.x,d=r.max.y-r.min.y,p=r.max.z-r.min.z):(l=r.min.x,u=r.min.y,h=r.max.x-r.min.x,d=r.max.y-r.min.y,p=1)),null!==n&&(s=n.x,a=n.y,A=n.z||0);const f=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),m=this.get(e).texture,g=this.get(t).texture;f.copyTextureToTexture({texture:m,mipLevel:i,origin:{x:l,y:u,z:c}},{texture:g,mipLevel:o,origin:{x:s,y:a,z:A}},[h,d,p]),this.device.queue.submit([f.finish()]),0===o&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,r){const n=this.get(t);let i=null;i=t.renderTarget?e.isDepthTexture?this.get(t.depthTexture).texture:this.get(t.textures[0]).texture:e.isDepthTexture?this.textureUtils.getDepthBuffer(t.depth,t.stencil):this.context.getCurrentTexture();const o=this.get(e).texture;if(i.format!==o.format)return void console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,o.format);let s;if(n.currentPass?(n.currentPass.end(),s=n.encoder):s=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),s.copyTextureToTexture({texture:i,origin:[r.x,r.y,0]},{texture:o},[r.z,r.w]),n.currentPass){const{descriptor:e}=n;for(let t=0;t<e.colorAttachments.length;t++)e.colorAttachments[t].loadOp=Iq;if(t.depth&&(e.depthStencilAttachment.depthLoadOp=Iq),t.stencil&&(e.depthStencilAttachment.stencilLoadOp=Iq),n.currentPass=s.beginRenderPass(e),n.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:e,y:r,width:i,height:o}=t.scissorValue;n.currentPass.setScissorRect(e,r,i,o)}}else this.device.queue.submit([s.finish()]);e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}}class pI extends G{constructor(e,t,r,n,i,o){super(e,t,r,n,i,o),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class fI extends G{constructor(e,t,r,n,i,o){super(e,t,r,n,i,o),this.aspect=null}copy(e,t){return super.copy(e,t),this.aspect=e.aspect,this}}class mI extends hB{constructor(){super(),this.addMaterial(mT,"MeshPhongMaterial"),this.addMaterial(nE,"MeshStandardMaterial"),this.addMaterial(oE,"MeshPhysicalMaterial"),this.addMaterial(lE,"MeshToonMaterial"),this.addMaterial(aT,"MeshBasicMaterial"),this.addMaterial(pT,"MeshLambertMaterial"),this.addMaterial(Qw,"MeshNormalMaterial"),this.addMaterial(dE,"MeshMatcapMaterial"),this.addMaterial(Fw,"LineBasicMaterial"),this.addMaterial(Vw,"LineDashedMaterial"),this.addMaterial(bE,"PointsMaterial"),this.addMaterial(gE,"SpriteMaterial"),this.addMaterial(xE,"ShadowMaterial"),this.addLight(RR,F),this.addLight(ID,U),this.addLight(GD,V),this.addLight(jD,G),this.addLight(QD,j),this.addLight($D,z),this.addLight(YD,H),this.addLight(zD,pI),this.addLight(WD,fI),this.addToneMapping(KN,W),this.addToneMapping(ZN,Q),this.addToneMapping(JN,$),this.addToneMapping(tC,Y),this.addToneMapping(oC,X),this.addToneMapping(sC,K)}}class gI extends BB{constructor(e={}){let t;e.forceWebGL?t=wq:(t=dI,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new wq(e)));super(new t(e),e),this.library=new mI,this.isWebGPURenderer=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}
/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */tD.BRDF_GGX,tD.BRDF_Lambert,tD.BasicShadowFilter,tD.Break,tD.Continue,tD.DFGApprox,tD.D_GGX,tD.Discard,tD.EPSILON,tD.F_Schlick;const yI=tD.Fn;tD.INFINITY;const bI=tD.If;tD.Switch;const vI=tD.Loop;tD.NodeShaderStage,tD.NodeType,tD.NodeUpdateType,tD.NodeAccess,tD.PCFShadowFilter,tD.PCFSoftShadowFilter,tD.PI,tD.PI2,tD.Return,tD.Schlick_to_F0,tD.ScriptableNodeResources,tD.ShaderNode,tD.TBNViewMatrix,tD.VSMShadowFilter,tD.V_GGX_SmithCorrelated,tD.abs,tD.acesFilmicToneMapping,tD.acos,tD.add,tD.addNodeElement,tD.agxToneMapping,tD.all,tD.alphaT,tD.and,tD.anisotropy,tD.anisotropyB,tD.anisotropyT,tD.any,tD.append,tD.array,tD.arrayBuffer;const _I=tD.asin;tD.assign,tD.atan,tD.atan2,tD.atomicAdd,tD.atomicAnd,tD.atomicFunc,tD.atomicMax,tD.atomicMin,tD.atomicOr,tD.atomicStore,tD.atomicSub,tD.atomicXor,tD.atomicLoad,tD.attenuationColor,tD.attenuationDistance,tD.attribute,tD.attributeArray,tD.backgroundBlurriness,tD.backgroundIntensity,tD.backgroundRotation,tD.batch,tD.billboarding,tD.bitAnd,tD.bitNot,tD.bitOr,tD.bitXor,tD.bitangentGeometry,tD.bitangentLocal,tD.bitangentView,tD.bitangentWorld,tD.bitcast,tD.blendBurn,tD.blendColor,tD.blendDodge,tD.blendOverlay,tD.blendScreen,tD.blur,tD.bool,tD.buffer,tD.bufferAttribute,tD.bumpMap,tD.burn,tD.bvec2,tD.bvec3,tD.bvec4,tD.bypass,tD.cache,tD.call,tD.cameraFar,tD.cameraIndex,tD.cameraNear,tD.cameraNormalMatrix,tD.cameraPosition,tD.cameraProjectionMatrix,tD.cameraProjectionMatrixInverse,tD.cameraViewMatrix,tD.cameraWorldMatrix,tD.cbrt,tD.cdl,tD.ceil,tD.checker,tD.cineonToneMapping,tD.clamp,tD.clearcoat,tD.clearcoatRoughness,tD.code,tD.color,tD.colorSpaceToWorking,tD.colorToDirection,tD.compute,tD.computeSkinning,tD.cond,tD.Const,tD.context,tD.convert,tD.convertColorSpace,tD.convertToTexture;const xI=tD.cos;tD.cross,tD.cubeTexture,tD.dFdx,tD.dFdy,tD.dashSize,tD.debug,tD.decrement,tD.decrementBefore,tD.defaultBuildStages,tD.defaultShaderStages,tD.defined,tD.degrees,tD.deltaTime,tD.densityFog,tD.densityFogFactor,tD.depth,tD.depthPass,tD.difference,tD.diffuseColor,tD.directPointLight,tD.directionToColor,tD.dispersion,tD.distance,tD.div,tD.dodge,tD.dot,tD.drawIndex,tD.dynamicBufferAttribute,tD.element,tD.emissive,tD.equal,tD.equals,tD.equirectUV;const wI=tD.exp;tD.exp2,tD.expression,tD.faceDirection,tD.faceForward,tD.faceforward;const TI=tD.float;tD.floor,tD.fog,tD.fract,tD.frameGroup,tD.frameId,tD.frontFacing,tD.fwidth,tD.gain,tD.gapSize,tD.getConstNodeType,tD.getCurrentStack,tD.getDirection,tD.getDistanceAttenuation,tD.getGeometryRoughness,tD.getNormalFromDepth,tD.getParallaxCorrectNormal,tD.getRoughness,tD.getScreenPosition,tD.getShIrradianceAt,tD.getTextureIndex,tD.getViewPosition,tD.getShadowMaterial,tD.getShadowRenderObjectFunction,tD.glsl,tD.glslFn,tD.grayscale,tD.greaterThan,tD.greaterThanEqual,tD.hash,tD.highpModelNormalViewMatrix,tD.highpModelViewMatrix,tD.hue,tD.increment,tD.incrementBefore,tD.instance;const SI=tD.instanceIndex;tD.instancedArray,tD.instancedBufferAttribute,tD.instancedDynamicBufferAttribute,tD.instancedMesh,tD.int,tD.inverseSqrt,tD.inversesqrt,tD.invocationLocalIndex,tD.invocationSubgroupIndex,tD.ior,tD.iridescence,tD.iridescenceIOR,tD.iridescenceThickness,tD.ivec2,tD.ivec3,tD.ivec4,tD.js,tD.label,tD.length,tD.lengthSq,tD.lessThan,tD.lessThanEqual,tD.lightPosition,tD.lightShadowMatrix,tD.lightTargetDirection,tD.lightTargetPosition,tD.lightViewPosition,tD.lightingContext,tD.lights,tD.linearDepth,tD.linearToneMapping,tD.localId,tD.globalId,tD.log,tD.log2,tD.logarithmicDepthToViewZ,tD.loop,tD.luminance,tD.mediumpModelViewMatrix,tD.mat2,tD.mat3,tD.mat4,tD.matcapUV,tD.materialAO,tD.materialAlphaTest,tD.materialAnisotropy,tD.materialAnisotropyVector,tD.materialAttenuationColor,tD.materialAttenuationDistance,tD.materialClearcoat,tD.materialClearcoatNormal,tD.materialClearcoatRoughness,tD.materialColor,tD.materialDispersion,tD.materialEmissive,tD.materialIOR,tD.materialIridescence,tD.materialIridescenceIOR,tD.materialIridescenceThickness,tD.materialLightMap,tD.materialLineDashOffset,tD.materialLineDashSize,tD.materialLineGapSize,tD.materialLineScale,tD.materialLineWidth,tD.materialMetalness,tD.materialNormal,tD.materialOpacity,tD.materialPointSize,tD.materialReference,tD.materialReflectivity,tD.materialRefractionRatio,tD.materialRotation,tD.materialRoughness,tD.materialSheen,tD.materialSheenRoughness,tD.materialShininess,tD.materialSpecular,tD.materialSpecularColor,tD.materialSpecularIntensity,tD.materialSpecularStrength,tD.materialThickness,tD.materialTransmission,tD.max,tD.maxMipLevel,tD.metalness,tD.min,tD.mix,tD.mixElement,tD.mod,tD.modInt,tD.modelDirection,tD.modelNormalMatrix,tD.modelPosition,tD.modelRadius,tD.modelScale,tD.modelViewMatrix,tD.modelViewPosition,tD.modelViewProjection,tD.modelWorldMatrix,tD.modelWorldMatrixInverse,tD.morphReference,tD.mrt,tD.mul,tD.mx_aastep,tD.mx_cell_noise_float,tD.mx_contrast,tD.mx_fractal_noise_float,tD.mx_fractal_noise_vec2,tD.mx_fractal_noise_vec3,tD.mx_fractal_noise_vec4,tD.mx_hsvtorgb,tD.mx_noise_float,tD.mx_noise_vec3,tD.mx_noise_vec4,tD.mx_ramplr,tD.mx_ramptb,tD.mx_rgbtohsv,tD.mx_safepower,tD.mx_splitlr,tD.mx_splittb,tD.mx_srgb_texture_to_lin_rec709,tD.mx_transform_uv,tD.mx_worley_noise_float,tD.mx_worley_noise_vec2,tD.mx_worley_noise_vec3,tD.namespace;const EI=tD.negate;tD.neutralToneMapping,tD.nodeArray,tD.nodeImmutable,tD.nodeObject,tD.nodeObjects,tD.nodeProxy,tD.normalFlat,tD.normalGeometry,tD.normalLocal,tD.normalMap,tD.normalView,tD.normalWorld,tD.normalize,tD.not,tD.notEqual,tD.numWorkgroups,tD.objectDirection,tD.objectGroup,tD.objectPosition,tD.objectRadius,tD.objectScale,tD.objectViewPosition,tD.objectWorldMatrix,tD.oneMinus,tD.or,tD.orthographicDepthToViewZ,tD.oscSawtooth,tD.oscSine,tD.oscSquare,tD.oscTriangle,tD.output,tD.outputStruct,tD.overlay,tD.overloadingFn,tD.parabola,tD.parallaxDirection,tD.parallaxUV,tD.parameter,tD.pass,tD.passTexture,tD.pcurve,tD.perspectiveDepthToViewZ,tD.pmremTexture,tD.pointUV,tD.pointWidth,tD.positionGeometry,tD.positionLocal,tD.positionPrevious,tD.positionView,tD.positionViewDirection,tD.positionWorld,tD.positionWorldDirection,tD.posterize,tD.pow,tD.pow2,tD.pow3,tD.pow4,tD.premult,tD.property,tD.radians,tD.rand,tD.range,tD.rangeFog,tD.rangeFogFactor,tD.reciprocal,tD.lightProjectionUV,tD.reference,tD.referenceBuffer,tD.reflect,tD.reflectVector,tD.reflectView,tD.reflector,tD.refract,tD.refractVector,tD.refractView,tD.reinhardToneMapping,tD.remainder,tD.remap,tD.remapClamp,tD.renderGroup,tD.renderOutput,tD.rendererReference,tD.rotate,tD.rotateUV,tD.roughness,tD.round,tD.rtt,tD.sRGBTransferEOTF,tD.sRGBTransferOETF,tD.sampler,tD.samplerComparison,tD.saturate,tD.saturation,tD.screen,tD.screenCoordinate,tD.screenSize,tD.screenUV,tD.scriptable,tD.scriptableValue,tD.select,tD.setCurrentStack,tD.shaderStages,tD.shadow,tD.pointShadow,tD.shadowPositionWorld,tD.sharedUniformGroup,tD.shapeCircle,tD.sheen,tD.sheenRoughness,tD.shiftLeft,tD.shiftRight,tD.shininess,tD.sign;const MI=tD.sin;tD.sinc,tD.skinning,tD.smoothstep,tD.smoothstepElement,tD.specularColor,tD.specularF90,tD.spherizeUV,tD.split,tD.spritesheetUV;const NI=tD.sqrt;tD.stack,tD.step;const CI=tD.storage;tD.storageBarrier,tD.storageObject,tD.storageTexture,tD.string,tD.struct,tD.sub,tD.subgroupIndex,tD.subgroupSize,tD.tan,tD.tangentGeometry,tD.tangentLocal,tD.tangentView,tD.tangentWorld,tD.temp,tD.texture,tD.texture3D,tD.textureBarrier,tD.textureBicubic,tD.textureCubeUV,tD.textureLoad,tD.textureSize,tD.textureStore,tD.thickness,tD.time,tD.timerDelta,tD.timerGlobal,tD.timerLocal,tD.toneMapping,tD.toneMappingExposure,tD.toonOutlinePass,tD.transformDirection,tD.transformNormal,tD.transformNormalToView,tD.transformedBentNormalView,tD.transformedBitangentView,tD.transformedBitangentWorld,tD.transformedClearcoatNormalView,tD.transformedNormalView,tD.transformedNormalWorld,tD.transformedTangentView,tD.transformedTangentWorld,tD.transmission,tD.transpose,tD.triNoise3D,tD.triplanarTexture,tD.triplanarTextures,tD.trunc,tD.tslFn,tD.uint;const RI=tD.uniform;tD.uniformCubeTexture,tD.uniformArray,tD.uniformGroup,tD.uniformTexture,tD.uniforms,tD.unpremult,tD.userData,tD.uv,tD.uvec2,tD.uvec3,tD.uvec4,tD.Var,tD.varying,tD.varyingProperty,tD.vec2,tD.vec3,tD.vec4,tD.vectorComponents,tD.velocity,tD.vertexColor,tD.vertexIndex,tD.vibrance,tD.viewZToLogarithmicDepth,tD.viewZToOrthographicDepth,tD.viewZToPerspectiveDepth,tD.viewport,tD.viewportBottomLeft,tD.viewportCoordinate,tD.viewportDepthTexture,tD.viewportLinearDepth,tD.viewportMipTexture,tD.viewportResolution,tD.viewportSafeUV,tD.viewportSharedTexture,tD.viewportSize,tD.viewportTexture,tD.viewportTopLeft,tD.viewportUV,tD.wgsl,tD.wgslFn,tD.workgroupArray,tD.workgroupBarrier,tD.workgroupId,tD.workingToColorSpace,tD.xor;const PI=new _n,DI=new o;class BI extends bn{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new m([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new m([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new An(t,6,1);return this.setAttribute("instanceStart",new v(r,3,0)),this.setAttribute("instanceEnd",new v(r,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new An(t,6,1);return this.setAttribute("instanceColorStart",new v(r,3,0)),this.setAttribute("instanceColorEnd",new v(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new vn(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new _n);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),PI.setFromBufferAttribute(t),this.boundingBox.union(PI))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new cn),null===this.boundingBox&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let n=0;for(let i=0,o=e.count;i<o;i++)DI.fromBufferAttribute(e,i),n=Math.max(n,r.distanceToSquared(DI)),DI.fromBufferAttribute(t,i),n=Math.max(n,r.distanceToSquared(DI));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}}Sn.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new n(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},wn.line={uniforms:Tn.merge([Sn.common,Sn.fog,Sn.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tworldStart = start.xyz;\n\t\t\t\tworldEnd = end.xyz;\n\n\t\t\t#else\n\n\t\t\t\tvUv = uv;\n\n\t\t\t#endif\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec3 ndcStart = clipStart.xyz / clipStart.w;\n\t\t\tvec3 ndcEnd = clipEnd.xyz / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd.xy - ndcStart.xy;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\tvec3 worldDir = normalize( end.xyz - start.xyz );\n\t\t\t\tvec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );\n\t\t\t\tvec3 worldUp = normalize( cross( worldDir, tmpFwd ) );\n\t\t\t\tvec3 worldFwd = cross( worldDir, worldUp );\n\t\t\t\tworldPos = position.y < 0.5 ? start: end;\n\n\t\t\t\t// height offset\n\t\t\t\tfloat hw = linewidth * 0.5;\n\t\t\t\tworldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;\n\n\t\t\t\t// don't extend the line if we're rendering dashes because we\n\t\t\t\t// won't be rendering the endcaps\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t// cap extension\n\t\t\t\t\tworldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;\n\n\t\t\t\t\t// add width to the box\n\t\t\t\t\tworldPos.xyz += worldFwd * hw;\n\n\t\t\t\t\t// endcaps\n\t\t\t\t\tif ( position.y > 1.0 || position.y < 0.0 ) {\n\n\t\t\t\t\t\tworldPos.xyz -= worldFwd * 2.0 * hw;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t\t// project the worldpos\n\t\t\t\tvec4 clip = projectionMatrix * worldPos;\n\n\t\t\t\t// shift the depth of the projected points so the line\n\t\t\t\t// segments overlap neatly\n\t\t\t\tvec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;\n\t\t\t\tclip.z = clipPose.z * clip.w;\n\n\t\t\t#else\n\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\t\toffset += - dir;\n\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\t\toffset += dir;\n\n\t\t\t\t}\n\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\n\t\t\t\tclip.xy += offset;\n\n\t\t\t#endif\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\t\tuniform float linewidth;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashOffset;\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#ifdef WORLD_UNITS\n\n\t\t\tvarying vec4 worldPos;\n\t\t\tvarying vec3 worldStart;\n\t\t\tvarying vec3 worldEnd;\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t#endif\n\n\t\t#else\n\n\t\t\tvarying vec2 vUv;\n\n\t\t#endif\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {\n\n\t\t\tfloat mua;\n\t\t\tfloat mub;\n\n\t\t\tvec3 p13 = p1 - p3;\n\t\t\tvec3 p43 = p4 - p3;\n\n\t\t\tvec3 p21 = p2 - p1;\n\n\t\t\tfloat d1343 = dot( p13, p43 );\n\t\t\tfloat d4321 = dot( p43, p21 );\n\t\t\tfloat d1321 = dot( p13, p21 );\n\t\t\tfloat d4343 = dot( p43, p43 );\n\t\t\tfloat d2121 = dot( p21, p21 );\n\n\t\t\tfloat denom = d2121 * d4343 - d4321 * d4321;\n\n\t\t\tfloat numer = d1343 * d4321 - d1321 * d4343;\n\n\t\t\tmua = numer / denom;\n\t\t\tmua = clamp( mua, 0.0, 1.0 );\n\t\t\tmub = ( d1343 + d4321 * ( mua ) ) / d4343;\n\t\t\tmub = clamp( mub, 0.0, 1.0 );\n\n\t\t\treturn vec2( mua, mub );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat alpha = opacity;\n\t\t\tvec4 diffuseColor = vec4( diffuse, alpha );\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\t#ifdef WORLD_UNITS\n\n\t\t\t\t// Find the closest points on the view ray and the line segment\n\t\t\t\tvec3 rayEnd = normalize( worldPos.xyz ) * 1e5;\n\t\t\t\tvec3 lineDir = worldEnd - worldStart;\n\t\t\t\tvec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );\n\n\t\t\t\tvec3 p1 = worldStart + lineDir * params.x;\n\t\t\t\tvec3 p2 = rayEnd * params.y;\n\t\t\t\tvec3 delta = p1 - p2;\n\t\t\t\tfloat len = length( delta );\n\t\t\t\tfloat norm = len / linewidth;\n\n\t\t\t\t#ifndef USE_DASH\n\n\t\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t\tfloat dnorm = fwidth( norm );\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );\n\n\t\t\t\t\t#else\n\n\t\t\t\t\t\tif ( norm > 0.5 ) {\n\n\t\t\t\t\t\t\tdiscard;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#endif\n\n\t\t\t\t#endif\n\n\t\t\t#else\n\n\t\t\t\t#ifdef USE_ALPHA_TO_COVERAGE\n\n\t\t\t\t\t// artifacts appear on some hardware if a derivative is taken within a conditional\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\t\t\t\tfloat dlen = fwidth( len2 );\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\talpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t#else\n\n\t\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t\t\t}\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, alpha );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <colorspace_fragment>\n\t\t\t#include <fog_fragment>\n\t\t\t#include <premultiplied_alpha_fragment>\n\n\t\t}\n\t\t"};class qI extends xn{constructor(e){super({type:"LineMaterial",uniforms:Tn.clone(wn.line.uniforms),vertexShader:wn.line.vertexShader,fragmentShader:wn.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){!0===e!==this.dashed&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(!0===e!==this.alphaToCoverage&&(this.needsUpdate=!0),!0===e?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const OI=new M,LI=new o,kI=new o,II=new M,FI=new M,UI=new M,VI=new o,GI=new i,jI=new En,zI=new o,HI=new _n,WI=new cn,QI=new M;let $I,YI;function XI(e,t,r){return QI.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),QI.multiplyScalar(1/QI.w),QI.x=YI/r.width,QI.y=YI/r.height,QI.applyMatrix4(e.projectionMatrixInverse),QI.multiplyScalar(1/QI.w),Math.abs(Math.max(QI.x,QI.y))}class KI extends A{constructor(e=new BI,t=new qI({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,s=0,a=t.count;o<a;o++,s+=2)LI.fromBufferAttribute(t,o),kI.fromBufferAttribute(r,o),n[s]=0===s?0:n[s-1],n[s+1]=n[s]+LI.distanceTo(kI);const i=new An(n,2,1);return e.setAttribute("instanceDistanceStart",new v(i,1,0)),e.setAttribute("instanceDistanceEnd",new v(i,1,1)),this}raycast(e,t){const r=this.material.worldUnits,n=e.camera;null!==n||r||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const i=void 0!==e.params.Line2&&e.params.Line2.threshold||0;$I=e.ray;const s=this.matrixWorld,a=this.geometry,A=this.material;let l,u;if(YI=A.linewidth+i,null===a.boundingSphere&&a.computeBoundingSphere(),WI.copy(a.boundingSphere).applyMatrix4(s),r)l=.5*YI;else{l=XI(n,Math.max(n.near,WI.distanceToPoint($I.origin)),A.resolution)}if(WI.radius+=l,!1!==$I.intersectsSphere(WI)){if(null===a.boundingBox&&a.computeBoundingBox(),HI.copy(a.boundingBox).applyMatrix4(s),r)u=.5*YI;else{u=XI(n,Math.max(n.near,HI.distanceToPoint($I.origin)),A.resolution)}HI.expandByScalar(u),!1!==$I.intersectsBox(HI)&&(r?function(e,t){const r=e.matrixWorld,n=e.geometry,i=n.attributes.instanceStart,s=n.attributes.instanceEnd;for(let a=0,A=Math.min(n.instanceCount,i.count);a<A;a++){jI.start.fromBufferAttribute(i,a),jI.end.fromBufferAttribute(s,a),jI.applyMatrix4(r);const n=new o,A=new o;$I.distanceSqToSegment(jI.start,jI.end,A,n),A.distanceTo(n)<.5*YI&&t.push({point:A,pointOnLine:n,distance:$I.origin.distanceTo(A),object:e,face:null,faceIndex:a,uv:null,uv1:null})}}(this,t):function(e,t,r){const n=t.projectionMatrix,i=e.material.resolution,s=e.matrixWorld,a=e.geometry,A=a.attributes.instanceStart,l=a.attributes.instanceEnd,u=Math.min(a.instanceCount,A.count),c=-t.near;$I.at(1,UI),UI.w=1,UI.applyMatrix4(t.matrixWorldInverse),UI.applyMatrix4(n),UI.multiplyScalar(1/UI.w),UI.x*=i.x/2,UI.y*=i.y/2,UI.z=0,VI.copy(UI),GI.multiplyMatrices(t.matrixWorldInverse,s);for(let h=0,d=u;h<d;h++){if(II.fromBufferAttribute(A,h),FI.fromBufferAttribute(l,h),II.w=1,FI.w=1,II.applyMatrix4(GI),FI.applyMatrix4(GI),II.z>c&&FI.z>c)continue;if(II.z>c){const e=II.z-FI.z,t=(II.z-c)/e;II.lerp(FI,t)}else if(FI.z>c){const e=FI.z-II.z,t=(FI.z-c)/e;FI.lerp(II,t)}II.applyMatrix4(n),FI.applyMatrix4(n),II.multiplyScalar(1/II.w),FI.multiplyScalar(1/FI.w),II.x*=i.x/2,II.y*=i.y/2,FI.x*=i.x/2,FI.y*=i.y/2,jI.start.copy(II),jI.start.z=0,jI.end.copy(FI),jI.end.z=0;const t=jI.closestPointToPointParameter(VI,!0);jI.at(t,zI);const a=Jr.lerp(II.z,FI.z,t),u=a>=-1&&a<=1,d=VI.distanceTo(zI)<.5*YI;if(u&&d){jI.start.fromBufferAttribute(A,h),jI.end.fromBufferAttribute(l,h),jI.start.applyMatrix4(s),jI.end.applyMatrix4(s);const t=new o,n=new o;$I.distanceSqToSegment(jI.start,jI.end,n,t),r.push({point:n,pointOnLine:t,distance:$I.origin.distanceTo(n),object:e,face:null,faceIndex:h,uv:null,uv1:null})}}}(this,n,t))}}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(OI),this.material.uniforms.resolution.value.set(OI.z,OI.w))}}class ZI extends BI{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let n=0;n<t;n+=3)r[2*n]=e[n],r[2*n+1]=e[n+1],r[2*n+2]=e[n+2],r[2*n+3]=e[n+3],r[2*n+4]=e[n+4],r[2*n+5]=e[n+5];return super.setPositions(r),this}setColors(e){const t=e.length-3,r=new Float32Array(2*t);for(let n=0;n<t;n+=3)r[2*n]=e[n],r[2*n+1]=e[n+1],r[2*n+2]=e[n+2],r[2*n+3]=e[n+3],r[2*n+4]=e[n+4],r[2*n+5]=e[n+5];return super.setColors(r),this}setFromPoints(e){const t=e.length-1,r=new Float32Array(6*t);for(let n=0;n<t;n++)r[6*n]=e[n].x,r[6*n+1]=e[n].y,r[6*n+2]=e[n].z||0,r[6*n+3]=e[n+1].x,r[6*n+4]=e[n+1].y,r[6*n+5]=e[n+1].z||0;return super.setPositions(r),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class JI extends KI{constructor(e=new ZI,t=new qI({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}class eF extends Mn{constructor(e,t={}){const r=t.font;if(void 0===r)super();else{const n=r.generateShapes(e,t.size);void 0===t.depth&&(t.depth=50),void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(n,t)}this.type="TextGeometry"}}function tF(e,t,r,n,i){const o=i.glyphs[e]||i.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");const s=new Nn;let a,A,l,u,c,h,d,p;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let i=0,o=e.length;i<o;){switch(e[i++]){case"m":a=e[i++]*t+r,A=e[i++]*t+n,s.moveTo(a,A);break;case"l":a=e[i++]*t+r,A=e[i++]*t+n,s.lineTo(a,A);break;case"q":l=e[i++]*t+r,u=e[i++]*t+n,c=e[i++]*t+r,h=e[i++]*t+n,s.quadraticCurveTo(c,h,l,u);break;case"b":l=e[i++]*t+r,u=e[i++]*t+n,c=e[i++]*t+r,h=e[i++]*t+n,d=e[i++]*t+r,p=e[i++]*t+n,s.bezierCurveTo(c,h,d,p,l,u)}}}return{offsetX:o.ha*t,path:s}}function rF(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function nF(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}function iF(e,t,r,n,i,o,s){try{var a=e[o](s),A=a.value}catch(e){return void r(e)}a.done?t(A):Promise.resolve(A).then(n,i)}function oF(e,t,r){return t=pF(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,mF()?Reflect.construct(t,r||[],pF(e).constructor):t.apply(e,r))}function sF(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function aF(e,t){return e.get(nF(e,t))}function AF(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}function lF(e,t,r){return e.set(nF(e,t),r),r}function uF(e,t,r){if(mF())return Reflect.construct.apply(null,arguments);var n=[null];return n.push.apply(n,t),new(e.bind.apply(e,n))}function cF(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,TF(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function hF(e,t,r){return(t=TF(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dF(){return dF="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=pF(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},dF.apply(null,arguments)}function pF(e){return pF=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pF(e)}function fF(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vF(e,t)}function mF(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(mF=function(){return!!e})()}function gF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function yF(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gF(Object(r),!0).forEach(function(t){hF(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function bF(){bF=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function A(e,t,r,n){return Object.defineProperty(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{A({},"")}catch(e){A=function(e,t,r){return e[t]=r}}function l(t,r,n,i){var o=r&&r.prototype instanceof h?r:h,s=Object.create(o.prototype);return A(s,"_invoke",function(t,r,n){var i=1;return function(o,s){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===o)throw s;return{value:e,done:!0}}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var A=_(a,n);if(A){if(A===c)continue;return A}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===i)throw i=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=3;var l=u(t,r,n);if("normal"===l.type){if(i=n.done?4:2,l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=4,n.method="throw",n.arg=l.arg)}}}(t,n,new T(i||[])),!0),s}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var c={};function h(){}function d(){}function p(){}var f={};A(f,o,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(S([])));g&&g!==r&&n.call(g,o)&&(f=g);var y=p.prototype=h.prototype=Object.create(f);function b(e){["next","throw","return"].forEach(function(t){A(e,t,function(e){return this._invoke(t,e)})})}function v(e,t){function r(i,o,s,a){var A=u(e[i],e,o);if("throw"!==A.type){var l=A.arg,c=l.value;return c&&"object"==typeof c&&n.call(c,"__await")?t.resolve(c.__await).then(function(e){r("next",e,s,a)},function(e){r("throw",e,s,a)}):t.resolve(c).then(function(e){l.value=e,s(l)},function(e){return r("throw",e,s,a)})}a(A.arg)}var i;A(this,"_invoke",function(e,n){function o(){return new t(function(t,i){r(e,n,t,i)})}return i=i?i.then(o,o):o()},!0)}function _(t,r){var n=r.method,i=t.i[n];if(i===e)return r.delegate=null,"throw"===n&&t.i.return&&(r.method="return",r.arg=e,_(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),c;var o=u(i,t.i,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,c;var s=o.arg;return s?s.done?(r[t.r]=s.value,r.next=t.n,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,c):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,c)}function x(e){this.tryEntries.push(e)}function w(t){var r=t[4]||{};r.type="normal",r.arg=e,t[4]=r}function T(e){this.tryEntries=[[-1]],e.forEach(x,this),this.reset(!0)}function S(t){if(null!=t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(typeof t+" is not iterable")}return d.prototype=p,A(y,"constructor",p),A(p,"constructor",d),d.displayName=A(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,A(e,a,"GeneratorFunction")),e.prototype=Object.create(y),e},t.awrap=function(e){return{__await:e}},b(v.prototype),A(v.prototype,s,function(){return this}),t.AsyncIterator=v,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var s=new v(l(e,r,n,i),o);return t.isGeneratorFunction(r)?s:s.next().then(function(e){return e.done?e.value:s.next()})},b(y),A(y,a,"Generator"),A(y,o,function(){return this}),A(y,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},t.values=S,T.prototype={constructor:T,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(w),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0][4];if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(e){s.type="throw",s.arg=t,r.next=e}for(var i=r.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o[4],a=this.prev,A=o[1],l=o[2];if(-1===o[0])return n("end"),!1;if(!A&&!l)throw Error("try statement without catch or finally");if(null!=o[0]&&o[0]<=a){if(a<A)return this.method="next",this.arg=e,n(A),!0;if(a<l)return n(l),!1}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var i=n;break}}i&&("break"===e||"continue"===e)&&i[0]<=t&&t<=i[2]&&(i=null);var o=i?i[4]:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i[2],c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[2]===e)return this.complete(r[4],r[3]),w(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r[0]===e){var n=r[4];if("throw"===n.type){var i=n.arg;w(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={i:S(t),r:r,n:n},"next"===this.method&&(this.arg=e),c}},t}function vF(e,t){return vF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vF(e,t)}function _F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;A=!1}else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||SF(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xF(e,t,r,n){var i=dF(pF(e.prototype),t,r);return"function"==typeof i?function(e){return i.apply(r,e)}:i}function wF(e){return function(e){if(Array.isArray(e))return rF(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||SF(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function TF(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function SF(e,t){if(e){if("string"==typeof e)return rF(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?rF(e,t):void 0}}var EF=function(e){e instanceof Array?e.forEach(EF):(e.map&&e.map.dispose(),e.dispose())},MF=function(e){e.geometry&&e.geometry.dispose(),e.material&&EF(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(MF)},NF=function(e){if(e&&e.children)for(;e.children.length;){var t=e.children[0];e.remove(t),MF(t)}};function CF(e,t){var r=new t;return{linkProp:function(t){return{default:r[t](),onChange:function(r,n){n[e][t](r)},triggerUpdate:!1}},linkMethod:function(t){return function(r){for(var n=r[e],i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];var a=n[t].apply(n,o);return a===n?this:a}}}}var RF=100;function PF(){return RF}function DF(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(90-e)*Math.PI/180,i=(90-t)*Math.PI/180,o=RF*(1+r),s=Math.sin(n);return{x:o*s*Math.cos(i),y:o*Math.cos(n),z:o*s*Math.sin(i)}}function BF(e){var t=e.x,r=e.y,n=e.z,i=Math.sqrt(t*t+r*r+n*n),o=Math.acos(r/i),s=Math.atan2(n,t);return{lat:90-180*o/Math.PI,lng:90-180*s/Math.PI-(s<-Math.PI/2?360:0),altitude:i/RF-1}}function qF(e){return e*Math.PI/180}var OF=window.THREE?window.THREE:{BackSide:O,BufferAttribute:g,Color:te,Mesh:A,ShaderMaterial:xn};var LF=function(){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.color,o=void 0===i?"gold":i,s=n.size,a=void 0===s?2:s,A=n.coefficient,l=void 0===A?.5:A,u=n.power,c=void 0===u?1:u,h=n.hollowRadius,d=void 0===h?0:h,p=n.backside,f=void 0===p||p;sF(this,e),r=oF(this,e);var m=function(e,t){for(var r=e.clone(),n=new Float32Array(3*e.attributes.position.count),i=0,o=n.length;i<o;i++){var s=e.attributes.normal.array[i],a=e.attributes.position.array[i];n[i]=a+s*t}return r.setAttribute("position",new OF.BufferAttribute(n,3)),r}(t,a),g=function(e,t,r,n){return new OF.ShaderMaterial({depthWrite:!1,transparent:!0,vertexShader:"\nuniform float hollowRadius;\n\nvarying vec3 vVertexWorldPosition;\nvarying vec3 vVertexNormal;\nvarying float vCameraDistanceToObjCenter;\nvarying float vVertexAngularDistanceToHollowRadius;\n\nvoid main() {    \n  vVertexNormal\t= normalize(normalMatrix * normal);\n  vVertexWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n  \n  vec4 objCenterViewPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n  vCameraDistanceToObjCenter = length(objCenterViewPosition);\n  \n  float edgeAngle = atan(hollowRadius / vCameraDistanceToObjCenter);\n  float vertexAngle = acos(dot(normalize(modelViewMatrix * vec4(position, 1.0)), normalize(objCenterViewPosition)));\n  vVertexAngularDistanceToHollowRadius = vertexAngle - edgeAngle;\n\n  gl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"\nuniform vec3 color;\nuniform float coefficient;\nuniform float power;\nuniform float hollowRadius;\n\nvarying vec3 vVertexNormal;\nvarying vec3 vVertexWorldPosition;\nvarying float vCameraDistanceToObjCenter;\nvarying float vVertexAngularDistanceToHollowRadius;\n\nvoid main() {\n  if (vCameraDistanceToObjCenter < hollowRadius) discard; // inside the hollowRadius\n  if (vVertexAngularDistanceToHollowRadius < 0.0) discard; // frag position is within the hollow radius\n\n  vec3 worldCameraToVertex = vVertexWorldPosition - cameraPosition;\n  vec3 viewCameraToVertex\t= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;\n  viewCameraToVertex = normalize(viewCameraToVertex);\n  float intensity\t= pow(\n    coefficient + dot(vVertexNormal, viewCameraToVertex),\n    power\n  );\n  gl_FragColor = vec4(color, intensity);\n}",uniforms:{coefficient:{value:e},color:{value:new OF.Color(t)},power:{value:r},hollowRadius:{value:n}}})}(l,o,c,d);return f&&(g.side=OF.BackSide),r.geometry=m,r.material=g,r}return fF(e,OF.Mesh),cF(e)}(),kF=window.THREE?window.THREE:{Color:te,Group:a,LineBasicMaterial:_r,LineSegments:Dn,Mesh:A,MeshPhongMaterial:fr,SphereGeometry:l,SRGBColorSpace:p,TextureLoader:d},IF=ki({props:{globeImageUrl:{},bumpImageUrl:{},showGlobe:{default:!0,onChange:function(e,t){t.globeGroup.visible=!!e},triggerUpdate:!1},showGraticules:{default:!1,onChange:function(e,t){t.graticulesObj.visible=!!e},triggerUpdate:!1},showAtmosphere:{default:!0,onChange:function(e,t){t.atmosphereObj&&(t.atmosphereObj.visible=!!e)},triggerUpdate:!1},atmosphereColor:{default:"lightskyblue"},atmosphereAltitude:{default:.15},globeTileEngineUrl:{onChange:function(e,t){t.tileEngine.tileUrl=e}},globeTileEngineMaxLevel:{default:17,onChange:function(e,t){t.tileEngine.maxLevel=e},triggerUpdate:!1},updatePov:{onChange:function(e,t){t.tileEngine.updatePov(e)},triggerUpdate:!1},onReady:{default:function(){},triggerUpdate:!1}},methods:{globeMaterial:function(e,t){return void 0!==t?(e.globeObj.material=t||e.defaultGlobeMaterial,this):e.globeObj.material},_destructor:function(e){NF(e.globeObj),NF(e.tileEngine),NF(e.graticulesObj)}},stateInit:function(){var e=new kF.SphereGeometry(RF,75,75),t=new kF.MeshPhongMaterial({color:0}),r=new kF.Mesh(e,t);r.rotation.y=-Math.PI/2;var n=new _u(RF),i=new kF.Group;return i.__globeObjType="globe",i.add(r),i.add(n),{globeGroup:i,globeObj:r,graticulesObj:new kF.LineSegments(new Ac(vl(),RF,2),new kF.LineBasicMaterial({color:"lightgrey",transparent:!0,opacity:.1})),defaultGlobeMaterial:t,tileEngine:n}},init:function(e,t){NF(e),t.scene=e,t.scene.add(t.globeGroup),t.scene.add(t.graticulesObj),t.ready=!1},update:function(e,t){var r=e.globeObj.material;if(e.tileEngine.visible=!(e.globeObj.visible=!e.globeTileEngineUrl),t.hasOwnProperty("globeImageUrl")&&(e.globeImageUrl?(new kF.TextureLoader).load(e.globeImageUrl,function(t){t.colorSpace=kF.SRGBColorSpace,r.map=t,r.color=null,r.needsUpdate=!0,!e.ready&&(e.ready=!0)&&setTimeout(e.onReady)}):!r.color&&(r.color=new kF.Color(0))),t.hasOwnProperty("bumpImageUrl")&&(e.bumpImageUrl?e.bumpImageUrl&&(new kF.TextureLoader).load(e.bumpImageUrl,function(e){r.bumpMap=e,r.needsUpdate=!0}):(r.bumpMap=null,r.needsUpdate=!0)),(t.hasOwnProperty("atmosphereColor")||t.hasOwnProperty("atmosphereAltitude"))&&(e.atmosphereObj&&(e.scene.remove(e.atmosphereObj),NF(e.atmosphereObj)),e.atmosphereColor&&e.atmosphereAltitude)){var n=e.atmosphereObj=new LF(e.globeObj.geometry,{color:e.atmosphereColor,size:RF*e.atmosphereAltitude,hollowRadius:RF,coefficient:.1,power:3.5});n.visible=!!e.showAtmosphere,n.__globeObjType="atmosphere",e.scene.add(n)}e.ready||e.globeImageUrl&&!e.globeTileEngineUrl||(e.ready=!0,e.onReady())}}),FF=function(e){return isNaN(e)?parseInt(bc(e).toHex(),16):e},UF=function(e){return e&&isNaN(e)?Lo(e).opacity:1},VF=function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1,o=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.eE+-]+)\s*\)$/.exec(e.trim().toLowerCase());if(o){var s=_F(o.slice(1),4),a=s[0],A=s[1],l=s[2],u=s[3];t=new te("rgb(".concat(+a,",").concat(+A,",").concat(+l,")")),i=Math.min(+u,1)}else t=new te(e);n&&t.convertLinearToSRGB();var c=t.toArray();return r?[].concat(wF(c),[i]):c};var GF=window.THREE?window.THREE:{BufferAttribute:g};function jF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float32Array;if(1===t)return new GF.BufferAttribute(new r(e),t);for(var n=new GF.BufferAttribute(new r(e.length*t),t),i=0,o=e.length;i<o;i++)n.set(e[i],i*t);return n}var zF=new WeakMap,HF=new WeakMap,WF=new WeakMap,QF=function(){function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.dataBindAttr,o=void 0===i?"__data":i,s=n.objBindAttr,a=void 0===s?"__threeObj":s,A=n.removeDelay,l=void 0===A?0:A;return sF(this,e),hF(r=oF(this,e),"scene",void 0),AF(r,zF,void 0),AF(r,HF,void 0),AF(r,WF,void 0),r.scene=t,lF(zF,r,o),lF(HF,r,a),lF(WF,r,l),r.onRemoveObj(function(){}),r}return fF(e,ph),cF(e,[{key:"onCreateObj",value:function(t){var r=this;return xF(e,"onCreateObj",this)([function(e){var n=t(e);return e[aF(HF,r)]=n,n[aF(zF,r)]=e,r.scene.add(n),n}]),this}},{key:"onRemoveObj",value:function(t){var r=this;return xF(e,"onRemoveObj",this)([function(n,i){var o=xF(e,"getData",r)([n]);t(n,i);var s=function(){r.scene.remove(n),NF(n),delete o[aF(HF,r)]};aF(WF,r)?setTimeout(s,aF(WF,r)):s()}]),this}}])}(),$F=window.THREE?window.THREE:{BufferGeometry:f,CylinderGeometry:fe,Matrix4:i,Mesh:A,MeshLambertMaterial:h,Object3D:r,Vector3:o},YF=Object.assign({},pc),XF=YF.BufferGeometryUtils||YF,KF=ki({props:{pointsData:{default:[]},pointLat:{default:"lat"},pointLng:{default:"lng"},pointColor:{default:function(){return"#ffffaa"}},pointAltitude:{default:.1},pointRadius:{default:.25},pointResolution:{default:12,triggerUpdate:!1},pointsMerge:{default:!1},pointsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjPoint"})},update:function(e,t){var r=fc(e.pointLat),n=fc(e.pointLng),i=fc(e.pointAltitude),o=fc(e.pointRadius),s=fc(e.pointColor),a=new $F.CylinderGeometry(1,1,1,e.pointResolution);a.applyMatrix4((new $F.Matrix4).makeRotationX(Math.PI/2)),a.applyMatrix4((new $F.Matrix4).makeTranslation(0,0,-.5));var A=2*Math.PI*RF/360,l={};if(!e.pointsMerge&&t.hasOwnProperty("pointsMerge")&&NF(e.scene),e.dataMapper.scene=e.pointsMerge?new $F.Object3D:e.scene,e.dataMapper.onCreateObj(function(){var e=new $F.Mesh(a);return e.__globeObjType="point",e}).onUpdateObj(function(t,a){var u=function(r){var n=t.__currentTargetD=r,i=n.r,o=n.alt,s=n.lat,a=n.lng;Object.assign(t.position,DF(s,a));var l=e.pointsMerge?new $F.Vector3(0,0,0):e.scene.localToWorld(new $F.Vector3(0,0,0));t.lookAt(l),t.scale.x=t.scale.y=Math.min(30,i)*A,t.scale.z=Math.max(o*RF,.1)},c={alt:+i(a),r:+o(a),lat:+r(a),lng:+n(a)},h=t.__currentTargetD||Object.assign({},c,{alt:-.001});Object.keys(c).some(function(e){return h[e]!==c[e]})&&(e.pointsMerge||!e.pointsTransitionDuration||e.pointsTransitionDuration<0?u(c):e.tweenGroup.add(new zi(h).to(c,e.pointsTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(u).start()));if(!e.pointsMerge){var d=s(a),p=d?UF(d):0,f=!!p;t.visible=f,f&&(l.hasOwnProperty(d)||(l[d]=new $F.MeshLambertMaterial({color:FF(d),transparent:p<1,opacity:p})),t.material=l[d])}}).digest(e.pointsData),e.pointsMerge){var u=e.pointsData.length?(XF.mergeGeometries||XF.mergeBufferGeometries)(e.pointsData.map(function(t){var r=e.dataMapper.getObj(t),n=r.geometry.clone();r.updateMatrix(),n.applyMatrix4(r.matrix);var i=VF(s(t));return n.setAttribute("color",jF(Array(n.getAttribute("position").count).fill(i),4)),n})):new $F.BufferGeometry,c=new $F.Mesh(u,new $F.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0}));c.__globeObjType="points",c.__data=e.pointsData,e.dataMapper.clear(),NF(e.scene),e.scene.add(c)}}}),ZF=function(){return{uniforms:{dashOffset:{value:0},dashSize:{value:1},gapSize:{value:0},dashTranslate:{value:0}},vertexShader:"\n    ".concat(Ln.common,"\n    ").concat(Ln.logdepthbuf_pars_vertex,"\n  \n    uniform float dashTranslate; \n\n    attribute vec4 color;\n    varying vec4 vColor;\n    \n    attribute float relDistance;\n    varying float vRelDistance;\n\n    void main() {\n      // pass through colors and distances\n      vColor = color;\n      vRelDistance = relDistance + dashTranslate;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  \n      ").concat(Ln.logdepthbuf_vertex,"\n    }\n  "),fragmentShader:"\n    ".concat(Ln.logdepthbuf_pars_fragment,"\n\n    uniform float dashOffset; \n    uniform float dashSize;\n    uniform float gapSize; \n    \n    varying vec4 vColor;\n    varying float vRelDistance;\n    \n    void main() {\n      // ignore pixels in the gap\n      if (vRelDistance < dashOffset) discard;\n      if (mod(vRelDistance - dashOffset, dashSize + gapSize) > dashSize) discard;\n    \n      // set px color: [r, g, b, a], interpolated between vertices \n      gl_FragColor = vColor; \n  \n      ").concat(Ln.logdepthbuf_fragment,"\n    }\n  ")}},JF=function(e){return e.uniforms.surfaceRadius={type:"float",value:0},e.vertexShader=("attribute float surfaceRadius;\nvarying float vSurfaceRadius;\nvarying vec3 vPos;\n"+e.vertexShader).replace("void main() {",["void main() {","vSurfaceRadius = surfaceRadius;","vPos = position;"].join("\n")),e.fragmentShader=("uniform float surfaceRadius;\nvarying float vSurfaceRadius;\nvarying vec3 vPos;\n"+e.fragmentShader).replace("void main() {",["void main() {","if (length(vPos) < max(surfaceRadius, vSurfaceRadius)) discard;"].join("\n")),e},eU=function(e){return e.vertexShader="\n    attribute float r;\n    \n    const float PI = 3.1415926535897932384626433832795;\n    float toRad(in float a) {\n      return a * PI / 180.0;\n    }\n    \n    vec3 Polar2Cartesian(in vec3 c) { // [lat, lng, r]\n      float phi = toRad(90.0 - c.x);\n      float theta = toRad(90.0 - c.y);\n      float r = c.z;\n      return vec3( // x,y,z\n        r * sin(phi) * cos(theta),\n        r * cos(phi),\n        r * sin(phi) * sin(theta)\n      );\n    }\n    \n    vec2 Cartesian2Polar(in vec3 p) {\n      float r = sqrt(p.x * p.x + p.y * p.y + p.z * p.z);\n      float phi = acos(p.y / r);\n      float theta = atan(p.z, p.x);\n      return vec2( // lat,lng\n        90.0 - phi * 180.0 / PI,\n        90.0 - theta * 180.0 / PI - (theta < -PI / 2.0 ? 360.0 : 0.0)\n      );\n    }\n    ".concat(e.vertexShader.replace("}","                  \n        vec3 pos = Polar2Cartesian(vec3(Cartesian2Polar(position), r));\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n      }\n    "),"\n  "),e},tU=function(e,t){return e.onBeforeCompile=function(r){e.userData.shader=t(r)},e},rU=["stroke"],nU=window.THREE?window.THREE:{BufferGeometry:f,CubicBezierCurve3:qn,Curve:On,Group:a,Line:Cn,Mesh:A,NormalBlending:ee,ShaderMaterial:xn,TubeGeometry:Bn,Vector3:o},iU=gh.default||gh,oU=ki({props:{arcsData:{default:[]},arcStartLat:{default:"startLat"},arcStartLng:{default:"startLng"},arcEndLat:{default:"endLat"},arcEndLng:{default:"endLng"},arcColor:{default:function(){return"#ffffaa"}},arcAltitude:{},arcAltitudeAutoScale:{default:.5},arcStroke:{},arcCurveResolution:{default:64,triggerUpdate:!1},arcCircularResolution:{default:6,triggerUpdate:!1},arcDashLength:{default:1},arcDashGap:{default:0},arcDashInitialGap:{default:0},arcDashAnimateTime:{default:0},arcsTransitionDuration:{default:1e3,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.pause()},resumeAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.resume()},_destructor:function(e){var t;e.sharedMaterial.dispose(),null===(t=e.ticker)||void 0===t||t.dispose()}},stateInit:function(e){return{tweenGroup:e.tweenGroup,ticker:new iU,sharedMaterial:new nU.ShaderMaterial(yF(yF({},ZF()),{},{transparent:!0,blending:nU.NormalBlending}))}},init:function(e,t){NF(e),t.scene=e,t.dataMapper=new QF(e,{objBindAttr:"__threeObjArc"}).onCreateObj(function(){var e=new nU.Group;return e.__globeObjType="arc",e}),t.ticker.onTick.add(function(e,r){t.dataMapper.entries().map(function(e){return _F(e,2)[1]}).filter(function(e){return e.children.length&&e.children[0].material&&e.children[0].__dashAnimateStep}).forEach(function(e){var t=e.children[0],n=t.__dashAnimateStep*r,i=t.material.uniforms.dashTranslate.value%1e9;t.material.uniforms.dashTranslate.value=i+n})})},update:function(e){var t=fc(e.arcStartLat),r=fc(e.arcStartLng),n=fc(e.arcEndLat),i=fc(e.arcEndLng),o=fc(e.arcAltitude),s=fc(e.arcAltitudeAutoScale),a=fc(e.arcStroke),A=fc(e.arcColor),l=fc(e.arcDashLength),u=fc(e.arcDashGap),c=fc(e.arcDashInitialGap),h=fc(e.arcDashAnimateTime);e.dataMapper.onUpdateObj(function(d,p){var f=a(p),m=null!=f;if(!d.children.length||m!==("Mesh"===d.children[0].type)){NF(d);var g=m?new nU.Mesh:new nU.Line(new nU.BufferGeometry);g.material=e.sharedMaterial.clone(),d.add(g)}var y=d.children[0];Object.assign(y.material.uniforms,{dashSize:{value:l(p)},gapSize:{value:u(p)},dashOffset:{value:c(p)}});var b=h(p);y.__dashAnimateStep=b>0?1e3/b:0;var v=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=t+1;if(e instanceof Array||e instanceof Function){var o=e instanceof Array?Is().domain(e.map(function(t,r){return r/(e.length-1)})).range(e):e;r=function(e){return VF(o(e),!0,!0)}}else{var s=VF(e,!0,!0);r=function(){return s}}for(var a=[],A=0,l=i;A<l;A++)for(var u=r(A/(l-1)),c=0;c<n;c++)a.push(u);return jF(a,4)}(A(p),e.arcCurveResolution,m?e.arcCircularResolution+1:1),_=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],i=0,o=e+1;i<o;i++)for(var s=i/(o-1),a=0;a<t;a++)n.push(s);return r&&n.reverse(),jF(n,1)}(e.arcCurveResolution,m?e.arcCircularResolution+1:1,!0);y.geometry.setAttribute("color",v),y.geometry.setAttribute("relDistance",_);var x=function(t){var r=d.__currentTargetD=t,n=r.stroke,i=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(r,rU),o=function(e){var t=e.alt,r=e.altAutoScale,n=e.startLat,i=e.startLng,o=e.endLat,s=e.endLng,a=function(e){var t=_F(e,3),r=t[0],n=DF(t[1],r,t[2]),i=n.x,o=n.y,s=n.z;return new nU.Vector3(i,o,s)},A=[i,n],l=[s,o],u=t;if(null==u&&(u=ll(A,l)/2*r),u){var c=_l(A,l),h=[.25,.75].map(function(e){return[].concat(wF(c(e)),[1.5*u])}),d=_F(h,2),p=d[0],f=d[1];return uF(nU.CubicBezierCurve3,wF([A,p,f,l].map(a)))}var m=.001;return g.apply(void 0,wF([[].concat(A,[m]),[].concat(l,[m])].map(a)));function g(e,t){var r=e.angleTo(t),n=0===r?function(){return e.clone()}:function(n){return(new nU.Vector3).addVectors(e.clone().multiplyScalar(Math.sin((1-n)*r)),t.clone().multiplyScalar(Math.sin(n*r))).divideScalar(Math.sin(r))},i=new nU.Curve;return i.getPoint=n,i}}(i);m?(y.geometry&&y.geometry.dispose(),y.geometry=new nU.TubeGeometry(o,e.arcCurveResolution,n/2,e.arcCircularResolution),y.geometry.setAttribute("color",v),y.geometry.setAttribute("relDistance",_)):y.geometry.setFromPoints(o.getPoints(e.arcCurveResolution))},w={stroke:f,alt:o(p),altAutoScale:+s(p),startLat:+t(p),startLng:+r(p),endLat:+n(p),endLng:+i(p)},T=d.__currentTargetD||Object.assign({},w,{altAutoScale:-.001});Object.keys(w).some(function(e){return T[e]!==w[e]})&&(!e.arcsTransitionDuration||e.arcsTransitionDuration<0?x(w):e.tweenGroup.add(new zi(T).to(w,e.arcsTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(x).start()))}).digest(e.arcsData)}}),sU=window.THREE?window.THREE:{BufferGeometry:f,DoubleSide:k,Mesh:A,MeshLambertMaterial:h,Object3D:r},aU=Object.assign({},pc),AU=aU.BufferGeometryUtils||aU,lU=ki({props:{hexBinPointsData:{default:[]},hexBinPointLat:{default:"lat"},hexBinPointLng:{default:"lng"},hexBinPointWeight:{default:1},hexBinResolution:{default:4},hexMargin:{default:.2},hexTopCurvatureResolution:{default:5},hexTopColor:{default:function(){return"#ffffaa"}},hexSideColor:{default:function(){return"#ffffaa"}},hexAltitude:{default:function(e){return.01*e.sumWeight}},hexBinMerge:{default:!1},hexTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjHexbin"})},update:function(e,t){var r=fc(e.hexBinPointLat),n=fc(e.hexBinPointLng),i=fc(e.hexBinPointWeight),o=fc(e.hexAltitude),s=fc(e.hexTopColor),a=fc(e.hexSideColor),A=fc(e.hexMargin),l=qd(e.hexBinPointsData.map(function(t){return yF(yF({},t),{},{h3Idx:op(r(t),n(t),e.hexBinResolution)})}),"h3Idx"),u=Object.entries(l).map(function(e){var t=_F(e,2),r=t[0],n=t[1];return{h3Idx:r,points:n,sumWeight:n.reduce(function(e,t){return e+ +i(t)},0)}}),c={};if(!e.hexBinMerge&&t.hasOwnProperty("hexBinMerge")&&NF(e.scene),e.dataMapper.scene=e.hexBinMerge?new sU.Object3D:e.scene,e.dataMapper.id(function(e){return e.h3Idx}).onCreateObj(function(e){var t=new sU.Mesh;t.__hexCenter=sp(e.h3Idx),t.__hexGeoJson=ap(e.h3Idx).reverse();var r=t.__hexCenter[1];return t.__hexGeoJson.forEach(function(e){var t=e[0];Math.abs(r-t)>170&&(e[0]+=r>t?360:-360)}),t.__globeObjType="hexbin",t}).onUpdateObj(function(t,r){var n=Math.max(0,Math.min(1,+A(r))),i=_F(t.__hexCenter,2),l=i[0],u=i[1],h=0===n?t.__hexGeoJson:t.__hexGeoJson.map(function(e){var t=_F(e,2),r=t[0],i=t[1];return[[r,u],[i,l]].map(function(e){var t=_F(e,2);return function(e,t,r){return e-(e-t)*r}(t[0],t[1],n)})}),d=e.hexTopCurvatureResolution;t.geometry&&t.geometry.dispose(),t.geometry=new Nd([h],0,RF,!1,!0,!0,d);var p={alt:+o(r)},f=function(e){var r=(t.__currentTargetD=e).alt;t.scale.x=t.scale.y=t.scale.z=1+r;var n=RF/(r+1);t.geometry.setAttribute("surfaceRadius",jF(Array(t.geometry.getAttribute("position").count).fill(n),1))},m=t.__currentTargetD||Object.assign({},p,{alt:-.001});Object.keys(p).some(function(e){return m[e]!==p[e]})&&(e.hexBinMerge||!e.hexTransitionDuration||e.hexTransitionDuration<0?f(p):e.tweenGroup.add(new zi(m).to(p,e.hexTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(f).start()));if(!e.hexBinMerge){var g=a(r),y=s(r);[g,y].forEach(function(e){if(!c.hasOwnProperty(e)){var t=UF(e);c[e]=tU(new sU.MeshLambertMaterial({color:FF(e),transparent:t<1,opacity:t,side:sU.DoubleSide}),JF)}}),t.material=[g,y].map(function(e){return c[e]})}}).digest(u),e.hexBinMerge){var h=u.length?(AU.mergeGeometries||AU.mergeBufferGeometries)(u.map(function(t){var r=e.dataMapper.getObj(t),n=r.geometry.toNonIndexed();r.updateMatrix(),n.applyMatrix4(r.matrix);var i=VF(s(t)),o=VF(a(t)),A=n.getAttribute("position").count,l=n.groups[0].count;return n.setAttribute("color",jF(wF(new Array(A)).map(function(e,t){return t>=l?i:o}),4)),n})):new sU.BufferGeometry,d=new sU.MeshLambertMaterial({color:16777215,transparent:!0,vertexColors:!0,side:sU.DoubleSide});d.onBeforeCompile=function(e){d.userData.shader=JF(e)};var p=new sU.Mesh(h,d);p.__globeObjType="hexBinPoints",p.__data=u,e.dataMapper.clear(),NF(e.scene),e.scene.add(p)}}}),uU=function(e){return e*e},cU=function(e){return e*Math.PI/180};var hU=Math.sqrt(2*Math.PI);var dU=function(e){var t=_F(e,2),r=t[0],n=t[1],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=o.lngAccessor,a=void 0===s?function(e){return e[0]}:s,A=o.latAccessor,l=void 0===A?function(e){return e[1]}:A,u=o.weightAccessor,c=void 0===u?function(){return 1}:u,h=o.bandwidth,d=[r,n],p=h*Math.PI/180;return function(e){let t=0;for(let r of e)(r=+r)&&(t+=r);return t}(i.map(function(e){var t=c(e);if(!t)return 0;var r=function(e,t){var r=Math.sqrt,n=Math.cos,i=function(e){return uU(Math.sin(e/2))},o=cU(e[1]),s=cU(t[1]),a=cU(e[0]),A=cU(t[0]);return 2*Math.asin(r(i(s-o)+n(o)*n(s)*i(A-a)))}(d,[a(e),l(e)]);return function(e,t){return Math.exp(-uU(e/t)/2)/(t*hU)}(r,p)*t}))},pU=function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var o=e.apply(t,r);function s(e){iF(o,n,i,s,a,"next",e)}function a(e){iF(o,n,i,s,a,"throw",e)}s(void 0)})}}(bF().mark(function e(t){var r,n,i,o,s,a,A,l,u,c,h,d,p,f,m,g,y,b,v,_,x,w,T,S,E,M,N,C,R,P,D,B,q,O,L,k,I,F,U,V=arguments;return bF().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=V.length>1&&void 0!==V[1]?V[1]:[],o=(i=V.length>2&&void 0!==V[2]?V[2]:{}).lngAccessor,s=void 0===o?function(e){return e[0]}:o,a=i.latAccessor,A=void 0===a?function(e){return e[1]}:a,l=i.weightAccessor,u=void 0===l?function(){return 1}:l,c=i.bandwidth,null!==(r=navigator)&&void 0!==r&&r.gpu){e.next=5;break}return console.warn("WebGPU not enabled in browser. Please consider enabling it to improve performance."),e.abrupt("return",t.map(function(e){return dU(e,n,{lngAccessor:s,latAccessor:A,weightAccessor:u,bandwidth:c})}));case 5:return h=yI,d=bI,p=RI,m=TI,g=SI,y=vI,b=NI,v=MI,_=xI,x=_I,w=wI,T=EI,S=(f=CI)(new uN(new Float32Array(t.flat().map(cU)),2),"vec2",t.length),E=f(new uN(new Float32Array(n.map(function(e){return[cU(s(e)),cU(A(e)),u(e)]}).flat()),3),"vec3",n.length),M=new uN(t.length,1),N=f(M,"float",t.length),C=m(Math.PI),R=b(C.mul(2)),P=function(e){return e.mul(e)},D=function(e){return P(v(e.div(2)))},B=function(e,t){var r=m(e[1]),n=m(t[1]),i=m(e[0]),o=m(t[0]);return m(2).mul(x(b(D(n.sub(r)).add(_(r).mul(_(n)).mul(D(o.sub(i)))))))},q=function(e,t){return w(T(P(e.div(t)).div(2))).div(t.mul(R))},O=p(cU(c)),L=p(cU(4*c)),k=p(n.length),I=h(function(){var e=S.element(g),t=N.element(g);t.assign(0),y(k,function(r){var n=r.i,i=E.element(n),o=i.z;d(o,function(){var r=B(i.xy,e.xy);d(r&&r.lessThan(L),function(){t.addAssign(q(r,O).mul(o))})})})}),F=I().compute(t.length),U=new gI,e.next=25,U.computeAsync(F);case 25:return e.t0=Array,e.t1=Float32Array,e.next=29,U.getArrayBufferAsync(M);case 29:return e.t2=e.sent,e.t3=new e.t1(e.t2),e.abrupt("return",e.t0.from.call(e.t0,e.t3));case 32:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),fU=window.THREE?window.THREE:{Mesh:A,MeshLambertMaterial:h,SphereGeometry:l},mU=function(e){var t=Lo(function(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-14825.05*e)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+707.56*e)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-6838.66*e)))))))+")"}(e));return t.opacity=Math.cbrt(e),t.formatRgb()},gU=ki({props:{heatmapsData:{default:[]},heatmapPoints:{default:function(e){return e}},heatmapPointLat:{default:function(e){return e[0]}},heatmapPointLng:{default:function(e){return e[1]}},heatmapPointWeight:{default:1},heatmapBandwidth:{default:2.5},heatmapColorFn:{default:function(){return mU}},heatmapColorSaturation:{default:1.5},heatmapBaseAltitude:{default:.01},heatmapTopAltitude:{},heatmapsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjHeatmap"}).onCreateObj(function(){var e=new fU.Mesh(new fU.SphereGeometry(RF),tU(new fU.MeshLambertMaterial({vertexColors:!0,transparent:!0}),eU));return e.__globeObjType="heatmap",e})},update:function(e){var t=fc(e.heatmapPoints),r=fc(e.heatmapPointLat),n=fc(e.heatmapPointLng),i=fc(e.heatmapPointWeight),o=fc(e.heatmapBandwidth),s=fc(e.heatmapColorFn),a=fc(e.heatmapColorSaturation),A=fc(e.heatmapBaseAltitude),l=fc(e.heatmapTopAltitude);e.dataMapper.onUpdateObj(function(u,c){var h=o(c),d=s(c),p=a(c),f=A(c),m=l(c),g=t(c).map(function(e){var t=r(e),o=n(e),s=DF(t,o);return{x:s.x,y:s.y,z:s.z,lat:t,lng:o,weight:i(e)}}),y=Math.max(.1,h/3.5),b=Math.ceil(360/(y||-1));u.geometry.parameters.widthSegments!==b&&(u.geometry.dispose(),u.geometry=new fU.SphereGeometry(RF,b,b/2));var v=function(e){for(var t=e.itemSize,r=[],n=0;n<e.count;n++)r.push(e.array.slice(n*t,(n+1)*t));return r}(u.geometry.getAttribute("position")),_=v.map(function(e){var t=_F(e,3),r=BF({x:t[0],y:t[1],z:t[2]});return[r.lng,r.lat]});pU(_,g,{latAccessor:function(e){return e.lat},lngAccessor:function(e){return e.lng},weightAccessor:function(e){return e.weight},bandwidth:h}).then(function(t){var r=wF(new Array(100)).map(function(e,t){return VF(d(t/99))}),n=function(e){var t=u.__currentTargetD=e,n=t.kdeVals,i=t.topAlt,o=t.saturation,s=function(e){let t;for(const r of e)null!=r&&(t<r||void 0===t&&r>=r)&&(t=r);return t}(n.map(Math.abs))||1e-15,a=Fs([0,s/o],r);u.geometry.setAttribute("color",jF(n.map(function(e){return a(Math.abs(e))}),4));var A=Is([0,s],[RF*(1+f),RF*(1+(i||f))]);u.geometry.setAttribute("r",jF(n.map(A)))},i={kdeVals:t,topAlt:m,saturation:p},o=u.__currentTargetD||Object.assign({},i,{kdeVals:t.map(function(){return 0}),topAlt:m?f:m,saturation:.5});o.kdeVals.length!==t.length&&(o.kdeVals=t.slice()),Object.keys(i).some(function(e){return o[e]!==i[e]})&&(!e.heatmapsTransitionDuration||e.heatmapsTransitionDuration<0?n(i):e.tweenGroup.add(new zi(o).to(i,e.heatmapsTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(n).start()))})}).digest(e.heatmapsData)}}),yU=window.THREE?window.THREE:{DoubleSide:k,Group:a,LineBasicMaterial:_r,LineSegments:Dn,Mesh:A,MeshBasicMaterial:u},bU=ki({props:{polygonsData:{default:[]},polygonGeoJsonGeometry:{default:"geometry"},polygonSideColor:{default:function(){return"#ffffaa"}},polygonSideMaterial:{},polygonCapColor:{default:function(){return"#ffffaa"}},polygonCapMaterial:{},polygonStrokeColor:{},polygonAltitude:{default:.01},polygonCapCurvatureResolution:{default:5},polygonsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjPolygon"}).id(function(e){return e.id}).onCreateObj(function(){var e=new yU.Group;return e.__defaultSideMaterial=tU(new yU.MeshBasicMaterial({side:yU.DoubleSide,depthWrite:!0}),JF),e.__defaultCapMaterial=new yU.MeshBasicMaterial({side:yU.DoubleSide,depthWrite:!0}),e.add(new yU.Mesh(void 0,[e.__defaultSideMaterial,e.__defaultCapMaterial])),e.add(new yU.LineSegments(void 0,new yU.LineBasicMaterial)),e.__globeObjType="polygon",e})},update:function(e){var t=fc(e.polygonGeoJsonGeometry),r=fc(e.polygonAltitude),n=fc(e.polygonCapCurvatureResolution),i=fc(e.polygonCapColor),o=fc(e.polygonCapMaterial),s=fc(e.polygonSideColor),a=fc(e.polygonSideMaterial),A=fc(e.polygonStrokeColor),l=[];e.polygonsData.forEach(function(e){var u={data:e,capColor:i(e),capMaterial:o(e),sideColor:s(e),sideMaterial:a(e),strokeColor:A(e),altitude:+r(e),capCurvatureResolution:+n(e)},c=t(e),h=e.__id||"".concat(Math.round(1e9*Math.random()));e.__id=h,"Polygon"===c.type?l.push(yF({id:"".concat(h,"_0"),coords:c.coordinates},u)):"MultiPolygon"===c.type?l.push.apply(l,wF(c.coordinates.map(function(e,t){return yF({id:"".concat(h,"_").concat(t),coords:e},u)}))):console.warn("Unsupported GeoJson geometry type: ".concat(c.type,". Skipping geometry..."))}),e.dataMapper.onUpdateObj(function(t,r){var n=r.coords,i=r.capColor,o=r.capMaterial,s=r.sideColor,a=r.sideMaterial,A=r.strokeColor,l=r.altitude,u=r.capCurvatureResolution,c=_F(t.children,2),h=c[0],d=c[1],p=!!A;d.visible=p;var f=!(!i&&!o),m=!(!s&&!a);(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return function(e,t){return e===t}};return Object.entries(t).every(function(t){var n=_F(t,2),i=n[0],o=n[1];return e.hasOwnProperty(i)&&r(i)(e[i],o)})})(h.geometry.parameters||{},{polygonGeoJson:n,curvatureResolution:u,closedTop:f,includeSides:m})||(h.geometry&&h.geometry.dispose(),h.geometry=new Nd(n,0,RF,!1,f,m,u)),!p||d.geometry.parameters&&d.geometry.parameters.geoJson.coordinates===n&&d.geometry.parameters.resolution===u||(d.geometry&&d.geometry.dispose(),d.geometry=new Ac({type:"Polygon",coordinates:n},RF,u));var g=m?0:-1,y=f?m?1:0:-1;if(g>=0&&(h.material[g]=a||t.__defaultSideMaterial),y>=0&&(h.material[y]=o||t.__defaultCapMaterial),[[!a&&s,g],[!o&&i,y]].forEach(function(e){var t=_F(e,2),r=t[0],n=t[1];if(r&&!(n<0)){var i=h.material[n],o=UF(r);i.color.set(FF(r)),i.transparent=o<1,i.opacity=o}}),p){var b=d.material,v=UF(A);b.color.set(FF(A)),b.transparent=v<1,b.opacity=v}var _={alt:l},x=function(e){var r=(t.__currentTargetD=e).alt;h.scale.x=h.scale.y=h.scale.z=1+r,p&&(d.scale.x=d.scale.y=d.scale.z=1+r+1e-4),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};if(e.userData.shader)t(e.userData.shader.uniforms);else{var r=e.onBeforeCompile;e.onBeforeCompile=function(e){r(e),t(e.uniforms)}}}(t.__defaultSideMaterial,function(e){return e.surfaceRadius.value=RF/(r+1)})},w=t.__currentTargetD||Object.assign({},_,{alt:-.001});Object.keys(_).some(function(e){return w[e]!==_[e]})&&(!e.polygonsTransitionDuration||e.polygonsTransitionDuration<0||w.alt===_.alt?x(_):e.tweenGroup.add(new zi(w).to(_,e.polygonsTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(x).start()))}).digest(l)}});var vU=window.THREE?window.THREE:{BufferGeometry:f,DoubleSide:k,Mesh:A,MeshLambertMaterial:h,Vector3:o},_U=Object.assign({},pc),xU=_U.BufferGeometryUtils||_U,wU=ki({props:{hexPolygonsData:{default:[]},hexPolygonGeoJsonGeometry:{default:"geometry"},hexPolygonColor:{default:function(){return"#ffffaa"}},hexPolygonAltitude:{default:.001},hexPolygonResolution:{default:3},hexPolygonMargin:{default:.2},hexPolygonUseDots:{default:!1},hexPolygonCurvatureResolution:{default:5},hexPolygonDotResolution:{default:12},hexPolygonsTransitionDuration:{default:0,triggerUpdate:!1}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjHexPolygon"}).onCreateObj(function(){var e=new vU.Mesh(void 0,new vU.MeshLambertMaterial({side:vU.DoubleSide}));return e.__globeObjType="hexPolygon",e})},update:function(e){var t=fc(e.hexPolygonGeoJsonGeometry),r=fc(e.hexPolygonColor),n=fc(e.hexPolygonAltitude),i=fc(e.hexPolygonResolution),o=fc(e.hexPolygonMargin),s=fc(e.hexPolygonUseDots),a=fc(e.hexPolygonCurvatureResolution),A=fc(e.hexPolygonDotResolution);e.dataMapper.onUpdateObj(function(l,u){var c=t(u),h=i(u),d=n(u),p=Math.max(0,Math.min(1,+o(u))),f=s(u),m=a(u),g=A(u),y=r(u),b=UF(y);l.material.color.set(FF(y)),l.material.transparent=b<1,l.material.opacity=b;var v={alt:d,margin:p,curvatureResolution:m},_={geoJson:c,h3Res:h},x=l.__currentTargetD||Object.assign({},v,{alt:-.001}),w=l.__currentMemD||_;if(Object.keys(v).some(function(e){return x[e]!==v[e]})||Object.keys(_).some(function(e){return w[e]!==_[e]})){l.__currentMemD=_;var T=[];"Polygon"===c.type?Ap(c.coordinates,h,!0).forEach(function(e){return T.push(e)}):"MultiPolygon"===c.type?c.coordinates.forEach(function(e){return Ap(e,h,!0).forEach(function(e){return T.push(e)})}):console.warn("Unsupported GeoJson geometry type: ".concat(c.type,". Skipping geometry..."));var S=T.map(function(e){var t=sp(e),r=ap(e).reverse(),n=t[1];return r.forEach(function(e){var t=e[0];Math.abs(n-t)>170&&(e[0]+=n>t?360:-360)}),{h3Idx:e,hexCenter:t,hexGeoJson:r}}),E=function(e){var t=l.__currentTargetD=e,r=t.alt,n=t.margin,i=t.curvatureResolution;l.geometry&&l.geometry.dispose(),l.geometry=S.length?(xU.mergeGeometries||xU.mergeBufferGeometries)(S.map(function(e){var t=_F(e.hexCenter,2),o=t[0],s=t[1];if(f){var a=DF(o,s,r),A=DF(e.hexGeoJson[0][1],e.hexGeoJson[0][0],r),l=.85*(1-n)*new vU.Vector3(a.x,a.y,a.z).distanceTo(new vU.Vector3(A.x,A.y,A.z)),u=new Pn(l,g);return u.rotateX(qF(-o)),u.rotateY(qF(s)),u.translate(a.x,a.y,a.z),u}var c=0===n?e.hexGeoJson:e.hexGeoJson.map(function(e){var t=_F(e,2),r=t[0],i=t[1];return[[r,s],[i,o]].map(function(e){var t=_F(e,2);return function(e,t,r){return e-(e-t)*r}(t[0],t[1],n)})});return new Nd([c],RF,RF*(1+r),!1,!0,!1,i)})):new vU.BufferGeometry};!e.hexPolygonsTransitionDuration||e.hexPolygonsTransitionDuration<0?E(v):e.tweenGroup.add(new zi(x).to(v,e.hexPolygonsTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(E).start())}}).digest(e.hexPolygonsData)}}),TU=window.THREE?window.THREE:{Vector3:o};function SU(e,t){var r=Math.max(e.length,t.length),n=is.apply(void 0,wF([e,t].map(function(e){return e.map(function(e){return[e.x,e.y,e.z]})}).map(function(e){return function(e,t){var r=e[e.length-1];return[].concat(wF(e),wF(Array(t-e.length).fill(r)))}(e,r)})));return function(r){return 0===r?e:1===r?t:n(r).map(function(e){var t=_F(e,3),r=t[0],n=t[1],i=t[2];return new TU.Vector3(r,n,i)})}}var EU=window.THREE?window.THREE:{BufferGeometry:f,Color:te,Group:a,Line:Cn,NormalBlending:ee,ShaderMaterial:xn,Vector3:o},MU=gh.default||gh,NU=ki({props:{pathsData:{default:[]},pathPoints:{default:function(e){return e}},pathPointLat:{default:function(e){return e[0]}},pathPointLng:{default:function(e){return e[1]}},pathPointAlt:{default:.001},pathResolution:{default:2},pathColor:{default:function(){return"#ffffaa"}},pathStroke:{},pathDashLength:{default:1},pathDashGap:{default:0},pathDashInitialGap:{default:0},pathDashAnimateTime:{default:0},pathTransitionDuration:{default:1e3,triggerUpdate:!1},rendererSize:{}},methods:{pauseAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.pause()},resumeAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.resume()},_destructor:function(e){var t;null===(t=e.ticker)||void 0===t||t.dispose()}},stateInit:function(e){return{tweenGroup:e.tweenGroup,ticker:new MU,sharedMaterial:new EU.ShaderMaterial(yF(yF({},ZF()),{},{transparent:!0,blending:EU.NormalBlending}))}},init:function(e,t){NF(e),t.scene=e,t.dataMapper=new QF(e,{objBindAttr:"__threeObjPath"}).onCreateObj(function(){var e=new EU.Group;return e.__globeObjType="path",e}),t.ticker.onTick.add(function(e,r){t.dataMapper.entries().map(function(e){return _F(e,2)[1]}).filter(function(e){return e.children.length&&e.children[0].material&&e.children[0].__dashAnimateStep}).forEach(function(e){var t=e.children[0],n=t.__dashAnimateStep*r;if("Line"===t.type){var i=t.material.uniforms.dashTranslate.value%1e9;t.material.uniforms.dashTranslate.value=i+n}else if("Line2"===t.type){for(var o=t.material.dashOffset-n,s=t.material.dashSize+t.material.gapSize;o<=-s;)o+=s;t.material.dashOffset=o}})})},update:function(e){var t=fc(e.pathPoints),r=fc(e.pathPointLat),n=fc(e.pathPointLng),i=fc(e.pathPointAlt),o=fc(e.pathStroke),s=fc(e.pathColor),a=fc(e.pathDashLength),A=fc(e.pathDashGap),l=fc(e.pathDashInitialGap),u=fc(e.pathDashAnimateTime);function c(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=t+1;if(e instanceof Array||e instanceof Function){var s=e instanceof Array?Is().domain(e.map(function(t,r){return r/(e.length-1)})).range(e):e;r=function(e){return VF(s(e),i,!0)}}else{var a=VF(e,i,!0);r=function(){return a}}for(var A=[],l=0,u=o;l<u;l++)for(var c=r(l/(u-1)),h=0;h<n;h++)A.push(c);return jF(A,i?4:3)}e.dataMapper.onUpdateObj(function(h,d){var p=o(d),f=null!=p;if(!h.children.length||f===("Line"===h.children[0].type)){NF(h);var m=f?new JI(new ZI,new qI):new EU.Line(new EU.BufferGeometry,e.sharedMaterial.clone());h.add(m)}var g,y,b=h.children[0],v=function(e,t,r,n,i){var o=function(e,t,r){for(var n=[],i=1;i<=r;i++)n.push(e+(t-e)*i/(r+1));return n},s=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=[],r=null;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(n){if(r){for(;Math.abs(r[1]-n[1])>180;)r[1]+=360*(r[1]<n[1]?1:-1);var i=Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2));if(i>e)for(var s=Math.floor(i/e),a=o(r[0],n[0],s),A=o(r[1],n[1],s),l=o(r[2],n[2],s),u=0,c=a.length;u<c;u++)t.push([a[u],A[u],l[u]])}t.push(r=n)}),t},a=function(e){var t=_F(e,3),r=DF(t[0],t[1],t[2]),n=r.x,i=r.y,o=r.z;return new EU.Vector3(n,i,o)};return s(e.map(function(e){return[t(e),r(e),n(e)]}),i).map(a)}(t(d),r,n,i,e.pathResolution),_=u(d);if(b.__dashAnimateStep=_>0?1e3/_:0,f){b.material.resolution=e.rendererSize;var x=a(d),w=A(d),T=l(d);b.material.dashed=w>0,b.material.dashed?b.material.defines.USE_DASH="":delete b.material.defines.USE_DASH,b.material.dashed&&(b.material.dashScale=1/(y=0,v.forEach(function(e){g&&(y+=g.distanceTo(e)),g=e}),y),b.material.dashSize=x,b.material.gapSize=w,b.material.dashOffset=-T);var S=s(d);if(S instanceof Array){var E=c(s(d),v.length-1,1,!1);b.geometry.setColors(E.array),b.material.vertexColors=!0}else{var M=S,N=UF(M);b.material.color=new EU.Color(FF(M)),b.material.transparent=N<1,b.material.opacity=N,b.material.vertexColors=!1}b.material.needsUpdate=!0}else{Object.assign(b.material.uniforms,{dashSize:{value:a(d)},gapSize:{value:A(d)},dashOffset:{value:l(d)}});var C=c(s(d),v.length),R=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],i=0,o=e+1;i<o;i++)for(var s=i/(o-1),a=0;a<t;a++)n.push(s);return r&&n.reverse(),jF(n,1)}(v.length,1,!0);b.geometry.setAttribute("color",C),b.geometry.setAttribute("relDistance",R)}var P=SU(h.__currentTargetD&&h.__currentTargetD.points||[v[0]],v),D=function(e){var t,r=h.__currentTargetD=e,n=r.stroke,i=r.interpolK,o=h.__currentTargetD.points=P(i);f?(b.geometry.setPositions((t=[]).concat.apply(t,wF(o.map(function(e){return[e.x,e.y,e.z]})))),b.material.linewidth=n,b.material.dashed&&b.computeLineDistances()):(b.geometry.setFromPoints(o),b.geometry.computeBoundingSphere())},B={stroke:p,interpolK:1},q=Object.assign({},h.__currentTargetD||B,{interpolK:0});Object.keys(B).some(function(e){return q[e]!==B[e]})&&(!e.pathTransitionDuration||e.pathTransitionDuration<0?D(B):e.tweenGroup.add(new zi(q).to(B,e.pathTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(D).start()))}).digest(e.pathsData)}}),CU=window.THREE?window.THREE:{Euler:rn,Mesh:A,MeshLambertMaterial:h,SphereGeometry:l},RU=ki({props:{tilesData:{default:[]},tileLat:{default:"lat"},tileLng:{default:"lng"},tileAltitude:{default:.01},tileWidth:{default:1},tileHeight:{default:1},tileUseGlobeProjection:{default:!0},tileMaterial:{default:function(){return new CU.MeshLambertMaterial({color:"#ffbb88",opacity:.4,transparent:!0})}},tileCurvatureResolution:{default:5},tilesTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjTile"}).onCreateObj(function(){var e=new CU.Mesh;return e.__globeObjType="tile",e})},update:function(e){var t=fc(e.tileLat),r=fc(e.tileLng),n=fc(e.tileAltitude),i=fc(e.tileWidth),o=fc(e.tileHeight),s=fc(e.tileUseGlobeProjection),a=fc(e.tileMaterial),A=fc(e.tileCurvatureResolution);e.dataMapper.onUpdateObj(function(l,u){l.material=a(u);var c=s(u),h=A(u),d=function(e){var t=l.__currentTargetD=e,r=t.lat,n=t.lng,i=t.alt,o=t.width,s=t.height,a=PU(n),A=PU(-r);l.geometry&&l.geometry.dispose(),l.geometry=new CU.SphereGeometry(RF*(1+i),Math.ceil(o/(h||-1)),Math.ceil(s/(h||-1)),PU(90-o/2)+(c?a:0),PU(o),PU(90-s/2)+(c?A:0),PU(s)),c||l.setRotationFromEuler(new CU.Euler(A,a,0,"YXZ"))},p={lat:+t(u),lng:+r(u),alt:+n(u),width:+i(u),height:+o(u)},f=l.__currentTargetD||Object.assign({},p,{width:0,height:0});Object.keys(p).some(function(e){return f[e]!==p[e]})&&(!e.tilesTransitionDuration||e.tilesTransitionDuration<0?d(p):e.tweenGroup.add(new zi(f).to(p,e.tilesTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(d).start()))}).digest(e.tilesData)}}),PU=function(e){return e*Math.PI/180},DU=window.THREE?window.THREE:{BufferGeometry:f,Color:te,Points:Rn,PointsMaterial:wr},BU=ki({props:{particlesData:{default:[]},particlesList:{default:function(e){return e}},particleLat:{default:"lat"},particleLng:{default:"lng"},particleAltitude:{default:.01},particlesSize:{default:.5},particlesSizeAttenuation:{default:!0},particlesColor:{default:function(){return"white"}},particlesTexture:{}},init:function(e,t){NF(e),t.scene=e,t.dataMapper=new QF(e,{objBindAttr:"__threeObjParticles"}).onCreateObj(function(){var e=new DU.Points(new DU.BufferGeometry,new DU.PointsMaterial);return e.__globeObjType="particles",e}).onUpdateObj(function(e,r){var n=fc(t.particlesList),i=fc(t.particleLat),o=fc(t.particleLng),s=fc(t.particleAltitude);e.geometry.setAttribute("position",jF(n(r).map(function(e){return Object.values(DF(i(e),o(e),s(e)))}),3))})},update:function(e,t){["particlesData","particlesList","particleLat","particleLng","particleAltitude"].some(function(e){return t.hasOwnProperty(e)})&&e.dataMapper.digest(e.particlesData);var r=fc(e.particlesColor),n=fc(e.particlesSize),i=fc(e.particlesSizeAttenuation),o=fc(e.particlesTexture);e.dataMapper.entries().forEach(function(t){var s=_F(t,2),a=s[0],A=s[1];if(A.material.size=n(a),A.material.sizeAttenuation=i(a),e.particlesTexture)A.material.color=new DU.Color(16777215),A.material.transparent=!1,A.material.alphaTest=.5,A.material.map=o(a);else{var l=r(a),u=UF(l);A.material.color=new DU.Color(FF(l)),A.material.transparent=u<1,A.material.opacity=u,A.material.alphaTest=0}})}}),qU=window.THREE?window.THREE:{BufferGeometry:f},OU=function(){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;sF(this,e),(t=oF(this,e)).type="CircleLineGeometry",t.parameters={radius:r,segmentCount:n};for(var i=[],o=0;o<=n;o++){var s=(o/n-.25)*Math.PI*2;i.push({x:Math.cos(s)*r,y:Math.sin(s)*r,z:0})}return t.setFromPoints(i),t}return fF(e,qU.BufferGeometry),cF(e)}(),LU=window.THREE?window.THREE:{Color:te,Group:a,Line:Cn,LineBasicMaterial:_r,Vector3:o},kU=gh.default||gh,IU=ki({props:{ringsData:{default:[]},ringLat:{default:"lat"},ringLng:{default:"lng"},ringAltitude:{default:.0015},ringColor:{default:function(){return"#ffffaa"},triggerUpdate:!1},ringResolution:{default:64,triggerUpdate:!1},ringMaxRadius:{default:2,triggerUpdate:!1},ringPropagationSpeed:{default:1,triggerUpdate:!1},ringRepeatPeriod:{default:700,triggerUpdate:!1}},methods:{pauseAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.pause()},resumeAnimation:function(e){var t;null===(t=e.ticker)||void 0===t||t.resume()},_destructor:function(e){var t;null===(t=e.ticker)||void 0===t||t.dispose()}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjRing",removeDelay:3e4}).onCreateObj(function(){var e=new LU.Group;return e.__globeObjType="ring",e}),t.ticker=new kU,t.ticker.onTick.add(function(e){if(t.ringsData.length){var r=fc(t.ringColor),n=fc(t.ringAltitude),i=fc(t.ringMaxRadius),o=fc(t.ringPropagationSpeed),s=fc(t.ringRepeatPeriod);t.dataMapper.entries().filter(function(e){return _F(e,2)[1]}).forEach(function(a){var A,l,u=_F(a,2),c=u[0],h=u[1];if((h.__nextRingTime||0)<=e){var d=s(c)/1e3;h.__nextRingTime=e+(d<=0?1/0:d);var p,f=new LU.Line(new OU(1,t.ringResolution),new LU.LineBasicMaterial),m=r(c),g=m instanceof Array||m instanceof Function;g?m instanceof Array?(p=Is().domain(m.map(function(e,t){return t/(m.length-1)})).range(m),f.material.transparent=m.some(function(e){return UF(e)<1})):(p=m,f.material.transparent=!0):(f.material.color=new LU.Color(FF(m)),A=f.material,l=UF(m),A.opacity=l,A.transparent=l<1,A.depthWrite=l>=1);var y=RF*(1+n(c)),b=i(c),v=b*Math.PI/180,_=o(c),x=_<=0,w=function(e){var t=e.t,r=(x?1-t:t)*v;if(f.scale.x=f.scale.y=y*Math.sin(r),f.position.z=y*(1-Math.cos(r)),g){var n=p(t);f.material.color=new LU.Color(FF(n)),f.material.transparent&&(f.material.opacity=UF(n))}};if(0===_)w({t:0}),h.add(f);else{var T=1e3*Math.abs(b/_);t.tweenGroup.add(new zi({t:0}).to({t:1},T).onUpdate(w).onStart(function(){return h.add(f)}).onComplete(function(){h.remove(f),MF(f)}).start())}}})}})},update:function(e){var t=fc(e.ringLat),r=fc(e.ringLng),n=fc(e.ringAltitude),i=e.scene.localToWorld(new LU.Vector3(0,0,0));e.dataMapper.onUpdateObj(function(e,o){var s=t(o),a=r(o),A=n(o);Object.assign(e.position,DF(s,a,A)),e.lookAt(i)}).digest(e.ringsData)}}),FU={glyphs:{0:{x_min:73,x_max:715,ha:792,o:"m 394 -29 q 153 129 242 -29 q 73 479 73 272 q 152 829 73 687 q 394 989 241 989 q 634 829 545 989 q 715 479 715 684 q 635 129 715 270 q 394 -29 546 -29 m 394 89 q 546 211 489 89 q 598 479 598 322 q 548 748 598 640 q 394 871 491 871 q 241 748 298 871 q 190 479 190 637 q 239 211 190 319 q 394 89 296 89 "},1:{x_min:215.671875,x_max:574,ha:792,o:"m 574 0 l 442 0 l 442 697 l 215 697 l 215 796 q 386 833 330 796 q 475 986 447 875 l 574 986 l 574 0 "},2:{x_min:59,x_max:731,ha:792,o:"m 731 0 l 59 0 q 197 314 59 188 q 457 487 199 315 q 598 691 598 580 q 543 819 598 772 q 411 867 488 867 q 272 811 328 867 q 209 630 209 747 l 81 630 q 182 901 81 805 q 408 986 271 986 q 629 909 536 986 q 731 694 731 826 q 613 449 731 541 q 378 316 495 383 q 201 122 235 234 l 731 122 l 731 0 "},3:{x_min:54,x_max:737,ha:792,o:"m 737 284 q 635 55 737 141 q 399 -25 541 -25 q 156 52 248 -25 q 54 308 54 140 l 185 308 q 245 147 185 202 q 395 96 302 96 q 539 140 484 96 q 602 280 602 190 q 510 429 602 390 q 324 454 451 454 l 324 565 q 487 584 441 565 q 565 719 565 617 q 515 835 565 791 q 395 879 466 879 q 255 824 307 879 q 203 661 203 769 l 78 661 q 166 909 78 822 q 387 992 250 992 q 603 921 513 992 q 701 723 701 844 q 669 607 701 656 q 578 524 637 558 q 696 434 655 499 q 737 284 737 369 "},4:{x_min:48,x_max:742.453125,ha:792,o:"m 742 243 l 602 243 l 602 0 l 476 0 l 476 243 l 48 243 l 48 368 l 476 958 l 602 958 l 602 354 l 742 354 l 742 243 m 476 354 l 476 792 l 162 354 l 476 354 "},5:{x_min:54.171875,x_max:738,ha:792,o:"m 738 314 q 626 60 738 153 q 382 -23 526 -23 q 155 47 248 -23 q 54 256 54 125 l 183 256 q 259 132 204 174 q 382 91 314 91 q 533 149 471 91 q 602 314 602 213 q 538 469 602 411 q 386 528 475 528 q 284 506 332 528 q 197 439 237 484 l 81 439 l 159 958 l 684 958 l 684 840 l 254 840 l 214 579 q 306 627 258 612 q 407 643 354 643 q 636 552 540 643 q 738 314 738 457 "},6:{x_min:53,x_max:739,ha:792,o:"m 739 312 q 633 62 739 162 q 400 -31 534 -31 q 162 78 257 -31 q 53 439 53 206 q 178 859 53 712 q 441 986 284 986 q 643 912 559 986 q 732 713 732 833 l 601 713 q 544 830 594 786 q 426 875 494 875 q 268 793 331 875 q 193 517 193 697 q 301 597 240 570 q 427 624 362 624 q 643 540 552 624 q 739 312 739 451 m 603 298 q 540 461 603 400 q 404 516 484 516 q 268 461 323 516 q 207 300 207 401 q 269 137 207 198 q 405 83 325 83 q 541 137 486 83 q 603 298 603 197 "},7:{x_min:58.71875,x_max:730.953125,ha:792,o:"m 730 839 q 469 448 560 641 q 335 0 378 255 l 192 0 q 328 441 235 252 q 593 830 421 630 l 58 830 l 58 958 l 730 958 l 730 839 "},8:{x_min:55,x_max:736,ha:792,o:"m 571 527 q 694 424 652 491 q 736 280 736 358 q 648 71 736 158 q 395 -26 551 -26 q 142 69 238 -26 q 55 279 55 157 q 96 425 55 359 q 220 527 138 491 q 120 615 153 562 q 88 726 88 668 q 171 904 88 827 q 395 986 261 986 q 618 905 529 986 q 702 727 702 830 q 670 616 702 667 q 571 527 638 565 m 394 565 q 519 610 475 565 q 563 717 563 655 q 521 823 563 781 q 392 872 474 872 q 265 824 312 872 q 224 720 224 783 q 265 613 224 656 q 394 565 312 565 m 395 91 q 545 150 488 91 q 597 280 597 204 q 546 408 597 355 q 395 465 492 465 q 244 408 299 465 q 194 280 194 356 q 244 150 194 203 q 395 91 299 91 "},9:{x_min:53,x_max:739,ha:792,o:"m 739 524 q 619 94 739 241 q 362 -32 516 -32 q 150 47 242 -32 q 59 244 59 126 l 191 244 q 246 129 191 176 q 373 82 301 82 q 526 161 466 82 q 597 440 597 255 q 363 334 501 334 q 130 432 216 334 q 53 650 53 521 q 134 880 53 786 q 383 986 226 986 q 659 841 566 986 q 739 524 739 719 m 388 449 q 535 514 480 449 q 585 658 585 573 q 535 805 585 744 q 388 873 480 873 q 242 809 294 873 q 191 658 191 745 q 239 514 191 572 q 388 449 292 449 "},"ο":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 96 88 192 -25 q 0 368 0 201 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 "},S:{x_min:0,x_max:788,ha:890,o:"m 788 291 q 662 54 788 144 q 397 -26 550 -26 q 116 68 226 -26 q 0 337 0 168 l 131 337 q 200 152 131 220 q 384 85 269 85 q 557 129 479 85 q 650 270 650 183 q 490 429 650 379 q 194 513 341 470 q 33 739 33 584 q 142 964 33 881 q 388 1041 242 1041 q 644 957 543 1041 q 756 716 756 867 l 625 716 q 561 874 625 816 q 395 933 497 933 q 243 891 309 933 q 164 759 164 841 q 325 609 164 656 q 625 526 475 568 q 788 291 788 454 "},"¦":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"/":{x_min:183.25,x_max:608.328125,ha:792,o:"m 608 1041 l 266 -129 l 183 -129 l 520 1041 l 608 1041 "},"Τ":{x_min:-.4375,x_max:777.453125,ha:839,o:"m 777 893 l 458 893 l 458 0 l 319 0 l 319 892 l 0 892 l 0 1013 l 777 1013 l 777 893 "},y:{x_min:0,x_max:684.78125,ha:771,o:"m 684 738 l 388 -83 q 311 -216 356 -167 q 173 -279 252 -279 q 97 -266 133 -279 l 97 -149 q 132 -155 109 -151 q 168 -160 155 -160 q 240 -114 213 -160 q 274 -26 248 -98 l 0 738 l 137 737 l 341 139 l 548 737 l 684 738 "},"Π":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 803 1012 l 803 0 "},"ΐ":{x_min:-111,x_max:339,ha:361,o:"m 339 800 l 229 800 l 229 925 l 339 925 l 339 800 m -1 800 l -111 800 l -111 925 l -1 925 l -1 800 m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 m 302 1040 l 113 819 l 30 819 l 165 1040 l 302 1040 "},g:{x_min:0,x_max:686,ha:838,o:"m 686 34 q 586 -213 686 -121 q 331 -306 487 -306 q 131 -252 216 -306 q 31 -84 31 -190 l 155 -84 q 228 -174 166 -138 q 345 -207 284 -207 q 514 -109 454 -207 q 564 89 564 -27 q 461 6 521 36 q 335 -23 401 -23 q 88 100 184 -23 q 0 370 0 215 q 87 634 0 522 q 330 758 183 758 q 457 728 398 758 q 564 644 515 699 l 564 737 l 686 737 l 686 34 m 582 367 q 529 560 582 481 q 358 652 468 652 q 189 561 250 652 q 135 369 135 482 q 189 176 135 255 q 361 85 251 85 q 529 176 468 85 q 582 367 582 255 "},"²":{x_min:0,x_max:442,ha:539,o:"m 442 383 l 0 383 q 91 566 0 492 q 260 668 176 617 q 354 798 354 727 q 315 875 354 845 q 227 905 277 905 q 136 869 173 905 q 99 761 99 833 l 14 761 q 82 922 14 864 q 232 974 141 974 q 379 926 316 974 q 442 797 442 878 q 351 635 442 704 q 183 539 321 611 q 92 455 92 491 l 442 455 l 442 383 "},"–":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},"Κ":{x_min:0,x_max:819.5625,ha:893,o:"m 819 0 l 650 0 l 294 509 l 139 356 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},"ƒ":{x_min:-46.265625,x_max:392,ha:513,o:"m 392 651 l 259 651 l 79 -279 l -46 -278 l 134 651 l 14 651 l 14 751 l 135 751 q 151 948 135 900 q 304 1041 185 1041 q 334 1040 319 1041 q 392 1034 348 1039 l 392 922 q 337 931 360 931 q 271 883 287 931 q 260 793 260 853 l 260 751 l 392 751 l 392 651 "},e:{x_min:0,x_max:714,ha:813,o:"m 714 326 l 140 326 q 200 157 140 227 q 359 87 260 87 q 488 130 431 87 q 561 245 545 174 l 697 245 q 577 48 670 123 q 358 -26 484 -26 q 97 85 195 -26 q 0 363 0 197 q 94 642 0 529 q 358 765 195 765 q 626 627 529 765 q 714 326 714 503 m 576 429 q 507 583 564 522 q 355 650 445 650 q 206 583 266 650 q 140 429 152 522 l 576 429 "},"ό":{x_min:0,x_max:712,ha:815,o:"m 356 -25 q 94 91 194 -25 q 0 368 0 202 q 92 642 0 533 q 356 761 192 761 q 617 644 517 761 q 712 368 712 533 q 619 91 712 201 q 356 -25 520 -25 m 356 85 q 527 175 465 85 q 583 369 583 255 q 528 562 583 484 q 356 651 466 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 356 85 250 85 m 576 1040 l 387 819 l 303 819 l 438 1040 l 576 1040 "},J:{x_min:0,x_max:588,ha:699,o:"m 588 279 q 287 -26 588 -26 q 58 73 126 -26 q 0 327 0 158 l 133 327 q 160 172 133 227 q 288 96 198 96 q 426 171 391 96 q 449 336 449 219 l 449 1013 l 588 1013 l 588 279 "},"»":{x_min:-1,x_max:503,ha:601,o:"m 503 302 l 280 136 l 281 256 l 429 373 l 281 486 l 280 608 l 503 440 l 503 302 m 221 302 l 0 136 l 0 255 l 145 372 l 0 486 l -1 608 l 221 440 l 221 302 "},"©":{x_min:-3,x_max:1008,ha:1106,o:"m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 741 394 q 661 246 731 302 q 496 190 591 190 q 294 285 369 190 q 228 497 228 370 q 295 714 228 625 q 499 813 370 813 q 656 762 588 813 q 733 625 724 711 l 634 625 q 589 704 629 673 q 498 735 550 735 q 377 666 421 735 q 334 504 334 597 q 374 340 334 408 q 490 272 415 272 q 589 304 549 272 q 638 394 628 337 l 741 394 "},"ώ":{x_min:0,x_max:922,ha:1030,o:"m 687 1040 l 498 819 l 415 819 l 549 1040 l 687 1040 m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 338 0 202 q 45 551 0 444 q 161 737 84 643 l 302 737 q 175 552 219 647 q 124 336 124 446 q 155 179 124 248 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 341 797 257 q 745 555 797 450 q 619 737 705 637 l 760 737 q 874 551 835 640 q 922 339 922 444 "},"^":{x_min:193.0625,x_max:598.609375,ha:792,o:"m 598 772 l 515 772 l 395 931 l 277 772 l 193 772 l 326 1013 l 462 1013 l 598 772 "},"«":{x_min:0,x_max:507.203125,ha:604,o:"m 506 136 l 284 302 l 284 440 l 506 608 l 507 485 l 360 371 l 506 255 l 506 136 m 222 136 l 0 302 l 0 440 l 222 608 l 221 486 l 73 373 l 222 256 l 222 136 "},D:{x_min:0,x_max:828,ha:935,o:"m 389 1013 q 714 867 593 1013 q 828 521 828 729 q 712 161 828 309 q 382 0 587 0 l 0 0 l 0 1013 l 389 1013 m 376 124 q 607 247 523 124 q 681 510 681 355 q 607 771 681 662 q 376 896 522 896 l 139 896 l 139 124 l 376 124 "},"∙":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"ÿ":{x_min:0,x_max:47,ha:125,o:"m 47 3 q 37 -7 47 -7 q 28 0 30 -7 q 39 -4 32 -4 q 45 3 45 -1 l 37 0 q 28 9 28 0 q 39 19 28 19 l 47 16 l 47 19 l 47 3 m 37 1 q 44 8 44 1 q 37 16 44 16 q 30 8 30 16 q 37 1 30 1 m 26 1 l 23 22 l 14 0 l 3 22 l 3 3 l 0 25 l 13 1 l 22 25 l 26 1 "},w:{x_min:0,x_max:1009.71875,ha:1100,o:"m 1009 738 l 783 0 l 658 0 l 501 567 l 345 0 l 222 0 l 0 738 l 130 738 l 284 174 l 432 737 l 576 738 l 721 173 l 881 737 l 1009 738 "},$:{x_min:0,x_max:700,ha:793,o:"m 664 717 l 542 717 q 490 825 531 785 q 381 872 450 865 l 381 551 q 620 446 540 522 q 700 241 700 370 q 618 45 700 116 q 381 -25 536 -25 l 381 -152 l 307 -152 l 307 -25 q 81 62 162 -25 q 0 297 0 149 l 124 297 q 169 146 124 204 q 307 81 215 89 l 307 441 q 80 536 148 469 q 13 725 13 603 q 96 910 13 839 q 307 982 180 982 l 307 1077 l 381 1077 l 381 982 q 574 917 494 982 q 664 717 664 845 m 307 565 l 307 872 q 187 831 233 872 q 142 724 142 791 q 180 618 142 656 q 307 565 218 580 m 381 76 q 562 237 562 96 q 517 361 562 313 q 381 423 472 409 l 381 76 "},"\\":{x_min:-.015625,x_max:425.0625,ha:522,o:"m 425 -129 l 337 -129 l 0 1041 l 83 1041 l 425 -129 "},"µ":{x_min:0,x_max:697.21875,ha:747,o:"m 697 -4 q 629 -14 658 -14 q 498 97 513 -14 q 422 9 470 41 q 313 -23 374 -23 q 207 4 258 -23 q 119 81 156 32 l 119 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 173 124 246 q 308 83 216 83 q 452 178 402 83 q 493 359 493 255 l 493 738 l 617 738 l 617 214 q 623 136 617 160 q 673 92 637 92 q 697 96 684 92 l 697 -4 "},"Ι":{x_min:42,x_max:181,ha:297,o:"m 181 0 l 42 0 l 42 1013 l 181 1013 l 181 0 "},"Ύ":{x_min:0,x_max:1144.5,ha:1214,o:"m 1144 1012 l 807 416 l 807 0 l 667 0 l 667 416 l 325 1012 l 465 1012 l 736 533 l 1004 1012 l 1144 1012 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"’":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"Ν":{x_min:0,x_max:801,ha:915,o:"m 801 0 l 651 0 l 131 822 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 191 l 670 1013 l 801 1013 l 801 0 "},"-":{x_min:8.71875,x_max:350.390625,ha:478,o:"m 350 317 l 8 317 l 8 428 l 350 428 l 350 317 "},Q:{x_min:0,x_max:968,ha:1072,o:"m 954 5 l 887 -79 l 744 35 q 622 -11 687 2 q 483 -26 556 -26 q 127 130 262 -26 q 0 504 0 279 q 127 880 0 728 q 484 1041 262 1041 q 841 884 708 1041 q 968 507 968 735 q 933 293 968 398 q 832 104 899 188 l 954 5 m 723 191 q 802 330 777 248 q 828 499 828 412 q 744 790 828 673 q 483 922 650 922 q 228 791 322 922 q 142 505 142 673 q 227 221 142 337 q 487 91 323 91 q 632 123 566 91 l 520 215 l 587 301 l 723 191 "},"ς":{x_min:1,x_max:676.28125,ha:740,o:"m 676 460 l 551 460 q 498 595 542 546 q 365 651 448 651 q 199 578 263 651 q 136 401 136 505 q 266 178 136 241 q 508 106 387 142 q 640 -50 640 62 q 625 -158 640 -105 q 583 -278 611 -211 l 465 -278 q 498 -182 490 -211 q 515 -80 515 -126 q 381 12 515 -15 q 134 91 197 51 q 1 388 1 179 q 100 651 1 542 q 354 761 199 761 q 587 680 498 761 q 676 460 676 599 "},M:{x_min:0,x_max:954,ha:1067,o:"m 954 0 l 819 0 l 819 869 l 537 0 l 405 0 l 128 866 l 128 0 l 0 0 l 0 1013 l 200 1013 l 472 160 l 757 1013 l 954 1013 l 954 0 "},"Ψ":{x_min:0,x_max:1006,ha:1094,o:"m 1006 678 q 914 319 1006 429 q 571 200 814 200 l 571 0 l 433 0 l 433 200 q 92 319 194 200 q 0 678 0 429 l 0 1013 l 139 1013 l 139 679 q 191 417 139 492 q 433 326 255 326 l 433 1013 l 571 1013 l 571 326 l 580 326 q 813 423 747 326 q 868 679 868 502 l 868 1013 l 1006 1013 l 1006 678 "},C:{x_min:0,x_max:886,ha:944,o:"m 886 379 q 760 87 886 201 q 455 -26 634 -26 q 112 136 236 -26 q 0 509 0 283 q 118 882 0 737 q 469 1041 245 1041 q 748 955 630 1041 q 879 708 879 859 l 745 708 q 649 862 724 805 q 473 920 573 920 q 219 791 312 920 q 136 509 136 675 q 217 229 136 344 q 470 99 311 99 q 672 179 591 99 q 753 379 753 259 l 886 379 "},"!":{x_min:0,x_max:138,ha:236,o:"m 138 684 q 116 409 138 629 q 105 244 105 299 l 33 244 q 16 465 33 313 q 0 684 0 616 l 0 1013 l 138 1013 l 138 684 m 138 0 l 0 0 l 0 151 l 138 151 l 138 0 "},"{":{x_min:0,x_max:480.5625,ha:578,o:"m 480 -286 q 237 -213 303 -286 q 187 -45 187 -159 q 194 48 187 -15 q 201 141 201 112 q 164 264 201 225 q 0 314 118 314 l 0 417 q 164 471 119 417 q 201 605 201 514 q 199 665 201 644 q 193 772 193 769 q 241 941 193 887 q 480 1015 308 1015 l 480 915 q 336 866 375 915 q 306 742 306 828 q 310 662 306 717 q 314 577 314 606 q 288 452 314 500 q 176 365 256 391 q 289 275 257 337 q 314 143 314 226 q 313 84 314 107 q 310 -11 310 -5 q 339 -131 310 -94 q 480 -182 377 -182 l 480 -286 "},X:{x_min:-.015625,x_max:854.15625,ha:940,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 428 637 l 675 1013 l 836 1013 l 504 520 l 854 0 "},"#":{x_min:0,x_max:963.890625,ha:1061,o:"m 963 690 l 927 590 l 719 590 l 655 410 l 876 410 l 840 310 l 618 310 l 508 -3 l 393 -2 l 506 309 l 329 310 l 215 -2 l 102 -3 l 212 310 l 0 310 l 36 410 l 248 409 l 312 590 l 86 590 l 120 690 l 347 690 l 459 1006 l 573 1006 l 462 690 l 640 690 l 751 1006 l 865 1006 l 754 690 l 963 690 m 606 590 l 425 590 l 362 410 l 543 410 l 606 590 "},"ι":{x_min:42,x_max:284,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 738 l 167 738 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 103 239 101 q 284 112 257 104 l 284 3 "},"Ά":{x_min:0,x_max:906.953125,ha:982,o:"m 283 1040 l 88 799 l 5 799 l 145 1040 l 283 1040 m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1012 l 529 1012 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},")":{x_min:0,x_max:318,ha:415,o:"m 318 365 q 257 25 318 191 q 87 -290 197 -141 l 0 -290 q 140 21 93 -128 q 193 360 193 189 q 141 704 193 537 q 0 1024 97 850 l 87 1024 q 257 706 197 871 q 318 365 318 542 "},"ε":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 314 0 265 q 128 390 67 353 q 56 460 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 "},"Δ":{x_min:0,x_max:952.78125,ha:1028,o:"m 952 0 l 0 0 l 400 1013 l 551 1013 l 952 0 m 762 124 l 476 867 l 187 124 l 762 124 "},"}":{x_min:0,x_max:481,ha:578,o:"m 481 314 q 318 262 364 314 q 282 136 282 222 q 284 65 282 97 q 293 -58 293 -48 q 241 -217 293 -166 q 0 -286 174 -286 l 0 -182 q 143 -130 105 -182 q 171 -2 171 -93 q 168 81 171 22 q 165 144 165 140 q 188 275 165 229 q 306 365 220 339 q 191 455 224 391 q 165 588 165 505 q 168 681 165 624 q 171 742 171 737 q 141 865 171 827 q 0 915 102 915 l 0 1015 q 243 942 176 1015 q 293 773 293 888 q 287 675 293 741 q 282 590 282 608 q 318 466 282 505 q 481 417 364 417 l 481 314 "},"‰":{x_min:-3,x_max:1672,ha:1821,o:"m 846 0 q 664 76 732 0 q 603 244 603 145 q 662 412 603 344 q 846 489 729 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 846 0 962 0 m 845 103 q 945 143 910 103 q 981 243 981 184 q 947 340 981 301 q 845 385 910 385 q 745 342 782 385 q 709 243 709 300 q 742 147 709 186 q 845 103 781 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 m 1428 0 q 1246 76 1314 0 q 1185 244 1185 145 q 1244 412 1185 344 q 1428 489 1311 489 q 1610 412 1542 489 q 1672 244 1672 343 q 1612 76 1672 144 q 1428 0 1545 0 m 1427 103 q 1528 143 1492 103 q 1564 243 1564 184 q 1530 340 1564 301 q 1427 385 1492 385 q 1327 342 1364 385 q 1291 243 1291 300 q 1324 147 1291 186 q 1427 103 1363 103 "},a:{x_min:0,x_max:698.609375,ha:794,o:"m 698 0 q 661 -12 679 -7 q 615 -17 643 -17 q 536 12 564 -17 q 500 96 508 41 q 384 6 456 37 q 236 -25 312 -25 q 65 31 130 -25 q 0 194 0 88 q 118 390 0 334 q 328 435 180 420 q 488 483 476 451 q 495 523 495 504 q 442 619 495 584 q 325 654 389 654 q 209 617 257 654 q 152 513 161 580 l 33 513 q 123 705 33 633 q 332 772 207 772 q 528 712 448 772 q 617 531 617 645 l 617 163 q 624 108 617 126 q 664 90 632 90 l 698 94 l 698 0 m 491 262 l 491 372 q 272 329 350 347 q 128 201 128 294 q 166 113 128 144 q 264 83 205 83 q 414 130 346 83 q 491 262 491 183 "},"—":{x_min:0,x_max:941.671875,ha:1039,o:"m 941 334 l 0 334 l 0 410 l 941 410 l 941 334 "},"=":{x_min:8.71875,x_max:780.953125,ha:792,o:"m 780 510 l 8 510 l 8 606 l 780 606 l 780 510 m 780 235 l 8 235 l 8 332 l 780 332 l 780 235 "},N:{x_min:0,x_max:801,ha:914,o:"m 801 0 l 651 0 l 131 823 l 131 0 l 0 0 l 0 1013 l 151 1013 l 670 193 l 670 1013 l 801 1013 l 801 0 "},"ρ":{x_min:0,x_max:712,ha:797,o:"m 712 369 q 620 94 712 207 q 362 -26 521 -26 q 230 2 292 -26 q 119 83 167 30 l 119 -278 l 0 -278 l 0 362 q 91 643 0 531 q 355 764 190 764 q 617 647 517 764 q 712 369 712 536 m 583 366 q 530 559 583 480 q 359 651 469 651 q 190 562 252 651 q 135 370 135 483 q 189 176 135 257 q 359 85 250 85 q 528 175 466 85 q 583 366 583 254 "},"¯":{x_min:0,x_max:941.671875,ha:938,o:"m 941 1033 l 0 1033 l 0 1109 l 941 1109 l 941 1033 "},Z:{x_min:0,x_max:779,ha:849,o:"m 779 0 l 0 0 l 0 113 l 621 896 l 40 896 l 40 1013 l 779 1013 l 778 887 l 171 124 l 779 124 l 779 0 "},u:{x_min:0,x_max:617,ha:729,o:"m 617 0 l 499 0 l 499 110 q 391 10 460 45 q 246 -25 322 -25 q 61 58 127 -25 q 0 258 0 136 l 0 738 l 125 738 l 125 284 q 156 148 125 202 q 273 82 197 82 q 433 165 369 82 q 493 340 493 243 l 493 738 l 617 738 l 617 0 "},k:{x_min:0,x_max:612.484375,ha:697,o:"m 612 738 l 338 465 l 608 0 l 469 0 l 251 382 l 121 251 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 402 l 456 738 l 612 738 "},"Η":{x_min:0,x_max:803,ha:917,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"Α":{x_min:0,x_max:906.953125,ha:985,o:"m 906 0 l 756 0 l 650 303 l 251 303 l 143 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 609 421 l 452 866 l 293 421 l 609 421 "},s:{x_min:0,x_max:604,ha:697,o:"m 604 217 q 501 36 604 104 q 292 -23 411 -23 q 86 43 166 -23 q 0 238 0 114 l 121 237 q 175 122 121 164 q 300 85 223 85 q 415 112 363 85 q 479 207 479 147 q 361 309 479 276 q 140 372 141 370 q 21 544 21 426 q 111 708 21 647 q 298 761 190 761 q 492 705 413 761 q 583 531 583 643 l 462 531 q 412 625 462 594 q 298 657 363 657 q 199 636 242 657 q 143 558 143 608 q 262 454 143 486 q 484 394 479 397 q 604 217 604 341 "},B:{x_min:0,x_max:778,ha:876,o:"m 580 546 q 724 469 670 535 q 778 311 778 403 q 673 83 778 171 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 892 q 691 633 732 693 q 580 546 650 572 m 393 899 l 139 899 l 139 588 l 379 588 q 521 624 462 588 q 592 744 592 667 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 303 635 219 q 559 436 635 389 q 402 477 494 477 l 139 477 l 139 124 l 419 124 "},"…":{x_min:0,x_max:614,ha:708,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 m 378 0 l 236 0 l 236 151 l 378 151 l 378 0 m 614 0 l 472 0 l 472 151 l 614 151 l 614 0 "},"?":{x_min:0,x_max:607,ha:704,o:"m 607 777 q 543 599 607 674 q 422 474 482 537 q 357 272 357 391 l 236 272 q 297 487 236 395 q 411 619 298 490 q 474 762 474 691 q 422 885 474 838 q 301 933 371 933 q 179 880 228 933 q 124 706 124 819 l 0 706 q 94 963 0 872 q 302 1044 177 1044 q 511 973 423 1044 q 607 777 607 895 m 370 0 l 230 0 l 230 151 l 370 151 l 370 0 "},H:{x_min:0,x_max:803,ha:915,o:"m 803 0 l 667 0 l 667 475 l 140 475 l 140 0 l 0 0 l 0 1013 l 140 1013 l 140 599 l 667 599 l 667 1013 l 803 1013 l 803 0 "},"ν":{x_min:0,x_max:675,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 738 l 340 147 l 541 738 l 675 738 "},c:{x_min:1,x_max:701.390625,ha:775,o:"m 701 264 q 584 53 681 133 q 353 -26 487 -26 q 91 91 188 -26 q 1 370 1 201 q 92 645 1 537 q 353 761 190 761 q 572 688 479 761 q 690 493 666 615 l 556 493 q 487 606 545 562 q 356 650 428 650 q 186 563 246 650 q 134 372 134 487 q 188 179 134 258 q 359 88 250 88 q 492 136 437 88 q 566 264 548 185 l 701 264 "},"¶":{x_min:0,x_max:566.671875,ha:678,o:"m 21 892 l 52 892 l 98 761 l 145 892 l 176 892 l 178 741 l 157 741 l 157 867 l 108 741 l 88 741 l 40 871 l 40 741 l 21 741 l 21 892 m 308 854 l 308 731 q 252 691 308 691 q 227 691 240 691 q 207 696 213 695 l 207 712 l 253 706 q 288 733 288 706 l 288 763 q 244 741 279 741 q 193 797 193 741 q 261 860 193 860 q 287 860 273 860 q 308 854 302 855 m 288 842 l 263 843 q 213 796 213 843 q 248 756 213 756 q 288 796 288 756 l 288 842 m 566 988 l 502 988 l 502 -1 l 439 -1 l 439 988 l 317 988 l 317 -1 l 252 -1 l 252 602 q 81 653 155 602 q 0 805 0 711 q 101 989 0 918 q 309 1053 194 1053 l 566 1053 l 566 988 "},"β":{x_min:0,x_max:660,ha:745,o:"m 471 550 q 610 450 561 522 q 660 280 660 378 q 578 64 660 151 q 367 -22 497 -22 q 239 5 299 -22 q 126 82 178 32 l 126 -278 l 0 -278 l 0 593 q 54 903 0 801 q 318 1042 127 1042 q 519 964 436 1042 q 603 771 603 887 q 567 644 603 701 q 471 550 532 586 m 337 79 q 476 138 418 79 q 535 279 535 198 q 427 437 535 386 q 226 477 344 477 l 226 583 q 398 620 329 583 q 486 762 486 668 q 435 884 486 833 q 312 935 384 935 q 169 861 219 935 q 126 698 126 797 l 126 362 q 170 169 126 242 q 337 79 224 79 "},"Μ":{x_min:0,x_max:954,ha:1068,o:"m 954 0 l 819 0 l 819 868 l 537 0 l 405 0 l 128 865 l 128 0 l 0 0 l 0 1013 l 199 1013 l 472 158 l 758 1013 l 954 1013 l 954 0 "},"Ό":{x_min:.109375,x_max:1120,ha:1217,o:"m 1120 505 q 994 132 1120 282 q 642 -29 861 -29 q 290 130 422 -29 q 167 505 167 280 q 294 883 167 730 q 650 1046 430 1046 q 999 882 868 1046 q 1120 505 1120 730 m 977 504 q 896 784 977 669 q 644 915 804 915 q 391 785 484 915 q 307 504 307 669 q 391 224 307 339 q 644 95 486 95 q 894 224 803 95 q 977 504 977 339 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ή":{x_min:0,x_max:1158,ha:1275,o:"m 1158 0 l 1022 0 l 1022 475 l 496 475 l 496 0 l 356 0 l 356 1012 l 496 1012 l 496 599 l 1022 599 l 1022 1012 l 1158 1012 l 1158 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"•":{x_min:0,x_max:663.890625,ha:775,o:"m 663 529 q 566 293 663 391 q 331 196 469 196 q 97 294 194 196 q 0 529 0 393 q 96 763 0 665 q 331 861 193 861 q 566 763 469 861 q 663 529 663 665 "},"¥":{x_min:.1875,x_max:819.546875,ha:886,o:"m 563 561 l 697 561 l 696 487 l 520 487 l 482 416 l 482 380 l 697 380 l 695 308 l 482 308 l 482 0 l 342 0 l 342 308 l 125 308 l 125 380 l 342 380 l 342 417 l 303 487 l 125 487 l 125 561 l 258 561 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 l 563 561 "},"(":{x_min:0,x_max:318.0625,ha:415,o:"m 318 -290 l 230 -290 q 61 23 122 -142 q 0 365 0 190 q 62 712 0 540 q 230 1024 119 869 l 318 1024 q 175 705 219 853 q 125 360 125 542 q 176 22 125 187 q 318 -290 223 -127 "},U:{x_min:0,x_max:796,ha:904,o:"m 796 393 q 681 93 796 212 q 386 -25 566 -25 q 101 95 208 -25 q 0 393 0 211 l 0 1013 l 138 1013 l 138 391 q 204 191 138 270 q 394 107 276 107 q 586 191 512 107 q 656 391 656 270 l 656 1013 l 796 1013 l 796 393 "},"γ":{x_min:.5,x_max:744.953125,ha:822,o:"m 744 737 l 463 54 l 463 -278 l 338 -278 l 338 54 l 154 495 q 104 597 124 569 q 13 651 67 651 l 0 651 l 0 751 l 39 753 q 168 711 121 753 q 242 594 207 676 l 403 208 l 617 737 l 744 737 "},"α":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 728 407 760 q 563 637 524 696 l 563 739 l 685 739 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 96 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 "},F:{x_min:0,x_max:683.328125,ha:717,o:"m 683 888 l 140 888 l 140 583 l 613 583 l 613 458 l 140 458 l 140 0 l 0 0 l 0 1013 l 683 1013 l 683 888 "},"­":{x_min:0,x_max:705.5625,ha:803,o:"m 705 334 l 0 334 l 0 410 l 705 410 l 705 334 "},":":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"Χ":{x_min:0,x_max:854.171875,ha:935,o:"m 854 0 l 683 0 l 423 409 l 166 0 l 0 0 l 347 519 l 18 1013 l 186 1013 l 427 637 l 675 1013 l 836 1013 l 504 521 l 854 0 "},"*":{x_min:116,x_max:674,ha:792,o:"m 674 768 l 475 713 l 610 544 l 517 477 l 394 652 l 272 478 l 178 544 l 314 713 l 116 766 l 153 876 l 341 812 l 342 1013 l 446 1013 l 446 811 l 635 874 l 674 768 "},"†":{x_min:0,x_max:777,ha:835,o:"m 458 804 l 777 804 l 777 683 l 458 683 l 458 0 l 319 0 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 "},"°":{x_min:0,x_max:347,ha:444,o:"m 173 802 q 43 856 91 802 q 0 977 0 905 q 45 1101 0 1049 q 173 1153 90 1153 q 303 1098 255 1153 q 347 977 347 1049 q 303 856 347 905 q 173 802 256 802 m 173 884 q 238 910 214 884 q 262 973 262 937 q 239 1038 262 1012 q 173 1064 217 1064 q 108 1037 132 1064 q 85 973 85 1010 q 108 910 85 937 q 173 884 132 884 "},V:{x_min:0,x_max:862.71875,ha:940,o:"m 862 1013 l 505 0 l 361 0 l 0 1013 l 143 1013 l 434 165 l 718 1012 l 862 1013 "},"Ξ":{x_min:0,x_max:734.71875,ha:763,o:"m 723 889 l 9 889 l 9 1013 l 723 1013 l 723 889 m 673 463 l 61 463 l 61 589 l 673 589 l 673 463 m 734 0 l 0 0 l 0 124 l 734 124 l 734 0 "}," ":{x_min:0,x_max:0,ha:853},"Ϋ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 588 1046 l 460 1046 l 460 1189 l 588 1189 l 588 1046 m 360 1046 l 232 1046 l 232 1189 l 360 1189 l 360 1046 m 819 1012 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1012 l 140 1012 l 411 533 l 679 1012 l 819 1012 "},"”":{x_min:0,x_max:347,ha:454,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 m 347 851 q 310 737 347 784 q 208 669 273 690 l 208 734 q 267 787 250 741 q 280 873 280 821 l 208 873 l 208 1013 l 347 1013 l 347 851 "},"@":{x_min:0,x_max:1260,ha:1357,o:"m 1098 -45 q 877 -160 1001 -117 q 633 -203 752 -203 q 155 -29 327 -203 q 0 360 0 127 q 176 802 0 616 q 687 1008 372 1008 q 1123 854 969 1008 q 1260 517 1260 718 q 1155 216 1260 341 q 868 82 1044 82 q 772 106 801 82 q 737 202 737 135 q 647 113 700 144 q 527 82 594 82 q 367 147 420 82 q 314 312 314 212 q 401 565 314 452 q 639 690 498 690 q 810 588 760 690 l 849 668 l 938 668 q 877 441 900 532 q 833 226 833 268 q 853 182 833 198 q 902 167 873 167 q 1088 272 1012 167 q 1159 512 1159 372 q 1051 793 1159 681 q 687 925 925 925 q 248 747 415 925 q 97 361 97 586 q 226 26 97 159 q 627 -122 370 -122 q 856 -87 737 -122 q 1061 8 976 -53 l 1098 -45 m 786 488 q 738 580 777 545 q 643 615 700 615 q 483 517 548 615 q 425 322 425 430 q 457 203 425 250 q 552 156 490 156 q 722 273 665 156 q 786 488 738 309 "},"Ί":{x_min:0,x_max:499,ha:613,o:"m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 m 499 0 l 360 0 l 360 1012 l 499 1012 l 499 0 "},i:{x_min:14,x_max:136,ha:275,o:"m 136 873 l 14 873 l 14 1013 l 136 1013 l 136 873 m 136 0 l 14 0 l 14 737 l 136 737 l 136 0 "},"Β":{x_min:0,x_max:778,ha:877,o:"m 580 545 q 724 468 671 534 q 778 310 778 402 q 673 83 778 170 q 432 0 575 0 l 0 0 l 0 1013 l 411 1013 q 629 957 541 1013 q 732 768 732 891 q 691 632 732 692 q 580 545 650 571 m 393 899 l 139 899 l 139 587 l 379 587 q 521 623 462 587 q 592 744 592 666 q 531 859 592 819 q 393 899 471 899 m 419 124 q 566 169 504 124 q 635 302 635 219 q 559 435 635 388 q 402 476 494 476 l 139 476 l 139 124 l 419 124 "},"υ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 94 617 199 q 308 -24 455 -24 q 76 94 161 -24 q 0 352 0 199 l 0 739 l 126 739 l 126 355 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 355 492 257 l 492 739 l 617 739 l 617 352 "},"]":{x_min:0,x_max:275,ha:372,o:"m 275 -281 l 0 -281 l 0 -187 l 151 -187 l 151 920 l 0 920 l 0 1013 l 275 1013 l 275 -281 "},m:{x_min:0,x_max:1019,ha:1128,o:"m 1019 0 l 897 0 l 897 454 q 860 591 897 536 q 739 660 816 660 q 613 586 659 660 q 573 436 573 522 l 573 0 l 447 0 l 447 455 q 412 591 447 535 q 294 657 372 657 q 165 586 213 657 q 122 437 122 521 l 122 0 l 0 0 l 0 738 l 117 738 l 117 640 q 202 730 150 697 q 316 763 254 763 q 437 730 381 763 q 525 642 494 697 q 621 731 559 700 q 753 763 682 763 q 943 694 867 763 q 1019 512 1019 625 l 1019 0 "},"χ":{x_min:8.328125,x_max:780.5625,ha:815,o:"m 780 -278 q 715 -294 747 -294 q 616 -257 663 -294 q 548 -175 576 -227 l 379 133 l 143 -277 l 9 -277 l 313 254 l 163 522 q 127 586 131 580 q 36 640 91 640 q 8 637 27 640 l 8 752 l 52 757 q 162 719 113 757 q 236 627 200 690 l 383 372 l 594 737 l 726 737 l 448 250 l 625 -69 q 670 -153 647 -110 q 743 -188 695 -188 q 780 -184 759 -188 l 780 -278 "},"ί":{x_min:42,x_max:326.71875,ha:361,o:"m 284 3 q 233 -10 258 -5 q 182 -15 207 -15 q 85 26 119 -15 q 42 200 42 79 l 42 737 l 167 737 l 168 215 q 172 141 168 157 q 226 101 183 101 q 248 102 239 101 q 284 112 257 104 l 284 3 m 326 1040 l 137 819 l 54 819 l 189 1040 l 326 1040 "},"Ζ":{x_min:0,x_max:779.171875,ha:850,o:"m 779 0 l 0 0 l 0 113 l 620 896 l 40 896 l 40 1013 l 779 1013 l 779 887 l 170 124 l 779 124 l 779 0 "},R:{x_min:0,x_max:781.953125,ha:907,o:"m 781 0 l 623 0 q 587 242 590 52 q 407 433 585 433 l 138 433 l 138 0 l 0 0 l 0 1013 l 396 1013 q 636 946 539 1013 q 749 731 749 868 q 711 597 749 659 q 608 502 674 534 q 718 370 696 474 q 729 207 722 352 q 781 26 736 62 l 781 0 m 373 551 q 533 594 465 551 q 614 731 614 645 q 532 859 614 815 q 373 896 465 896 l 138 896 l 138 551 l 373 551 "},o:{x_min:0,x_max:713,ha:821,o:"m 357 -25 q 94 91 194 -25 q 0 368 0 202 q 93 642 0 533 q 357 761 193 761 q 618 644 518 761 q 713 368 713 533 q 619 91 713 201 q 357 -25 521 -25 m 357 85 q 528 175 465 85 q 584 369 584 255 q 529 562 584 484 q 357 651 467 651 q 189 560 250 651 q 135 369 135 481 q 187 177 135 257 q 357 85 250 85 "},K:{x_min:0,x_max:819.46875,ha:906,o:"m 819 0 l 649 0 l 294 509 l 139 355 l 139 0 l 0 0 l 0 1013 l 139 1013 l 139 526 l 626 1013 l 809 1013 l 395 600 l 819 0 "},",":{x_min:0,x_max:142,ha:239,o:"m 142 -12 q 105 -132 142 -82 q 0 -205 68 -182 l 0 -138 q 57 -82 40 -124 q 70 0 70 -51 l 0 0 l 0 151 l 142 151 l 142 -12 "},d:{x_min:0,x_max:683,ha:796,o:"m 683 0 l 564 0 l 564 93 q 456 6 516 38 q 327 -25 395 -25 q 87 100 181 -25 q 0 365 0 215 q 90 639 0 525 q 343 763 187 763 q 564 647 486 763 l 564 1013 l 683 1013 l 683 0 m 582 373 q 529 562 582 484 q 361 653 468 653 q 190 561 253 653 q 135 365 135 479 q 189 175 135 254 q 358 85 251 85 q 529 178 468 85 q 582 373 582 258 "},"¨":{x_min:-109,x_max:247,ha:232,o:"m 247 1046 l 119 1046 l 119 1189 l 247 1189 l 247 1046 m 19 1046 l -109 1046 l -109 1189 l 19 1189 l 19 1046 "},E:{x_min:0,x_max:736.109375,ha:789,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},Y:{x_min:0,x_max:820,ha:886,o:"m 820 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 534 l 679 1012 l 820 1013 "},'"':{x_min:0,x_max:299,ha:396,o:"m 299 606 l 203 606 l 203 988 l 299 988 l 299 606 m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"‹":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"„":{x_min:0,x_max:364,ha:467,o:"m 141 -12 q 104 -132 141 -82 q 0 -205 67 -182 l 0 -138 q 56 -82 40 -124 q 69 0 69 -51 l 0 0 l 0 151 l 141 151 l 141 -12 m 364 -12 q 327 -132 364 -82 q 222 -205 290 -182 l 222 -138 q 279 -82 262 -124 q 292 0 292 -51 l 222 0 l 222 151 l 364 151 l 364 -12 "},"δ":{x_min:1,x_max:710,ha:810,o:"m 710 360 q 616 87 710 196 q 356 -28 518 -28 q 99 82 197 -28 q 1 356 1 192 q 100 606 1 509 q 355 703 199 703 q 180 829 288 754 q 70 903 124 866 l 70 1012 l 643 1012 l 643 901 l 258 901 q 462 763 422 794 q 636 592 577 677 q 710 360 710 485 m 584 365 q 552 501 584 447 q 451 602 521 555 q 372 611 411 611 q 197 541 258 611 q 136 355 136 472 q 190 171 136 245 q 358 85 252 85 q 528 173 465 85 q 584 365 584 252 "},"έ":{x_min:0,x_max:634.71875,ha:714,o:"m 634 234 q 527 38 634 110 q 300 -25 433 -25 q 98 29 183 -25 q 0 204 0 93 q 37 313 0 265 q 128 390 67 352 q 56 459 82 419 q 26 555 26 505 q 114 712 26 654 q 295 763 191 763 q 499 700 416 763 q 589 515 589 631 l 478 515 q 419 618 464 580 q 307 657 374 657 q 207 630 253 657 q 151 547 151 598 q 238 445 151 469 q 389 434 280 434 l 389 331 l 349 331 q 206 315 255 331 q 125 210 125 287 q 183 107 125 145 q 302 76 233 76 q 436 117 379 76 q 509 234 493 159 l 634 234 m 520 1040 l 331 819 l 248 819 l 383 1040 l 520 1040 "},"ω":{x_min:0,x_max:922,ha:1031,o:"m 922 339 q 856 97 922 203 q 650 -26 780 -26 q 538 9 587 -26 q 461 103 489 44 q 387 12 436 46 q 277 -22 339 -22 q 69 97 147 -22 q 0 339 0 203 q 45 551 0 444 q 161 738 84 643 l 302 738 q 175 553 219 647 q 124 336 124 446 q 155 179 124 249 q 275 88 197 88 q 375 163 341 88 q 400 294 400 219 l 400 572 l 524 572 l 524 294 q 561 135 524 192 q 643 88 591 88 q 762 182 719 88 q 797 342 797 257 q 745 556 797 450 q 619 738 705 638 l 760 738 q 874 551 835 640 q 922 339 922 444 "},"´":{x_min:0,x_max:96,ha:251,o:"m 96 606 l 0 606 l 0 988 l 96 988 l 96 606 "},"±":{x_min:11,x_max:781,ha:792,o:"m 781 490 l 446 490 l 446 255 l 349 255 l 349 490 l 11 490 l 11 586 l 349 586 l 349 819 l 446 819 l 446 586 l 781 586 l 781 490 m 781 21 l 11 21 l 11 115 l 781 115 l 781 21 "},"|":{x_min:343,x_max:449,ha:792,o:"m 449 462 l 343 462 l 343 986 l 449 986 l 449 462 m 449 -242 l 343 -242 l 343 280 l 449 280 l 449 -242 "},"ϋ":{x_min:0,x_max:617,ha:725,o:"m 482 800 l 372 800 l 372 925 l 482 925 l 482 800 m 239 800 l 129 800 l 129 925 l 239 925 l 239 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 "},"§":{x_min:0,x_max:593,ha:690,o:"m 593 425 q 554 312 593 369 q 467 233 516 254 q 537 83 537 172 q 459 -74 537 -12 q 288 -133 387 -133 q 115 -69 184 -133 q 47 96 47 -6 l 166 96 q 199 7 166 40 q 288 -26 232 -26 q 371 -5 332 -26 q 420 60 420 21 q 311 201 420 139 q 108 309 210 255 q 0 490 0 383 q 33 602 0 551 q 124 687 66 654 q 75 743 93 712 q 58 812 58 773 q 133 984 58 920 q 300 1043 201 1043 q 458 987 394 1043 q 529 814 529 925 l 411 814 q 370 908 404 877 q 289 939 336 939 q 213 911 246 939 q 180 841 180 883 q 286 720 180 779 q 484 612 480 615 q 593 425 593 534 m 467 409 q 355 544 467 473 q 196 630 228 612 q 146 587 162 609 q 124 525 124 558 q 239 387 124 462 q 398 298 369 315 q 448 345 429 316 q 467 409 467 375 "},b:{x_min:0,x_max:685,ha:783,o:"m 685 372 q 597 99 685 213 q 347 -25 501 -25 q 219 5 277 -25 q 121 93 161 36 l 121 0 l 0 0 l 0 1013 l 121 1013 l 121 634 q 214 723 157 692 q 341 754 272 754 q 591 637 493 754 q 685 372 685 526 m 554 356 q 499 550 554 470 q 328 644 437 644 q 162 556 223 644 q 108 369 108 478 q 160 176 108 256 q 330 83 221 83 q 498 169 435 83 q 554 356 554 245 "},q:{x_min:0,x_max:683,ha:876,o:"m 683 -278 l 564 -278 l 564 97 q 474 8 533 39 q 345 -23 415 -23 q 91 93 188 -23 q 0 364 0 203 q 87 635 0 522 q 337 760 184 760 q 466 727 408 760 q 564 637 523 695 l 564 737 l 683 737 l 683 -278 m 582 375 q 527 564 582 488 q 358 652 466 652 q 190 565 253 652 q 135 377 135 488 q 189 179 135 261 q 361 84 251 84 q 530 179 469 84 q 582 375 582 260 "},"Ω":{x_min:-.171875,x_max:969.5625,ha:1068,o:"m 969 0 l 555 0 l 555 123 q 744 308 675 194 q 814 558 814 423 q 726 812 814 709 q 484 922 633 922 q 244 820 334 922 q 154 567 154 719 q 223 316 154 433 q 412 123 292 199 l 412 0 l 0 0 l 0 124 l 217 124 q 68 327 122 210 q 15 572 15 444 q 144 911 15 781 q 484 1041 274 1041 q 822 909 691 1041 q 953 569 953 777 q 899 326 953 443 q 750 124 846 210 l 969 124 l 969 0 "},"ύ":{x_min:0,x_max:617,ha:725,o:"m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 535 1040 l 346 819 l 262 819 l 397 1040 l 535 1040 "},z:{x_min:-.015625,x_max:613.890625,ha:697,o:"m 613 0 l 0 0 l 0 100 l 433 630 l 20 630 l 20 738 l 594 738 l 593 636 l 163 110 l 613 110 l 613 0 "},"™":{x_min:0,x_max:894,ha:1e3,o:"m 389 951 l 229 951 l 229 503 l 160 503 l 160 951 l 0 951 l 0 1011 l 389 1011 l 389 951 m 894 503 l 827 503 l 827 939 l 685 503 l 620 503 l 481 937 l 481 503 l 417 503 l 417 1011 l 517 1011 l 653 580 l 796 1010 l 894 1011 l 894 503 "},"ή":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 721 124 755 q 200 630 193 687 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 m 479 1040 l 290 819 l 207 819 l 341 1040 l 479 1040 "},"Θ":{x_min:0,x_max:960,ha:1056,o:"m 960 507 q 833 129 960 280 q 476 -32 698 -32 q 123 129 255 -32 q 0 507 0 280 q 123 883 0 732 q 476 1045 255 1045 q 832 883 696 1045 q 960 507 960 732 m 817 500 q 733 789 817 669 q 476 924 639 924 q 223 792 317 924 q 142 507 142 675 q 222 222 142 339 q 476 89 315 89 q 730 218 636 89 q 817 500 817 334 m 716 449 l 243 449 l 243 571 l 716 571 l 716 449 "},"®":{x_min:-3,x_max:1008,ha:1106,o:"m 503 532 q 614 562 566 532 q 672 658 672 598 q 614 747 672 716 q 503 772 569 772 l 338 772 l 338 532 l 503 532 m 502 -7 q 123 151 263 -7 q -3 501 -3 294 q 123 851 -3 706 q 502 1011 263 1011 q 881 851 739 1011 q 1008 501 1008 708 q 883 151 1008 292 q 502 -7 744 -7 m 502 60 q 830 197 709 60 q 940 501 940 322 q 831 805 940 681 q 502 944 709 944 q 174 805 296 944 q 65 501 65 680 q 173 197 65 320 q 502 60 294 60 m 788 146 l 678 146 q 653 316 655 183 q 527 449 652 449 l 338 449 l 338 146 l 241 146 l 241 854 l 518 854 q 688 808 621 854 q 766 658 766 755 q 739 563 766 607 q 668 497 713 519 q 751 331 747 472 q 788 164 756 190 l 788 146 "},"~":{x_min:0,x_max:833,ha:931,o:"m 833 958 q 778 753 833 831 q 594 665 716 665 q 402 761 502 665 q 240 857 302 857 q 131 795 166 857 q 104 665 104 745 l 0 665 q 54 867 0 789 q 237 958 116 958 q 429 861 331 958 q 594 765 527 765 q 704 827 670 765 q 729 958 729 874 l 833 958 "},"Ε":{x_min:0,x_max:736.21875,ha:778,o:"m 736 0 l 0 0 l 0 1013 l 725 1013 l 725 889 l 139 889 l 139 585 l 677 585 l 677 467 l 139 467 l 139 125 l 736 125 l 736 0 "},"³":{x_min:0,x_max:450,ha:547,o:"m 450 552 q 379 413 450 464 q 220 366 313 366 q 69 414 130 366 q 0 567 0 470 l 85 567 q 126 470 85 504 q 225 437 168 437 q 320 467 280 437 q 360 552 360 498 q 318 632 360 608 q 213 657 276 657 q 195 657 203 657 q 176 657 181 657 l 176 722 q 279 733 249 722 q 334 815 334 752 q 300 881 334 856 q 220 907 267 907 q 133 875 169 907 q 97 781 97 844 l 15 781 q 78 926 15 875 q 220 972 135 972 q 364 930 303 972 q 426 817 426 888 q 344 697 426 733 q 421 642 392 681 q 450 552 450 603 "},"[":{x_min:0,x_max:273.609375,ha:371,o:"m 273 -281 l 0 -281 l 0 1013 l 273 1013 l 273 920 l 124 920 l 124 -187 l 273 -187 l 273 -281 "},L:{x_min:0,x_max:645.828125,ha:696,o:"m 645 0 l 0 0 l 0 1013 l 140 1013 l 140 126 l 645 126 l 645 0 "},"σ":{x_min:0,x_max:803.390625,ha:894,o:"m 803 628 l 633 628 q 713 368 713 512 q 618 93 713 204 q 357 -25 518 -25 q 94 91 194 -25 q 0 368 0 201 q 94 644 0 533 q 356 761 194 761 q 481 750 398 761 q 608 739 564 739 l 803 739 l 803 628 m 360 85 q 529 180 467 85 q 584 374 584 262 q 527 566 584 490 q 352 651 463 651 q 187 559 247 651 q 135 368 135 478 q 189 175 135 254 q 360 85 251 85 "},"ζ":{x_min:0,x_max:573,ha:642,o:"m 573 -40 q 553 -162 573 -97 q 510 -278 543 -193 l 400 -278 q 441 -187 428 -219 q 462 -90 462 -132 q 378 -14 462 -14 q 108 45 197 -14 q 0 290 0 117 q 108 631 0 462 q 353 901 194 767 l 55 901 l 55 1012 l 561 1012 l 561 924 q 261 669 382 831 q 128 301 128 489 q 243 117 128 149 q 458 98 350 108 q 573 -40 573 80 "},"θ":{x_min:0,x_max:674,ha:778,o:"m 674 496 q 601 160 674 304 q 336 -26 508 -26 q 73 153 165 -26 q 0 485 0 296 q 72 840 0 683 q 343 1045 166 1045 q 605 844 516 1045 q 674 496 674 692 m 546 579 q 498 798 546 691 q 336 935 437 935 q 178 798 237 935 q 126 579 137 701 l 546 579 m 546 475 l 126 475 q 170 233 126 348 q 338 80 230 80 q 504 233 447 80 q 546 475 546 346 "},"Ο":{x_min:0,x_max:958,ha:1054,o:"m 485 1042 q 834 883 703 1042 q 958 511 958 735 q 834 136 958 287 q 481 -26 701 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 729 q 485 1042 263 1042 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 670 q 480 913 640 913 q 226 785 321 913 q 142 504 142 671 q 226 224 142 339 q 480 98 319 98 "},"Γ":{x_min:0,x_max:705.28125,ha:749,o:"m 705 886 l 140 886 l 140 0 l 0 0 l 0 1012 l 705 1012 l 705 886 "}," ":{x_min:0,x_max:0,ha:375},"%":{x_min:-3,x_max:1089,ha:1186,o:"m 845 0 q 663 76 731 0 q 602 244 602 145 q 661 412 602 344 q 845 489 728 489 q 1027 412 959 489 q 1089 244 1089 343 q 1029 76 1089 144 q 845 0 962 0 m 844 103 q 945 143 909 103 q 981 243 981 184 q 947 340 981 301 q 844 385 909 385 q 744 342 781 385 q 708 243 708 300 q 741 147 708 186 q 844 103 780 103 m 888 986 l 284 -25 l 199 -25 l 803 986 l 888 986 m 241 468 q 58 545 126 468 q -3 715 -3 615 q 56 881 -3 813 q 238 958 124 958 q 421 881 353 958 q 483 712 483 813 q 423 544 483 612 q 241 468 356 468 m 241 855 q 137 811 175 855 q 100 710 100 768 q 136 612 100 653 q 240 572 172 572 q 344 614 306 572 q 382 713 382 656 q 347 810 382 771 q 241 855 308 855 "},P:{x_min:0,x_max:726,ha:806,o:"m 424 1013 q 640 931 555 1013 q 726 719 726 850 q 637 506 726 587 q 413 426 548 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 379 889 l 140 889 l 140 548 l 372 548 q 522 589 459 548 q 593 720 593 637 q 528 845 593 801 q 379 889 463 889 "},"Έ":{x_min:0,x_max:1078.21875,ha:1118,o:"m 1078 0 l 342 0 l 342 1013 l 1067 1013 l 1067 889 l 481 889 l 481 585 l 1019 585 l 1019 467 l 481 467 l 481 125 l 1078 125 l 1078 0 m 277 1040 l 83 799 l 0 799 l 140 1040 l 277 1040 "},"Ώ":{x_min:.125,x_max:1136.546875,ha:1235,o:"m 1136 0 l 722 0 l 722 123 q 911 309 842 194 q 981 558 981 423 q 893 813 981 710 q 651 923 800 923 q 411 821 501 923 q 321 568 321 720 q 390 316 321 433 q 579 123 459 200 l 579 0 l 166 0 l 166 124 l 384 124 q 235 327 289 210 q 182 572 182 444 q 311 912 182 782 q 651 1042 441 1042 q 989 910 858 1042 q 1120 569 1120 778 q 1066 326 1120 443 q 917 124 1013 210 l 1136 124 l 1136 0 m 277 1040 l 83 800 l 0 800 l 140 1041 l 277 1040 "},_:{x_min:0,x_max:705.5625,ha:803,o:"m 705 -334 l 0 -334 l 0 -234 l 705 -234 l 705 -334 "},"Ϊ":{x_min:-110,x_max:246,ha:275,o:"m 246 1046 l 118 1046 l 118 1189 l 246 1189 l 246 1046 m 18 1046 l -110 1046 l -110 1189 l 18 1189 l 18 1046 m 136 0 l 0 0 l 0 1012 l 136 1012 l 136 0 "},"+":{x_min:23,x_max:768,ha:792,o:"m 768 372 l 444 372 l 444 0 l 347 0 l 347 372 l 23 372 l 23 468 l 347 468 l 347 840 l 444 840 l 444 468 l 768 468 l 768 372 "},"½":{x_min:0,x_max:1050,ha:1149,o:"m 1050 0 l 625 0 q 712 178 625 108 q 878 277 722 187 q 967 385 967 328 q 932 456 967 429 q 850 484 897 484 q 759 450 798 484 q 721 352 721 416 l 640 352 q 706 502 640 448 q 851 551 766 551 q 987 509 931 551 q 1050 385 1050 462 q 976 251 1050 301 q 829 179 902 215 q 717 68 740 133 l 1050 68 l 1050 0 m 834 985 l 215 -28 l 130 -28 l 750 984 l 834 985 m 224 422 l 142 422 l 142 811 l 0 811 l 0 867 q 104 889 62 867 q 164 973 157 916 l 224 973 l 224 422 "},"Ρ":{x_min:0,x_max:720,ha:783,o:"m 424 1013 q 637 933 554 1013 q 720 723 720 853 q 633 508 720 591 q 413 426 546 426 l 140 426 l 140 0 l 0 0 l 0 1013 l 424 1013 m 378 889 l 140 889 l 140 548 l 371 548 q 521 589 458 548 q 592 720 592 637 q 527 845 592 801 q 378 889 463 889 "},"'":{x_min:0,x_max:139,ha:236,o:"m 139 851 q 102 737 139 784 q 0 669 65 690 l 0 734 q 59 787 42 741 q 72 873 72 821 l 0 873 l 0 1013 l 139 1013 l 139 851 "},"ª":{x_min:0,x_max:350,ha:397,o:"m 350 625 q 307 616 328 616 q 266 631 281 616 q 247 673 251 645 q 190 628 225 644 q 116 613 156 613 q 32 641 64 613 q 0 722 0 669 q 72 826 0 800 q 247 866 159 846 l 247 887 q 220 934 247 916 q 162 953 194 953 q 104 934 129 953 q 76 882 80 915 l 16 882 q 60 976 16 941 q 166 1011 104 1011 q 266 979 224 1011 q 308 891 308 948 l 308 706 q 311 679 308 688 q 331 670 315 670 l 350 672 l 350 625 m 247 757 l 247 811 q 136 790 175 798 q 64 726 64 773 q 83 682 64 697 q 132 667 103 667 q 207 690 174 667 q 247 757 247 718 "},"΅":{x_min:0,x_max:450,ha:553,o:"m 450 800 l 340 800 l 340 925 l 450 925 l 450 800 m 406 1040 l 212 800 l 129 800 l 269 1040 l 406 1040 m 110 800 l 0 800 l 0 925 l 110 925 l 110 800 "},T:{x_min:0,x_max:777,ha:835,o:"m 777 894 l 458 894 l 458 0 l 319 0 l 319 894 l 0 894 l 0 1013 l 777 1013 l 777 894 "},"Φ":{x_min:0,x_max:915,ha:997,o:"m 527 0 l 389 0 l 389 122 q 110 231 220 122 q 0 509 0 340 q 110 785 0 677 q 389 893 220 893 l 389 1013 l 527 1013 l 527 893 q 804 786 693 893 q 915 509 915 679 q 805 231 915 341 q 527 122 696 122 l 527 0 m 527 226 q 712 310 641 226 q 779 507 779 389 q 712 705 779 627 q 527 787 641 787 l 527 226 m 389 226 l 389 787 q 205 698 275 775 q 136 505 136 620 q 206 308 136 391 q 389 226 276 226 "},"⁋":{x_min:0,x_max:0,ha:694},j:{x_min:-77.78125,x_max:167,ha:349,o:"m 167 871 l 42 871 l 42 1013 l 167 1013 l 167 871 m 167 -80 q 121 -231 167 -184 q -26 -278 76 -278 l -77 -278 l -77 -164 l -41 -164 q 26 -143 11 -164 q 42 -65 42 -122 l 42 737 l 167 737 l 167 -80 "},"Σ":{x_min:0,x_max:756.953125,ha:819,o:"m 756 0 l 0 0 l 0 107 l 395 523 l 22 904 l 22 1013 l 745 1013 l 745 889 l 209 889 l 566 523 l 187 125 l 756 125 l 756 0 "},"›":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},"<":{x_min:17.984375,x_max:773.609375,ha:792,o:"m 773 40 l 18 376 l 17 465 l 773 799 l 773 692 l 159 420 l 773 149 l 773 40 "},"£":{x_min:0,x_max:704.484375,ha:801,o:"m 704 41 q 623 -10 664 5 q 543 -26 583 -26 q 359 15 501 -26 q 243 36 288 36 q 158 23 197 36 q 73 -21 119 10 l 6 76 q 125 195 90 150 q 175 331 175 262 q 147 443 175 383 l 0 443 l 0 512 l 108 512 q 43 734 43 623 q 120 929 43 854 q 358 1010 204 1010 q 579 936 487 1010 q 678 729 678 857 l 678 684 l 552 684 q 504 838 552 780 q 362 896 457 896 q 216 852 263 896 q 176 747 176 815 q 199 627 176 697 q 248 512 217 574 l 468 512 l 468 443 l 279 443 q 297 356 297 398 q 230 194 297 279 q 153 107 211 170 q 227 133 190 125 q 293 142 264 142 q 410 119 339 142 q 516 96 482 96 q 579 105 550 96 q 648 142 608 115 l 704 41 "},t:{x_min:0,x_max:367,ha:458,o:"m 367 0 q 312 -5 339 -2 q 262 -8 284 -8 q 145 28 183 -8 q 108 143 108 64 l 108 638 l 0 638 l 0 738 l 108 738 l 108 944 l 232 944 l 232 738 l 367 738 l 367 638 l 232 638 l 232 185 q 248 121 232 140 q 307 102 264 102 q 345 104 330 102 q 367 107 360 107 l 367 0 "},"¬":{x_min:0,x_max:706,ha:803,o:"m 706 411 l 706 158 l 630 158 l 630 335 l 0 335 l 0 411 l 706 411 "},"λ":{x_min:0,x_max:750,ha:803,o:"m 750 -7 q 679 -15 716 -15 q 538 59 591 -15 q 466 214 512 97 l 336 551 l 126 0 l 0 0 l 270 705 q 223 837 247 770 q 116 899 190 899 q 90 898 100 899 l 90 1004 q 152 1011 125 1011 q 298 938 244 1011 q 373 783 326 901 l 605 192 q 649 115 629 136 q 716 95 669 95 l 736 95 q 750 97 745 97 l 750 -7 "},W:{x_min:0,x_max:1263.890625,ha:1351,o:"m 1263 1013 l 995 0 l 859 0 l 627 837 l 405 0 l 265 0 l 0 1013 l 136 1013 l 342 202 l 556 1013 l 701 1013 l 921 207 l 1133 1012 l 1263 1013 "},">":{x_min:18.0625,x_max:774,ha:792,o:"m 774 376 l 18 40 l 18 149 l 631 421 l 18 692 l 18 799 l 774 465 l 774 376 "},v:{x_min:0,x_max:675.15625,ha:761,o:"m 675 738 l 404 0 l 272 0 l 0 738 l 133 737 l 340 147 l 541 737 l 675 738 "},"τ":{x_min:.28125,x_max:644.5,ha:703,o:"m 644 628 l 382 628 l 382 179 q 388 120 382 137 q 436 91 401 91 q 474 94 447 91 q 504 97 501 97 l 504 0 q 454 -9 482 -5 q 401 -14 426 -14 q 278 67 308 -14 q 260 233 260 118 l 260 628 l 0 628 l 0 739 l 644 739 l 644 628 "},"ξ":{x_min:0,x_max:624.9375,ha:699,o:"m 624 -37 q 608 -153 624 -96 q 563 -278 593 -211 l 454 -278 q 491 -183 486 -200 q 511 -83 511 -126 q 484 -23 511 -44 q 370 1 452 1 q 323 0 354 1 q 283 -1 293 -1 q 84 76 169 -1 q 0 266 0 154 q 56 431 0 358 q 197 538 108 498 q 94 613 134 562 q 54 730 54 665 q 77 823 54 780 q 143 901 101 867 l 27 901 l 27 1012 l 576 1012 l 576 901 l 380 901 q 244 863 303 901 q 178 745 178 820 q 312 600 178 636 q 532 582 380 582 l 532 479 q 276 455 361 479 q 118 281 118 410 q 165 173 118 217 q 274 120 208 133 q 494 101 384 110 q 624 -37 624 76 "},"&":{x_min:-3,x_max:894.25,ha:992,o:"m 894 0 l 725 0 l 624 123 q 471 0 553 40 q 306 -41 390 -41 q 168 -7 231 -41 q 62 92 105 26 q 14 187 31 139 q -3 276 -3 235 q 55 433 -3 358 q 248 581 114 508 q 170 689 196 640 q 137 817 137 751 q 214 985 137 922 q 384 1041 284 1041 q 548 988 483 1041 q 622 824 622 928 q 563 666 622 739 q 431 556 516 608 l 621 326 q 649 407 639 361 q 663 493 653 426 l 781 493 q 703 229 781 352 l 894 0 m 504 818 q 468 908 504 877 q 384 940 433 940 q 293 907 331 940 q 255 818 255 875 q 289 714 255 767 q 363 628 313 678 q 477 729 446 682 q 504 818 504 771 m 556 209 l 314 499 q 179 395 223 449 q 135 283 135 341 q 146 222 135 253 q 183 158 158 192 q 333 80 241 80 q 556 209 448 80 "},"Λ":{x_min:0,x_max:862.5,ha:942,o:"m 862 0 l 719 0 l 426 847 l 143 0 l 0 0 l 356 1013 l 501 1013 l 862 0 "},I:{x_min:41,x_max:180,ha:293,o:"m 180 0 l 41 0 l 41 1013 l 180 1013 l 180 0 "},G:{x_min:0,x_max:921,ha:1011,o:"m 921 0 l 832 0 l 801 136 q 655 15 741 58 q 470 -28 568 -28 q 126 133 259 -28 q 0 499 0 284 q 125 881 0 731 q 486 1043 259 1043 q 763 957 647 1043 q 905 709 890 864 l 772 709 q 668 866 747 807 q 486 926 589 926 q 228 795 322 926 q 142 507 142 677 q 228 224 142 342 q 483 94 323 94 q 712 195 625 94 q 796 435 796 291 l 477 435 l 477 549 l 921 549 l 921 0 "},"ΰ":{x_min:0,x_max:617,ha:725,o:"m 524 800 l 414 800 l 414 925 l 524 925 l 524 800 m 183 800 l 73 800 l 73 925 l 183 925 l 183 800 m 617 352 q 540 93 617 199 q 308 -24 455 -24 q 76 93 161 -24 q 0 352 0 199 l 0 738 l 126 738 l 126 354 q 169 185 126 257 q 312 98 220 98 q 451 185 402 98 q 492 354 492 257 l 492 738 l 617 738 l 617 352 m 489 1040 l 300 819 l 216 819 l 351 1040 l 489 1040 "},"`":{x_min:0,x_max:138.890625,ha:236,o:"m 138 699 l 0 699 l 0 861 q 36 974 0 929 q 138 1041 72 1020 l 138 977 q 82 931 95 969 q 69 839 69 893 l 138 839 l 138 699 "},"·":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 "},"Υ":{x_min:.328125,x_max:819.515625,ha:889,o:"m 819 1013 l 482 416 l 482 0 l 342 0 l 342 416 l 0 1013 l 140 1013 l 411 533 l 679 1013 l 819 1013 "},r:{x_min:0,x_max:355.5625,ha:432,o:"m 355 621 l 343 621 q 179 569 236 621 q 122 411 122 518 l 122 0 l 0 0 l 0 737 l 117 737 l 117 604 q 204 719 146 686 q 355 753 262 753 l 355 621 "},x:{x_min:0,x_max:675,ha:764,o:"m 675 0 l 525 0 l 331 286 l 144 0 l 0 0 l 256 379 l 12 738 l 157 737 l 336 473 l 516 738 l 661 738 l 412 380 l 675 0 "},"μ":{x_min:0,x_max:696.609375,ha:747,o:"m 696 -4 q 628 -14 657 -14 q 498 97 513 -14 q 422 8 470 41 q 313 -24 374 -24 q 207 3 258 -24 q 120 80 157 31 l 120 -278 l 0 -278 l 0 738 l 124 738 l 124 343 q 165 172 124 246 q 308 82 216 82 q 451 177 402 82 q 492 358 492 254 l 492 738 l 616 738 l 616 214 q 623 136 616 160 q 673 92 636 92 q 696 95 684 92 l 696 -4 "},h:{x_min:0,x_max:615,ha:724,o:"m 615 472 l 615 0 l 490 0 l 490 454 q 456 590 490 535 q 338 654 416 654 q 186 588 251 654 q 122 436 122 522 l 122 0 l 0 0 l 0 1013 l 122 1013 l 122 633 q 218 727 149 694 q 362 760 287 760 q 552 676 484 760 q 615 472 615 600 "},".":{x_min:0,x_max:142,ha:239,o:"m 142 0 l 0 0 l 0 151 l 142 151 l 142 0 "},"φ":{x_min:-2,x_max:878,ha:974,o:"m 496 -279 l 378 -279 l 378 -17 q 101 88 204 -17 q -2 367 -2 194 q 68 626 -2 510 q 283 758 151 758 l 283 646 q 167 537 209 626 q 133 373 133 462 q 192 177 133 254 q 378 93 259 93 l 378 758 q 445 764 426 763 q 476 765 464 765 q 765 659 653 765 q 878 377 878 553 q 771 96 878 209 q 496 -17 665 -17 l 496 -279 m 496 93 l 514 93 q 687 183 623 93 q 746 380 746 265 q 691 569 746 491 q 522 658 629 658 l 496 656 l 496 93 "},";":{x_min:0,x_max:142,ha:239,o:"m 142 585 l 0 585 l 0 738 l 142 738 l 142 585 m 142 -12 q 105 -132 142 -82 q 0 -206 68 -182 l 0 -138 q 58 -82 43 -123 q 68 0 68 -56 l 0 0 l 0 151 l 142 151 l 142 -12 "},f:{x_min:0,x_max:378,ha:472,o:"m 378 638 l 246 638 l 246 0 l 121 0 l 121 638 l 0 638 l 0 738 l 121 738 q 137 935 121 887 q 290 1028 171 1028 q 320 1027 305 1028 q 378 1021 334 1026 l 378 908 q 323 918 346 918 q 257 870 273 918 q 246 780 246 840 l 246 738 l 378 738 l 378 638 "},"“":{x_min:1,x_max:348.21875,ha:454,o:"m 140 670 l 1 670 l 1 830 q 37 943 1 897 q 140 1011 74 990 l 140 947 q 82 900 97 940 q 68 810 68 861 l 140 810 l 140 670 m 348 670 l 209 670 l 209 830 q 245 943 209 897 q 348 1011 282 990 l 348 947 q 290 900 305 940 q 276 810 276 861 l 348 810 l 348 670 "},A:{x_min:.03125,x_max:906.953125,ha:1008,o:"m 906 0 l 756 0 l 648 303 l 251 303 l 142 0 l 0 0 l 376 1013 l 529 1013 l 906 0 m 610 421 l 452 867 l 293 421 l 610 421 "},"‘":{x_min:1,x_max:139.890625,ha:236,o:"m 139 670 l 1 670 l 1 830 q 37 943 1 897 q 139 1011 74 990 l 139 947 q 82 900 97 940 q 68 810 68 861 l 139 810 l 139 670 "},"ϊ":{x_min:-70,x_max:283,ha:361,o:"m 283 800 l 173 800 l 173 925 l 283 925 l 283 800 m 40 800 l -70 800 l -70 925 l 40 925 l 40 800 m 283 3 q 232 -10 257 -5 q 181 -15 206 -15 q 84 26 118 -15 q 41 200 41 79 l 41 737 l 166 737 l 167 215 q 171 141 167 157 q 225 101 182 101 q 247 103 238 101 q 283 112 256 104 l 283 3 "},"π":{x_min:-.21875,x_max:773.21875,ha:857,o:"m 773 -7 l 707 -11 q 575 40 607 -11 q 552 174 552 77 l 552 226 l 552 626 l 222 626 l 222 0 l 97 0 l 97 626 l 0 626 l 0 737 l 773 737 l 773 626 l 676 626 l 676 171 q 695 103 676 117 q 773 90 714 90 l 773 -7 "},"ά":{x_min:0,x_max:765.5625,ha:809,o:"m 765 -4 q 698 -14 726 -14 q 564 97 586 -14 q 466 7 525 40 q 337 -26 407 -26 q 88 98 186 -26 q 0 369 0 212 q 88 637 0 525 q 337 760 184 760 q 465 727 407 760 q 563 637 524 695 l 563 738 l 685 738 l 685 222 q 693 141 685 168 q 748 94 708 94 q 765 95 760 94 l 765 -4 m 584 371 q 531 562 584 485 q 360 653 470 653 q 192 566 254 653 q 135 379 135 489 q 186 181 135 261 q 358 84 247 84 q 528 176 465 84 q 584 371 584 260 m 604 1040 l 415 819 l 332 819 l 466 1040 l 604 1040 "},O:{x_min:0,x_max:958,ha:1057,o:"m 485 1041 q 834 882 702 1041 q 958 512 958 734 q 834 136 958 287 q 481 -26 702 -26 q 126 130 261 -26 q 0 504 0 279 q 127 880 0 728 q 485 1041 263 1041 m 480 98 q 731 225 638 98 q 815 504 815 340 q 733 783 815 669 q 480 912 640 912 q 226 784 321 912 q 142 504 142 670 q 226 224 142 339 q 480 98 319 98 "},n:{x_min:0,x_max:615,ha:724,o:"m 615 463 l 615 0 l 490 0 l 490 454 q 453 592 490 537 q 331 656 410 656 q 178 585 240 656 q 117 421 117 514 l 117 0 l 0 0 l 0 738 l 117 738 l 117 630 q 218 728 150 693 q 359 764 286 764 q 552 675 484 764 q 615 463 615 593 "},l:{x_min:41,x_max:166,ha:279,o:"m 166 0 l 41 0 l 41 1013 l 166 1013 l 166 0 "},"¤":{x_min:40.09375,x_max:728.796875,ha:825,o:"m 728 304 l 649 224 l 512 363 q 383 331 458 331 q 256 363 310 331 l 119 224 l 40 304 l 177 441 q 150 553 150 493 q 184 673 150 621 l 40 818 l 119 898 l 267 749 q 321 766 291 759 q 384 773 351 773 q 447 766 417 773 q 501 749 477 759 l 649 898 l 728 818 l 585 675 q 612 618 604 648 q 621 553 621 587 q 591 441 621 491 l 728 304 m 384 682 q 280 643 318 682 q 243 551 243 604 q 279 461 243 499 q 383 423 316 423 q 487 461 449 423 q 525 553 525 500 q 490 641 525 605 q 384 682 451 682 "},"κ":{x_min:0,x_max:632.328125,ha:679,o:"m 632 0 l 482 0 l 225 384 l 124 288 l 124 0 l 0 0 l 0 738 l 124 738 l 124 446 l 433 738 l 596 738 l 312 466 l 632 0 "},p:{x_min:0,x_max:685,ha:786,o:"m 685 364 q 598 96 685 205 q 350 -23 504 -23 q 121 89 205 -23 l 121 -278 l 0 -278 l 0 738 l 121 738 l 121 633 q 220 726 159 691 q 351 761 280 761 q 598 636 504 761 q 685 364 685 522 m 557 371 q 501 560 557 481 q 330 651 437 651 q 162 559 223 651 q 108 366 108 479 q 162 177 108 254 q 333 87 224 87 q 502 178 441 87 q 557 371 557 258 "},"‡":{x_min:0,x_max:777,ha:835,o:"m 458 238 l 458 0 l 319 0 l 319 238 l 0 238 l 0 360 l 319 360 l 319 681 l 0 683 l 0 804 l 319 804 l 319 1015 l 458 1013 l 458 804 l 777 804 l 777 683 l 458 683 l 458 360 l 777 360 l 777 238 l 458 238 "},"ψ":{x_min:0,x_max:808,ha:907,o:"m 465 -278 l 341 -278 l 341 -15 q 87 102 180 -15 q 0 378 0 210 l 0 739 l 133 739 l 133 379 q 182 195 133 275 q 341 98 242 98 l 341 922 l 465 922 l 465 98 q 623 195 563 98 q 675 382 675 278 l 675 742 l 808 742 l 808 381 q 720 104 808 213 q 466 -13 627 -13 l 465 -278 "},"η":{x_min:.78125,x_max:697,ha:810,o:"m 697 -278 l 572 -278 l 572 454 q 540 587 572 536 q 425 650 501 650 q 271 579 337 650 q 206 420 206 509 l 206 0 l 81 0 l 81 489 q 73 588 81 562 q 0 644 56 644 l 0 741 q 68 755 38 755 q 158 720 124 755 q 200 630 193 686 q 297 726 234 692 q 434 761 359 761 q 620 692 544 761 q 697 516 697 624 l 697 -278 "}},cssFontWeight:"normal",ascender:1189,underlinePosition:-100,cssFontStyle:"normal",boundingBox:{yMin:-334,xMin:-111,yMax:1189,xMax:1672},resolution:1e3,original_font_information:{postscript_name:"Helvetiker-Regular",version_string:"Version 1.00 2004 initial release",vendor_url:"http://www.magenta.gr/",full_font_name:"Helvetiker",font_family_name:"Helvetiker",copyright:"Copyright (c) Μagenta ltd, 2004",description:"",trademark:"",designer:"",designer_url:"",unique_font_identifier:"Μagenta ltd:Helvetiker:22-10-104",license_url:"http://www.ellak.gr/fonts/MgOpen/license.html",license_description:'Copyright (c) 2004 by MAGENTA Ltd. All Rights Reserved.\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of the fonts accompanying this license ("Fonts") and associated documentation files (the "Font Software"), to reproduce and distribute the Font Software, including without limitation the rights to use, copy, merge, publish, distribute, and/or sell copies of the Font Software, and to permit persons to whom the Font Software is furnished to do so, subject to the following conditions: \r\n\r\nThe above copyright and this permission notice shall be included in all copies of one or more of the Font Software typefaces.\r\n\r\nThe Font Software may be modified, altered, or added to, and in particular the designs of glyphs or characters in the Fonts may be modified and additional glyphs or characters may be added to the Fonts, only if the fonts are renamed to names not containing the word "MgOpen", or if the modifications are accepted for inclusion in the Font Software itself by the each appointed Administrator.\r\n\r\nThis License becomes null and void to the extent applicable to Fonts or Font Software that has been modified and is distributed under the "MgOpen" name.\r\n\r\nThe Font Software may be sold as part of a larger software package but no copy of one or more of the Font Software typefaces may be sold by itself. \r\n\r\nTHE FONT SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF COPYRIGHT, PATENT, TRADEMARK, OR OTHER RIGHT. IN NO EVENT SHALL MAGENTA OR PERSONS OR BODIES IN CHARGE OF ADMINISTRATION AND MAINTENANCE OF THE FONT SOFTWARE BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, INCLUDING ANY GENERAL, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF THE USE OR INABILITY TO USE THE FONT SOFTWARE OR FROM OTHER DEALINGS IN THE FONT SOFTWARE.',manufacturer_name:"Μagenta ltd",font_sub_family_name:"Regular"},descender:-334,familyName:"Helvetiker",lineHeight:1522,underlineThickness:50},UU=yF(yF({},window.THREE?window.THREE:{BoxGeometry:on,CircleGeometry:Pn,DoubleSide:k,Group:a,Mesh:A,MeshLambertMaterial:h,TextGeometry:eF,Vector3:o}),{},{Font:class{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const r=[],n=function(e,t,r){const n=Array.from(e),i=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,s=[];let a=0,A=0;for(let l=0;l<n.length;l++){const e=n[l];if("\n"===e)a=0,A-=o;else{const t=tF(e,i,a,A,r);a+=t.offsetX,s.push(t.path)}}return s}(e,t,this.data);for(let i=0,o=n.length;i<o;i++)r.push(...n[i].toShapes());return r}},TextGeometry:eF}),VU=ki({props:{labelsData:{default:[]},labelLat:{default:"lat"},labelLng:{default:"lng"},labelAltitude:{default:.002},labelText:{default:"text"},labelSize:{default:.5},labelTypeFace:{default:FU,onChange:function(e,t){t.font=new UU.Font(e)}},labelColor:{default:function(){return"lightgrey"}},labelRotation:{default:0},labelResolution:{default:3},labelIncludeDot:{default:!0},labelDotRadius:{default:.1},labelDotOrientation:{default:function(){return"bottom"}},labelsTransitionDuration:{default:1e3,triggerUpdate:!1}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n;var i=new UU.CircleGeometry(1,32);t.dataMapper=new QF(e,{objBindAttr:"__threeObjLabel"}).onCreateObj(function(){var e=new UU.MeshLambertMaterial;e.side=k;var t=new UU.Group;t.add(new UU.Mesh(i,e));var r=new UU.Mesh(void 0,e);t.add(r);var n=new UU.Mesh;return n.visible=!1,r.add(n),t.__globeObjType="label",t})},update:function(e){var t=fc(e.labelLat),r=fc(e.labelLng),n=fc(e.labelAltitude),i=fc(e.labelText),o=fc(e.labelSize),s=fc(e.labelRotation),a=fc(e.labelColor),A=fc(e.labelIncludeDot),l=fc(e.labelDotRadius),u=fc(e.labelDotOrientation),c=new Set(["right","top","bottom"]),h=2*Math.PI*RF/360;e.dataMapper.onUpdateObj(function(d,p){var f=_F(d.children,2),m=f[0],g=f[1],y=_F(g.children,1)[0],b=a(p),v=UF(b);g.material.color.set(FF(b)),g.material.transparent=v<1,g.material.opacity=v;var _=A(p),x=u(p);!_||!c.has(x)&&(x="bottom");var w=_?+l(p)*h:1e-12;m.scale.x=m.scale.y=w;var T=+o(p)*h;if(g.geometry&&g.geometry.dispose(),g.geometry=new UU.TextGeometry(i(p),{font:e.font,size:T,depth:0,bevelEnabled:!0,bevelThickness:0,bevelSize:0,curveSegments:e.labelResolution}),y.geometry&&y.geometry.dispose(),g.geometry.computeBoundingBox(),y.geometry=uF(UU.BoxGeometry,wF((new UU.Vector3).subVectors(g.geometry.boundingBox.max,g.geometry.boundingBox.min).clampScalar(0,1/0).toArray())),"right"!==x&&g.geometry.center(),_){var S=w+T/2;"right"===x&&(g.position.x=S),g.position.y={right:-T/2,top:S+T/2,bottom:-S-T/2}[x]}var E=function(t){var r=d.__currentTargetD=t,n=r.lat,i=r.lng,o=r.alt,s=r.rot,a=r.scale;Object.assign(d.position,DF(n,i,o)),d.lookAt(e.scene.localToWorld(new UU.Vector3(0,0,0))),d.rotateY(Math.PI),d.rotateZ(-s*Math.PI/180),d.scale.x=d.scale.y=d.scale.z=a},M={lat:+t(p),lng:+r(p),alt:+n(p),rot:+s(p),scale:1},N=d.__currentTargetD||Object.assign({},M,{scale:1e-12});Object.keys(M).some(function(e){return N[e]!==M[e]})&&(!e.labelsTransitionDuration||e.labelsTransitionDuration<0?E(M):e.tweenGroup.add(new zi(N).to(M,e.labelsTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(E).start()))}).digest(e.labelsData)}}),GU=yF(yF({},window.THREE?window.THREE:{}),{},{CSS2DObject:class extends r{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new n(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&null!==e.element.parentNode&&e.element.remove()})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}}),jU=ki({props:{htmlElementsData:{default:[]},htmlLat:{default:"lat"},htmlLng:{default:"lng"},htmlAltitude:{default:0},htmlElement:{},htmlElementVisibilityModifier:{triggerUpdate:!1},htmlTransitionDuration:{default:1e3,triggerUpdate:!1},isBehindGlobe:{onChange:function(){this.updateObjVisibility()},triggerUpdate:!1}},methods:{updateObjVisibility:function(e,t){if(e.dataMapper){var r=t?[t]:e.dataMapper.entries().map(function(e){return _F(e,2)[1]}).filter(function(e){return e});r.forEach(function(t){var r=!e.isBehindGlobe||!e.isBehindGlobe(t.position);e.htmlElementVisibilityModifier?(t.visible=!0,e.htmlElementVisibilityModifier(t.element,r)):t.visible=r})}}},init:function(e,t,r){var n=r.tweenGroup;NF(e),t.scene=e,t.tweenGroup=n,t.dataMapper=new QF(e,{objBindAttr:"__threeObjHtml"}).onCreateObj(function(e){var r=fc(t.htmlElement)(e),n=new GU.CSS2DObject(r);return n.__globeObjType="html",n})},update:function(e,t){var r=this,n=fc(e.htmlLat),i=fc(e.htmlLng),o=fc(e.htmlAltitude);t.hasOwnProperty("htmlElement")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(t,s){var a=function(e){var n=t.__currentTargetD=e,i=n.alt,o=n.lat,s=n.lng;Object.assign(t.position,DF(o,s,i)),r.updateObjVisibility(t)},A={lat:+n(s),lng:+i(s),alt:+o(s)};!e.htmlTransitionDuration||e.htmlTransitionDuration<0||!t.__currentTargetD?a(A):e.tweenGroup.add(new zi(t.__currentTargetD).to(A,e.htmlTransitionDuration).easing(Ii.Quadratic.InOut).onUpdate(a).start())}).digest(e.htmlElementsData)}}),zU=window.THREE?window.THREE:{Group:a,Mesh:A,MeshLambertMaterial:h,SphereGeometry:l},HU=ki({props:{objectsData:{default:[]},objectLat:{default:"lat"},objectLng:{default:"lng"},objectAltitude:{default:.01},objectFacesSurface:{default:!0},objectRotation:{},objectThreeObject:{default:new zU.Mesh(new zU.SphereGeometry(1,16,8),new zU.MeshLambertMaterial({color:"#ffffaa",transparent:!0,opacity:.7}))}},init:function(e,t){NF(e),t.scene=e,t.dataMapper=new QF(e,{objBindAttr:"__threeObjObject"}).onCreateObj(function(e){var r=fc(t.objectThreeObject)(e);t.objectThreeObject===r&&(r=r.clone());var n=new zU.Group;return n.add(r),n.__globeObjType="object",n})},update:function(e,t){var r=fc(e.objectLat),n=fc(e.objectLng),i=fc(e.objectAltitude),o=fc(e.objectFacesSurface),s=fc(e.objectRotation);t.hasOwnProperty("objectThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(e,t){var a=+r(t),A=+n(t),l=+i(t);Object.assign(e.position,DF(a,A,l)),o(t)?e.setRotationFromEuler(new rn(qF(-a),qF(A),0,"YXZ")):e.rotation.set(0,0,0);var u=e.children[0],c=s(t);c&&u.setRotationFromEuler(new rn(qF(c.x||0),qF(c.y||0),qF(c.z||0)))}).digest(e.objectsData)}}),WU=ki({props:{customLayerData:{default:[]},customThreeObject:{},customThreeObjectUpdate:{triggerUpdate:!1}},init:function(e,t){NF(e),t.scene=e,t.dataMapper=new QF(e,{objBindAttr:"__threeObjCustom"}).onCreateObj(function(e){var r=fc(t.customThreeObject)(e,RF);return r&&(t.customThreeObject===r&&(r=r.clone()),r.__globeObjType="custom"),r})},update:function(e,t){e.customThreeObjectUpdate||NF(e.scene);var r=fc(e.customThreeObjectUpdate);t.hasOwnProperty("customThreeObject")&&e.dataMapper.clear(),e.dataMapper.onUpdateObj(function(e,t){return r(e,t,RF)}).digest(e.customLayerData)}}),QU=window.THREE?window.THREE:{Camera:s,Group:a,Vector2:n,Vector3:o},$U=["globeLayer","pointsLayer","arcsLayer","hexBinLayer","heatmapsLayer","polygonsLayer","hexedPolygonsLayer","pathsLayer","tilesLayer","particlesLayer","ringsLayer","labelsLayer","htmlElementsLayer","objectsLayer","customLayer"],YU=CF("globeLayer",IF),XU=Object.assign.apply(Object,wF(["globeImageUrl","bumpImageUrl","globeTileEngineUrl","globeTileEngineMaxLevel","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude"].map(function(e){return hF({},e,YU.linkProp(e))}))),KU=Object.assign.apply(Object,wF(["globeMaterial"].map(function(e){return hF({},e,YU.linkMethod(e))}))),ZU=CF("pointsLayer",KF),JU=Object.assign.apply(Object,wF(["pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration"].map(function(e){return hF({},e,ZU.linkProp(e))}))),eV=CF("arcsLayer",oU),tV=Object.assign.apply(Object,wF(["arcsData","arcStartLat","arcStartLng","arcEndLat","arcEndLng","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration"].map(function(e){return hF({},e,eV.linkProp(e))}))),rV=CF("hexBinLayer",lU),nV=Object.assign.apply(Object,wF(["hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration"].map(function(e){return hF({},e,rV.linkProp(e))}))),iV=CF("heatmapsLayer",gU),oV=Object.assign.apply(Object,wF(["heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration"].map(function(e){return hF({},e,iV.linkProp(e))}))),sV=CF("hexedPolygonsLayer",wU),aV=Object.assign.apply(Object,wF(["hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration"].map(function(e){return hF({},e,sV.linkProp(e))}))),AV=CF("polygonsLayer",bU),lV=Object.assign.apply(Object,wF(["polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration"].map(function(e){return hF({},e,AV.linkProp(e))}))),uV=CF("pathsLayer",NU),cV=Object.assign.apply(Object,wF(["pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration"].map(function(e){return hF({},e,uV.linkProp(e))}))),hV=CF("tilesLayer",RU),dV=Object.assign.apply(Object,wF(["tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration"].map(function(e){return hF({},e,hV.linkProp(e))}))),pV=CF("particlesLayer",BU),fV=Object.assign.apply(Object,wF(["particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture"].map(function(e){return hF({},e,pV.linkProp(e))}))),mV=CF("ringsLayer",IU),gV=Object.assign.apply(Object,wF(["ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod"].map(function(e){return hF({},e,mV.linkProp(e))}))),yV=CF("labelsLayer",VU),bV=Object.assign.apply(Object,wF(["labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration"].map(function(e){return hF({},e,yV.linkProp(e))}))),vV=CF("htmlElementsLayer",jU),_V=Object.assign.apply(Object,wF(["htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration"].map(function(e){return hF({},e,vV.linkProp(e))}))),xV=CF("objectsLayer",HU),wV=Object.assign.apply(Object,wF(["objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject"].map(function(e){return hF({},e,xV.linkProp(e))}))),TV=CF("customLayer",WU),SV=Object.assign.apply(Object,wF(["customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(e){return hF({},e,TV.linkProp(e))}))),EV=ki({props:yF(yF(yF(yF(yF(yF(yF(yF(yF(yF(yF(yF(yF(yF(yF({onGlobeReady:{triggerUpdate:!1},rendererSize:{default:new QU.Vector2(window.innerWidth,window.innerHeight),onChange:function(e,t){t.pathsLayer.rendererSize(e)},triggerUpdate:!1}},XU),JU),tV),nV),oV),lV),aV),cV),dV),fV),gV),bV),_V),wV),SV),methods:yF({getGlobeRadius:PF,getCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return DF.apply(void 0,r)},toGeoCoords:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return BF.apply(void 0,r)},setPointOfView:function(e,t){var r,n,i,o,s=t instanceof QU.Camera?t.position:t,a=PF(),A=void 0;e.scene&&s&&(A=function(t){void 0===r&&(r=s.clone().applyMatrix4(e.scene.matrixWorld.clone().invert())),void 0===n&&(n=r.length()),void 0===i&&(i=Math.sqrt(Math.pow(n,2)-Math.pow(a,2))),void 0===o&&(o=Math.acos(i/n));var A=r.distanceTo(t);if(A<i)return!1;var l=t.length();return Math.acos((Math.pow(n,2)+Math.pow(A,2)-Math.pow(l,2))/(2*n*A))<o});e.layersThatNeedUpdatePov.forEach(function(e){return e.updatePov(t)}),e.layersThatNeedBehindGlobeChecker.forEach(function(e){return e.isBehindGlobe(A)})},pauseAnimation:function(e){return null!==e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),e.pausableLayers.forEach(function(e){var t;return null===(t=e.pauseAnimation)||void 0===t?void 0:t.call(e)}),this},resumeAnimation:function(e){return null===e.animationFrameRequestId&&this._animationCycle(),e.pausableLayers.forEach(function(e){var t;return null===(t=e.resumeAnimation)||void 0===t?void 0:t.call(e)}),this},_animationCycle:function(e){e.animationFrameRequestId=requestAnimationFrame(this._animationCycle),e.tweenGroup.update()},_destructor:function(e){this.pauseAnimation(),e.destructableLayers.forEach(function(e){return e._destructor()})}},KU),stateInit:function(){var e=new Ui,t={tweenGroup:e},r={globeLayer:IF(t),pointsLayer:KF(t),arcsLayer:oU(t),hexBinLayer:lU(t),heatmapsLayer:gU(t),polygonsLayer:bU(t),hexedPolygonsLayer:wU(t),pathsLayer:NU(t),tilesLayer:RU(t),particlesLayer:BU(t),ringsLayer:IU(t),labelsLayer:VU(t),htmlElementsLayer:jU(t),objectsLayer:HU(t),customLayer:WU(t)};return yF(yF({tweenGroup:e},r),{},{layersThatNeedUpdatePov:Object.values(r).filter(function(e){return e.hasOwnProperty("updatePov")}),layersThatNeedBehindGlobeChecker:Object.values(r).filter(function(e){return e.hasOwnProperty("isBehindGlobe")}),destructableLayers:Object.values(r).filter(function(e){return e.hasOwnProperty("_destructor")}),pausableLayers:Object.values(r).filter(function(e){return e.hasOwnProperty("pauseAnimation")})})},init:function(e,t,r){var n=r.animateIn,i=void 0===n||n,o=r.waitForGlobeReady,s=void 0===o||o;NF(e),t.scene=e,t.scene.visible=!1,$U.forEach(function(e){var r=new QU.Group;t.scene.add(r),t[e](r)});var a=function(){if(i){t.scene.scale.set(1e-6,1e-6,1e-6),t.tweenGroup.add(new zi({k:1e-6}).to({k:1},600).easing(Ii.Quadratic.Out).onUpdate(function(e){var r=e.k;return t.scene.scale.set(r,r,r)}).start());var e=new QU.Vector3(0,1,0);t.tweenGroup.add(new zi({rot:2*Math.PI}).to({rot:0},1200).easing(Ii.Quintic.Out).onUpdate(function(r){var n=r.rot;return t.scene.setRotationFromAxisAngle(e,n)}).start())}t.scene.visible=!0,t.onGlobeReady&&t.onGlobeReady()};s?t.globeLayer.onReady(a):a(),this._animationCycle()},update:function(e){}});var MV=function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(r){function n(){var r;sF(this,n);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return(r=oF(this,n,[].concat(o))).__kapsuleInstance=uF(e,[].concat(wF(t?[r]:[]),o)),r}return fF(n,r),cF(n)}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object);return Object.keys(e()).forEach(function(e){return r.prototype[e]=function(){var t,r=(t=this.__kapsuleInstance)[e].apply(t,arguments);return r===this.__kapsuleInstance?this:r}}),r}(EV,(window.THREE?window.THREE:{Group:a}).Group,!0);const NV={type:"change"},CV={type:"start"},RV={type:"end"},PV=1e-6,DV=-1,BV=0,qV=1,OV=2,LV=3,kV=4,IV=new n,FV=new n,UV=new o,VV=new o,GV=new o,jV=new me,zV=new o,HV=new o,WV=new o,QV=new o;class $V extends kn{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:In.ROTATE,MIDDLE:In.DOLLY,RIGHT:In.PAN},this.target=new o,this.state=DV,this.keyState=DV,this._lastPosition=new o,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new o,this._movePrev=new n,this._moveCurr=new n,this._lastAxis=new o,this._zoomStart=new n,this._zoomEnd=new n,this._panStart=new n,this._panEnd=new n,this._pointers=[],this._pointerPositions={},this._onPointerMove=XV.bind(this),this._onPointerDown=YV.bind(this),this._onPointerUp=KV.bind(this),this._onPointerCancel=ZV.bind(this),this._onContextMenu=oG.bind(this),this._onMouseWheel=iG.bind(this),this._onKeyDown=eG.bind(this),this._onKeyUp=JV.bind(this),this._onTouchStart=sG.bind(this),this._onTouchMove=aG.bind(this),this._onTouchEnd=AG.bind(this),this._onMouseDown=tG.bind(this),this._onMouseMove=rG.bind(this),this._onMouseUp=nG.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,null!==t&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>PV&&(this.dispatchEvent(NV),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>PV||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(NV),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=DV,this.keyState=DV,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(NV),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(FV.copy(this._panEnd).sub(this._panStart),FV.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;FV.x*=e,FV.y*=t}FV.multiplyScalar(this._eye.length()*this.panSpeed),VV.copy(this._eye).cross(this.object.up).setLength(FV.x),VV.add(UV.copy(this.object.up).setLength(FV.y)),this.object.position.add(VV),this.target.add(VV),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(FV.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){QV.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=QV.length();e?(this._eye.copy(this.object.position).sub(this.target),zV.copy(this._eye).normalize(),HV.copy(this.object.up).normalize(),WV.crossVectors(HV,zV).normalize(),HV.setLength(this._moveCurr.y-this._movePrev.y),WV.setLength(this._moveCurr.x-this._movePrev.x),QV.copy(HV.add(WV)),GV.crossVectors(QV,this._eye).normalize(),e*=this.rotateSpeed,jV.setFromAxisAngle(GV,e),this._eye.applyQuaternion(jV),this.object.up.applyQuaternion(jV),this._lastAxis.copy(GV),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),jV.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(jV),this.object.up.applyQuaternion(jV)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===kV?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Jr.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,1!==e&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=Jr.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return IV.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),IV}_getMouseOnCircle(e,t){return IV.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),IV}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId)return void this._pointers.splice(t,1)}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new n,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function YV(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e))}function XV(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function KV(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchEnd(e):this._onMouseUp(),this._removePointer(e),0===this._pointers.length&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function ZV(e){this._removePointer(e)}function JV(){!1!==this.enabled&&(this.keyState=DV,window.addEventListener("keydown",this._onKeyDown))}function eG(e){!1!==this.enabled&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===DV&&(e.code!==this.keys[BV]||this.noRotate?e.code!==this.keys[qV]||this.noZoom?e.code!==this.keys[OV]||this.noPan||(this.keyState=OV):this.keyState=qV:this.keyState=BV))}function tG(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case In.DOLLY:this.state=qV;break;case In.ROTATE:this.state=BV;break;case In.PAN:this.state=OV;break;default:this.state=DV}const r=this.keyState!==DV?this.keyState:this.state;r!==BV||this.noRotate?r!==qV||this.noZoom?r!==OV||this.noPan||(this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.dispatchEvent(CV)}function rG(e){const t=this.keyState!==DV?this.keyState:this.state;t!==BV||this.noRotate?t!==qV||this.noZoom?t!==OV||this.noPan||this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)))}function nG(){this.state=DV,this.dispatchEvent(RV)}function iG(e){if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.dispatchEvent(CV),this.dispatchEvent(RV)}}function oG(e){!1!==this.enabled&&e.preventDefault()}function sG(e){if(this._trackPointer(e),1===this._pointers.length)this.state=LV,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);else{this.state=kV;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const r=(this._pointers[0].pageX+this._pointers[1].pageX)/2,n=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(r,n)),this._panEnd.copy(this._panStart)}this.dispatchEvent(CV)}function aG(e){if(this._trackPointer(e),1===this._pointers.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));else{const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,n=e.pageY-t.y;this._touchZoomDistanceEnd=Math.sqrt(r*r+n*n);const i=(e.pageX+t.x)/2,o=(e.pageY+t.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,o))}}function AG(e){switch(this._pointers.length){case 0:this.state=DV;break;case 1:this.state=LV,this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=kV;for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId!==e.pointerId){const e=this._pointerPositions[this._pointers[t].pointerId];this._moveCurr.copy(this._getMouseOnCircle(e.x,e.y)),this._movePrev.copy(this._moveCurr);break}}this.dispatchEvent(RV)}const lG={type:"change"},uG={type:"start"},cG={type:"end"},hG=new Vn,dG=new Se,pG=Math.cos(70*Jr.DEG2RAD),fG=new o,mG=2*Math.PI,gG=-1,yG=0,bG=1,vG=2,_G=3,xG=4,wG=5,TG=6,SG=1e-6;class EG extends kn{constructor(e,t=null){super(e,t),this.state=gG,this.target=new o,this.cursor=new o,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:In.ROTATE,MIDDLE:In.DOLLY,RIGHT:In.PAN},this.touches={ONE:Fn.ROTATE,TWO:Fn.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new o,this._lastQuaternion=new me,this._lastTargetPosition=new o,this._quat=(new me).setFromUnitVectors(e.up,new o(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Un,this._sphericalDelta=new Un,this._scale=1,this._panOffset=new o,this._rotateStart=new n,this._rotateEnd=new n,this._rotateDelta=new n,this._panStart=new n,this._panEnd=new n,this._panDelta=new n,this._dollyStart=new n,this._dollyEnd=new n,this._dollyDelta=new n,this._dollyDirection=new o,this._mouse=new n,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=NG.bind(this),this._onPointerDown=MG.bind(this),this._onPointerUp=CG.bind(this),this._onContextMenu=LG.bind(this),this._onMouseWheel=DG.bind(this),this._onKeyDown=BG.bind(this),this._onTouchStart=qG.bind(this),this._onTouchMove=OG.bind(this),this._onMouseDown=RG.bind(this),this._onMouseMove=PG.bind(this),this._interceptControlDown=kG.bind(this),this._interceptControlUp=IG.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(lG),this.update(),this.state=gG}update(e=null){const t=this.object.position;fG.copy(t).sub(this.target),fG.applyQuaternion(this._quat),this._spherical.setFromVector3(fG),this.autoRotate&&this.state===gG&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(r)&&isFinite(n)&&(r<-Math.PI?r+=mG:r>Math.PI&&(r-=mG),n<-Math.PI?n+=mG:n>Math.PI&&(n-=mG),this._spherical.theta=r<=n?Math.max(r,Math.min(n,this._spherical.theta)):this._spherical.theta>(r+n)/2?Math.max(r,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=e!=this._spherical.radius}if(fG.setFromSpherical(this._spherical),fG.applyQuaternion(this._quatInverse),t.copy(this.target).add(fG),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){const t=fG.length();e=this._clampDistance(t*this._scale);const r=t-e;this.object.position.addScaledVector(this._dollyDirection,r),this.object.updateMatrixWorld(),i=!!r}else if(this.object.isOrthographicCamera){const t=new o(this._mouse.x,this._mouse.y,0);t.unproject(this.object);const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=r!==this.object.zoom;const n=new o(this._mouse.x,this._mouse.y,0);n.unproject(this.object),this.object.position.sub(n).add(t),this.object.updateMatrixWorld(),e=fG.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(hG.origin.copy(this.object.position),hG.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(hG.direction))<pG?this.object.lookAt(this.target):(dG.setFromNormalAndCoplanarPoint(this.object.up,this.target),hG.intersectPlane(dG,this.target))))}else if(this.object.isOrthographicCamera){const e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,!!(i||this._lastPosition.distanceToSquared(this.object.position)>SG||8*(1-this._lastQuaternion.dot(this.object.quaternion))>SG||this._lastTargetPosition.distanceToSquared(this.target)>SG)&&(this.dispatchEvent(lG),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?mG/60*this.autoRotateSpeed*e:mG/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(.01*e);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){fG.setFromMatrixColumn(t,0),fG.multiplyScalar(-e),this._panOffset.add(fG)}_panUp(e,t){!0===this.screenSpacePanning?fG.setFromMatrixColumn(t,1):(fG.setFromMatrixColumn(t,0),fG.crossVectors(this.object.up,fG)),fG.multiplyScalar(e),this._panOffset.add(fG)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;fG.copy(n).sub(this.target);let i=fG.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/r.clientHeight,this.object.matrix),this._panUp(2*t*i/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),n=e-r.left,i=t-r.top,o=r.width,s=r.height;this._mouse.x=n/o*2-1,this._mouse.y=-i/s*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(mG*this._rotateDelta.x/t.clientHeight),this._rotateUp(mG*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(mG*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-mG*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(mG*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-mG*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(r,n)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(r,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,n=e.pageY-t.y,i=Math.sqrt(r*r+n*n);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateEnd.set(r,n)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(mG*this._rotateDelta.x/t.clientHeight),this._rotateUp(mG*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(r,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,n=e.pageY-t.y,i=Math.sqrt(r*r+n*n);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=.5*(e.pageX+t.x),s=.5*(e.pageY+t.y);this._updateZoomParameters(o,s)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return void this._pointers.splice(t,1)}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new n,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function MG(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(e)||(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function NG(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function CG(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(cG),this.state=gG;break;case 1:const t=this._pointers[0],r=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:r.x,pageY:r.y})}}function RG(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case In.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=bG;break;case In.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=vG}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=yG}break;case In.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=yG}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=vG}break;default:this.state=gG}this.state!==gG&&this.dispatchEvent(uG)}function PG(e){switch(this.state){case yG:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case bG:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case vG:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function DG(e){!1!==this.enabled&&!1!==this.enableZoom&&this.state===gG&&(e.preventDefault(),this.dispatchEvent(uG),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(cG))}function BG(e){!1!==this.enabled&&this._handleKeyDown(e)}function qG(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case Fn.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=_G;break;case Fn.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=xG;break;default:this.state=gG}break;case 2:switch(this.touches.TWO){case Fn.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=wG;break;case Fn.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=TG;break;default:this.state=gG}break;default:this.state=gG}this.state!==gG&&this.dispatchEvent(uG)}function OG(e){switch(this._trackPointer(e),this.state){case _G:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case xG:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case wG:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case TG:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=gG}}function LG(e){!1!==this.enabled&&e.preventDefault()}function kG(e){if("Control"===e.key){this._controlActive=!0;this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function IG(e){if("Control"===e.key){this._controlActive=!1;this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}const FG={type:"change"},UG=1e-6,VG=new me;class GG extends kn{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new o(0,0,0),this._rotationVector=new o(0,0,0),this._lastQuaternion=new me,this._lastPosition=new o,this._status=0,this._onKeyDown=jG.bind(this),this._onKeyUp=zG.bind(this),this._onPointerMove=WG.bind(this),this._onPointerDown=HG.bind(this),this._onPointerUp=QG.bind(this),this._onPointerCancel=$G.bind(this),this._onContextMenu=YG.bind(this),null!==t&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(!1===this.enabled)return;const t=this.object,r=e*this.movementSpeed,n=e*this.rollSpeed;t.translateX(this._moveVector.x*r),t.translateY(this._moveVector.y*r),t.translateZ(this._moveVector.z*r),VG.set(this._rotationVector.x*n,this._rotationVector.y*n,this._rotationVector.z*n,1).normalize(),t.quaternion.multiply(VG),(this._lastPosition.distanceToSquared(t.position)>UG||8*(1-this._lastQuaternion.dot(t.quaternion))>UG)&&(this.dispatchEvent(FG),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function jG(e){if(!e.altKey&&!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1}this._updateMovementVector(),this._updateRotationVector()}}function zG(e){if(!1!==this.enabled){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0}this._updateMovementVector(),this._updateRotationVector()}}function HG(e){if(!1!==this.enabled)if(this.dragToLook)this._status++;else{switch(e.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1}this._updateMovementVector()}}function WG(e){if(!1!==this.enabled&&(!this.dragToLook||this._status>0)){const t=this._getContainerDimensions(),r=t.size[0]/2,n=t.size[1]/2;this._moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this._moveState.pitchDown=(e.pageY-t.offset[1]-n)/n,this._updateRotationVector()}}function QG(e){if(!1!==this.enabled){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(e.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0}this._updateMovementVector()}this._updateRotationVector()}}function $G(){!1!==this.enabled&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function YG(e){!1!==this.enabled&&e.preventDefault()}const XG={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"};class KG{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const ZG=new Z(-1,1,1,-1,0,1);const JG=new class extends f{constructor(){super(),this.setAttribute("position",new m([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new m([0,2,0,0,2,0],2))}};class ej{constructor(e){this._mesh=new A(JG,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ZG)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class tj extends KG{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof xn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Tn.clone(e.uniforms),this.material=new xn({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new ej(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class rj extends KG{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const n=e.getContext(),i=e.state;let o,s;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(o=0,s=1):(o=1,s=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),i.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),i.buffers.stencil.setClear(s),i.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.color.setMask(!0),i.buffers.depth.setMask(!0),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(n.EQUAL,1,4294967295),i.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),i.buffers.stencil.setLocked(!0)}}class nj extends KG{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class ij{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){const r=e.getSize(new n);this._width=r.width,this._height=r.height,(t=new Gn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:S})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new tj(XG),this.copyPass.material.blending=dt,this.clock=new jn}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let n=0,i=this.passes.length;n<i;n++){const t=this.passes[n];if(!1!==t.enabled){if(t.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){const t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==rj&&(t instanceof rj?r=!0:t instanceof nj&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new n);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class oj extends KG{constructor(e,t,r=null,n=null,i=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=i,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new te}render(e,t,r){const n=e.autoClear;let i,o;e.autoClear=!1,null!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),null!==this.clearAlpha&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(i),null!==this.overrideMaterial&&(this.scene.overrideMaterial=o),e.autoClear=n}}function sj(e,t){return sj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},sj(e,t)}function aj(e){return aj=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},aj(e)}function Aj(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Aj=function(){return!!e})()}function lj(e){var t="function"==typeof Map?new Map:void 0;return lj=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch($z){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(Aj())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&sj(i,r.prototype),i}(e,arguments,aj(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),sj(r,e)},lj(e)}var uj=function(e){function t(t){return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this)}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,sj(e,t)}(t,e),t}(lj(Error));function cj(e){return Math.round(255*e)}function hj(e,t,r){return cj(e)+","+cj(t)+","+cj(r)}function dj(e,t,r,n){if(void 0===n&&(n=hj),0===t)return n(r,r,r);var i=(e%360+360)%360/60,o=(1-Math.abs(2*r-1))*t,s=o*(1-Math.abs(i%2-1)),a=0,A=0,l=0;i>=0&&i<1?(a=o,A=s):i>=1&&i<2?(a=s,A=o):i>=2&&i<3?(A=o,l=s):i>=3&&i<4?(A=s,l=o):i>=4&&i<5?(a=s,l=o):i>=5&&i<6&&(a=o,l=s);var u=r-o/2;return n(a+u,A+u,l+u)}var pj={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var fj=/^#[a-fA-F0-9]{6}$/,mj=/^#[a-fA-F0-9]{8}$/,gj=/^#[a-fA-F0-9]{3}$/,yj=/^#[a-fA-F0-9]{4}$/,bj=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,vj=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,_j=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,xj=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function wj(e){if("string"!=typeof e)throw new uj(3);var t=function(e){if("string"!=typeof e)return e;var t=e.toLowerCase();return pj[t]?"#"+pj[t]:e}(e);if(t.match(fj))return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16)};if(t.match(mj)){var r=parseFloat((parseInt(""+t[7]+t[8],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[2],16),green:parseInt(""+t[3]+t[4],16),blue:parseInt(""+t[5]+t[6],16),alpha:r}}if(t.match(gj))return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16)};if(t.match(yj)){var n=parseFloat((parseInt(""+t[4]+t[4],16)/255).toFixed(2));return{red:parseInt(""+t[1]+t[1],16),green:parseInt(""+t[2]+t[2],16),blue:parseInt(""+t[3]+t[3],16),alpha:n}}var i=bj.exec(t);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var o=vj.exec(t.substring(0,50));if(o)return{red:parseInt(""+o[1],10),green:parseInt(""+o[2],10),blue:parseInt(""+o[3],10),alpha:parseFloat(""+o[4])>1?parseFloat(""+o[4])/100:parseFloat(""+o[4])};var s=_j.exec(t);if(s){var a="rgb("+dj(parseInt(""+s[1],10),parseInt(""+s[2],10)/100,parseInt(""+s[3],10)/100)+")",A=bj.exec(a);if(!A)throw new uj(4,t,a);return{red:parseInt(""+A[1],10),green:parseInt(""+A[2],10),blue:parseInt(""+A[3],10)}}var l=xj.exec(t.substring(0,50));if(l){var u="rgb("+dj(parseInt(""+l[1],10),parseInt(""+l[2],10)/100,parseInt(""+l[3],10)/100)+")",c=bj.exec(u);if(!c)throw new uj(4,t,u);return{red:parseInt(""+c[1],10),green:parseInt(""+c[2],10),blue:parseInt(""+c[3],10),alpha:parseFloat(""+l[4])>1?parseFloat(""+l[4])/100:parseFloat(""+l[4])}}throw new uj(5)}function Tj(e){return function(e){var t,r=e.red/255,n=e.green/255,i=e.blue/255,o=Math.max(r,n,i),s=Math.min(r,n,i),a=(o+s)/2;if(o===s)return void 0!==e.alpha?{hue:0,saturation:0,lightness:a,alpha:e.alpha}:{hue:0,saturation:0,lightness:a};var A=o-s,l=a>.5?A/(2-o-s):A/(o+s);switch(o){case r:t=(n-i)/A+(n<i?6:0);break;case n:t=(i-r)/A+2;break;default:t=(r-n)/A+4}return t*=60,void 0!==e.alpha?{hue:t,saturation:l,lightness:a,alpha:e.alpha}:{hue:t,saturation:l,lightness:a}}(wj(e))}var Sj=function(e){return 7===e.length&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e};function Ej(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function Mj(e){return Ej(Math.round(255*e))}function Nj(e,t,r){return Sj("#"+Mj(e)+Mj(t)+Mj(r))}function Cj(e,t,r){return dj(e,t,r,Nj)}function Rj(e,t,r){if("number"==typeof e&&"number"==typeof t&&"number"==typeof r)return Sj("#"+Ej(e)+Ej(t)+Ej(r));if("object"==typeof e&&void 0===t&&void 0===r)return Sj("#"+Ej(e.red)+Ej(e.green)+Ej(e.blue));throw new uj(6)}function Pj(e,t,r,n){if("object"==typeof e&&void 0===t&&void 0===r&&void 0===n)return e.alpha>=1?Rj(e.red,e.green,e.blue):"rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")";throw new uj(7)}function Dj(e){if("object"!=typeof e)throw new uj(8);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&"number"==typeof e.alpha}(e))return Pj(e);if(function(e){return"number"==typeof e.red&&"number"==typeof e.green&&"number"==typeof e.blue&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return Rj(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&"number"==typeof e.alpha}(e))return function(e,t,r,n){if("object"==typeof e&&void 0===t&&void 0===r&&void 0===n)return e.alpha>=1?Cj(e.hue,e.saturation,e.lightness):"rgba("+dj(e.hue,e.saturation,e.lightness)+","+e.alpha+")";throw new uj(2)}(e);if(function(e){return"number"==typeof e.hue&&"number"==typeof e.saturation&&"number"==typeof e.lightness&&("number"!=typeof e.alpha||void 0===e.alpha)}(e))return function(e,t,r){if("object"==typeof e&&void 0===t&&void 0===r)return Cj(e.hue,e.saturation,e.lightness);throw new uj(1)}(e);throw new uj(8)}function Bj(e,t,r){return function(){var n=r.concat(Array.prototype.slice.call(arguments));return n.length>=t?e.apply(this,n):Bj(e,t,n)}}function qj(e){return Bj(e,e.length,[])}function Oj(e,t,r){return Math.max(e,Math.min(t,r))}qj(function(e,t){if("transparent"===t)return t;var r=Tj(t);return Dj(zn({},r,{hue:r.hue+parseFloat(e)}))}),qj(function(e,t){if("transparent"===t)return t;var r=Tj(t);return Dj(zn({},r,{lightness:Oj(0,1,r.lightness-parseFloat(e))}))}),qj(function(e,t){if("transparent"===t)return t;var r=Tj(t);return Dj(zn({},r,{saturation:Oj(0,1,r.saturation-parseFloat(e))}))}),qj(function(e,t){if("transparent"===t)return t;var r=Tj(t);return Dj(zn({},r,{lightness:Oj(0,1,r.lightness+parseFloat(e))}))});var Lj=qj(function(e,t,r){if("transparent"===t)return r;if("transparent"===r)return t;if(0===e)return r;var n=wj(t),i=zn({},n,{alpha:"number"==typeof n.alpha?n.alpha:1}),o=wj(r),s=zn({},o,{alpha:"number"==typeof o.alpha?o.alpha:1}),a=i.alpha-s.alpha,A=2*parseFloat(e)-1,l=((A*a===-1?A:A+a)/(1+A*a)+1)/2,u=1-l;return Pj({red:Math.floor(i.red*l+s.red*u),green:Math.floor(i.green*l+s.green*u),blue:Math.floor(i.blue*l+s.blue*u),alpha:i.alpha*parseFloat(e)+s.alpha*(1-parseFloat(e))})}),kj=Lj;var Ij=qj(function(e,t){if("transparent"===t)return t;var r=wj(t),n="number"==typeof r.alpha?r.alpha:1;return Pj(zn({},r,{alpha:Oj(0,1,(100*n+100*parseFloat(e))/100)}))}),Fj=Ij;qj(function(e,t){if("transparent"===t)return t;var r=Tj(t);return Dj(zn({},r,{saturation:Oj(0,1,r.saturation+parseFloat(e))}))}),qj(function(e,t){return"transparent"===t?t:Dj(zn({},Tj(t),{hue:parseFloat(e)}))}),qj(function(e,t){return"transparent"===t?t:Dj(zn({},Tj(t),{lightness:parseFloat(e)}))}),qj(function(e,t){return"transparent"===t?t:Dj(zn({},Tj(t),{saturation:parseFloat(e)}))}),qj(function(e,t){return"transparent"===t?t:kj(parseFloat(e),"rgb(0, 0, 0)",t)}),qj(function(e,t){return"transparent"===t?t:kj(parseFloat(e),"rgb(255, 255, 255)",t)}),qj(function(e,t){if("transparent"===t)return t;var r=wj(t),n="number"==typeof r.alpha?r.alpha:1;return Pj(zn({},r,{alpha:Oj(0,1,+(100*n-100*parseFloat(e)).toFixed(2)/100)}))});var Uj="http://www.w3.org/1999/xhtml";const Vj={svg:"http://www.w3.org/2000/svg",xhtml:Uj,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Gj(e){var t=e+="",r=t.indexOf(":");return r>=0&&"xmlns"!==(t=e.slice(0,r))&&(e=e.slice(r+1)),Vj.hasOwnProperty(t)?{space:Vj[t],local:e}:e}function jj(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===Uj&&t.documentElement.namespaceURI===Uj?t.createElement(e):t.createElementNS(r,e)}}function zj(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Hj(e){var t=Gj(e);return(t.local?zj:jj)(t)}function Wj(){}function Qj(e){return null==e?Wj:function(){return this.querySelector(e)}}function $j(){return[]}function Yj(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}function Xj(e){return function(t){return t.matches(e)}}var Kj=Array.prototype.find;function Zj(){return this.firstElementChild}var Jj=Array.prototype.filter;function ez(){return Array.from(this.children)}function tz(e){return new Array(e.length)}function rz(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function nz(e,t,r,n,i,o){for(var s,a=0,A=t.length,l=o.length;a<l;++a)(s=t[a])?(s.__data__=o[a],n[a]=s):r[a]=new rz(e,o[a]);for(;a<A;++a)(s=t[a])&&(i[a]=s)}function iz(e,t,r,n,i,o,s){var a,A,l,u=new Map,c=t.length,h=o.length,d=new Array(c);for(a=0;a<c;++a)(A=t[a])&&(d[a]=l=s.call(A,A.__data__,a,t)+"",u.has(l)?i[a]=A:u.set(l,A));for(a=0;a<h;++a)l=s.call(e,o[a],a,o)+"",(A=u.get(l))?(n[a]=A,A.__data__=o[a],u.delete(l)):r[a]=new rz(e,o[a]);for(a=0;a<c;++a)(A=t[a])&&u.get(d[a])===A&&(i[a]=A)}function oz(e){return e.__data__}function sz(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function az(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Az(e){return function(){this.removeAttribute(e)}}function lz(e){return function(){this.removeAttributeNS(e.space,e.local)}}function uz(e,t){return function(){this.setAttribute(e,t)}}function cz(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function hz(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttribute(e):this.setAttribute(e,r)}}function dz(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function pz(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function fz(e){return function(){this.style.removeProperty(e)}}function mz(e,t,r){return function(){this.style.setProperty(e,t,r)}}function gz(e,t,r){return function(){var n=t.apply(this,arguments);null==n?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function yz(e){return function(){delete this[e]}}function bz(e,t){return function(){this[e]=t}}function vz(e,t){return function(){var r=t.apply(this,arguments);null==r?delete this[e]:this[e]=r}}function _z(e){return e.trim().split(/^|\s+/)}function xz(e){return e.classList||new wz(e)}function wz(e){this._node=e,this._names=_z(e.getAttribute("class")||"")}function Tz(e,t){for(var r=xz(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function Sz(e,t){for(var r=xz(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function Ez(e){return function(){Tz(this,e)}}function Mz(e){return function(){Sz(this,e)}}function Nz(e,t){return function(){(t.apply(this,arguments)?Tz:Sz)(this,e)}}function Cz(){this.textContent=""}function Rz(e){return function(){this.textContent=e}}function Pz(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Dz(){this.innerHTML=""}function Bz(e){return function(){this.innerHTML=e}}function qz(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Oz(){this.nextSibling&&this.parentNode.appendChild(this)}function Lz(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function kz(){return null}function Iz(){var e=this.parentNode;e&&e.removeChild(this)}function Fz(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Uz(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Vz(e){return function(){var t=this.__on;if(t){for(var r,n=0,i=-1,o=t.length;n<o;++n)r=t[n],e.type&&r.type!==e.type||r.name!==e.name?t[++i]=r:this.removeEventListener(r.type,r.listener,r.options);++i?t.length=i:delete this.__on}}}function Gz(e,t,r){return function(){var n,i=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var s=0,a=i.length;s<a;++s)if((n=i[s]).type===e.type&&n.name===e.name)return this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=o,n.options=r),void(n.value=t);this.addEventListener(e.type,o,r),n={type:e.type,name:e.name,value:t,listener:o,options:r},i?i.push(n):this.__on=[n]}}function jz(e,t,r){var n=pz(e),i=n.CustomEvent;"function"==typeof i?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function zz(e,t){return function(){return jz(this,e,t)}}function Hz(e,t){return function(){return jz(this,e,t.apply(this,arguments))}}rz.prototype={constructor:rz,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},wz.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Wz=[null];function Qz(e,t){this._groups=e,this._parents=t}Qz.prototype={constructor:Qz,select:function(e){"function"!=typeof e&&(e=Qj(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o,s,a=t[i],A=a.length,l=n[i]=new Array(A),u=0;u<A;++u)(o=a[u])&&(s=e.call(o,o.__data__,u,a))&&("__data__"in o&&(s.__data__=o.__data__),l[u]=s);return new Qz(n,this._parents)},selectAll:function(e){e="function"==typeof e?Yj(e):function(e){return null==e?$j:function(){return this.querySelectorAll(e)}}(e);for(var t=this._groups,r=t.length,n=[],i=[],o=0;o<r;++o)for(var s,a=t[o],A=a.length,l=0;l<A;++l)(s=a[l])&&(n.push(e.call(s,s.__data__,l,a)),i.push(s));return new Qz(n,i)},selectChild:function(e){return this.select(null==e?Zj:function(e){return function(){return Kj.call(this.children,e)}}("function"==typeof e?e:Xj(e)))},selectChildren:function(e){return this.selectAll(null==e?ez:function(e){return function(){return Jj.call(this.children,e)}}("function"==typeof e?e:Xj(e)))},filter:function(e){"function"!=typeof e&&(e=function(e){return function(){return this.matches(e)}}(e));for(var t=this._groups,r=t.length,n=new Array(r),i=0;i<r;++i)for(var o,s=t[i],a=s.length,A=n[i]=[],l=0;l<a;++l)(o=s[l])&&e.call(o,o.__data__,l,s)&&A.push(o);return new Qz(n,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,oz);var r=t?iz:nz,n=this._parents,i=this._groups;"function"!=typeof e&&(e=function(e){return function(){return e}}(e));for(var o=i.length,s=new Array(o),a=new Array(o),A=new Array(o),l=0;l<o;++l){var u=n[l],c=i[l],h=c.length,d=sz(e.call(u,u&&u.__data__,l,n)),p=d.length,f=a[l]=new Array(p),m=s[l]=new Array(p);r(u,c,f,m,A[l]=new Array(h),d,t);for(var g,y,b=0,v=0;b<p;++b)if(g=f[b]){for(b>=v&&(v=b+1);!(y=m[v])&&++v<p;);g._next=y||null}}return(s=new Qz(s,n))._enter=a,s._exit=A,s},enter:function(){return new Qz(this._enter||this._groups.map(tz),this._parents)},exit:function(){return new Qz(this._exit||this._groups.map(tz),this._parents)},join:function(e,t,r){var n=this.enter(),i=this,o=this.exit();return"function"==typeof e?(n=e(n))&&(n=n.selection()):n=n.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==r?o.remove():r(o),n&&i?n.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,o=n.length,s=Math.min(i,o),a=new Array(i),A=0;A<s;++A)for(var l,u=r[A],c=n[A],h=u.length,d=a[A]=new Array(h),p=0;p<h;++p)(l=u[p]||c[p])&&(d[p]=l);for(;A<i;++A)a[A]=r[A];return new Qz(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n,i=e[t],o=i.length-1,s=i[o];--o>=0;)(n=i[o])&&(s&&4^n.compareDocumentPosition(s)&&s.parentNode.insertBefore(n,s),s=n);return this},sort:function(e){function t(t,r){return t&&r?e(t.__data__,r.__data__):!t-!r}e||(e=az);for(var r=this._groups,n=r.length,i=new Array(n),o=0;o<n;++o){for(var s,a=r[o],A=a.length,l=i[o]=new Array(A),u=0;u<A;++u)(s=a[u])&&(l[u]=s);l.sort(t)}return new Qz(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i,o=t[r],s=0,a=o.length;s<a;++s)(i=o[s])&&e.call(i,i.__data__,s,o);return this},attr:function(e,t){var r=Gj(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((null==t?r.local?lz:Az:"function"==typeof t?r.local?dz:hz:r.local?cz:uz)(r,t))},style:function(e,t,r){return arguments.length>1?this.each((null==t?fz:"function"==typeof t?gz:mz)(e,t,null==r?"":r)):function(e,t){return e.style.getPropertyValue(t)||pz(e).getComputedStyle(e,null).getPropertyValue(t)}(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?yz:"function"==typeof t?vz:bz)(e,t)):this.node()[e]},classed:function(e,t){var r=_z(e+"");if(arguments.length<2){for(var n=xz(this.node()),i=-1,o=r.length;++i<o;)if(!n.contains(r[i]))return!1;return!0}return this.each(("function"==typeof t?Nz:t?Ez:Mz)(r,t))},text:function(e){return arguments.length?this.each(null==e?Cz:("function"==typeof e?Pz:Rz)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Dz:("function"==typeof e?qz:Bz)(e)):this.node().innerHTML},raise:function(){return this.each(Oz)},lower:function(){return this.each(Lz)},append:function(e){var t="function"==typeof e?e:Hj(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var r="function"==typeof e?e:Hj(e),n=null==t?kz:"function"==typeof t?t:Qj(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function(){return this.each(Iz)},clone:function(e){return this.select(e?Uz:Fz)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,r){var n,i,o=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}(e+""),s=o.length;if(!(arguments.length<2)){for(a=t?Gz:Vz,n=0;n<s;++n)this.each(a(o[n],t,r));return this}var a=this.node().__on;if(a)for(var A,l=0,u=a.length;l<u;++l)for(n=0,A=a[l];n<s;++n)if((i=o[n]).type===A.type&&i.name===A.name)return A.value},dispatch:function(e,t){return this.each(("function"==typeof t?Hz:zz)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n,i=e[t],o=0,s=i.length;o<s;++o)(n=i[o])&&(yield n)}};var $z,Yz,Xz,Kz,Zz,Jz,eH,tH,rH,nH,iH,oH,sH={},aH=[],AH=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,lH=Array.isArray;function uH(e,t){for(var r in t)e[r]=t[r];return e}function cH(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function hH(e,t,r,n,i){var o={type:e,props:t,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==i?++Xz:i,__i:-1,__u:0};return null==i&&null!=Yz.vnode&&Yz.vnode(o),o}function dH(e){return e.children}function pH(e,t){this.props=e,this.context=t}function fH(e,t){if(null==t)return e.__?fH(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?fH(e):null}function mH(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return mH(e)}}function gH(e){(!e.__d&&(e.__d=!0)&&Zz.push(e)&&!yH.__r++||Jz!=Yz.debounceRendering)&&((Jz=Yz.debounceRendering)||eH)(yH)}function yH(){for(var e,t,r,n,i,o,s,a=1;Zz.length;)Zz.length>a&&Zz.sort(tH),e=Zz.shift(),a=Zz.length,e.__d&&(r=void 0,i=(n=(t=e).__v).__e,o=[],s=[],t.__P&&((r=uH({},n)).__v=n.__v+1,Yz.vnode&&Yz.vnode(r),EH(t.__P,r,n,t.__n,t.__P.namespaceURI,32&n.__u?[i]:null,o,null==i?fH(n):i,!!(32&n.__u),s),r.__v=n.__v,r.__.__k[r.__i]=r,MH(o,r,s),r.__e!=i&&mH(r)));yH.__r=0}function bH(e,t,r,n,i,o,s,a,A,l,u){var c,h,d,p,f,m,g=n&&n.__k||aH,y=t.length;for(A=vH(r,t,g,A,y),c=0;c<y;c++)null!=(d=r.__k[c])&&(h=-1==d.__i?sH:g[d.__i]||sH,d.__i=c,m=EH(e,d,h,i,o,s,a,A,l,u),p=d.__e,d.ref&&h.ref!=d.ref&&(h.ref&&RH(h.ref,null,d),u.push(d.ref,d.__c||p,d)),null==f&&null!=p&&(f=p),4&d.__u||h.__k===d.__k?A=_H(d,A,e):"function"==typeof d.type&&void 0!==m?A=m:p&&(A=p.nextSibling),d.__u&=-7);return r.__e=f,A}function vH(e,t,r,n,i){var o,s,a,A,l,u=r.length,c=u,h=0;for(e.__k=new Array(i),o=0;o<i;o++)null!=(s=t[o])&&"boolean"!=typeof s&&"function"!=typeof s?(A=o+h,(s=e.__k[o]="string"==typeof s||"number"==typeof s||"bigint"==typeof s||s.constructor==String?hH(null,s,null,null,null):lH(s)?hH(dH,{children:s},null,null,null):null==s.constructor&&s.__b>0?hH(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=e,s.__b=e.__b+1,a=null,-1!=(l=s.__i=xH(s,r,A,c))&&(c--,(a=r[l])&&(a.__u|=2)),null==a||null==a.__v?(-1==l&&(i>u?h--:i<u&&h++),"function"!=typeof s.type&&(s.__u|=4)):l!=A&&(l==A-1?h--:l==A+1?h++:(l>A?h--:h++,s.__u|=4))):e.__k[o]=null;if(c)for(o=0;o<u;o++)null!=(a=r[o])&&!(2&a.__u)&&(a.__e==n&&(n=fH(a)),PH(a,a));return n}function _H(e,t,r){var n,i;if("function"==typeof e.type){for(n=e.__k,i=0;n&&i<n.length;i++)n[i]&&(n[i].__=e,t=_H(n[i],t,r));return t}e.__e!=t&&(t&&e.type&&!r.contains(t)&&(t=fH(e)),r.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function xH(e,t,r,n){var i,o,s=e.key,a=e.type,A=t[r];if(null===A&&null==e.key||A&&s==A.key&&a==A.type&&!(2&A.__u))return r;if(n>(null==A||2&A.__u?0:1))for(i=r-1,o=r+1;i>=0||o<t.length;){if(i>=0){if((A=t[i])&&!(2&A.__u)&&s==A.key&&a==A.type)return i;i--}if(o<t.length){if((A=t[o])&&!(2&A.__u)&&s==A.key&&a==A.type)return o;o++}}return-1}function wH(e,t,r){"-"==t[0]?e.setProperty(t,null==r?"":r):e[t]=null==r?"":"number"!=typeof r||AH.test(t)?r:r+"px"}function TH(e,t,r,n,i){var o,s;e:if("style"==t)if("string"==typeof r)e.style.cssText=r;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||wH(e.style,t,"");if(r)for(t in r)n&&r[t]==n[t]||wH(e.style,t,r[t])}else if("o"==t[0]&&"n"==t[1])o=t!=(t=t.replace(rH,"$1")),s=t.toLowerCase(),t=s in e||"onFocusOut"==t||"onFocusIn"==t?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=r,r?n?r.u=n.u:(r.u=nH,e.addEventListener(t,o?oH:iH,o)):e.removeEventListener(t,o?oH:iH,o);else{if("http://www.w3.org/2000/svg"==i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==r?"":r;break e}catch(e){}"function"==typeof r||(null==r||!1===r&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==r?"":r))}}function SH(e){return function(t){if(this.l){var r=this.l[t.type+e];if(null==t.t)t.t=nH++;else if(t.t<r.u)return;return r(Yz.event?Yz.event(t):t)}}}function EH(e,t,r,n,i,o,s,a,A,l){var u,c,h,d,p,f,m,g,y,b,v,_,x,w,T,S,E,M=t.type;if(null!=t.constructor)return null;128&r.__u&&(A=!!(32&r.__u),o=[a=t.__e=r.__e]),(u=Yz.__b)&&u(t);e:if("function"==typeof M)try{if(g=t.props,y="prototype"in M&&M.prototype.render,b=(u=M.contextType)&&n[u.__c],v=u?b?b.props.value:u.__:n,r.__c?m=(c=t.__c=r.__c).__=c.__E:(y?t.__c=c=new M(g,v):(t.__c=c=new pH(g,v),c.constructor=M,c.render=DH),b&&b.sub(c),c.props=g,c.state||(c.state={}),c.context=v,c.__n=n,h=c.__d=!0,c.__h=[],c._sb=[]),y&&null==c.__s&&(c.__s=c.state),y&&null!=M.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=uH({},c.__s)),uH(c.__s,M.getDerivedStateFromProps(g,c.__s))),d=c.props,p=c.state,c.__v=t,h)y&&null==M.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),y&&null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(y&&null==M.getDerivedStateFromProps&&g!==d&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(g,v),!c.__e&&null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(g,c.__s,v)||t.__v==r.__v){for(t.__v!=r.__v&&(c.props=g,c.state=c.__s,c.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.some(function(e){e&&(e.__=t)}),_=0;_<c._sb.length;_++)c.__h.push(c._sb[_]);c._sb=[],c.__h.length&&s.push(c);break e}null!=c.componentWillUpdate&&c.componentWillUpdate(g,c.__s,v),y&&null!=c.componentDidUpdate&&c.__h.push(function(){c.componentDidUpdate(d,p,f)})}if(c.context=v,c.props=g,c.__P=e,c.__e=!1,x=Yz.__r,w=0,y){for(c.state=c.__s,c.__d=!1,x&&x(t),u=c.render(c.props,c.state,c.context),T=0;T<c._sb.length;T++)c.__h.push(c._sb[T]);c._sb=[]}else do{c.__d=!1,x&&x(t),u=c.render(c.props,c.state,c.context),c.state=c.__s}while(c.__d&&++w<25);c.state=c.__s,null!=c.getChildContext&&(n=uH(uH({},n),c.getChildContext())),y&&!h&&null!=c.getSnapshotBeforeUpdate&&(f=c.getSnapshotBeforeUpdate(d,p)),S=u,null!=u&&u.type===dH&&null==u.key&&(S=NH(u.props.children)),a=bH(e,lH(S)?S:[S],t,r,n,i,o,s,a,A,l),c.base=t.__e,t.__u&=-161,c.__h.length&&s.push(c),m&&(c.__E=c.__=null)}catch(e){if(t.__v=null,A||null!=o)if(e.then){for(t.__u|=A?160:128;a&&8==a.nodeType&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,t.__e=a}else for(E=o.length;E--;)cH(o[E]);else t.__e=r.__e,t.__k=r.__k;Yz.__e(e,t,r)}else null==o&&t.__v==r.__v?(t.__k=r.__k,t.__e=r.__e):a=t.__e=CH(r.__e,t,r,n,i,o,s,A,l);return(u=Yz.diffed)&&u(t),128&t.__u?void 0:a}function MH(e,t,r){for(var n=0;n<r.length;n++)RH(r[n],r[++n],r[++n]);Yz.__c&&Yz.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){Yz.__e(e,t.__v)}})}function NH(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:lH(e)?e.map(NH):uH({},e)}function CH(e,t,r,n,i,o,s,a,A){var l,u,c,h,d,p,f,m=r.props,g=t.props,y=t.type;if("svg"==y?i="http://www.w3.org/2000/svg":"math"==y?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),null!=o)for(l=0;l<o.length;l++)if((d=o[l])&&"setAttribute"in d==!!y&&(y?d.localName==y:3==d.nodeType)){e=d,o[l]=null;break}if(null==e){if(null==y)return document.createTextNode(g);e=document.createElementNS(i,y,g.is&&g),a&&(Yz.__m&&Yz.__m(t,o),a=!1),o=null}if(null==y)m===g||a&&e.data==g||(e.data=g);else{if(o=o&&$z.call(e.childNodes),m=r.props||sH,!a&&null!=o)for(m={},l=0;l<e.attributes.length;l++)m[(d=e.attributes[l]).name]=d.value;for(l in m)if(d=m[l],"children"==l);else if("dangerouslySetInnerHTML"==l)c=d;else if(!(l in g)){if("value"==l&&"defaultValue"in g||"checked"==l&&"defaultChecked"in g)continue;TH(e,l,null,d,i)}for(l in g)d=g[l],"children"==l?h=d:"dangerouslySetInnerHTML"==l?u=d:"value"==l?p=d:"checked"==l?f=d:a&&"function"!=typeof d||m[l]===d||TH(e,l,d,m[l],i);if(u)a||c&&(u.__html==c.__html||u.__html==e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(c&&(e.innerHTML=""),bH("template"==t.type?e.content:e,lH(h)?h:[h],t,r,n,"foreignObject"==y?"http://www.w3.org/1999/xhtml":i,o,s,o?o[0]:r.__k&&fH(r,0),a,A),null!=o)for(l=o.length;l--;)cH(o[l]);a||(l="value","progress"==y&&null==p?e.removeAttribute("value"):null!=p&&(p!==e[l]||"progress"==y&&!p||"option"==y&&p!=m[l])&&TH(e,l,p,m[l],i),l="checked",null!=f&&f!=e[l]&&TH(e,l,f,m[l],i))}return e}function RH(e,t,r){try{if("function"==typeof e){var n="function"==typeof e.__u;n&&e.__u(),n&&null==t||(e.__u=e(t))}else e.current=t}catch(e){Yz.__e(e,r)}}function PH(e,t,r){var n,i;if(Yz.unmount&&Yz.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||RH(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){Yz.__e(e,t)}n.base=n.__P=null}if(n=e.__k)for(i=0;i<n.length;i++)n[i]&&PH(n[i],t,r||"function"!=typeof e.type);r||cH(e.__e),e.__c=e.__=e.__e=void 0}function DH(e,t,r){return this.constructor(e,r)}function BH(e,t,r){var n,i,o;t==document&&(t=document.documentElement),Yz.__&&Yz.__(e,t),n=!1?null:t.__k,i=[],o=[],EH(t,e=t.__k=function(e,t,r){var n,i,o,s={};for(o in t)"key"==o?n=t[o]:"ref"==o?i=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?$z.call(arguments,2):r),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===s[o]&&(s[o]=e.defaultProps[o]);return hH(e,s,n,i,null)}(dH,null,[e]),n||sH,sH,t.namespaceURI,n?null:t.firstChild?$z.call(t.childNodes):null,i,n?n.__e:t.firstChild,false,o),MH(i,e,o)}function qH(e,t,r){var n,i,o,s,a=uH({},e.props);for(o in e.type&&e.type.defaultProps&&(s=e.type.defaultProps),t)"key"==o?n=t[o]:"ref"==o?i=t[o]:a[o]=void 0===t[o]&&null!=s?s[o]:t[o];return arguments.length>2&&(a.children=arguments.length>3?$z.call(arguments,2):r),hH(e.type,a,n||e.key,i||e.ref,null)}function OH(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function LH(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function IH(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return OH(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?OH(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function FH(e){return FH="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},FH(e)}$z=aH.slice,Yz={__e:function(e,t,r,n){for(var i,o,s;t=t.__;)if((i=t.__c)&&!i.__)try{if((o=i.constructor)&&null!=o.getDerivedStateFromError&&(i.setState(o.getDerivedStateFromError(e)),s=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(e,n||{}),s=i.__d),s)return i.__E=i}catch(t){e=t}throw e}},Xz=0,Kz=function(e){return null!=e&&null==e.constructor},pH.prototype.setState=function(e,t){var r;r=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=uH({},this.state),"function"==typeof e&&(e=e(uH({},r),this.props)),e&&uH(r,e),null!=e&&this.__v&&(t&&this._sb.push(t),gH(this))},pH.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),gH(this))},pH.prototype.render=dH,Zz=[],eH="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,tH=function(e,t){return e.__v.__b-t.__v.__b},yH.__r=0,rH=/(PointerCapture)$|Capture$/i,nH=0,iH=SH(!1),oH=SH(!0);var UH=function(e){if("object"!==FH(e))return e;var t,r=qH(e);r.props&&(r.props=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?kH(Object(r),!0).forEach(function(t){LH(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kH(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},r.props),null!=r&&null!==(t=r.props)&&void 0!==t&&t.children&&(r.props.children=Array.isArray(r.props.children)?r.props.children.map(UH):UH(r.props.children)));return r};!function(e,t){void 0===t&&(t={});var r=t.insertAt;if("undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".float-tooltip-kap {\n  position: absolute;\n  width: max-content; /* prevent shrinking near right edge */\n  max-width: max(50%, 150px);\n  padding: 3px 5px;\n  border-radius: 3px;\n  font: 12px sans-serif;\n  color: #eee;\n  background: rgba(0,0,0,0.6);\n  pointer-events: none;\n}\n");var VH=ki({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).style,n=void 0===r?{}:r,i=function(e){return"string"==typeof e?new Qz([[document.querySelector(e)]],[document.documentElement]):new Qz([[e]],Wz)}(!!e&&"object"===FH(e)&&!!e.node&&"function"==typeof e.node?e.node():e);"static"===i.style("position")&&i.style("position","relative"),t.tooltipEl=i.append("div").attr("class","float-tooltip-kap"),Object.entries(n).forEach(function(e){var r=IH(e,2),n=r[0],i=r[1];return t.tooltipEl.style(n,i)}),t.tooltipEl.style("left","-10000px").style("display","none");var o="tooltip-".concat(Math.round(1e12*Math.random()));t.mouseInside=!1,i.on("mousemove.".concat(o),function(e){t.mouseInside=!0;var r=function(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}(e),n=i.node(),o=n.offsetWidth,s=n.offsetHeight,a=[null===t.offsetX||void 0===t.offsetX?"-".concat(r[0]/o*100,"%"):"number"==typeof t.offsetX?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,null===t.offsetY||void 0===t.offsetY?s>130&&s-r[1]<100?"calc(-100% - 6px)":"21px":"number"==typeof t.offsetY?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",r[0]+"px").style("top",r[1]+"px").style("transform","translate(".concat(a.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),i.on("mouseover.".concat(o),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),i.on("mouseout.".concat(o),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){var t,r;e.tooltipEl.style("display",e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):"string"==typeof e.content?e.tooltipEl.html(e.content):!function(e){return Kz(qH(e))}(e.content)?(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):(e.tooltipEl.text(""),t=e.content,delete(r=e.tooltipEl.node()).__k,BH(UH(t),r)):e.tooltipEl.text("")}});function GH(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function jH(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zH(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,s,a=[],A=!0,l=!1;try{if(o=(r=r.call(e)).next,0===t);else for(;!(A=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);A=!0);}catch(e){l=!0,i=e}finally{try{if(!A&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(e,t)||WH(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function HH(e){return function(e){if(Array.isArray(e))return GH(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||WH(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function WH(e,t){if(e){if("string"==typeof e)return GH(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?GH(e,t):void 0}}!function(e,t){void 0===t&&(t={});var r=t.insertAt;if("undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".scene-nav-info {\n  position: absolute;\n  bottom: 5px;\n  width: 100%;\n  text-align: center;\n  color: slategrey;\n  opacity: 0.7;\n  font-size: 10px;\n  font-family: sans-serif;\n  pointer-events: none;\n  user-select: none;\n}\n\n.scene-container canvas:focus {\n  outline: none;\n}");var QH=window.THREE?window.THREE:{WebGLRenderer:Hn,Scene:C,PerspectiveCamera:ne,Raycaster:Wn,SRGBColorSpace:p,TextureLoader:d,Vector2:n,Vector3:o,Box3:_n,Color:te,Mesh:A,SphereGeometry:l,MeshBasicMaterial:u,BackSide:O,Clock:jn},$H=ki({props:{width:{default:window.innerWidth,onChange:function(e,t,r){isNaN(e)&&(t.width=r)}},height:{default:window.innerHeight,onChange:function(e,t,r){isNaN(e)&&(t.height=r)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.enabled&&e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(t){return t.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var r=null;if(e.hoverDuringDrag||!e.isPointerDragging){var n=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&n.sort(function(t,r){return e.hoverOrderComparator(t.object,r.object)});var i=n.find(function(t){return e.hoverFilter(t.object)})||null;r=i?i.object:null,e.intersection=i||null}r!==e.hoverObj&&(e.onHover(r,e.hoverObj,e.intersection),e.tooltip.content(r&&fc(e.tooltipContent)(r,e.intersection)||null),e.hoverObj=r)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos;return{x:t.x,y:t.y}},cameraPosition:function(e,t,r,n){var i=e.camera;if(t&&e.initialised){var o=t,s=r||{x:0,y:0,z:0};if(n){var a=Object.assign({},i.position),A=c();e.tweenGroup.add(new zi(a).to(o,n).easing(Ii.Quadratic.Out).onUpdate(l).start()),e.tweenGroup.add(new zi(A).to(s,n/3).easing(Ii.Quadratic.Out).onUpdate(u).start())}else l(o),u(s);return this}return Object.assign({},i.position,{lookAt:c()});function l(e){var t=e.x,r=e.y,n=e.z;void 0!==t&&(i.position.x=t),void 0!==r&&(i.position.y=r),void 0!==n&&(i.position.z=n)}function u(t){var r=new QH.Vector3(t.x,t.y,t.z);e.controls.target?e.controls.target=r:i.lookAt(r)}function c(){return Object.assign(new QH.Vector3(0,0,-1e3).applyQuaternion(i.quaternion).add(i.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=arguments.length,i=new Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];return this.fitToBbox(this.getBbox.apply(this,i),t,r)},fitToBbox:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=e.camera;if(t){var o=new QH.Vector3(0,0,0),s=2*Math.max.apply(Math,HH(Object.entries(t).map(function(e){var t=zH(e,2),r=t[0],n=t[1];return Math.max.apply(Math,HH(n.map(function(e){return Math.abs(o[r]-e)})))}))),a=(1-2*n/e.height)*i.fov,A=s/Math.atan(a*Math.PI/180),l=A/i.aspect,u=Math.max(A,l);if(u>0){var c=o.clone().sub(i.position).normalize().multiplyScalar(-u);this.cameraPosition(c,o,r)}}return this},getBbox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},r=new QH.Box3(new QH.Vector3(0,0,0),new QH.Vector3(0,0,0)),n=e.objects.filter(t);return n.length?(n.forEach(function(e){return r.expandByObject(e)}),Object.assign.apply(Object,HH(["x","y","z"].map(function(e){return jH({},e,[r.min[e],r.max[e]])})))):null},getScreenCoords:function(e,t,r,n){var i=new QH.Vector3(t,r,n);return i.project(this.camera()),{x:(i.x+1)*e.width/2,y:-(i.y-1)*e.height/2}},getSceneCoords:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new QH.Vector2(t/e.width*2-1,-r/e.height*2+1),o=new QH.Raycaster;return o.setFromCamera(i,e.camera),Object.assign({},o.ray.at(n,new QH.Vector3))},intersectingObjects:function(e,t,r){var n=new QH.Vector2(t/e.width*2-1,-r/e.height*2+1),i=new QH.Raycaster;return i.params.Line.threshold=e.lineHoverPrecision,i.params.Points.threshold=e.pointsHoverPrecision,i.setFromCamera(n,e.camera),i.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new QH.Scene,camera:new QH.PerspectiveCamera,clock:new QH.Clock,tweenGroup:new Ui,lastRaycasterCheck:0}},init:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.controlType,i=void 0===n?"trackball":n,o=r.useWebGPU,s=void 0!==o&&o,a=r.rendererConfig,A=void 0===a?{}:a,l=r.extraRenderers,u=void 0===l?[]:l,c=r.waitForLoadComplete,h=void 0===c||c;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[i]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new VH(t.container),t.pointerPos=new QH.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(e){return t.container.addEventListener(e,function(r){if("pointerdown"===e&&(t.isPointerPressed=!0),!t.isPointerDragging&&"pointermove"===r.type&&(r.pressure>0||t.isPointerPressed)&&("touch"!==r.pointerType||void 0===r.movementX||[r.movementX,r.movementY].some(function(e){return Math.abs(e)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var n=(i=t.container,o=i.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,a=window.pageYOffset||document.documentElement.scrollTop,{top:o.top+a,left:o.left+s});t.pointerPos.x=r.pageX-n.left,t.pointerPos.y=r.pageY-n.top}var i,o,s,a},{passive:!0})}),t.container.addEventListener("pointerup",function(e){t.isPointerPressed&&(t.isPointerPressed=!1,t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag)||requestAnimationFrame(function(){0===e.button&&t.onClick(t.hoverObj||null,e,t.intersection),2===e.button&&t.onRightClick&&t.onRightClick(t.hoverObj||null,e,t.intersection)}))},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(e){t.onRightClick&&e.preventDefault()}),t.renderer=new(s?gI:QH.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},A)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=u,t.extraRenderers.forEach(function(e){e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.pointerEvents="none",t.container.appendChild(e.domElement)}),t.postProcessingComposer=new ij(t.renderer),t.postProcessingComposer.addPass(new oj(t.scene,t.camera)),t.controls=new{trackball:$V,orbit:EG,fly:GG}[i](t.camera,t.renderer.domElement),"fly"===i&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),"trackball"!==i&&"orbit"!==i||(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(HH(t.extraRenderers)).forEach(function(e){return e.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new QH.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!h,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var r,n=e.width,i=e.height;e.container.style.width="".concat(n,"px"),e.container.style.height="".concat(i,"px"),[e.renderer,e.postProcessingComposer].concat(HH(e.extraRenderers)).forEach(function(e){return e.setSize(n,i)}),e.camera.aspect=n/i;var o=e.viewOffset.slice(0,2);o.some(function(e){return e})&&(r=e.camera).setViewOffset.apply(r,[n,i].concat(HH(o),[n,i])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var s,a=e.width,A=e.height,l=e.viewOffset.slice(0,2);l.some(function(e){return e})?(s=e.camera).setViewOffset.apply(s,[a,A].concat(HH(l),[a,A])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=2.5*e.skyRadius,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new QH.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var u=wj(e.backgroundColor).alpha;void 0===u&&(u=1),e.renderer.setClearColor(new QH.Color(Fj(1,e.backgroundColor)),u)}function c(){e.loadComplete=e.scene.visible=!0}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?(new QH.TextureLoader).load(e.backgroundImageUrl,function(t){t.colorSpace=QH.SRGBColorSpace,e.skysphere.material=new QH.MeshBasicMaterial({map:t,side:QH.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&c()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&c())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(t){return e.scene.remove(t)}),e.lights.forEach(function(t){return e.scene.add(t)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(t){return e.scene.remove(t)}),e.objects.forEach(function(t){return e.scene.add(t)}))}});function YH(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function XH(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ZH(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?KH(Object(r),!0).forEach(function(t){XH(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KH(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function JH(e){return function(e){if(Array.isArray(e))return YH(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return YH(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?YH(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eW(e,t){var r=new t;return r._destructor&&r._destructor(),{linkProp:function(t){return{default:r[t](),onChange:function(r,n){n[e][t](r)},triggerUpdate:!1}},linkMethod:function(t){return function(r){for(var n=r[e],i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];var a=n[t].apply(n,o);return a===n?this:a}}}}!function(e,t){void 0===t&&(t={});var r=t.insertAt;if("undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".scene-container .clickable {\n  cursor: pointer;\n}");var tW=["rendererConfig","waitForGlobeReady"],rW=ZH(ZH({},window.THREE?window.THREE:{AmbientLight:j,DirectionalLight:U,Vector2:n,REVISION:Ce}),{},{CSS2DRenderer:class{constructor(e={}){const t=this;let r,n,i,o;const s={objects:new WeakMap},a=void 0!==e.element?e.element:document.createElement("div");function A(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,r=e.children.length;t<r;t++)A(e.children[t])}function l(e,r,n){if(!1!==e.visible){if(e.isCSS2DObject){ii.setFromMatrixPosition(e.matrixWorld),ii.applyMatrix4(si);const A=ii.z>=-1&&ii.z<=1&&!0===e.layers.test(n.layers),l=e.element;l.style.display=!0===A?"":"none",!0===A&&(e.onBeforeRender(t,r,n),l.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(ii.x*i+i)+"px,"+(-ii.y*o+o)+"px)",l.parentNode!==a&&a.appendChild(l),e.onAfterRender(t,r,n));const c={distanceToCameraSquared:u(n,e)};s.objects.set(e,c)}for(let t=0,i=e.children.length;t<i;t++)l(e.children[t],r,n)}else A(e)}function u(e,t){return ai.setFromMatrixPosition(e.matrixWorld),Ai.setFromMatrixPosition(t.matrixWorld),ai.distanceToSquared(Ai)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:r,height:n}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),oi.copy(t.matrixWorldInverse),si.multiplyMatrices(t.projectionMatrix,oi),l(e,e,t),function(e){const t=function(e){const t=[];return e.traverseVisible(function(e){e.isCSS2DObject&&t.push(e)}),t}(e).sort(function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return s.objects.get(e).distanceToCameraSquared-s.objects.get(t).distanceToCameraSquared}),r=t.length;for(let n=0,i=t.length;n<i;n++)t[n].element.style.zIndex=r-n}(e)},this.setSize=function(e,t){r=e,n=t,i=r/2,o=n/2,a.style.width=e+"px",a.style.height=t+"px"}}}}),nW=eW("globe",MV),iW=Object.assign.apply(Object,JH(["globeImageUrl","bumpImageUrl","globeTileEngineUrl","globeTileEngineMaxLevel","showGlobe","showGraticules","showAtmosphere","atmosphereColor","atmosphereAltitude","onGlobeReady","pointsData","pointLat","pointLng","pointColor","pointAltitude","pointRadius","pointResolution","pointsMerge","pointsTransitionDuration","arcsData","arcStartLat","arcStartLng","arcEndLat","arcEndLng","arcColor","arcAltitude","arcAltitudeAutoScale","arcStroke","arcCurveResolution","arcCircularResolution","arcDashLength","arcDashGap","arcDashInitialGap","arcDashAnimateTime","arcsTransitionDuration","polygonsData","polygonGeoJsonGeometry","polygonCapColor","polygonCapMaterial","polygonSideColor","polygonSideMaterial","polygonStrokeColor","polygonAltitude","polygonCapCurvatureResolution","polygonsTransitionDuration","pathsData","pathPoints","pathPointLat","pathPointLng","pathPointAlt","pathResolution","pathColor","pathStroke","pathDashLength","pathDashGap","pathDashInitialGap","pathDashAnimateTime","pathTransitionDuration","heatmapsData","heatmapPoints","heatmapPointLat","heatmapPointLng","heatmapPointWeight","heatmapBandwidth","heatmapColorFn","heatmapColorSaturation","heatmapBaseAltitude","heatmapTopAltitude","heatmapsTransitionDuration","hexBinPointsData","hexBinPointLat","hexBinPointLng","hexBinPointWeight","hexBinResolution","hexMargin","hexTopCurvatureResolution","hexTopColor","hexSideColor","hexAltitude","hexBinMerge","hexTransitionDuration","hexPolygonsData","hexPolygonGeoJsonGeometry","hexPolygonColor","hexPolygonAltitude","hexPolygonResolution","hexPolygonMargin","hexPolygonUseDots","hexPolygonCurvatureResolution","hexPolygonDotResolution","hexPolygonsTransitionDuration","tilesData","tileLat","tileLng","tileAltitude","tileWidth","tileHeight","tileUseGlobeProjection","tileMaterial","tileCurvatureResolution","tilesTransitionDuration","particlesData","particlesList","particleLat","particleLng","particleAltitude","particlesSize","particlesSizeAttenuation","particlesColor","particlesTexture","ringsData","ringLat","ringLng","ringAltitude","ringColor","ringResolution","ringMaxRadius","ringPropagationSpeed","ringRepeatPeriod","labelsData","labelLat","labelLng","labelAltitude","labelRotation","labelText","labelSize","labelTypeFace","labelColor","labelResolution","labelIncludeDot","labelDotRadius","labelDotOrientation","labelsTransitionDuration","htmlElementsData","htmlLat","htmlLng","htmlAltitude","htmlElement","htmlElementVisibilityModifier","htmlTransitionDuration","objectsData","objectLat","objectLng","objectAltitude","objectRotation","objectFacesSurface","objectThreeObject","customLayerData","customThreeObject","customThreeObjectUpdate"].map(function(e){return XH({},e,nW.linkProp(e))}))),oW=Object.assign.apply(Object,JH(["globeMaterial","getGlobeRadius","getCoords","toGeoCoords"].map(function(e){return XH({},e,nW.linkMethod(e))}))),sW=eW("renderObjs",$H),aW=Object.assign.apply(Object,JH(["width","height","backgroundColor","backgroundImageUrl","enablePointerInteraction"].map(function(e){return XH({},e,sW.linkProp(e))}))),AW=Object.assign.apply(Object,JH(["lights","postProcessingComposer"].map(function(e){return XH({},e,sW.linkMethod(e))}))),lW=ki({props:ZH(ZH({onZoom:{triggerUpdate:!1},onGlobeClick:{triggerUpdate:!1},onGlobeRightClick:{triggerUpdate:!1},pointLabel:{default:"name",triggerUpdate:!1},onPointClick:{triggerUpdate:!1},onPointRightClick:{triggerUpdate:!1},onPointHover:{triggerUpdate:!1},arcLabel:{default:"name",triggerUpdate:!1},onArcClick:{triggerUpdate:!1},onArcRightClick:{triggerUpdate:!1},onArcHover:{triggerUpdate:!1},polygonLabel:{default:"name",triggerUpdate:!1},onPolygonClick:{triggerUpdate:!1},onPolygonRightClick:{triggerUpdate:!1},onPolygonHover:{triggerUpdate:!1},pathLabel:{default:"name",triggerUpdate:!1},onPathClick:{triggerUpdate:!1},onPathRightClick:{triggerUpdate:!1},onPathHover:{triggerUpdate:!1},onHeatmapClick:{triggerUpdate:!1},onHeatmapRightClick:{triggerUpdate:!1},onHeatmapHover:{triggerUpdate:!1},hexLabel:{triggerUpdate:!1},onHexClick:{triggerUpdate:!1},onHexRightClick:{triggerUpdate:!1},onHexHover:{triggerUpdate:!1},hexPolygonLabel:{triggerUpdate:!1},onHexPolygonClick:{triggerUpdate:!1},onHexPolygonRightClick:{triggerUpdate:!1},onHexPolygonHover:{triggerUpdate:!1},tileLabel:{default:"name",triggerUpdate:!1},onTileClick:{triggerUpdate:!1},onTileRightClick:{triggerUpdate:!1},onTileHover:{triggerUpdate:!1},particleLabel:{default:"name",triggerUpdate:!1},onParticleClick:{triggerUpdate:!1},onParticleRightClick:{triggerUpdate:!1},onParticleHover:{triggerUpdate:!1},labelLabel:{triggerUpdate:!1},onLabelClick:{triggerUpdate:!1},onLabelRightClick:{triggerUpdate:!1},onLabelHover:{triggerUpdate:!1},objectLabel:{default:"name",triggerUpdate:!1},onObjectClick:{triggerUpdate:!1},onObjectRightClick:{triggerUpdate:!1},onObjectHover:{triggerUpdate:!1},customLayerLabel:{default:"name",triggerUpdate:!1},onCustomLayerClick:{triggerUpdate:!1},onCustomLayerRightClick:{triggerUpdate:!1},onCustomLayerHover:{triggerUpdate:!1},pointerEventsFilter:{default:function(){return!0},triggerUpdate:!1},lineHoverPrecision:{default:.2,triggerUpdate:!1,onChange:function(e,t){t.renderObjs.lineHoverPrecision(e),t.renderObjs.pointsHoverPrecision(e)}},globeOffset:{default:[0,0],triggerUpdate:!1,onChange:function(e,t){return Array.isArray(e)&&2===e.length&&t.renderObjs.viewOffset(e.map(function(e){return-e}))}}},iW),aW),methods:ZH(ZH({pauseAnimation:function(e){var t;return null!==e.animationFrameRequestId&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),null===(t=e.globe)||void 0===t||t.pauseAnimation(),this},resumeAnimation:function(e){var t;return null===e.animationFrameRequestId&&this._animationCycle(),null===(t=e.globe)||void 0===t||t.resumeAnimation(),this},_animationCycle:function(e){e.renderObjs.tick(),e.tweenGroup.update(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},pointOfView:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e.globe.toGeoCoords(e.renderObjs.cameraPosition());if(void 0===t.lat&&void 0===t.lng&&void 0===t.altitude)return n;var i=Object.assign({},n,t);if(["lat","lng","altitude"].forEach(function(e){return i[e]=+i[e]}),r){for(;n.lng-i.lng>180;)n.lng-=360;for(;n.lng-i.lng<-180;)n.lng+=360;e.tweenGroup.add(new zi(n).to(i,r).easing(Ii.Cubic.InOut).onUpdate(o).start())}else o(i);return this;function o(t){var r=t.lat,n=t.lng,i=t.altitude;e.renderObjs.cameraPosition(e.globe.getCoords(r,n,i)),e.globe.setPointOfView(e.renderObjs.camera())}},getScreenCoords:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var o=(t=e.globe).getCoords.apply(t,n);return e.renderObjs.getScreenCoords(o.x,o.y,o.z)},toGlobeCoords:function(e,t,r){var n=e.renderObjs.intersectingObjects(t,r).find(function(e){return"globe"===(e.object.__globeObjType||e.object.parent.__globeObjType)});if(!n)return null;var i=e.globe.toGeoCoords(n.point);return{lat:i.lat,lng:i.lng}},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},_destructor:function(e){e.globe._destructor(),this.pauseAnimation(),this.pointsData([]),this.arcsData([]),this.polygonsData([]),this.pathsData([]),this.heatmapsData([]),this.hexBinPointsData([]),this.hexPolygonsData([]),this.tilesData([]),this.particlesData([]),this.labelsData([]),this.htmlElementsData([]),this.objectsData([]),this.customLayerData([])}},oW),AW),stateInit:function(e){var t=e.rendererConfig,r=e.waitForGlobeReady,n=void 0===r||r,i=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,tW),o=new MV(ZH({waitForGlobeReady:n},i));return{globe:o,renderObjs:$H({controlType:"orbit",rendererConfig:t,waitForLoadComplete:n,extraRenderers:[new rW.CSS2DRenderer]}).skyRadius(500*o.getGlobeRadius()).showNavInfo(!1).objects([o]).lights([new rW.AmbientLight(13421772,Math.PI),new rW.DirectionalLight(16777215,.6*Math.PI)]),tweenGroup:new Ui}},init:function(e,t){var r=this;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var n=document.createElement("div");t.container.appendChild(n),t.renderObjs(n),t.globe.rendererSize(t.renderObjs.renderer().getSize(new rW.Vector2)),this.pointOfView({altitude:2.5});var i=t.globe.getGlobeRadius(),o=t.renderObjs.controls();t.renderObjs.camera().near=.05,o.minDistance=i+Math.max(.001,1.1*t.renderObjs.camera().near),o.maxDistance=100*i,o.enablePan=!1,o.enableDamping=!0,o.dampingFactor=.1,o.rotateSpeed=.3,o.zoomSpeed=.3,o.zoomToCursor=!0,o.addEventListener("change",function(){o.target.setScalar(0);var e=r.pointOfView();o.rotateSpeed=.3*e.altitude,o.zoomSpeed=.5*Math.sqrt(e.altitude),t.globe.setPointOfView(t.renderObjs.camera()),t.onZoom&&t.onZoom(e)});var s=function(e){for(var t=e;t&&!t.hasOwnProperty("__globeObjType");)t=t.parent;return t},a={point:function(e){return e},arc:function(e){return e},polygon:function(e){return e.data},path:function(e){return e},heatmap:function(e){return e},hexbin:function(e){return e},hexPolygon:function(e){return e},tile:function(e){return e},particles:function(e,t){return!t||!t.hasOwnProperty("index")||e.length<=t.index?e:e[t.index]},label:function(e){return e},object:function(e){return e},custom:function(e){return e}};rW.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverFilter(function(e){var r=s(e);if(!r)return!1;var n=r.__globeObjType;if("globe"!==n&&!a.hasOwnProperty(n))return!1;var i=a.hasOwnProperty(n)&&r.__data?a[n](r.__data):null;return(!["points","hexBinPoints"].some(function(e){return e===n})||!Array.isArray(i))&&t.pointerEventsFilter(r,i)}).tooltipContent(function(e,r){var n={point:t.pointLabel,arc:t.arcLabel,polygon:t.polygonLabel,path:t.pathLabel,hexbin:t.hexLabel,hexPolygon:t.hexPolygonLabel,tile:t.tileLabel,particles:t.particleLabel,label:t.labelLabel,object:t.objectLabel,custom:t.customLayerLabel},i=s(e),o=i&&i.__globeObjType;return i&&o&&n.hasOwnProperty(o)&&a.hasOwnProperty(o)&&fc(n[o])(a[o](i.__data,r))||""}).onHover(function(e,r,n){var i={point:t.onPointHover,arc:t.onArcHover,polygon:t.onPolygonHover,path:t.onPathHover,heatmap:t.onHeatmapHover,hexbin:t.onHexHover,hexPolygon:t.onHexPolygonHover,tile:t.onTileHover,particles:t.onParticleHover,label:t.onLabelHover,object:t.onObjectHover,custom:t.onCustomLayerHover},o={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},A=s(e);if(A&&!i.hasOwnProperty(A.__globeObjType)&&(A=null),A!==t.hoverObj){var l=t.hoverObj?t.hoverObj.__globeObjType:null,u=t.hoverData,c=A?A.__globeObjType:null,h=A?a[c](A.__data,n):null;l&&l!==c&&i[l]&&i[l](null,u||null),c&&i[c]&&i[c](h,l===c?u:null),t.renderObjs.renderer().domElement.classList[c&&o[c]?"add":"remove"]("clickable"),t.hoverObj=A,t.hoverData=h}}).onClick(function(e,n,i){if(e){var o={globe:t.onGlobeClick,point:t.onPointClick,arc:t.onArcClick,polygon:t.onPolygonClick,path:t.onPathClick,heatmap:t.onHeatmapClick,hexbin:t.onHexClick,hexPolygon:t.onHexPolygonClick,tile:t.onTileClick,particles:t.onParticleClick,label:t.onLabelClick,object:t.onObjectClick,custom:t.onCustomLayerClick},A=s(e),l=A.__globeObjType;if(A&&o.hasOwnProperty(l)&&o[l]){var u=[n],c=null!=i&&i.isVector3?i:null==i?void 0:i.point;if("globe"===l){var h=r.toGeoCoords(c),d=h.lat,p=h.lng;u.unshift({lat:d,lng:p})}else u.push(r.toGeoCoords(c));a.hasOwnProperty(l)&&u.unshift(a[l](A.__data,i)),o[l].apply(o,u)}}}).onRightClick(function(e,n,i){if(e){var o={globe:t.onGlobeRightClick,point:t.onPointRightClick,arc:t.onArcRightClick,polygon:t.onPolygonRightClick,path:t.onPathRightClick,heatmap:t.onHeatmapRightClick,hexbin:t.onHexRightClick,hexPolygon:t.onHexPolygonRightClick,tile:t.onTileRightClick,particles:t.onParticleRightClick,label:t.onLabelRightClick,object:t.onObjectRightClick,custom:t.onCustomLayerRightClick},A=s(e),l=A.__globeObjType;if(A&&o.hasOwnProperty(l)&&o[l]){var u=[n],c=null!=i&&i.isVector3?i:null==i?void 0:i.point;if("globe"===l){var h=r.toGeoCoords(c),d=h.lat,p=h.lng;u.unshift({lat:d,lng:p})}else u.push(r.toGeoCoords(c));a.hasOwnProperty(l)&&u.unshift(a[l](A.__data,i)),o[l].apply(o,u)}}}),this._animationCycle()}}),uW={width:Qn.number,height:Qn.number,globeOffset:Qn.arrayOf(Qn.number),backgroundColor:Qn.string,backgroundImageUrl:Qn.string,globeImageUrl:Qn.string,bumpImageUrl:Qn.string,globeTileEngineUrl:Qn.func,showGlobe:Qn.bool,showGraticules:Qn.bool,showAtmosphere:Qn.bool,atmosphereColor:Qn.string,atmosphereAltitude:Qn.number,globeMaterial:Qn.object,onGlobeReady:Qn.func,onGlobeClick:Qn.func,onGlobeRightClick:Qn.func,pointsData:Qn.arrayOf(Qn.object),pointLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pointLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pointColor:Qn.oneOfType([Qn.string,Qn.func]),pointAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pointRadius:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pointResolution:Qn.number,pointsMerge:Qn.bool,pointsTransitionDuration:Qn.number,pointLabel:Qn.oneOfType([Qn.string,Qn.func]),onPointClick:Qn.func,onPointRightClick:Qn.func,onPointHover:Qn.func,arcsData:Qn.arrayOf(Qn.object),arcStartLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcStartLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcEndLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcEndLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcColor:Qn.oneOfType([Qn.string,Qn.arrayOf(Qn.string),Qn.func]),arcAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcAltitudeAutoScale:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcStroke:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcCurveResolution:Qn.number,arcCircularResolution:Qn.number,arcDashLength:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcDashGap:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcDashInitialGap:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcDashAnimateTime:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),arcsTransitionDuration:Qn.number,arcLabel:Qn.oneOfType([Qn.string,Qn.func]),onArcClick:Qn.func,onArcRightClick:Qn.func,onArcHover:Qn.func,polygonsData:Qn.arrayOf(Qn.object),polygonGeoJsonGeometry:Qn.oneOfType([Qn.string,Qn.func]),polygonCapColor:Qn.oneOfType([Qn.string,Qn.func]),polygonCapMaterial:Qn.oneOfType([Qn.object,Qn.string,Qn.func]),polygonSideColor:Qn.oneOfType([Qn.string,Qn.func]),polygonSideMaterial:Qn.oneOfType([Qn.object,Qn.string,Qn.func]),polygonStrokeColor:Qn.oneOfType([Qn.string,Qn.func]),polygonAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),polygonCapCurvatureResolution:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),polygonsTransitionDuration:Qn.number,polygonLabel:Qn.oneOfType([Qn.string,Qn.func]),onPolygonClick:Qn.func,onPolygonRightClick:Qn.func,onPolygonHover:Qn.func,pathsData:Qn.array,pathPoints:Qn.oneOfType([Qn.array,Qn.string,Qn.func]),pathPointLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathPointLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathPointAlt:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathResolution:Qn.number,pathColor:Qn.oneOfType([Qn.string,Qn.arrayOf(Qn.string),Qn.func]),pathStroke:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathDashLength:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathDashGap:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathDashInitialGap:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathDashAnimateTime:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),pathTransitionDuration:Qn.number,pathLabel:Qn.oneOfType([Qn.string,Qn.func]),onPathClick:Qn.func,onPathRightClick:Qn.func,onPathHover:Qn.func,heatmapsData:Qn.array,heatmapPoints:Qn.oneOfType([Qn.array,Qn.string,Qn.func]),heatmapPointLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),heatmapPointLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),heatmapPointWeight:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),heatmapBandwidth:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),heatmapColorFn:Qn.oneOfType([Qn.string,Qn.func]),heatmapColorSaturation:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),heatmapBaseAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),heatmapTopAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),heatmapsTransitionDuration:Qn.number,onHeatmapClick:Qn.func,onHeatmapRightClick:Qn.func,onHeatmapHover:Qn.func,hexBinPointsData:Qn.arrayOf(Qn.object),hexBinPointLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexBinPointLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexBinPointWeight:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexBinResolution:Qn.number,hexMargin:Qn.oneOfType([Qn.number,Qn.func]),hexTopColor:Qn.func,hexSideColor:Qn.func,hexAltitude:Qn.oneOfType([Qn.number,Qn.func]),hexTopCurvatureResolution:Qn.number,hexBinMerge:Qn.bool,hexTransitionDuration:Qn.number,hexLabel:Qn.oneOfType([Qn.string,Qn.func]),onHexClick:Qn.func,onHexRightClick:Qn.func,onHexHover:Qn.func,hexPolygonsData:Qn.arrayOf(Qn.object),hexPolygonGeoJsonGeometry:Qn.oneOfType([Qn.string,Qn.func]),hexPolygonColor:Qn.oneOfType([Qn.string,Qn.func]),hexPolygonAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexPolygonResolution:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexPolygonMargin:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexPolygonUseDots:Qn.oneOfType([Qn.bool,Qn.string,Qn.func]),hexPolygonCurvatureResolution:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexPolygonDotResolution:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),hexPolygonsTransitionDuration:Qn.number,hexPolygonLabel:Qn.oneOfType([Qn.string,Qn.func]),onHexPolygonClick:Qn.func,onHexPolygonRightClick:Qn.func,onHexPolygonHover:Qn.func,tilesData:Qn.arrayOf(Qn.object),tileLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),tileLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),tileAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),tileWidth:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),tileHeight:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),tileUseGlobeProjection:Qn.oneOfType([Qn.bool,Qn.string,Qn.func]),tileMaterial:Qn.oneOfType([Qn.object,Qn.string,Qn.func]),tileCurvatureResolution:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),tilesTransitionDuration:Qn.number,tileLabel:Qn.oneOfType([Qn.string,Qn.func]),onTileClick:Qn.func,onTileRightClick:Qn.func,onTileHover:Qn.func,particlesData:Qn.arrayOf(Qn.object),particlesList:Qn.oneOfType([Qn.string,Qn.func]),particleLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),particleLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),particleAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),particlesSize:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),particlesSizeAttenuation:Qn.oneOfType([Qn.bool,Qn.string,Qn.func]),particlesColor:Qn.oneOfType([Qn.string,Qn.func]),particlesTexture:Qn.oneOfType([Qn.string,Qn.func]),particleLabel:Qn.oneOfType([Qn.string,Qn.func]),onParticleClick:Qn.func,onParticleRightClick:Qn.func,onParticleHover:Qn.func,ringsData:Qn.arrayOf(Qn.object),ringLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),ringLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),ringAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),ringColor:Qn.oneOfType([Qn.string,Qn.arrayOf(Qn.string),Qn.func]),ringResolution:Qn.number,ringMaxRadius:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),ringPropagationSpeed:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),ringRepeatPeriod:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),labelsData:Qn.arrayOf(Qn.object),labelLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),labelLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),labelAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),labelRotation:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),labelText:Qn.oneOfType([Qn.string,Qn.func]),labelSize:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),labelTypeFace:Qn.object,labelColor:Qn.oneOfType([Qn.string,Qn.func]),labelResolution:Qn.number,labelIncludeDot:Qn.oneOfType([Qn.bool,Qn.string,Qn.func]),labelDotRadius:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),labelDotOrientation:Qn.oneOfType([Qn.string,Qn.func]),labelsTransitionDuration:Qn.number,labelLabel:Qn.oneOfType([Qn.string,Qn.func]),onLabelClick:Qn.func,onLabelRightClick:Qn.func,onLabelHover:Qn.func,htmlElementsData:Qn.arrayOf(Qn.object),htmlLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),htmlLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),htmlAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),htmlElement:Qn.oneOfType([Qn.string,Qn.func]),htmlElementVisibilityModifier:Qn.func,htmlTransitionDuration:Qn.number,objectsData:Qn.arrayOf(Qn.object),objectLat:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),objectLng:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),objectAltitude:Qn.oneOfType([Qn.number,Qn.string,Qn.func]),objectRotation:Qn.oneOfType([Qn.shape({x:Qn.number,y:Qn.number,z:Qn.number}),Qn.string,Qn.func]),objectFacesSurface:Qn.oneOfType([Qn.bool,Qn.string,Qn.func]),objectThreeObject:Qn.oneOfType([Qn.object,Qn.string,Qn.func]),objectLabel:Qn.oneOfType([Qn.string,Qn.func]),onObjectClick:Qn.func,onObjectRightClick:Qn.func,onObjectHover:Qn.func,customLayerData:Qn.arrayOf(Qn.object),customThreeObject:Qn.oneOfType([Qn.object,Qn.string,Qn.func]),customThreeObjectUpdate:Qn.oneOfType([Qn.string,Qn.func]),customLayerLabel:Qn.oneOfType([Qn.string,Qn.func]),onCustomLayerClick:Qn.func,onCustomLayerRightClick:Qn.func,onCustomLayerHover:Qn.func,enablePointerInteraction:Qn.bool,pointerEventsFilter:Qn.func,lineHoverPrecision:Qn.number,onZoom:Qn.func},cW=function(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.wrapperElementType,o=void 0===i?"div":i,s=n.nodeMapper,a=void 0===s?function(e){return e}:s,A=n.methodNames,l=void 0===A?[]:A,u=n.initPropNames,c=void 0===u?[]:u;return e.forwardRef(function(n,i){var s=e.useRef(),A=e.useMemo(function(){var e=Object.fromEntries(c.filter(function(e){return n.hasOwnProperty(e)}).map(function(e){return[e,n[e]]}));return r(e)},[]);ni(function(){A(a(s.current))},e.useLayoutEffect),ni(function(){return A._destructor instanceof Function?A._destructor:void 0});var u,h,d,p=e.useCallback(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return A[e]instanceof Function?A[e].apply(A,r):void 0},[A]),f=e.useRef({});return Object.keys((u=n,h=[].concat(ti(l),ti(c)),d=new Set(h),Object.assign.apply(Object,[{}].concat(Xn(Object.entries(u).filter(function(e){var t=Yn(e,1)[0];return!d.has(t)}).map(function(e){var t=Yn(e,2);return $n({},t[0],t[1])})))))).filter(function(e){return f.current[e]!==n[e]}).forEach(function(e){return p(e,n[e])}),f.current=n,e.useImperativeHandle(i,function(){return Object.fromEntries(l.map(function(e){return[e,function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return p.apply(void 0,[e].concat(r))}]}))},[p]),t.createElement(o,{ref:s})})}(lW,{methodNames:["pauseAnimation","resumeAnimation","pointOfView","lights","scene","camera","renderer","postProcessingComposer","controls","getGlobeRadius","getCoords","getScreenCoords","toGeoCoords","toGlobeCoords"],initPropNames:["animateIn","waitForGlobeReady","rendererConfig"]});cW.displayName="Globe",cW.propTypes=uW;export{cW as default};
